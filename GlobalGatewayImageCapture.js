/*! For license information please see GlobalGatewayImageCapture.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(self,(function(){return function(){var __webpack_modules__={757:function(e,t,n){e.exports=n(666)},8:function(e,t){!function(){"use strict";var n={};function r(e){return f(">"+h("B",e.length),e)}function o(e){return f(">"+h("H",e.length),e)}function a(e){return f(">"+h("L",e.length),e)}function i(e,t,n){var i,s,u,c,l="",p="";if("Byte"==t)(i=e.length)<=4?p=r(e)+h("\0",4-i):(p=f(">L",[n]),l=r(e));else if("Short"==t)(i=e.length)<=2?p=o(e)+h("\0\0",2-i):(p=f(">L",[n]),l=o(e));else if("Long"==t)(i=e.length)<=1?p=a(e):(p=f(">L",[n]),l=a(e));else if("Ascii"==t)(i=(s=e+"\0").length)>4?(p=f(">L",[n]),l=s):p=s+h("\0",4-i);else if("Rational"==t){if("number"==typeof e[0])i=1,u=e[0],c=e[1],s=f(">L",[u])+f(">L",[c]);else{i=e.length,s="";for(var d=0;d<i;d++)u=e[d][0],c=e[d][1],s+=f(">L",[u])+f(">L",[c])}p=f(">L",[n]),l=s}else if("SRational"==t){if("number"==typeof e[0])i=1,u=e[0],c=e[1],s=f(">l",[u])+f(">l",[c]);else for(i=e.length,s="",d=0;d<i;d++)u=e[d][0],c=e[d][1],s+=f(">l",[u])+f(">l",[c]);p=f(">L",[n]),l=s}else"Undefined"==t&&((i=e.length)>4?(p=f(">L",[n]),l=e):p=e+h("\0",4-i));return[f(">L",[i]),p,l]}function s(e,t,n){var r,o=Object.keys(e).length,a=f(">H",[o]);r=["0th","1st"].indexOf(t)>-1?2+12*o+4:2+12*o;var s="",u="";for(var c in e)if("string"==typeof c&&(c=parseInt(c)),!("0th"==t&&[34665,34853].indexOf(c)>-1||"Exif"==t&&40965==c||"1st"==t&&[513,514].indexOf(c)>-1)){var l=e[c],p=f(">H",[c]),h=m[t][c].type,d=f(">H",[v[h]]);"number"==typeof l&&(l=[l]);var g=i(l,h,8+r+n+u.length);s+=p+d+g[0]+g[1],u+=g[2]}return[a+s,u]}function u(e){var t;if("ÿØ"==e.slice(0,2))t=function(e){for(var t,n=0;n<e.length;n++)if("ÿá"==(t=e[n]).slice(0,2)&&"Exif\0\0"==t.slice(4,10))return t;return null}(d(e)),this.tiftag=t?t.slice(10):null;else if(["II","MM"].indexOf(e.slice(0,2))>-1)this.tiftag=e;else{if("Exif"!=e.slice(0,4))throw new Error("Given file is neither JPEG nor TIFF.");this.tiftag=e.slice(6)}}if(n.version="1.0.4",n.remove=function(e){var t=!1;if("ÿØ"==e.slice(0,2));else{if("data:image/jpeg;base64,"!=e.slice(0,23)&&"data:image/jpg;base64,"!=e.slice(0,22))throw new Error("Given data is not jpeg.");e=l(e.split(",")[1]),t=!0}var n=d(e).filter((function(e){return!("ÿá"==e.slice(0,2)&&"Exif\0\0"==e.slice(4,10))})).join("");return t&&(n="data:image/jpeg;base64,"+c(n)),n},n.insert=function(e,t){var n=!1;if("Exif\0\0"!=e.slice(0,6))throw new Error("Given data is not exif.");if("ÿØ"==t.slice(0,2));else{if("data:image/jpeg;base64,"!=t.slice(0,23)&&"data:image/jpg;base64,"!=t.slice(0,22))throw new Error("Given data is not jpeg.");t=l(t.split(",")[1]),n=!0}var r="ÿá"+f(">H",[e.length+2])+e,o=function(e,t){var n=!1,r=[];return e.forEach((function(o,a){"ÿá"==o.slice(0,2)&&"Exif\0\0"==o.slice(4,10)&&(n?r.unshift(a):(e[a]=t,n=!0))})),r.forEach((function(t){e.splice(t,1)})),!n&&t&&(e=[e[0],t].concat(e.slice(1))),e.join("")}(d(t),r);return n&&(o="data:image/jpeg;base64,"+c(o)),o},n.load=function(e){var t;if("string"!=typeof e)throw new Error("'load' gots invalid type argument.");if("ÿØ"==e.slice(0,2))t=e;else if("data:image/jpeg;base64,"==e.slice(0,23)||"data:image/jpg;base64,"==e.slice(0,22))t=l(e.split(",")[1]);else{if("Exif"!=e.slice(0,4))throw new Error("'load' gots invalid file data.");t=e.slice(6)}var n={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},r=new u(t);if(null===r.tiftag)return n;"II"==r.tiftag.slice(0,2)?r.endian_mark="<":r.endian_mark=">";var o=p(r.endian_mark+"L",r.tiftag.slice(4,8))[0];n["0th"]=r.get_ifd(o,"0th");var a=n["0th"].first_ifd_pointer;if(delete n["0th"].first_ifd_pointer,34665 in n["0th"]&&(o=n["0th"][34665],n.Exif=r.get_ifd(o,"Exif")),34853 in n["0th"]&&(o=n["0th"][34853],n.GPS=r.get_ifd(o,"GPS")),40965 in n.Exif&&(o=n.Exif[40965],n.Interop=r.get_ifd(o,"Interop")),"\0\0\0\0"!=a&&(o=p(r.endian_mark+"L",a)[0],n["1st"]=r.get_ifd(o,"1st"),513 in n["1st"]&&514 in n["1st"])){var i=n["1st"][513]+n["1st"][514],s=r.tiftag.slice(n["1st"][513],i);n.thumbnail=s}return n},n.dump=function(e){var t,r,o,a,i,u,c=(t=e,JSON.parse(JSON.stringify(t))),l=!1,p=!1,h=!1,m=!1;r="0th"in c?c["0th"]:{},"Exif"in c&&Object.keys(c.Exif).length||"Interop"in c&&Object.keys(c.Interop).length?(r[34665]=1,l=!0,o=c.Exif,"Interop"in c&&Object.keys(c.Interop).length?(o[40965]=1,h=!0,a=c.Interop):Object.keys(o).indexOf(n.ExifIFD.InteroperabilityTag.toString())>-1&&delete o[40965]):Object.keys(r).indexOf(n.ImageIFD.ExifTag.toString())>-1&&delete r[34665],"GPS"in c&&Object.keys(c.GPS).length?(r[n.ImageIFD.GPSTag]=1,p=!0,i=c.GPS):Object.keys(r).indexOf(n.ImageIFD.GPSTag.toString())>-1&&delete r[n.ImageIFD.GPSTag],"1st"in c&&"thumbnail"in c&&null!=c.thumbnail&&(m=!0,c["1st"][513]=1,c["1st"][514]=1,u=c["1st"]);var g,y,b,x=s(r,"0th",0),w=x[0].length+12*l+12*p+4+x[1].length,E="",A=0,C="",S=0,_="",I=0,R="";if(l&&(A=(g=s(o,"Exif",w))[0].length+12*h+g[1].length),p&&(S=(C=s(i,"GPS",w+A).join("")).length),h&&(I=(_=s(a,"Interop",w+A+S).join("")).length),m&&(y=s(u,"1st",w+A+S+I),(b=function(e){for(var t=d(e);"ÿà"<=t[1].slice(0,2)&&t[1].slice(0,2)<="ÿï";)t=[t[0]].concat(t.slice(2));return t.join("")}(c.thumbnail)).length>64e3))throw new Error("Given thumbnail is too large. max 64kB");var T="",P="",N="",O="\0\0\0\0";if(l){var D=f(">L",[k=8+w]);T=f(">H",[34665])+f(">H",[v.Long])+f(">L",[1])+D}if(p&&(D=f(">L",[k=8+w+A]),P=f(">H",[34853])+f(">H",[v.Long])+f(">L",[1])+D),h&&(D=f(">L",[k=8+w+A+S]),N=f(">H",[40965])+f(">H",[v.Long])+f(">L",[1])+D),m){var k;O=f(">L",[k=8+w+A+S+I]);var F="\0\0\0\0"+f(">L",[k+y[0].length+24+4+y[1].length]),M="\0\0\0\0"+f(">L",[b.length]);R=y[0]+F+M+"\0\0\0\0"+y[1]+b}var L=x[0]+T+P+O+x[1];return l&&(E=g[0]+N+g[1]),"Exif\0\0MM\0*\0\0\0\b"+L+E+C+_+R},u.prototype={get_ifd:function(e,t){var n,r={},o=p(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],a=e+2;n=["0th","1st"].indexOf(t)>-1?"Image":t;for(var i=0;i<o;i++){e=a+12*i;var s=p(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],u=[p(this.endian_mark+"H",this.tiftag.slice(e+2,e+4))[0],p(this.endian_mark+"L",this.tiftag.slice(e+4,e+8))[0],this.tiftag.slice(e+8,e+12)];s in m[n]&&(r[s]=this.convert_value(u))}return"0th"==t&&(e=a+12*o,r.first_ifd_pointer=this.tiftag.slice(e,e+4)),r},convert_value:function(e){var t,n=null,r=e[0],o=e[1],a=e[2];if(1==r)o>4?(t=p(this.endian_mark+"L",a)[0],n=p(this.endian_mark+h("B",o),this.tiftag.slice(t,t+o))):n=p(this.endian_mark+h("B",o),a.slice(0,o));else if(2==r)o>4?(t=p(this.endian_mark+"L",a)[0],n=this.tiftag.slice(t,t+o-1)):n=a.slice(0,o-1);else if(3==r)o>2?(t=p(this.endian_mark+"L",a)[0],n=p(this.endian_mark+h("H",o),this.tiftag.slice(t,t+2*o))):n=p(this.endian_mark+h("H",o),a.slice(0,2*o));else if(4==r)o>1?(t=p(this.endian_mark+"L",a)[0],n=p(this.endian_mark+h("L",o),this.tiftag.slice(t,t+4*o))):n=p(this.endian_mark+h("L",o),a);else if(5==r)if(t=p(this.endian_mark+"L",a)[0],o>1){n=[];for(var i=0;i<o;i++)n.push([p(this.endian_mark+"L",this.tiftag.slice(t+8*i,t+4+8*i))[0],p(this.endian_mark+"L",this.tiftag.slice(t+4+8*i,t+8+8*i))[0]])}else n=[p(this.endian_mark+"L",this.tiftag.slice(t,t+4))[0],p(this.endian_mark+"L",this.tiftag.slice(t+4,t+8))[0]];else if(7==r)o>4?(t=p(this.endian_mark+"L",a)[0],n=this.tiftag.slice(t,t+o)):n=a.slice(0,o);else if(9==r)o>1?(t=p(this.endian_mark+"L",a)[0],n=p(this.endian_mark+h("l",o),this.tiftag.slice(t,t+4*o))):n=p(this.endian_mark+h("l",o),a);else{if(10!=r)throw new Error("Exif might be wrong. Got incorrect value type to decode. type:"+r);if(t=p(this.endian_mark+"L",a)[0],o>1)for(n=[],i=0;i<o;i++)n.push([p(this.endian_mark+"l",this.tiftag.slice(t+8*i,t+4+8*i))[0],p(this.endian_mark+"l",this.tiftag.slice(t+4+8*i,t+8+8*i))[0]]);else n=[p(this.endian_mark+"l",this.tiftag.slice(t,t+4))[0],p(this.endian_mark+"l",this.tiftag.slice(t+4,t+8))[0]]}return n instanceof Array&&1==n.length?n[0]:n}},"undefined"!=typeof window&&"function"==typeof window.btoa)var c=window.btoa;if(void 0===c&&(c=function(e){for(var t,n,r,o,a,i,s,u="",c=0,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c<e.length;)o=(t=e.charCodeAt(c++))>>2,a=(3&t)<<4|(n=e.charCodeAt(c++))>>4,i=(15&n)<<2|(r=e.charCodeAt(c++))>>6,s=63&r,isNaN(n)?i=s=64:isNaN(r)&&(s=64),u=u+l.charAt(o)+l.charAt(a)+l.charAt(i)+l.charAt(s);return u}),"undefined"!=typeof window&&"function"==typeof window.atob)var l=window.atob;function f(e,t){if(!(t instanceof Array))throw new Error("'pack' error. Got invalid type argument.");if(e.length-1!=t.length)throw new Error("'pack' error. "+(e.length-1)+" marks, "+t.length+" elements.");var n;if("<"==e[0])n=!0;else{if(">"!=e[0])throw new Error("");n=!1}for(var r="",o=1,a=null,i=null,s=null;i=e[o];){if("b"==i.toLowerCase()){if(a=t[o-1],"b"==i&&a<0&&(a+=256),a>255||a<0)throw new Error("'pack' error.");s=String.fromCharCode(a)}else if("H"==i){if((a=t[o-1])>65535||a<0)throw new Error("'pack' error.");s=String.fromCharCode(Math.floor(a%65536/256))+String.fromCharCode(a%256),n&&(s=s.split("").reverse().join(""))}else{if("l"!=i.toLowerCase())throw new Error("'pack' error.");if(a=t[o-1],"l"==i&&a<0&&(a+=4294967296),a>4294967295||a<0)throw new Error("'pack' error.");s=String.fromCharCode(Math.floor(a/16777216))+String.fromCharCode(Math.floor(a%16777216/65536))+String.fromCharCode(Math.floor(a%65536/256))+String.fromCharCode(a%256),n&&(s=s.split("").reverse().join(""))}r+=s,o+=1}return r}function p(e,t){if("string"!=typeof t)throw new Error("'unpack' error. Got invalid type argument.");for(var n,r=0,o=1;o<e.length;o++)if("b"==e[o].toLowerCase())r+=1;else if("h"==e[o].toLowerCase())r+=2;else{if("l"!=e[o].toLowerCase())throw new Error("'unpack' error. Got invalid mark.");r+=4}if(r!=t.length)throw new Error("'unpack' error. Mismatch between symbol and string length. "+r+":"+t.length);if("<"==e[0])n=!0;else{if(">"!=e[0])throw new Error("'unpack' error.");n=!1}for(var a=[],i=0,s=1,u=null,c=null,l=null,f="";c=e[s];){if("b"==c.toLowerCase())l=1,u=(f=t.slice(i,i+l)).charCodeAt(0),"b"==c&&u>=128&&(u-=256);else if("H"==c)l=2,f=t.slice(i,i+l),n&&(f=f.split("").reverse().join("")),u=256*f.charCodeAt(0)+f.charCodeAt(1);else{if("l"!=c.toLowerCase())throw new Error("'unpack' error. "+c);l=4,f=t.slice(i,i+l),n&&(f=f.split("").reverse().join("")),u=16777216*f.charCodeAt(0)+65536*f.charCodeAt(1)+256*f.charCodeAt(2)+f.charCodeAt(3),"l"==c&&u>=2147483648&&(u-=4294967296)}a.push(u),i+=l,s+=1}return a}function h(e,t){for(var n="",r=0;r<t;r++)n+=e;return n}function d(e){if("ÿØ"!=e.slice(0,2))throw new Error("Given data isn't JPEG.");for(var t=2,n=["ÿØ"];;){if("ÿÚ"==e.slice(t,t+2)){n.push(e.slice(t));break}var r=t+p(">H",e.slice(t+2,t+4))[0]+2;if(n.push(e.slice(t,r)),(t=r)>=e.length)throw new Error("Wrong JPEG data.")}return n}void 0===l&&(l=function(e){var t,n,r,o,a,i,s="",u=0,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<e.length;)t=c.indexOf(e.charAt(u++))<<2|(o=c.indexOf(e.charAt(u++)))>>4,n=(15&o)<<4|(a=c.indexOf(e.charAt(u++)))>>2,r=(3&a)<<6|(i=c.indexOf(e.charAt(u++))),s+=String.fromCharCode(t),64!=a&&(s+=String.fromCharCode(n)),64!=i&&(s+=String.fromCharCode(r));return s});var v={Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10},m={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};m["0th"]=m.Image,m["1st"]=m.Image,n.TAGS=m,n.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041},n.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,Gamma:42240},n.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},n.InteropIFD={InteroperabilityIndex:1},n.GPSHelper={degToDmsRational:function(e){var t=Math.abs(e),n=t%1*60,r=n%1*60;return[[Math.floor(t),1],[Math.floor(n),1],[Math.round(100*r),100]]},dmsRationalToDeg:function(e,t){var n="S"===t||"W"===t?-1:1;return(e[0][0]/e[0][1]+e[1][0]/e[1][1]/60+e[2][0]/e[2][1]/3600)*n}},e.exports&&(t=e.exports=n),t.piexif=n}()},666:function(e){var t=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,a=Object.create(o.prototype),i=new R(r||[]);return a._invoke=function(e,t,n){var r=f;return function(o,a){if(r===h)throw new Error("Generator is already running");if(r===d){if("throw"===o)throw a;return P()}for(n.method=o,n.arg=a;;){var i=n.delegate;if(i){var s=S(i,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var u=l(e,t,n);if("normal"===u.type){if(r=n.done?d:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=d,n.method="throw",n.arg=u.arg)}}}(e,n,i),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var f="suspendedStart",p="suspendedYield",h="executing",d="completed",v={};function m(){}function g(){}function y(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(T([])));w&&w!==n&&r.call(w,a)&&(b=w);var E=y.prototype=m.prototype=Object.create(b);function A(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(o,a,i,s){var u=l(e[o],e,a);if("throw"!==u.type){var c=u.arg,f=c.value;return f&&"object"==typeof f&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(f).then((function(e){c.value=e,i(c)}),(function(e){return n("throw",e,i,s)}))}s(u.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function S(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=l(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function T(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}return{next:P}}function P(){return{value:t,done:!0}}return g.prototype=y,u(E,"constructor",y),u(y,"constructor",g),g.displayName=u(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,s,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},A(C.prototype),u(C.prototype,i,(function(){return this})),e.AsyncIterator=C,e.async=function(t,n,r,o,a){void 0===a&&(a=Promise);var i=new C(c(t,n,r,o),a);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},A(E),u(E,s,"Generator"),u(E,a,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=T,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;I(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:T(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},902:function(){},522:function(){},753:function(){},730:function(){},221:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){"use strict";function _mergeNamespaces(e,t){return t.forEach((function(t){Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}function ownKeys$1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$1(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}__webpack_require__.d(__webpack_exports__,{Z:function(){return imageCompression}});var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e){var t={exports:{}};return e(t,t.exports),t.exports}var check=function(e){return e&&e.Math==Math&&e},global$1=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof commonjsGlobal&&commonjsGlobal)||function(){return this}()||Function("return this")(),isPure=!1,setGlobal=function(e,t){try{Object.defineProperty(global$1,e,{value:t,configurable:!0,writable:!0})}catch(n){global$1[e]=t}return t},SHARED="__core-js_shared__",store$1=global$1[SHARED]||setGlobal(SHARED,{}),sharedStore=store$1,shared=createCommonjsModule((function(e){(e.exports=function(e,t){return sharedStore[e]||(sharedStore[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.18.0",mode:"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})})),requireObjectCoercible=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},toObject=function(e){return Object(requireObjectCoercible(e))},hasOwnProperty={}.hasOwnProperty,has$1=Object.hasOwn||function(e,t){return hasOwnProperty.call(toObject(e),t)},id=0,postfix=Math.random(),uid=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++id+postfix).toString(36)},isCallable=function(e){return"function"==typeof e},aFunction=function(e){return isCallable(e)?e:void 0},getBuiltIn=function(e,t){return arguments.length<2?aFunction(global$1[e]):global$1[e]&&global$1[e][t]},engineUserAgent=getBuiltIn("navigator","userAgent")||"",process$3=global$1.process,Deno=global$1.Deno,versions=process$3&&process$3.versions||Deno&&Deno.version,v8=versions&&versions.v8,match,version;v8?(match=v8.split("."),version=match[0]<4?1:match[0]+match[1]):engineUserAgent&&(match=engineUserAgent.match(/Edge\/(\d+)/),(!match||match[1]>=74)&&(match=engineUserAgent.match(/Chrome\/(\d+)/),match&&(version=match[1])));var engineV8Version=version&&+version,fails=function(e){try{return!!e()}catch(e){return!0}},nativeSymbol=!!Object.getOwnPropertySymbols&&!fails((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&engineV8Version&&engineV8Version<41})),useSymbolAsUid=nativeSymbol&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,WellKnownSymbolsStore=shared("wks"),Symbol$1=global$1.Symbol,createWellKnownSymbol=useSymbolAsUid?Symbol$1:Symbol$1&&Symbol$1.withoutSetter||uid,wellKnownSymbol=function(e){return has$1(WellKnownSymbolsStore,e)&&(nativeSymbol||"string"==typeof WellKnownSymbolsStore[e])||(nativeSymbol&&has$1(Symbol$1,e)?WellKnownSymbolsStore[e]=Symbol$1[e]:WellKnownSymbolsStore[e]=createWellKnownSymbol("Symbol."+e)),WellKnownSymbolsStore[e]},TO_STRING_TAG$4=wellKnownSymbol("toStringTag"),test$1={};test$1[TO_STRING_TAG$4]="z";var toStringTagSupport="[object z]"===String(test$1),descriptors=!fails((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),isObject=function(e){return"object"==typeof e?null!==e:isCallable(e)},document$3=global$1.document,EXISTS$1=isObject(document$3)&&isObject(document$3.createElement),documentCreateElement=function(e){return EXISTS$1?document$3.createElement(e):{}},ie8DomDefine=!descriptors&&!fails((function(){return 7!=Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a})),anObject=function(e){if(isObject(e))return e;throw TypeError(String(e)+" is not an object")},isSymbol=useSymbolAsUid?function(e){return"symbol"==typeof e}:function(e){var t=getBuiltIn("Symbol");return isCallable(t)&&Object(e)instanceof t},tryToString=function(e){try{return String(e)}catch(e){return"Object"}},aCallable=function(e){if(isCallable(e))return e;throw TypeError(tryToString(e)+" is not a function")},getMethod=function(e,t){var n=e[t];return null==n?void 0:aCallable(n)},ordinaryToPrimitive=function(e,t){var n,r;if("string"===t&&isCallable(n=e.toString)&&!isObject(r=n.call(e)))return r;if(isCallable(n=e.valueOf)&&!isObject(r=n.call(e)))return r;if("string"!==t&&isCallable(n=e.toString)&&!isObject(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},TO_PRIMITIVE=wellKnownSymbol("toPrimitive"),toPrimitive=function(e,t){if(!isObject(e)||isSymbol(e))return e;var n,r=getMethod(e,TO_PRIMITIVE);if(r){if(void 0===t&&(t="default"),n=r.call(e,t),!isObject(n)||isSymbol(n))return n;throw TypeError("Can't convert object to primitive value")}return void 0===t&&(t="number"),ordinaryToPrimitive(e,t)},toPropertyKey=function(e){var t=toPrimitive(e,"string");return isSymbol(t)?t:String(t)},$defineProperty=Object.defineProperty,f$5=descriptors?$defineProperty:function(e,t,n){if(anObject(e),t=toPropertyKey(t),anObject(n),ie8DomDefine)try{return $defineProperty(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e},objectDefineProperty={f:f$5},createPropertyDescriptor=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},createNonEnumerableProperty=descriptors?function(e,t,n){return objectDefineProperty.f(e,t,createPropertyDescriptor(1,n))}:function(e,t,n){return e[t]=n,e},functionToString=Function.toString;isCallable(sharedStore.inspectSource)||(sharedStore.inspectSource=function(e){return functionToString.call(e)});var inspectSource=sharedStore.inspectSource,WeakMap$1=global$1.WeakMap,nativeWeakMap=isCallable(WeakMap$1)&&/native code/.test(inspectSource(WeakMap$1)),keys$2=shared("keys"),sharedKey=function(e){return keys$2[e]||(keys$2[e]=uid(e))},hiddenKeys$1={},OBJECT_ALREADY_INITIALIZED="Object already initialized",WeakMap=global$1.WeakMap,set$2,get$1,has,enforce=function(e){return has(e)?get$1(e):set$2(e,{})},getterFor=function(e){return function(t){var n;if(!isObject(t)||(n=get$1(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}};if(nativeWeakMap||sharedStore.state){var store=sharedStore.state||(sharedStore.state=new WeakMap),wmget=store.get,wmhas=store.has,wmset=store.set;set$2=function(e,t){if(wmhas.call(store,e))throw new TypeError(OBJECT_ALREADY_INITIALIZED);return t.facade=e,wmset.call(store,e,t),t},get$1=function(e){return wmget.call(store,e)||{}},has=function(e){return wmhas.call(store,e)}}else{var STATE=sharedKey("state");hiddenKeys$1[STATE]=!0,set$2=function(e,t){if(has$1(e,STATE))throw new TypeError(OBJECT_ALREADY_INITIALIZED);return t.facade=e,createNonEnumerableProperty(e,STATE,t),t},get$1=function(e){return has$1(e,STATE)?e[STATE]:{}},has=function(e){return has$1(e,STATE)}}var internalState={set:set$2,get:get$1,has:has,enforce:enforce,getterFor:getterFor},FunctionPrototype$1=Function.prototype,getDescriptor=descriptors&&Object.getOwnPropertyDescriptor,EXISTS=has$1(FunctionPrototype$1,"name"),PROPER=EXISTS&&"something"===function(){}.name,CONFIGURABLE=EXISTS&&(!descriptors||descriptors&&getDescriptor(FunctionPrototype$1,"name").configurable),functionName={EXISTS:EXISTS,PROPER:PROPER,CONFIGURABLE:CONFIGURABLE},redefine=createCommonjsModule((function(e){var t=functionName.CONFIGURABLE,n=internalState.get,r=internalState.enforce,o=String(String).split("String");(e.exports=function(e,n,a,i){var s,u=!!i&&!!i.unsafe,c=!!i&&!!i.enumerable,l=!!i&&!!i.noTargetGet,f=i&&void 0!==i.name?i.name:n;isCallable(a)&&("Symbol("===String(f).slice(0,7)&&(f="["+String(f).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!has$1(a,"name")||t&&a.name!==f)&&createNonEnumerableProperty(a,"name",f),(s=r(a)).source||(s.source=o.join("string"==typeof f?f:""))),e!==global$1?(u?!l&&e[n]&&(c=!0):delete e[n],c?e[n]=a:createNonEnumerableProperty(e,n,a)):c?e[n]=a:setGlobal(n,a)})(Function.prototype,"toString",(function(){return isCallable(this)&&n(this).source||inspectSource(this)}))})),toString$1={}.toString,classofRaw=function(e){return toString$1.call(e).slice(8,-1)},TO_STRING_TAG$3=wellKnownSymbol("toStringTag"),CORRECT_ARGUMENTS="Arguments"==classofRaw(function(){return arguments}()),tryGet=function(e,t){try{return e[t]}catch(e){}},classof=toStringTagSupport?classofRaw:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=tryGet(t=Object(e),TO_STRING_TAG$3))?n:CORRECT_ARGUMENTS?classofRaw(t):"Object"==(r=classofRaw(t))&&isCallable(t.callee)?"Arguments":r},objectToString=toStringTagSupport?{}.toString:function(){return"[object "+classof(this)+"]"};toStringTagSupport||redefine(Object.prototype,"toString",objectToString,{unsafe:!0});var $propertyIsEnumerable={}.propertyIsEnumerable,getOwnPropertyDescriptor$4=Object.getOwnPropertyDescriptor,NASHORN_BUG=getOwnPropertyDescriptor$4&&!$propertyIsEnumerable.call({1:2},1),f$4=NASHORN_BUG?function(e){var t=getOwnPropertyDescriptor$4(this,e);return!!t&&t.enumerable}:$propertyIsEnumerable,objectPropertyIsEnumerable={f:f$4},split="".split,indexedObject=fails((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==classofRaw(e)?split.call(e,""):Object(e)}:Object,toIndexedObject=function(e){return indexedObject(requireObjectCoercible(e))},$getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,f$3=descriptors?$getOwnPropertyDescriptor:function(e,t){if(e=toIndexedObject(e),t=toPropertyKey(t),ie8DomDefine)try{return $getOwnPropertyDescriptor(e,t)}catch(e){}if(has$1(e,t))return createPropertyDescriptor(!objectPropertyIsEnumerable.f.call(e,t),e[t])},objectGetOwnPropertyDescriptor={f:f$3},ceil=Math.ceil,floor$7=Math.floor,toInteger=function(e){return isNaN(e=+e)?0:(e>0?floor$7:ceil)(e)},min$6=Math.min,toLength=function(e){return e>0?min$6(toInteger(e),9007199254740991):0},max$2=Math.max,min$5=Math.min,toAbsoluteIndex=function(e,t){var n=toInteger(e);return n<0?max$2(n+t,0):min$5(n,t)},createMethod$5=function(e){return function(t,n,r){var o,a=toIndexedObject(t),i=toLength(a.length),s=toAbsoluteIndex(r,i);if(e&&n!=n){for(;i>s;)if((o=a[s++])!=o)return!0}else for(;i>s;s++)if((e||s in a)&&a[s]===n)return e||s||0;return!e&&-1}},arrayIncludes={includes:createMethod$5(!0),indexOf:createMethod$5(!1)},indexOf=arrayIncludes.indexOf,objectKeysInternal=function(e,t){var n,r=toIndexedObject(e),o=0,a=[];for(n in r)!has$1(hiddenKeys$1,n)&&has$1(r,n)&&a.push(n);for(;t.length>o;)has$1(r,n=t[o++])&&(~indexOf(a,n)||a.push(n));return a},enumBugKeys=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],hiddenKeys=enumBugKeys.concat("length","prototype"),f$2=Object.getOwnPropertyNames||function(e){return objectKeysInternal(e,hiddenKeys)},objectGetOwnPropertyNames={f:f$2},f$1=Object.getOwnPropertySymbols,objectGetOwnPropertySymbols={f:f$1},ownKeys=getBuiltIn("Reflect","ownKeys")||function(e){var t=objectGetOwnPropertyNames.f(anObject(e)),n=objectGetOwnPropertySymbols.f;return n?t.concat(n(e)):t},copyConstructorProperties=function(e,t){for(var n=ownKeys(t),r=objectDefineProperty.f,o=objectGetOwnPropertyDescriptor.f,a=0;a<n.length;a++){var i=n[a];has$1(e,i)||r(e,i,o(t,i))}},replacement=/#|\.prototype\./,isForced=function(e,t){var n=data[normalize(e)];return n==POLYFILL||n!=NATIVE&&(isCallable(t)?fails(t):!!t)},normalize=isForced.normalize=function(e){return String(e).replace(replacement,".").toLowerCase()},data=isForced.data={},NATIVE=isForced.NATIVE="N",POLYFILL=isForced.POLYFILL="P",isForced_1=isForced,getOwnPropertyDescriptor$3=objectGetOwnPropertyDescriptor.f,_export=function(e,t){var n,r,o,a,i,s=e.target,u=e.global,c=e.stat;if(n=u?global$1:c?global$1[s]||setGlobal(s,{}):(global$1[s]||{}).prototype)for(r in t){if(a=t[r],o=e.noTargetGet?(i=getOwnPropertyDescriptor$3(n,r))&&i.value:n[r],!isForced_1(u?r:s+(c?".":"#")+r,e.forced)&&void 0!==o){if(typeof a==typeof o)continue;copyConstructorProperties(a,o)}(e.sham||o&&o.sham)&&createNonEnumerableProperty(a,"sham",!0),redefine(n,r,a,e)}},nativePromiseConstructor=global$1.Promise,redefineAll=function(e,t,n){for(var r in t)redefine(e,r,t[r],n);return e},aPossiblePrototype=function(e){if("object"==typeof e||isCallable(e))return e;throw TypeError("Can't set "+String(e)+" as a prototype")},objectSetPrototypeOf=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return anObject(n),aPossiblePrototype(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),defineProperty$5=objectDefineProperty.f,TO_STRING_TAG$2=wellKnownSymbol("toStringTag"),setToStringTag=function(e,t,n){e&&!has$1(e=n?e:e.prototype,TO_STRING_TAG$2)&&defineProperty$5(e,TO_STRING_TAG$2,{configurable:!0,value:t})},SPECIES$6=wellKnownSymbol("species"),setSpecies=function(e){var t=getBuiltIn(e),n=objectDefineProperty.f;descriptors&&t&&!t[SPECIES$6]&&n(t,SPECIES$6,{configurable:!0,get:function(){return this}})},anInstance=function(e,t,n){if(e instanceof t)return e;throw TypeError("Incorrect "+(n?n+" ":"")+"invocation")},iterators={},ITERATOR$8=wellKnownSymbol("iterator"),ArrayPrototype$1=Array.prototype,isArrayIteratorMethod=function(e){return void 0!==e&&(iterators.Array===e||ArrayPrototype$1[ITERATOR$8]===e)},functionBindContext=function(e,t,n){if(aCallable(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}},ITERATOR$7=wellKnownSymbol("iterator"),getIteratorMethod=function(e){if(null!=e)return getMethod(e,ITERATOR$7)||getMethod(e,"@@iterator")||iterators[classof(e)]},getIterator=function(e,t){var n=arguments.length<2?getIteratorMethod(e):t;if(aCallable(n))return anObject(n.call(e));throw TypeError(String(e)+" is not iterable")},iteratorClose=function(e,t,n){var r,o;anObject(e);try{if(!(r=getMethod(e,"return"))){if("throw"===t)throw n;return n}r=r.call(e)}catch(e){o=!0,r=e}if("throw"===t)throw n;if(o)throw r;return anObject(r),n},Result=function(e,t){this.stopped=e,this.result=t},iterate=function(e,t,n){var r,o,a,i,s,u,c,l=n&&n.that,f=!(!n||!n.AS_ENTRIES),p=!(!n||!n.IS_ITERATOR),h=!(!n||!n.INTERRUPTED),d=functionBindContext(t,l,1+f+h),v=function(e){return r&&iteratorClose(r,"normal",e),new Result(!0,e)},m=function(e){return f?(anObject(e),h?d(e[0],e[1],v):d(e[0],e[1])):h?d(e,v):d(e)};if(p)r=e;else{if(!(o=getIteratorMethod(e)))throw TypeError(String(e)+" is not iterable");if(isArrayIteratorMethod(o)){for(a=0,i=toLength(e.length);i>a;a++)if((s=m(e[a]))&&s instanceof Result)return s;return new Result(!1)}r=getIterator(e,o)}for(u=r.next;!(c=u.call(r)).done;){try{s=m(c.value)}catch(e){iteratorClose(r,"throw",e)}if("object"==typeof s&&s&&s instanceof Result)return s}return new Result(!1)},ITERATOR$6=wellKnownSymbol("iterator"),SAFE_CLOSING=!1;try{var called=0,iteratorWithReturn={next:function(){return{done:!!called++}},return:function(){SAFE_CLOSING=!0}};iteratorWithReturn[ITERATOR$6]=function(){return this},Array.from(iteratorWithReturn,(function(){throw 2}))}catch(e){}var checkCorrectnessOfIteration=function(e,t){if(!t&&!SAFE_CLOSING)return!1;var n=!1;try{var r={};r[ITERATOR$6]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},empty=[],construct=getBuiltIn("Reflect","construct"),constructorRegExp=/^\s*(?:class|function)\b/,exec=constructorRegExp.exec,INCORRECT_TO_STRING=!constructorRegExp.exec((function(){})),isConstructorModern=function(e){if(!isCallable(e))return!1;try{return construct(Object,empty,e),!0}catch(e){return!1}},isConstructorLegacy=function(e){if(!isCallable(e))return!1;switch(classof(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return INCORRECT_TO_STRING||!!exec.call(constructorRegExp,inspectSource(e))},isConstructor=!construct||fails((function(){var e;return isConstructorModern(isConstructorModern.call)||!isConstructorModern(Object)||!isConstructorModern((function(){e=!0}))||e}))?isConstructorLegacy:isConstructorModern,aConstructor=function(e){if(isConstructor(e))return e;throw TypeError(tryToString(e)+" is not a constructor")},SPECIES$5=wellKnownSymbol("species"),speciesConstructor=function(e,t){var n,r=anObject(e).constructor;return void 0===r||null==(n=anObject(r)[SPECIES$5])?t:aConstructor(n)},html=getBuiltIn("document","documentElement"),engineIsIos=/(?:ipad|iphone|ipod).*applewebkit/i.test(engineUserAgent),engineIsNode="process"==classofRaw(global$1.process),set$1=global$1.setImmediate,clear=global$1.clearImmediate,process$2=global$1.process,MessageChannel=global$1.MessageChannel,Dispatch=global$1.Dispatch,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",location,defer,channel,port;try{location=global$1.location}catch(e){}var run=function(e){if(queue.hasOwnProperty(e)){var t=queue[e];delete queue[e],t()}},runner=function(e){return function(){run(e)}},listener=function(e){run(e.data)},post=function(e){global$1.postMessage(String(e),location.protocol+"//"+location.host)};set$1&&clear||(set$1=function(e){for(var t=[],n=arguments.length,r=1;n>r;)t.push(arguments[r++]);return queue[++counter]=function(){(isCallable(e)?e:Function(e)).apply(void 0,t)},defer(counter),counter},clear=function(e){delete queue[e]},engineIsNode?defer=function(e){process$2.nextTick(runner(e))}:Dispatch&&Dispatch.now?defer=function(e){Dispatch.now(runner(e))}:MessageChannel&&!engineIsIos?(channel=new MessageChannel,port=channel.port2,channel.port1.onmessage=listener,defer=functionBindContext(port.postMessage,port,1)):global$1.addEventListener&&isCallable(global$1.postMessage)&&!global$1.importScripts&&location&&"file:"!==location.protocol&&!fails(post)?(defer=post,global$1.addEventListener("message",listener,!1)):defer=ONREADYSTATECHANGE in documentCreateElement("script")?function(e){html.appendChild(documentCreateElement("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run(e)}}:function(e){setTimeout(runner(e),0)});var task$1={set:set$1,clear:clear},engineIsIosPebble=/ipad|iphone|ipod/i.test(engineUserAgent)&&void 0!==global$1.Pebble,engineIsWebosWebkit=/web0s(?!.*chrome)/i.test(engineUserAgent),getOwnPropertyDescriptor$2=objectGetOwnPropertyDescriptor.f,macrotask=task$1.set,MutationObserver=global$1.MutationObserver||global$1.WebKitMutationObserver,document$2=global$1.document,process$1=global$1.process,Promise$1=global$1.Promise,queueMicrotaskDescriptor=getOwnPropertyDescriptor$2(global$1,"queueMicrotask"),queueMicrotask=queueMicrotaskDescriptor&&queueMicrotaskDescriptor.value,flush,head,last,notify$1,toggle,node,promise,then;queueMicrotask||(flush=function(){var e,t;for(engineIsNode&&(e=process$1.domain)&&e.exit();head;){t=head.fn,head=head.next;try{t()}catch(e){throw head?notify$1():last=void 0,e}}last=void 0,e&&e.enter()},engineIsIos||engineIsNode||engineIsWebosWebkit||!MutationObserver||!document$2?!engineIsIosPebble&&Promise$1&&Promise$1.resolve?(promise=Promise$1.resolve(void 0),promise.constructor=Promise$1,then=promise.then,notify$1=function(){then.call(promise,flush)}):notify$1=engineIsNode?function(){process$1.nextTick(flush)}:function(){macrotask.call(global$1,flush)}:(toggle=!0,node=document$2.createTextNode(""),new MutationObserver(flush).observe(node,{characterData:!0}),notify$1=function(){node.data=toggle=!toggle}));var microtask=queueMicrotask||function(e){var t={fn:e,next:void 0};last&&(last.next=t),head||(head=t,notify$1()),last=t},PromiseCapability=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=aCallable(t),this.reject=aCallable(n)},f=function(e){return new PromiseCapability(e)},newPromiseCapability$1={f:f},promiseResolve=function(e,t){if(anObject(e),isObject(t)&&t.constructor===e)return t;var n=newPromiseCapability$1.f(e);return(0,n.resolve)(t),n.promise},hostReportErrors=function(e,t){var n=global$1.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},perform=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},engineIsBrowser="object"==typeof window,task=task$1.set,SPECIES$4=wellKnownSymbol("species"),PROMISE="Promise",getInternalState$4=internalState.get,setInternalState$5=internalState.set,getInternalPromiseState=internalState.getterFor(PROMISE),NativePromisePrototype=nativePromiseConstructor&&nativePromiseConstructor.prototype,PromiseConstructor=nativePromiseConstructor,PromiseConstructorPrototype=NativePromisePrototype,TypeError$1=global$1.TypeError,document$1=global$1.document,process=global$1.process,newPromiseCapability=newPromiseCapability$1.f,newGenericPromiseCapability=newPromiseCapability,DISPATCH_EVENT=!!(document$1&&document$1.createEvent&&global$1.dispatchEvent),NATIVE_REJECTION_EVENT=isCallable(global$1.PromiseRejectionEvent),UNHANDLED_REJECTION="unhandledrejection",REJECTION_HANDLED="rejectionhandled",PENDING=0,FULFILLED=1,REJECTED=2,HANDLED=1,UNHANDLED=2,SUBCLASSING=!1,Internal,OwnPromiseCapability,PromiseWrapper,nativeThen,FORCED$6=isForced_1(PROMISE,(function(){var e=inspectSource(PromiseConstructor),t=e!==String(PromiseConstructor);if(!t&&66===engineV8Version)return!0;if(engineV8Version>=51&&/native code/.test(e))return!1;var n=new PromiseConstructor((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[SPECIES$4]=r,!(SUBCLASSING=n.then((function(){}))instanceof r)||!t&&engineIsBrowser&&!NATIVE_REJECTION_EVENT})),INCORRECT_ITERATION=FORCED$6||!checkCorrectnessOfIteration((function(e){PromiseConstructor.all(e).catch((function(){}))})),isThenable=function(e){var t;return!(!isObject(e)||!isCallable(t=e.then))&&t},notify=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;microtask((function(){for(var r=e.value,o=e.state==FULFILLED,a=0;n.length>a;){var i,s,u,c=n[a++],l=o?c.ok:c.fail,f=c.resolve,p=c.reject,h=c.domain;try{l?(o||(e.rejection===UNHANDLED&&onHandleUnhandled(e),e.rejection=HANDLED),!0===l?i=r:(h&&h.enter(),i=l(r),h&&(h.exit(),u=!0)),i===c.promise?p(TypeError$1("Promise-chain cycle")):(s=isThenable(i))?s.call(i,f,p):f(i)):p(r)}catch(e){h&&!u&&h.exit(),p(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&onUnhandled(e)}))}},dispatchEvent=function(e,t,n){var r,o;DISPATCH_EVENT?((r=document$1.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),global$1.dispatchEvent(r)):r={promise:t,reason:n},!NATIVE_REJECTION_EVENT&&(o=global$1["on"+e])?o(r):e===UNHANDLED_REJECTION&&hostReportErrors("Unhandled promise rejection",n)},onUnhandled=function(e){task.call(global$1,(function(){var t,n=e.facade,r=e.value;if(isUnhandled(e)&&(t=perform((function(){engineIsNode?process.emit("unhandledRejection",r,n):dispatchEvent(UNHANDLED_REJECTION,n,r)})),e.rejection=engineIsNode||isUnhandled(e)?UNHANDLED:HANDLED,t.error))throw t.value}))},isUnhandled=function(e){return e.rejection!==HANDLED&&!e.parent},onHandleUnhandled=function(e){task.call(global$1,(function(){var t=e.facade;engineIsNode?process.emit("rejectionHandled",t):dispatchEvent(REJECTION_HANDLED,t,e.value)}))},bind=function(e,t,n){return function(r){e(t,r,n)}},internalReject=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=REJECTED,notify(e,!0))},internalResolve=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw TypeError$1("Promise can't be resolved itself");var r=isThenable(t);r?microtask((function(){var n={done:!1};try{r.call(t,bind(internalResolve,n,e),bind(internalReject,n,e))}catch(t){internalReject(n,t,e)}})):(e.value=t,e.state=FULFILLED,notify(e,!1))}catch(t){internalReject({done:!1},t,e)}}};if(FORCED$6&&(PromiseConstructor=function(e){anInstance(this,PromiseConstructor,PROMISE),aCallable(e),Internal.call(this);var t=getInternalState$4(this);try{e(bind(internalResolve,t),bind(internalReject,t))}catch(e){internalReject(t,e)}},PromiseConstructorPrototype=PromiseConstructor.prototype,Internal=function(e){setInternalState$5(this,{type:PROMISE,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:PENDING,value:void 0})},Internal.prototype=redefineAll(PromiseConstructorPrototype,{then:function(e,t){var n=getInternalPromiseState(this),r=newPromiseCapability(speciesConstructor(this,PromiseConstructor));return r.ok=!isCallable(e)||e,r.fail=isCallable(t)&&t,r.domain=engineIsNode?process.domain:void 0,n.parent=!0,n.reactions.push(r),n.state!=PENDING&&notify(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),OwnPromiseCapability=function(){var e=new Internal,t=getInternalState$4(e);this.promise=e,this.resolve=bind(internalResolve,t),this.reject=bind(internalReject,t)},newPromiseCapability$1.f=newPromiseCapability=function(e){return e===PromiseConstructor||e===PromiseWrapper?new OwnPromiseCapability(e):newGenericPromiseCapability(e)},isCallable(nativePromiseConstructor)&&NativePromisePrototype!==Object.prototype)){nativeThen=NativePromisePrototype.then,SUBCLASSING||(redefine(NativePromisePrototype,"then",(function(e,t){var n=this;return new PromiseConstructor((function(e,t){nativeThen.call(n,e,t)})).then(e,t)}),{unsafe:!0}),redefine(NativePromisePrototype,"catch",PromiseConstructorPrototype.catch,{unsafe:!0}));try{delete NativePromisePrototype.constructor}catch(e){}objectSetPrototypeOf&&objectSetPrototypeOf(NativePromisePrototype,PromiseConstructorPrototype)}_export({global:!0,wrap:!0,forced:FORCED$6},{Promise:PromiseConstructor}),setToStringTag(PromiseConstructor,PROMISE,!1),setSpecies(PROMISE),PromiseWrapper=getBuiltIn(PROMISE),_export({target:PROMISE,stat:!0,forced:FORCED$6},{reject:function(e){var t=newPromiseCapability(this);return t.reject.call(void 0,e),t.promise}}),_export({target:PROMISE,stat:!0,forced:FORCED$6},{resolve:function(e){return promiseResolve(this,e)}}),_export({target:PROMISE,stat:!0,forced:INCORRECT_ITERATION},{all:function(e){var t=this,n=newPromiseCapability(t),r=n.resolve,o=n.reject,a=perform((function(){var n=aCallable(t.resolve),a=[],i=0,s=1;iterate(e,(function(e){var u=i++,c=!1;a.push(void 0),s++,n.call(t,e).then((function(e){c||(c=!0,a[u]=e,--s||r(a))}),o)})),--s||r(a)}));return a.error&&o(a.value),n.promise},race:function(e){var t=this,n=newPromiseCapability(t),r=n.reject,o=perform((function(){var o=aCallable(t.resolve);iterate(e,(function(e){o.call(t,e).then(n.resolve,r)}))}));return o.error&&r(o.value),n.promise}});var inheritIfRequired=function(e,t,n){var r,o;return objectSetPrototypeOf&&isCallable(r=t.constructor)&&r!==n&&isObject(o=r.prototype)&&o!==n.prototype&&objectSetPrototypeOf(e,o),e},objectKeys=Object.keys||function(e){return objectKeysInternal(e,enumBugKeys)},objectDefineProperties=descriptors?Object.defineProperties:function(e,t){anObject(e);for(var n,r=objectKeys(t),o=r.length,a=0;o>a;)objectDefineProperty.f(e,n=r[a++],t[n]);return e},GT=">",LT="<",PROTOTYPE$1="prototype",SCRIPT="script",IE_PROTO$1=sharedKey("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(e){return LT+SCRIPT+GT+e+LT+"/"+SCRIPT+GT},NullProtoObjectViaActiveX=function(e){e.write(scriptTag("")),e.close();var t=e.parentWindow.Object;return e=null,t},NullProtoObjectViaIFrame=function(){var e,t=documentCreateElement("iframe"),n="java"+SCRIPT+":";return t.style.display="none",html.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(scriptTag("document.F=Object")),e.close(),e.F},activeXDocument,NullProtoObject=function(){try{activeXDocument=new ActiveXObject("htmlfile")}catch(e){}NullProtoObject="undefined"!=typeof document?document.domain&&activeXDocument?NullProtoObjectViaActiveX(activeXDocument):NullProtoObjectViaIFrame():NullProtoObjectViaActiveX(activeXDocument);for(var e=enumBugKeys.length;e--;)delete NullProtoObject[PROTOTYPE$1][enumBugKeys[e]];return NullProtoObject()};hiddenKeys$1[IE_PROTO$1]=!0;var objectCreate=Object.create||function(e,t){var n;return null!==e?(EmptyConstructor[PROTOTYPE$1]=anObject(e),n=new EmptyConstructor,EmptyConstructor[PROTOTYPE$1]=null,n[IE_PROTO$1]=e):n=NullProtoObject(),void 0===t?n:objectDefineProperties(n,t)},toString=function(e){if("Symbol"===classof(e))throw TypeError("Cannot convert a Symbol value to a string");return String(e)},whitespaces="\t\n\v\f\r                　\u2028\u2029\ufeff",whitespace="["+whitespaces+"]",ltrim=RegExp("^"+whitespace+whitespace+"*"),rtrim=RegExp(whitespace+whitespace+"*$"),createMethod$4=function(e){return function(t){var n=toString(requireObjectCoercible(t));return 1&e&&(n=n.replace(ltrim,"")),2&e&&(n=n.replace(rtrim,"")),n}},stringTrim={start:createMethod$4(1),end:createMethod$4(2),trim:createMethod$4(3)},getOwnPropertyNames$1=objectGetOwnPropertyNames.f,getOwnPropertyDescriptor$1=objectGetOwnPropertyDescriptor.f,defineProperty$4=objectDefineProperty.f,trim=stringTrim.trim,NUMBER="Number",NativeNumber=global$1[NUMBER],NumberPrototype=NativeNumber.prototype,BROKEN_CLASSOF=classofRaw(objectCreate(NumberPrototype))==NUMBER,toNumber=function(e){if(isSymbol(e))throw TypeError("Cannot convert a Symbol value to a number");var t,n,r,o,a,i,s,u,c=toPrimitive(e,"number");if("string"==typeof c&&c.length>2)if(43===(t=(c=trim(c)).charCodeAt(0))||45===t){if(88===(n=c.charCodeAt(2))||120===n)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:r=2,o=49;break;case 79:case 111:r=8,o=55;break;default:return+c}for(i=(a=c.slice(2)).length,s=0;s<i;s++)if((u=a.charCodeAt(s))<48||u>o)return NaN;return parseInt(a,r)}return+c};if(isForced_1(NUMBER,!NativeNumber(" 0o1")||!NativeNumber("0b1")||NativeNumber("+0x1"))){for(var NumberWrapper=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof NumberWrapper&&(BROKEN_CLASSOF?fails((function(){NumberPrototype.valueOf.call(n)})):classofRaw(n)!=NUMBER)?inheritIfRequired(new NativeNumber(toNumber(t)),n,NumberWrapper):toNumber(t)},keys$1=descriptors?getOwnPropertyNames$1(NativeNumber):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),j$1=0,key$1;keys$1.length>j$1;j$1++)has$1(NativeNumber,key$1=keys$1[j$1])&&!has$1(NumberWrapper,key$1)&&defineProperty$4(NumberWrapper,key$1,getOwnPropertyDescriptor$1(NativeNumber,key$1));NumberWrapper.prototype=NumberPrototype,NumberPrototype.constructor=NumberWrapper,redefine(global$1,NUMBER,NumberWrapper)}var FUNCTION_NAME_EXISTS=functionName.EXISTS,defineProperty$3=objectDefineProperty.f,FunctionPrototype=Function.prototype,FunctionPrototypeToString=FunctionPrototype.toString,nameRE=/^\s*function ([^ (]*)/,NAME$1="name";descriptors&&!FUNCTION_NAME_EXISTS&&defineProperty$3(FunctionPrototype,NAME$1,{configurable:!0,get:function(){try{return FunctionPrototypeToString.call(this).match(nameRE)[1]}catch(e){return""}}}),_export({global:!0},{globalThis:global$1});var $assign=Object.assign,defineProperty$2=Object.defineProperty,objectAssign=!$assign||fails((function(){if(descriptors&&1!==$assign({b:1},$assign(defineProperty$2({},"a",{enumerable:!0,get:function(){defineProperty$2(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=$assign({},e)[n]||"abcdefghijklmnopqrst"!=objectKeys($assign({},t)).join("")}))?function(e,t){for(var n=toObject(e),r=arguments.length,o=1,a=objectGetOwnPropertySymbols.f,i=objectPropertyIsEnumerable.f;r>o;)for(var s,u=indexedObject(arguments[o++]),c=a?objectKeys(u).concat(a(u)):objectKeys(u),l=c.length,f=0;l>f;)s=c[f++],descriptors&&!i.call(u,s)||(n[s]=u[s]);return n}:$assign;_export({target:"Object",stat:!0,forced:Object.assign!==objectAssign},{assign:objectAssign});var path=global$1;path.Object.assign;var regexpFlags=function(){var e=anObject(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},$RegExp$2=global$1.RegExp,UNSUPPORTED_Y$2=fails((function(){var e=$RegExp$2("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),BROKEN_CARET=fails((function(){var e=$RegExp$2("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),regexpStickyHelpers={UNSUPPORTED_Y:UNSUPPORTED_Y$2,BROKEN_CARET:BROKEN_CARET},$RegExp$1=global$1.RegExp,regexpUnsupportedDotAll=fails((function(){var e=$RegExp$1(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),$RegExp=global$1.RegExp,regexpUnsupportedNcg=fails((function(){var e=$RegExp("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),getInternalState$3=internalState.get,nativeExec=RegExp.prototype.exec,nativeReplace=shared("native-string-replace",String.prototype.replace),patchedExec=nativeExec,UPDATES_LAST_INDEX_WRONG=(re1=/a/,re2=/b*/g,nativeExec.call(re1,"a"),nativeExec.call(re2,"a"),0!==re1.lastIndex||0!==re2.lastIndex),re1,re2,UNSUPPORTED_Y$1=regexpStickyHelpers.UNSUPPORTED_Y||regexpStickyHelpers.BROKEN_CARET,NPCG_INCLUDED=void 0!==/()??/.exec("")[1],PATCH=UPDATES_LAST_INDEX_WRONG||NPCG_INCLUDED||UNSUPPORTED_Y$1||regexpUnsupportedDotAll||regexpUnsupportedNcg;PATCH&&(patchedExec=function(e){var t,n,r,o,a,i,s,u=this,c=getInternalState$3(u),l=toString(e),f=c.raw;if(f)return f.lastIndex=u.lastIndex,t=patchedExec.call(f,l),u.lastIndex=f.lastIndex,t;var p=c.groups,h=UNSUPPORTED_Y$1&&u.sticky,d=regexpFlags.call(u),v=u.source,m=0,g=l;if(h&&(-1===(d=d.replace("y","")).indexOf("g")&&(d+="g"),g=l.slice(u.lastIndex),u.lastIndex>0&&(!u.multiline||u.multiline&&"\n"!==l.charAt(u.lastIndex-1))&&(v="(?: "+v+")",g=" "+g,m++),n=new RegExp("^(?:"+v+")",d)),NPCG_INCLUDED&&(n=new RegExp("^"+v+"$(?!\\s)",d)),UPDATES_LAST_INDEX_WRONG&&(r=u.lastIndex),o=nativeExec.call(h?n:u,g),h?o?(o.input=o.input.slice(m),o[0]=o[0].slice(m),o.index=u.lastIndex,u.lastIndex+=o[0].length):u.lastIndex=0:UPDATES_LAST_INDEX_WRONG&&o&&(u.lastIndex=u.global?o.index+o[0].length:r),NPCG_INCLUDED&&o&&o.length>1&&nativeReplace.call(o[0],n,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(o[a]=void 0)})),o&&p)for(o.groups=i=objectCreate(null),a=0;a<p.length;a++)i[(s=p[a])[0]]=o[s[1]];return o});var regexpExec=patchedExec;_export({target:"RegExp",proto:!0,forced:/./.exec!==regexpExec},{exec:regexpExec});var SPECIES$3=wellKnownSymbol("species"),RegExpPrototype$1=RegExp.prototype,fixRegexpWellKnownSymbolLogic=function(e,t,n,r){var o=wellKnownSymbol(e),a=!fails((function(){var t={};return t[o]=function(){return 7},7!=""[e](t)})),i=a&&!fails((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[SPECIES$3]=function(){return n},n.flags="",n[o]=/./[o]),n.exec=function(){return t=!0,null},n[o](""),!t}));if(!a||!i||n){var s=/./[o],u=t(o,""[e],(function(e,t,n,r,o){var i=t.exec;return i===regexpExec||i===RegExpPrototype$1.exec?a&&!o?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}));redefine(String.prototype,e,u[0]),redefine(RegExpPrototype$1,o,u[1])}r&&createNonEnumerableProperty(RegExpPrototype$1[o],"sham",!0)},MATCH$1=wellKnownSymbol("match"),isRegexp=function(e){var t;return isObject(e)&&(void 0!==(t=e[MATCH$1])?!!t:"RegExp"==classofRaw(e))},createMethod$3=function(e){return function(t,n){var r,o,a=toString(requireObjectCoercible(t)),i=toInteger(n),s=a.length;return i<0||i>=s?e?"":void 0:(r=a.charCodeAt(i))<55296||r>56319||i+1===s||(o=a.charCodeAt(i+1))<56320||o>57343?e?a.charAt(i):r:e?a.slice(i,i+2):o-56320+(r-55296<<10)+65536}},stringMultibyte={codeAt:createMethod$3(!1),charAt:createMethod$3(!0)},charAt$1=stringMultibyte.charAt,advanceStringIndex=function(e,t,n){return t+(n?charAt$1(e,t).length:1)},regexpExecAbstract=function(e,t){var n=e.exec;if(isCallable(n)){var r=n.call(e,t);return null!==r&&anObject(r),r}if("RegExp"===classofRaw(e))return regexpExec.call(e,t);throw TypeError("RegExp#exec called on incompatible receiver")},UNSUPPORTED_Y=regexpStickyHelpers.UNSUPPORTED_Y,arrayPush=[].push,min$4=Math.min,MAX_UINT32=4294967295,SPLIT_WORKS_WITH_OVERWRITTEN_EXEC=!fails((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));fixRegexpWellKnownSymbolLogic("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=toString(requireObjectCoercible(this)),o=void 0===n?MAX_UINT32:n>>>0;if(0===o)return[];if(void 0===e)return[r];if(!isRegexp(e))return t.call(r,e,o);for(var a,i,s,u=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,f=new RegExp(e.source,c+"g");(a=regexpExec.call(f,r))&&!((i=f.lastIndex)>l&&(u.push(r.slice(l,a.index)),a.length>1&&a.index<r.length&&arrayPush.apply(u,a.slice(1)),s=a[0].length,l=i,u.length>=o));)f.lastIndex===a.index&&f.lastIndex++;return l===r.length?!s&&f.test("")||u.push(""):u.push(r.slice(l)),u.length>o?u.slice(0,o):u}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var o=requireObjectCoercible(this),a=null==t?void 0:getMethod(t,e);return a?a.call(t,o,n):r.call(toString(o),t,n)},function(e,o){var a=anObject(this),i=toString(e),s=n(r,a,i,o,r!==t);if(s.done)return s.value;var u=speciesConstructor(a,RegExp),c=a.unicode,l=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(UNSUPPORTED_Y?"g":"y"),f=new u(UNSUPPORTED_Y?"^(?:"+a.source+")":a,l),p=void 0===o?MAX_UINT32:o>>>0;if(0===p)return[];if(0===i.length)return null===regexpExecAbstract(f,i)?[i]:[];for(var h=0,d=0,v=[];d<i.length;){f.lastIndex=UNSUPPORTED_Y?0:d;var m,g=regexpExecAbstract(f,UNSUPPORTED_Y?i.slice(d):i);if(null===g||(m=min$4(toLength(f.lastIndex+(UNSUPPORTED_Y?d:0)),i.length))===h)d=advanceStringIndex(i,d,c);else{if(v.push(i.slice(h,d)),v.length===p)return v;for(var y=1;y<=g.length-1;y++)if(v.push(g[y]),v.length===p)return v;d=h=m}}return v.push(i.slice(h)),v}]}),!SPLIT_WORKS_WITH_OVERWRITTEN_EXEC,UNSUPPORTED_Y),fixRegexpWellKnownSymbolLogic("match",(function(e,t,n){return[function(t){var n=requireObjectCoercible(this),r=null==t?void 0:getMethod(t,e);return r?r.call(t,n):new RegExp(t)[e](toString(n))},function(e){var r=anObject(this),o=toString(e),a=n(t,r,o);if(a.done)return a.value;if(!r.global)return regexpExecAbstract(r,o);var i=r.unicode;r.lastIndex=0;for(var s,u=[],c=0;null!==(s=regexpExecAbstract(r,o));){var l=toString(s[0]);u[c]=l,""===l&&(r.lastIndex=advanceStringIndex(o,toLength(r.lastIndex),i)),c++}return 0===c?null:u}]}));var UNSCOPABLES=wellKnownSymbol("unscopables"),ArrayPrototype=Array.prototype;null==ArrayPrototype[UNSCOPABLES]&&objectDefineProperty.f(ArrayPrototype,UNSCOPABLES,{configurable:!0,value:objectCreate(null)});var addToUnscopables=function(e){ArrayPrototype[UNSCOPABLES][e]=!0},correctPrototypeGetter=!fails((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),IE_PROTO=sharedKey("IE_PROTO"),ObjectPrototype$2=Object.prototype,objectGetPrototypeOf=correctPrototypeGetter?Object.getPrototypeOf:function(e){var t=toObject(e);if(has$1(t,IE_PROTO))return t[IE_PROTO];var n=t.constructor;return isCallable(n)&&t instanceof n?n.prototype:t instanceof Object?ObjectPrototype$2:null},ITERATOR$5=wellKnownSymbol("iterator"),BUGGY_SAFARI_ITERATORS$1=!1,IteratorPrototype$2,PrototypeOfArrayIteratorPrototype,arrayIterator;[].keys&&(arrayIterator=[].keys(),"next"in arrayIterator?(PrototypeOfArrayIteratorPrototype=objectGetPrototypeOf(objectGetPrototypeOf(arrayIterator)),PrototypeOfArrayIteratorPrototype!==Object.prototype&&(IteratorPrototype$2=PrototypeOfArrayIteratorPrototype)):BUGGY_SAFARI_ITERATORS$1=!0);var NEW_ITERATOR_PROTOTYPE=null==IteratorPrototype$2||fails((function(){var e={};return IteratorPrototype$2[ITERATOR$5].call(e)!==e}));NEW_ITERATOR_PROTOTYPE&&(IteratorPrototype$2={}),isCallable(IteratorPrototype$2[ITERATOR$5])||redefine(IteratorPrototype$2,ITERATOR$5,(function(){return this}));var iteratorsCore={IteratorPrototype:IteratorPrototype$2,BUGGY_SAFARI_ITERATORS:BUGGY_SAFARI_ITERATORS$1},IteratorPrototype$1=iteratorsCore.IteratorPrototype,returnThis$1=function(){return this},createIteratorConstructor=function(e,t,n){var r=t+" Iterator";return e.prototype=objectCreate(IteratorPrototype$1,{next:createPropertyDescriptor(1,n)}),setToStringTag(e,r,!1),iterators[r]=returnThis$1,e},PROPER_FUNCTION_NAME$3=functionName.PROPER,CONFIGURABLE_FUNCTION_NAME$1=functionName.CONFIGURABLE,IteratorPrototype=iteratorsCore.IteratorPrototype,BUGGY_SAFARI_ITERATORS=iteratorsCore.BUGGY_SAFARI_ITERATORS,ITERATOR$4=wellKnownSymbol("iterator"),KEYS="keys",VALUES="values",ENTRIES="entries",returnThis=function(){return this},defineIterator=function(e,t,n,r,o,a,i){createIteratorConstructor(n,t,r);var s,u,c,l=function(e){if(e===o&&v)return v;if(!BUGGY_SAFARI_ITERATORS&&e in h)return h[e];switch(e){case KEYS:case VALUES:case ENTRIES:return function(){return new n(this,e)}}return function(){return new n(this)}},f=t+" Iterator",p=!1,h=e.prototype,d=h[ITERATOR$4]||h["@@iterator"]||o&&h[o],v=!BUGGY_SAFARI_ITERATORS&&d||l(o),m="Array"==t&&h.entries||d;if(m&&(s=objectGetPrototypeOf(m.call(new e)))!==Object.prototype&&s.next&&(objectGetPrototypeOf(s)!==IteratorPrototype&&(objectSetPrototypeOf?objectSetPrototypeOf(s,IteratorPrototype):isCallable(s[ITERATOR$4])||redefine(s,ITERATOR$4,returnThis)),setToStringTag(s,f,!0)),PROPER_FUNCTION_NAME$3&&o==VALUES&&d&&d.name!==VALUES&&(CONFIGURABLE_FUNCTION_NAME$1?createNonEnumerableProperty(h,"name",VALUES):(p=!0,v=function(){return d.call(this)})),o)if(u={values:l(VALUES),keys:a?v:l(KEYS),entries:l(ENTRIES)},i)for(c in u)(BUGGY_SAFARI_ITERATORS||p||!(c in h))&&redefine(h,c,u[c]);else _export({target:t,proto:!0,forced:BUGGY_SAFARI_ITERATORS||p},u);return h[ITERATOR$4]!==v&&redefine(h,ITERATOR$4,v,{name:o}),iterators[t]=v,u},ARRAY_ITERATOR="Array Iterator",setInternalState$4=internalState.set,getInternalState$2=internalState.getterFor(ARRAY_ITERATOR),es_array_iterator=defineIterator(Array,"Array",(function(e,t){setInternalState$4(this,{type:ARRAY_ITERATOR,target:toIndexedObject(e),index:0,kind:t})}),(function(){var e=getInternalState$2(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");iterators.Arguments=iterators.Array,addToUnscopables("keys"),addToUnscopables("values"),addToUnscopables("entries");var arrayBufferNative="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,defineProperty$1=objectDefineProperty.f,Int8Array$3=global$1.Int8Array,Int8ArrayPrototype=Int8Array$3&&Int8Array$3.prototype,Uint8ClampedArray=global$1.Uint8ClampedArray,Uint8ClampedArrayPrototype=Uint8ClampedArray&&Uint8ClampedArray.prototype,TypedArray=Int8Array$3&&objectGetPrototypeOf(Int8Array$3),TypedArrayPrototype=Int8ArrayPrototype&&objectGetPrototypeOf(Int8ArrayPrototype),ObjectPrototype$1=Object.prototype,isPrototypeOf=ObjectPrototype$1.isPrototypeOf,TO_STRING_TAG$1=wellKnownSymbol("toStringTag"),TYPED_ARRAY_TAG=uid("TYPED_ARRAY_TAG"),TYPED_ARRAY_CONSTRUCTOR$1=uid("TYPED_ARRAY_CONSTRUCTOR"),NATIVE_ARRAY_BUFFER_VIEWS$1=arrayBufferNative&&!!objectSetPrototypeOf&&"Opera"!==classof(global$1.opera),TYPED_ARRAY_TAG_REQIRED=!1,NAME,Constructor,Prototype,TypedArrayConstructorsList={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},BigIntArrayConstructorsList={BigInt64Array:8,BigUint64Array:8},isView=function(e){if(!isObject(e))return!1;var t=classof(e);return"DataView"===t||has$1(TypedArrayConstructorsList,t)||has$1(BigIntArrayConstructorsList,t)},isTypedArray=function(e){if(!isObject(e))return!1;var t=classof(e);return has$1(TypedArrayConstructorsList,t)||has$1(BigIntArrayConstructorsList,t)},aTypedArray$m=function(e){if(isTypedArray(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor$2=function(e){if(isCallable(e)&&(!objectSetPrototypeOf||isPrototypeOf.call(TypedArray,e)))return e;throw TypeError(tryToString(e)+" is not a typed array constructor")},exportTypedArrayMethod$n=function(e,t,n){if(descriptors){if(n)for(var r in TypedArrayConstructorsList){var o=global$1[r];if(o&&has$1(o.prototype,e))try{delete o.prototype[e]}catch(e){}}TypedArrayPrototype[e]&&!n||redefine(TypedArrayPrototype,e,n?t:NATIVE_ARRAY_BUFFER_VIEWS$1&&Int8ArrayPrototype[e]||t)}},exportTypedArrayStaticMethod=function(e,t,n){var r,o;if(descriptors){if(objectSetPrototypeOf){if(n)for(r in TypedArrayConstructorsList)if((o=global$1[r])&&has$1(o,e))try{delete o[e]}catch(e){}if(TypedArray[e]&&!n)return;try{return redefine(TypedArray,e,n?t:NATIVE_ARRAY_BUFFER_VIEWS$1&&TypedArray[e]||t)}catch(e){}}for(r in TypedArrayConstructorsList)!(o=global$1[r])||o[e]&&!n||redefine(o,e,t)}};for(NAME in TypedArrayConstructorsList)Constructor=global$1[NAME],Prototype=Constructor&&Constructor.prototype,Prototype?createNonEnumerableProperty(Prototype,TYPED_ARRAY_CONSTRUCTOR$1,Constructor):NATIVE_ARRAY_BUFFER_VIEWS$1=!1;for(NAME in BigIntArrayConstructorsList)Constructor=global$1[NAME],Prototype=Constructor&&Constructor.prototype,Prototype&&createNonEnumerableProperty(Prototype,TYPED_ARRAY_CONSTRUCTOR$1,Constructor);if((!NATIVE_ARRAY_BUFFER_VIEWS$1||!isCallable(TypedArray)||TypedArray===Function.prototype)&&(TypedArray=function(){throw TypeError("Incorrect invocation")},NATIVE_ARRAY_BUFFER_VIEWS$1))for(NAME in TypedArrayConstructorsList)global$1[NAME]&&objectSetPrototypeOf(global$1[NAME],TypedArray);if((!NATIVE_ARRAY_BUFFER_VIEWS$1||!TypedArrayPrototype||TypedArrayPrototype===ObjectPrototype$1)&&(TypedArrayPrototype=TypedArray.prototype,NATIVE_ARRAY_BUFFER_VIEWS$1))for(NAME in TypedArrayConstructorsList)global$1[NAME]&&objectSetPrototypeOf(global$1[NAME].prototype,TypedArrayPrototype);if(NATIVE_ARRAY_BUFFER_VIEWS$1&&objectGetPrototypeOf(Uint8ClampedArrayPrototype)!==TypedArrayPrototype&&objectSetPrototypeOf(Uint8ClampedArrayPrototype,TypedArrayPrototype),descriptors&&!has$1(TypedArrayPrototype,TO_STRING_TAG$1))for(NAME in TYPED_ARRAY_TAG_REQIRED=!0,defineProperty$1(TypedArrayPrototype,TO_STRING_TAG$1,{get:function(){return isObject(this)?this[TYPED_ARRAY_TAG]:void 0}}),TypedArrayConstructorsList)global$1[NAME]&&createNonEnumerableProperty(global$1[NAME],TYPED_ARRAY_TAG,NAME);var arrayBufferViewCore={NATIVE_ARRAY_BUFFER_VIEWS:NATIVE_ARRAY_BUFFER_VIEWS$1,TYPED_ARRAY_CONSTRUCTOR:TYPED_ARRAY_CONSTRUCTOR$1,TYPED_ARRAY_TAG:TYPED_ARRAY_TAG_REQIRED&&TYPED_ARRAY_TAG,aTypedArray:aTypedArray$m,aTypedArrayConstructor:aTypedArrayConstructor$2,exportTypedArrayMethod:exportTypedArrayMethod$n,exportTypedArrayStaticMethod:exportTypedArrayStaticMethod,isView:isView,isTypedArray:isTypedArray,TypedArray:TypedArray,TypedArrayPrototype:TypedArrayPrototype},NATIVE_ARRAY_BUFFER_VIEWS=arrayBufferViewCore.NATIVE_ARRAY_BUFFER_VIEWS,ArrayBuffer$1=global$1.ArrayBuffer,Int8Array$2=global$1.Int8Array,typedArrayConstructorsRequireWrappers=!NATIVE_ARRAY_BUFFER_VIEWS||!fails((function(){Int8Array$2(1)}))||!fails((function(){new Int8Array$2(-1)}))||!checkCorrectnessOfIteration((function(e){new Int8Array$2,new Int8Array$2(null),new Int8Array$2(1.5),new Int8Array$2(e)}),!0)||fails((function(){return 1!==new Int8Array$2(new ArrayBuffer$1(2),1,void 0).length})),toIndex=function(e){if(void 0===e)return 0;var t=toInteger(e),n=toLength(t);if(t!==n)throw RangeError("Wrong length or index");return n},abs=Math.abs,pow$1=Math.pow,floor$6=Math.floor,log=Math.log,LN2=Math.LN2,pack=function(e,t,n){var r,o,a,i=new Array(n),s=8*n-t-1,u=(1<<s)-1,c=u>>1,l=23===t?pow$1(2,-24)-pow$1(2,-77):0,f=e<0||0===e&&1/e<0?1:0,p=0;for((e=abs(e))!=e||e===1/0?(o=e!=e?1:0,r=u):(r=floor$6(log(e)/LN2),e*(a=pow$1(2,-r))<1&&(r--,a*=2),(e+=r+c>=1?l/a:l*pow$1(2,1-c))*a>=2&&(r++,a/=2),r+c>=u?(o=0,r=u):r+c>=1?(o=(e*a-1)*pow$1(2,t),r+=c):(o=e*pow$1(2,c-1)*pow$1(2,t),r=0));t>=8;i[p++]=255&o,o/=256,t-=8);for(r=r<<t|o,s+=t;s>0;i[p++]=255&r,r/=256,s-=8);return i[--p]|=128*f,i},unpack=function(e,t){var n,r=e.length,o=8*r-t-1,a=(1<<o)-1,i=a>>1,s=o-7,u=r-1,c=e[u--],l=127&c;for(c>>=7;s>0;l=256*l+e[u],u--,s-=8);for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;n=256*n+e[u],u--,s-=8);if(0===l)l=1-i;else{if(l===a)return n?NaN:c?-1/0:1/0;n+=pow$1(2,t),l-=i}return(c?-1:1)*n*pow$1(2,l-t)},ieee754={pack:pack,unpack:unpack},arrayFill=function(e){for(var t=toObject(this),n=toLength(t.length),r=arguments.length,o=toAbsoluteIndex(r>1?arguments[1]:void 0,n),a=r>2?arguments[2]:void 0,i=void 0===a?n:toAbsoluteIndex(a,n);i>o;)t[o++]=e;return t},getOwnPropertyNames=objectGetOwnPropertyNames.f,defineProperty=objectDefineProperty.f,PROPER_FUNCTION_NAME$2=functionName.PROPER,CONFIGURABLE_FUNCTION_NAME=functionName.CONFIGURABLE,getInternalState$1=internalState.get,setInternalState$3=internalState.set,ARRAY_BUFFER="ArrayBuffer",DATA_VIEW="DataView",PROTOTYPE="prototype",WRONG_LENGTH="Wrong length",WRONG_INDEX="Wrong index",NativeArrayBuffer=global$1[ARRAY_BUFFER],$ArrayBuffer=NativeArrayBuffer,$DataView=global$1[DATA_VIEW],$DataViewPrototype=$DataView&&$DataView[PROTOTYPE],ObjectPrototype=Object.prototype,RangeError$1=global$1.RangeError,packIEEE754=ieee754.pack,unpackIEEE754=ieee754.unpack,packInt8=function(e){return[255&e]},packInt16=function(e){return[255&e,e>>8&255]},packInt32=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},unpackInt32=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},packFloat32=function(e){return packIEEE754(e,23,4)},packFloat64=function(e){return packIEEE754(e,52,8)},addGetter=function(e,t){defineProperty(e[PROTOTYPE],t,{get:function(){return getInternalState$1(this)[t]}})},get=function(e,t,n,r){var o=toIndex(n),a=getInternalState$1(e);if(o+t>a.byteLength)throw RangeError$1(WRONG_INDEX);var i=getInternalState$1(a.buffer).bytes,s=o+a.byteOffset,u=i.slice(s,s+t);return r?u:u.reverse()},set=function(e,t,n,r,o,a){var i=toIndex(n),s=getInternalState$1(e);if(i+t>s.byteLength)throw RangeError$1(WRONG_INDEX);for(var u=getInternalState$1(s.buffer).bytes,c=i+s.byteOffset,l=r(+o),f=0;f<t;f++)u[c+f]=l[a?f:t-f-1]};if(arrayBufferNative){var INCORRECT_ARRAY_BUFFER_NAME=PROPER_FUNCTION_NAME$2&&NativeArrayBuffer.name!==ARRAY_BUFFER;if(fails((function(){NativeArrayBuffer(1)}))&&fails((function(){new NativeArrayBuffer(-1)}))&&!fails((function(){return new NativeArrayBuffer,new NativeArrayBuffer(1.5),new NativeArrayBuffer(NaN),INCORRECT_ARRAY_BUFFER_NAME&&!CONFIGURABLE_FUNCTION_NAME})))INCORRECT_ARRAY_BUFFER_NAME&&CONFIGURABLE_FUNCTION_NAME&&createNonEnumerableProperty(NativeArrayBuffer,"name",ARRAY_BUFFER);else{$ArrayBuffer=function(e){return anInstance(this,$ArrayBuffer),new NativeArrayBuffer(toIndex(e))};for(var ArrayBufferPrototype=$ArrayBuffer[PROTOTYPE]=NativeArrayBuffer[PROTOTYPE],keys=getOwnPropertyNames(NativeArrayBuffer),j=0,key;keys.length>j;)(key=keys[j++])in $ArrayBuffer||createNonEnumerableProperty($ArrayBuffer,key,NativeArrayBuffer[key]);ArrayBufferPrototype.constructor=$ArrayBuffer}objectSetPrototypeOf&&objectGetPrototypeOf($DataViewPrototype)!==ObjectPrototype&&objectSetPrototypeOf($DataViewPrototype,ObjectPrototype);var testView=new $DataView(new $ArrayBuffer(2)),$setInt8=$DataViewPrototype.setInt8;testView.setInt8(0,2147483648),testView.setInt8(1,2147483649),!testView.getInt8(0)&&testView.getInt8(1)||redefineAll($DataViewPrototype,{setInt8:function(e,t){$setInt8.call(this,e,t<<24>>24)},setUint8:function(e,t){$setInt8.call(this,e,t<<24>>24)}},{unsafe:!0})}else $ArrayBuffer=function(e){anInstance(this,$ArrayBuffer,ARRAY_BUFFER);var t=toIndex(e);setInternalState$3(this,{bytes:arrayFill.call(new Array(t),0),byteLength:t}),descriptors||(this.byteLength=t)},$DataView=function(e,t,n){anInstance(this,$DataView,DATA_VIEW),anInstance(e,$ArrayBuffer,DATA_VIEW);var r=getInternalState$1(e).byteLength,o=toInteger(t);if(o<0||o>r)throw RangeError$1("Wrong offset");if(o+(n=void 0===n?r-o:toLength(n))>r)throw RangeError$1(WRONG_LENGTH);setInternalState$3(this,{buffer:e,byteLength:n,byteOffset:o}),descriptors||(this.buffer=e,this.byteLength=n,this.byteOffset=o)},descriptors&&(addGetter($ArrayBuffer,"byteLength"),addGetter($DataView,"buffer"),addGetter($DataView,"byteLength"),addGetter($DataView,"byteOffset")),redefineAll($DataView[PROTOTYPE],{getInt8:function(e){return get(this,1,e)[0]<<24>>24},getUint8:function(e){return get(this,1,e)[0]},getInt16:function(e){var t=get(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=get(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return unpackInt32(get(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return unpackInt32(get(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return unpackIEEE754(get(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return unpackIEEE754(get(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){set(this,1,e,packInt8,t)},setUint8:function(e,t){set(this,1,e,packInt8,t)},setInt16:function(e,t){set(this,2,e,packInt16,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){set(this,2,e,packInt16,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){set(this,4,e,packInt32,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){set(this,4,e,packInt32,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){set(this,4,e,packFloat32,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){set(this,8,e,packFloat64,t,arguments.length>2?arguments[2]:void 0)}});setToStringTag($ArrayBuffer,ARRAY_BUFFER),setToStringTag($DataView,DATA_VIEW);var arrayBuffer={ArrayBuffer:$ArrayBuffer,DataView:$DataView},floor$5=Math.floor,isInteger=function(e){return!isObject(e)&&isFinite(e)&&floor$5(e)===e},toPositiveInteger=function(e){var t=toInteger(e);if(t<0)throw RangeError("The argument can't be less than 0");return t},toOffset=function(e,t){var n=toPositiveInteger(e);if(n%t)throw RangeError("Wrong offset");return n},aTypedArrayConstructor$1=arrayBufferViewCore.aTypedArrayConstructor,typedArrayFrom=function(e){var t,n,r,o,a,i,s=aConstructor(this),u=toObject(e),c=arguments.length,l=c>1?arguments[1]:void 0,f=void 0!==l,p=getIteratorMethod(u);if(p&&!isArrayIteratorMethod(p))for(i=(a=getIterator(u,p)).next,u=[];!(o=i.call(a)).done;)u.push(o.value);for(f&&c>2&&(l=functionBindContext(l,arguments[2],2)),n=toLength(u.length),r=new(aTypedArrayConstructor$1(s))(n),t=0;n>t;t++)r[t]=f?l(u[t],t):u[t];return r},isArray=Array.isArray||function(e){return"Array"==classofRaw(e)},SPECIES$2=wellKnownSymbol("species"),arraySpeciesConstructor=function(e){var t;return isArray(e)&&(t=e.constructor,(isConstructor(t)&&(t===Array||isArray(t.prototype))||isObject(t)&&null===(t=t[SPECIES$2]))&&(t=void 0)),void 0===t?Array:t},arraySpeciesCreate=function(e,t){return new(arraySpeciesConstructor(e))(0===t?0:t)},push=[].push,createMethod$2=function(e){var t=1==e,n=2==e,r=3==e,o=4==e,a=6==e,i=7==e,s=5==e||a;return function(u,c,l,f){for(var p,h,d=toObject(u),v=indexedObject(d),m=functionBindContext(c,l,3),g=toLength(v.length),y=0,b=f||arraySpeciesCreate,x=t?b(u,g):n||i?b(u,0):void 0;g>y;y++)if((s||y in v)&&(h=m(p=v[y],y,d),e))if(t)x[y]=h;else if(h)switch(e){case 3:return!0;case 5:return p;case 6:return y;case 2:push.call(x,p)}else switch(e){case 4:return!1;case 7:push.call(x,p)}return a?-1:r||o?o:x}},arrayIteration={forEach:createMethod$2(0),map:createMethod$2(1),filter:createMethod$2(2),some:createMethod$2(3),every:createMethod$2(4),find:createMethod$2(5),findIndex:createMethod$2(6),filterReject:createMethod$2(7)},typedArrayConstructor=createCommonjsModule((function(e){var t=objectGetOwnPropertyNames.f,n=arrayIteration.forEach,r=internalState.get,o=internalState.set,a=objectDefineProperty.f,i=objectGetOwnPropertyDescriptor.f,s=Math.round,u=global$1.RangeError,c=arrayBuffer.ArrayBuffer,l=arrayBuffer.DataView,f=arrayBufferViewCore.NATIVE_ARRAY_BUFFER_VIEWS,p=arrayBufferViewCore.TYPED_ARRAY_CONSTRUCTOR,h=arrayBufferViewCore.TYPED_ARRAY_TAG,d=arrayBufferViewCore.TypedArray,v=arrayBufferViewCore.TypedArrayPrototype,m=arrayBufferViewCore.aTypedArrayConstructor,g=arrayBufferViewCore.isTypedArray,y=function(e,t){for(var n=0,r=t.length,o=new(m(e))(r);r>n;)o[n]=t[n++];return o},b=function(e,t){a(e,t,{get:function(){return r(this)[t]}})},x=function(e){var t;return e instanceof c||"ArrayBuffer"==(t=classof(e))||"SharedArrayBuffer"==t},w=function(e,t){return g(e)&&!isSymbol(t)&&t in e&&isInteger(+t)&&t>=0},E=function(e,t){return t=toPropertyKey(t),w(e,t)?createPropertyDescriptor(2,e[t]):i(e,t)},A=function(e,t,n){return t=toPropertyKey(t),!(w(e,t)&&isObject(n)&&has$1(n,"value"))||has$1(n,"get")||has$1(n,"set")||n.configurable||has$1(n,"writable")&&!n.writable||has$1(n,"enumerable")&&!n.enumerable?a(e,t,n):(e[t]=n.value,e)};descriptors?(f||(objectGetOwnPropertyDescriptor.f=E,objectDefineProperty.f=A,b(v,"buffer"),b(v,"byteOffset"),b(v,"byteLength"),b(v,"length")),_export({target:"Object",stat:!0,forced:!f},{getOwnPropertyDescriptor:E,defineProperty:A}),e.exports=function(e,i,m){var b=e.match(/\d+$/)[0]/8,w=e+(m?"Clamped":"")+"Array",E="get"+e,A="set"+e,C=global$1[w],S=C,_=S&&S.prototype,I={},R=function(e,t){a(e,t,{get:function(){return function(e,t){var n=r(e);return n.view[E](t*b+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var o=r(e);m&&(n=(n=s(n))<0?0:n>255?255:255&n),o.view[A](t*b+o.byteOffset,n,!0)}(this,t,e)},enumerable:!0})};f?typedArrayConstructorsRequireWrappers&&(S=i((function(e,t,n,r){return anInstance(e,S,w),inheritIfRequired(isObject(t)?x(t)?void 0!==r?new C(t,toOffset(n,b),r):void 0!==n?new C(t,toOffset(n,b)):new C(t):g(t)?y(S,t):typedArrayFrom.call(S,t):new C(toIndex(t)),e,S)})),objectSetPrototypeOf&&objectSetPrototypeOf(S,d),n(t(C),(function(e){e in S||createNonEnumerableProperty(S,e,C[e])})),S.prototype=_):(S=i((function(e,t,n,r){anInstance(e,S,w);var a,i,s,f=0,p=0;if(isObject(t)){if(!x(t))return g(t)?y(S,t):typedArrayFrom.call(S,t);a=t,p=toOffset(n,b);var h=t.byteLength;if(void 0===r){if(h%b)throw u("Wrong length");if((i=h-p)<0)throw u("Wrong length")}else if((i=toLength(r)*b)+p>h)throw u("Wrong length");s=i/b}else s=toIndex(t),a=new c(i=s*b);for(o(e,{buffer:a,byteOffset:p,byteLength:i,length:s,view:new l(a)});f<s;)R(e,f++)})),objectSetPrototypeOf&&objectSetPrototypeOf(S,d),_=S.prototype=objectCreate(v)),_.constructor!==S&&createNonEnumerableProperty(_,"constructor",S),createNonEnumerableProperty(_,p,S),h&&createNonEnumerableProperty(_,h,w),I[w]=S,_export({global:!0,forced:S!=C,sham:!f},I),"BYTES_PER_ELEMENT"in S||createNonEnumerableProperty(S,"BYTES_PER_ELEMENT",b),"BYTES_PER_ELEMENT"in _||createNonEnumerableProperty(_,"BYTES_PER_ELEMENT",b),setSpecies(w)}):e.exports=function(){}}));typedArrayConstructor("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var min$3=Math.min,arrayCopyWithin=[].copyWithin||function(e,t){var n=toObject(this),r=toLength(n.length),o=toAbsoluteIndex(e,r),a=toAbsoluteIndex(t,r),i=arguments.length>2?arguments[2]:void 0,s=min$3((void 0===i?r:toAbsoluteIndex(i,r))-a,r-o),u=1;for(a<o&&o<a+s&&(u=-1,a+=s-1,o+=s-1);s-- >0;)a in n?n[o]=n[a]:delete n[o],o+=u,a+=u;return n},aTypedArray$l=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$m=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$m("copyWithin",(function(e,t){return arrayCopyWithin.call(aTypedArray$l(this),e,t,arguments.length>2?arguments[2]:void 0)}));var $every=arrayIteration.every,aTypedArray$k=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$l=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$l("every",(function(e){return $every(aTypedArray$k(this),e,arguments.length>1?arguments[1]:void 0)}));var aTypedArray$j=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$k=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$k("fill",(function(e){return arrayFill.apply(aTypedArray$j(this),arguments)}));var arrayFromConstructorAndList=function(e,t){for(var n=0,r=t.length,o=new e(r);r>n;)o[n]=t[n++];return o},TYPED_ARRAY_CONSTRUCTOR=arrayBufferViewCore.TYPED_ARRAY_CONSTRUCTOR,aTypedArrayConstructor=arrayBufferViewCore.aTypedArrayConstructor,typedArraySpeciesConstructor=function(e){return aTypedArrayConstructor(speciesConstructor(e,e[TYPED_ARRAY_CONSTRUCTOR]))},typedArrayFromSpeciesAndList=function(e,t){return arrayFromConstructorAndList(typedArraySpeciesConstructor(e),t)},$filter$1=arrayIteration.filter,aTypedArray$i=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$j=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$j("filter",(function(e){var t=$filter$1(aTypedArray$i(this),e,arguments.length>1?arguments[1]:void 0);return typedArrayFromSpeciesAndList(this,t)}));var $find=arrayIteration.find,aTypedArray$h=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$i=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$i("find",(function(e){return $find(aTypedArray$h(this),e,arguments.length>1?arguments[1]:void 0)}));var $findIndex=arrayIteration.findIndex,aTypedArray$g=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$h=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$h("findIndex",(function(e){return $findIndex(aTypedArray$g(this),e,arguments.length>1?arguments[1]:void 0)}));var $forEach$1=arrayIteration.forEach,aTypedArray$f=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$g=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$g("forEach",(function(e){$forEach$1(aTypedArray$f(this),e,arguments.length>1?arguments[1]:void 0)}));var $includes$1=arrayIncludes.includes,aTypedArray$e=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$f=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$f("includes",(function(e){return $includes$1(aTypedArray$e(this),e,arguments.length>1?arguments[1]:void 0)}));var $indexOf=arrayIncludes.indexOf,aTypedArray$d=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$e=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$e("indexOf",(function(e){return $indexOf(aTypedArray$d(this),e,arguments.length>1?arguments[1]:void 0)}));var PROPER_FUNCTION_NAME$1=functionName.PROPER,ITERATOR$3=wellKnownSymbol("iterator"),Uint8Array$2=global$1.Uint8Array,arrayValues=es_array_iterator.values,arrayKeys=es_array_iterator.keys,arrayEntries=es_array_iterator.entries,aTypedArray$c=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$d=arrayBufferViewCore.exportTypedArrayMethod,nativeTypedArrayIterator=Uint8Array$2&&Uint8Array$2.prototype[ITERATOR$3],PROPER_ARRAY_VALUES_NAME=!!nativeTypedArrayIterator&&"values"===nativeTypedArrayIterator.name,typedArrayValues=function(){return arrayValues.call(aTypedArray$c(this))};exportTypedArrayMethod$d("entries",(function(){return arrayEntries.call(aTypedArray$c(this))})),exportTypedArrayMethod$d("keys",(function(){return arrayKeys.call(aTypedArray$c(this))})),exportTypedArrayMethod$d("values",typedArrayValues,PROPER_FUNCTION_NAME$1&&!PROPER_ARRAY_VALUES_NAME),exportTypedArrayMethod$d(ITERATOR$3,typedArrayValues,PROPER_FUNCTION_NAME$1&&!PROPER_ARRAY_VALUES_NAME);var aTypedArray$b=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$c=arrayBufferViewCore.exportTypedArrayMethod,$join=[].join;exportTypedArrayMethod$c("join",(function(e){return $join.apply(aTypedArray$b(this),arguments)}));var arrayMethodIsStrict=function(e,t){var n=[][e];return!!n&&fails((function(){n.call(null,t||function(){throw 1},1)}))},min$2=Math.min,$lastIndexOf=[].lastIndexOf,NEGATIVE_ZERO=!!$lastIndexOf&&1/[1].lastIndexOf(1,-0)<0,STRICT_METHOD$2=arrayMethodIsStrict("lastIndexOf"),FORCED$5=NEGATIVE_ZERO||!STRICT_METHOD$2,arrayLastIndexOf=FORCED$5?function(e){if(NEGATIVE_ZERO)return $lastIndexOf.apply(this,arguments)||0;var t=toIndexedObject(this),n=toLength(t.length),r=n-1;for(arguments.length>1&&(r=min$2(r,toInteger(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:$lastIndexOf,aTypedArray$a=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$b=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$b("lastIndexOf",(function(e){return arrayLastIndexOf.apply(aTypedArray$a(this),arguments)}));var $map=arrayIteration.map,aTypedArray$9=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$a=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$a("map",(function(e){return $map(aTypedArray$9(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(typedArraySpeciesConstructor(e))(t)}))}));var createMethod$1=function(e){return function(t,n,r,o){aCallable(n);var a=toObject(t),i=indexedObject(a),s=toLength(a.length),u=e?s-1:0,c=e?-1:1;if(r<2)for(;;){if(u in i){o=i[u],u+=c;break}if(u+=c,e?u<0:s<=u)throw TypeError("Reduce of empty array with no initial value")}for(;e?u>=0:s>u;u+=c)u in i&&(o=n(o,i[u],u,a));return o}},arrayReduce={left:createMethod$1(!1),right:createMethod$1(!0)},$reduce=arrayReduce.left,aTypedArray$8=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$9=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$9("reduce",(function(e){return $reduce(aTypedArray$8(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var $reduceRight=arrayReduce.right,aTypedArray$7=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$8=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$8("reduceRight",(function(e){return $reduceRight(aTypedArray$7(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var aTypedArray$6=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$7=arrayBufferViewCore.exportTypedArrayMethod,floor$4=Math.floor;exportTypedArrayMethod$7("reverse",(function(){for(var e,t=aTypedArray$6(this).length,n=floor$4(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}));var aTypedArray$5=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$6=arrayBufferViewCore.exportTypedArrayMethod,FORCED$4=fails((function(){new Int8Array(1).set({})}));exportTypedArrayMethod$6("set",(function(e){aTypedArray$5(this);var t=toOffset(arguments.length>1?arguments[1]:void 0,1),n=this.length,r=toObject(e),o=toLength(r.length),a=0;if(o+t>n)throw RangeError("Wrong length");for(;a<o;)this[t+a]=r[a++]}),FORCED$4);var aTypedArray$4=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$5=arrayBufferViewCore.exportTypedArrayMethod,$slice$1=[].slice,FORCED$3=fails((function(){new Int8Array(1).slice()}));exportTypedArrayMethod$5("slice",(function(e,t){for(var n=$slice$1.call(aTypedArray$4(this),e,t),r=typedArraySpeciesConstructor(this),o=0,a=n.length,i=new r(a);a>o;)i[o]=n[o++];return i}),FORCED$3);var $some=arrayIteration.some,aTypedArray$3=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$4=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$4("some",(function(e){return $some(aTypedArray$3(this),e,arguments.length>1?arguments[1]:void 0)}));var floor$3=Math.floor,mergeSort=function(e,t){var n=e.length,r=floor$3(n/2);return n<8?insertionSort(e,t):merge(mergeSort(e.slice(0,r),t),mergeSort(e.slice(r),t),t)},insertionSort=function(e,t){for(var n,r,o=e.length,a=1;a<o;){for(r=a,n=e[a];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==a++&&(e[r]=n)}return e},merge=function(e,t,n){for(var r=e.length,o=t.length,a=0,i=0,s=[];a<r||i<o;)a<r&&i<o?s.push(n(e[a],t[i])<=0?e[a++]:t[i++]):s.push(a<r?e[a++]:t[i++]);return s},arraySort=mergeSort,firefox=engineUserAgent.match(/firefox\/(\d+)/i),engineFfVersion=!!firefox&&+firefox[1],engineIsIeOrEdge=/MSIE|Trident/.test(engineUserAgent),webkit=engineUserAgent.match(/AppleWebKit\/(\d+)\./),engineWebkitVersion=!!webkit&&+webkit[1],aTypedArray$2=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$3=arrayBufferViewCore.exportTypedArrayMethod,Uint16Array$1=global$1.Uint16Array,nativeSort$1=Uint16Array$1&&Uint16Array$1.prototype.sort,ACCEPT_INCORRECT_ARGUMENTS=!!nativeSort$1&&!fails((function(){var e=new Uint16Array$1(2);e.sort(null),e.sort({})})),STABLE_SORT$1=!!nativeSort$1&&!fails((function(){if(engineV8Version)return engineV8Version<74;if(engineFfVersion)return engineFfVersion<67;if(engineIsIeOrEdge)return!0;if(engineWebkitVersion)return engineWebkitVersion<602;var e,t,n=new Uint16Array$1(516),r=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(n.sort((function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0})),getSortCompare$1=function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}};exportTypedArrayMethod$3("sort",(function(e){if(void 0!==e&&aCallable(e),STABLE_SORT$1)return nativeSort$1.call(this,e);aTypedArray$2(this);var t,n=toLength(this.length),r=Array(n);for(t=0;t<n;t++)r[t]=this[t];for(r=arraySort(this,getSortCompare$1(e)),t=0;t<n;t++)this[t]=r[t];return this}),!STABLE_SORT$1||ACCEPT_INCORRECT_ARGUMENTS);var aTypedArray$1=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$2=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$2("subarray",(function(e,t){var n=aTypedArray$1(this),r=n.length,o=toAbsoluteIndex(e,r);return new(typedArraySpeciesConstructor(n))(n.buffer,n.byteOffset+o*n.BYTES_PER_ELEMENT,toLength((void 0===t?r:toAbsoluteIndex(t,r))-o))}));var Int8Array$1=global$1.Int8Array,aTypedArray=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$1=arrayBufferViewCore.exportTypedArrayMethod,$toLocaleString=[].toLocaleString,$slice=[].slice,TO_LOCALE_STRING_BUG=!!Int8Array$1&&fails((function(){$toLocaleString.call(new Int8Array$1(1))})),FORCED$2=fails((function(){return[1,2].toLocaleString()!=new Int8Array$1([1,2]).toLocaleString()}))||!fails((function(){Int8Array$1.prototype.toLocaleString.call([1,2])}));exportTypedArrayMethod$1("toLocaleString",(function(){return $toLocaleString.apply(TO_LOCALE_STRING_BUG?$slice.call(aTypedArray(this)):aTypedArray(this),arguments)}),FORCED$2);var exportTypedArrayMethod=arrayBufferViewCore.exportTypedArrayMethod,Uint8Array$1=global$1.Uint8Array,Uint8ArrayPrototype=Uint8Array$1&&Uint8Array$1.prototype||{},arrayToString=[].toString,arrayJoin=[].join;fails((function(){arrayToString.call({})}))&&(arrayToString=function(){return arrayJoin.call(this)});var IS_NOT_ARRAY_METHOD=Uint8ArrayPrototype.toString!=arrayToString;exportTypedArrayMethod("toString",arrayToString,IS_NOT_ARRAY_METHOD);var $includes=arrayIncludes.includes;_export({target:"Array",proto:!0},{includes:function(e){return $includes(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables("includes");var notARegexp=function(e){if(isRegexp(e))throw TypeError("The method doesn't accept regular expressions");return e},MATCH=wellKnownSymbol("match"),correctIsRegexpLogic=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[MATCH]=!1,"/./"[e](t)}catch(e){}}return!1};_export({target:"String",proto:!0,forced:!correctIsRegexpLogic("includes")},{includes:function(e){return!!~toString(requireObjectCoercible(this)).indexOf(toString(notARegexp(e)),arguments.length>1?arguments[1]:void 0)}});var createProperty=function(e,t,n){var r=toPropertyKey(t);r in e?objectDefineProperty.f(e,r,createPropertyDescriptor(0,n)):e[r]=n},SPECIES$1=wellKnownSymbol("species"),arrayMethodHasSpeciesSupport=function(e){return engineV8Version>=51||!fails((function(){var t=[];return(t.constructor={})[SPECIES$1]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},HAS_SPECIES_SUPPORT$1=arrayMethodHasSpeciesSupport("slice"),SPECIES=wellKnownSymbol("species"),nativeSlice=[].slice,max$1=Math.max;_export({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$1},{slice:function(e,t){var n,r,o,a=toIndexedObject(this),i=toLength(a.length),s=toAbsoluteIndex(e,i),u=toAbsoluteIndex(void 0===t?i:t,i);if(isArray(a)&&(n=a.constructor,(isConstructor(n)&&(n===Array||isArray(n.prototype))||isObject(n)&&null===(n=n[SPECIES]))&&(n=void 0),n===Array||void 0===n))return nativeSlice.call(a,s,u);for(r=new(void 0===n?Array:n)(max$1(u-s,0)),o=0;s<u;s++,o++)s in a&&createProperty(r,o,a[s]);return r.length=o,r}}),typedArrayConstructor("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),typedArrayConstructor("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var $filter=arrayIteration.filter,HAS_SPECIES_SUPPORT=arrayMethodHasSpeciesSupport("filter");_export({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT},{filter:function(e){return $filter(this,e,arguments.length>1?arguments[1]:void 0)}});var PROPER_FUNCTION_NAME=functionName.PROPER,TO_STRING="toString",RegExpPrototype=RegExp.prototype,nativeToString=RegExpPrototype[TO_STRING],NOT_GENERIC=fails((function(){return"/a/b"!=nativeToString.call({source:"a",flags:"b"})})),INCORRECT_NAME=PROPER_FUNCTION_NAME&&nativeToString.name!=TO_STRING;(NOT_GENERIC||INCORRECT_NAME)&&redefine(RegExp.prototype,TO_STRING,(function(){var e=anObject(this),t=toString(e.source),n=e.flags;return"/"+t+"/"+toString(void 0===n&&e instanceof RegExp&&!("flags"in RegExpPrototype)?regexpFlags.call(e):n)}),{unsafe:!0});var test=[],nativeSort=test.sort,FAILS_ON_UNDEFINED=fails((function(){test.sort(void 0)})),FAILS_ON_NULL=fails((function(){test.sort(null)})),STRICT_METHOD$1=arrayMethodIsStrict("sort"),STABLE_SORT=!fails((function(){if(engineV8Version)return engineV8Version<70;if(!(engineFfVersion&&engineFfVersion>3)){if(engineIsIeOrEdge)return!0;if(engineWebkitVersion)return engineWebkitVersion<603;var e,t,n,r,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)test.push({k:t+r,v:n})}for(test.sort((function(e,t){return t.v-e.v})),r=0;r<test.length;r++)t=test[r].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return"DGBEFHACIJK"!==o}})),FORCED$1=FAILS_ON_UNDEFINED||!FAILS_ON_NULL||!STRICT_METHOD$1||!STABLE_SORT,getSortCompare=function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:toString(t)>toString(n)?1:-1}};_export({target:"Array",proto:!0,forced:FORCED$1},{sort:function(e){void 0!==e&&aCallable(e);var t=toObject(this);if(STABLE_SORT)return void 0===e?nativeSort.call(t):nativeSort.call(t,e);var n,r,o=[],a=toLength(t.length);for(r=0;r<a;r++)r in t&&o.push(t[r]);for(n=(o=arraySort(o,getSortCompare(e))).length,r=0;r<n;)t[r]=o[r++];for(;r<a;)delete t[r++];return t}});var UZIP_1=createCommonjsModule((function(e){var t,n,r={};e.exports=r,r.parse=function(e,t){for(var n=r.bin.readUshort,o=r.bin.readUint,a=0,i={},s=new Uint8Array(e),u=s.length-4;101010256!=o(s,u);)u--;a=u,a+=4;var c=n(s,a+=4);n(s,a+=2);var l=o(s,a+=2),f=o(s,a+=4);a+=4,a=f;for(var p=0;p<c;p++){o(s,a),a+=4,a+=4,a+=4,o(s,a+=4),l=o(s,a+=4);var h=o(s,a+=4),d=n(s,a+=4),v=n(s,a+2),m=n(s,a+4);a+=6;var g=o(s,a+=8);a+=4,a+=d+v+m,r._readLocal(s,g,i,l,h,t)}return i},r._readLocal=function(e,t,n,o,a,i){var s=r.bin.readUshort,u=r.bin.readUint;u(e,t),s(e,t+=4),s(e,t+=2);var c=s(e,t+=2);u(e,t+=2),u(e,t+=4),t+=4;var l=s(e,t+=8),f=s(e,t+=2);t+=2;var p=r.bin.readUTF8(e,t,l);if(t+=l,t+=f,i)n[p]={size:a,csize:o};else{var h=new Uint8Array(e.buffer,t);if(0==c)n[p]=new Uint8Array(h.buffer.slice(t,t+o));else{if(8!=c)throw"unknown compression method: "+c;var d=new Uint8Array(a);r.inflateRaw(h,d),n[p]=d}}},r.inflateRaw=function(e,t){return r.F.inflate(e,t)},r.inflate=function(e,t){return e[0],e[1],r.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},r.deflate=function(e,t){null==t&&(t={level:6});var n=0,o=new Uint8Array(50+Math.floor(1.1*e.length));o[n]=120,o[n+1]=156,n+=2,n=r.F.deflateRaw(e,o,n,t.level);var a=r.adler(e,0,e.length);return o[n+0]=a>>>24&255,o[n+1]=a>>>16&255,o[n+2]=a>>>8&255,o[n+3]=a>>>0&255,new Uint8Array(o.buffer,0,n+4)},r.deflateRaw=function(e,t){null==t&&(t={level:6});var n=new Uint8Array(50+Math.floor(1.1*e.length)),o=r.F.deflateRaw(e,n,o,t.level);return new Uint8Array(n.buffer,0,o)},r.encode=function(e,t){null==t&&(t=!1);var n=0,o=r.bin.writeUint,a=r.bin.writeUshort,i={};for(var s in e){var u=!r._noNeed(s)&&!t,c=e[s],l=r.crc.crc(c,0,c.length);i[s]={cpr:u,usize:c.length,crc:l,file:u?r.deflateRaw(c):c}}for(var s in i)n+=i[s].file.length+30+46+2*r.bin.sizeUTF8(s);n+=22;var f=new Uint8Array(n),p=0,h=[];for(var s in i){var d=i[s];h.push(p),p=r._writeHeader(f,p,s,d,0)}var v=0,m=p;for(var s in i)d=i[s],h.push(p),p=r._writeHeader(f,p,s,d,1,h[v++]);var g=p-m;return o(f,p,101010256),p+=4,a(f,p+=4,v),a(f,p+=2,v),o(f,p+=2,g),o(f,p+=4,m),p+=4,p+=2,f.buffer},r._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return-1!="png,jpg,jpeg,zip".indexOf(t)},r._writeHeader=function(e,t,n,o,a,i){var s=r.bin.writeUint,u=r.bin.writeUshort,c=o.file;return s(e,t,0==a?67324752:33639248),t+=4,1==a&&(t+=2),u(e,t,20),u(e,t+=2,0),u(e,t+=2,o.cpr?8:0),s(e,t+=2,0),s(e,t+=4,o.crc),s(e,t+=4,c.length),s(e,t+=4,o.usize),u(e,t+=4,r.bin.sizeUTF8(n)),u(e,t+=2,0),t+=2,1==a&&(t+=2,t+=2,s(e,t+=6,i),t+=4),t+=r.bin.writeUTF8(e,t,n),0==a&&(e.set(c,t),t+=c.length),t},r.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var n=t,r=0;r<8;r++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update:function(e,t,n,o){for(var a=0;a<o;a++)e=r.crc.table[255&(e^t[n+a])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^r.crc.update(4294967295,e,t,n)}},r.adler=function(e,t,n){for(var r=1,o=0,a=t,i=t+n;a<i;){for(var s=Math.min(a+5552,i);a<s;)o+=r+=e[a++];r%=65521,o%=65521}return o<<16|r},r.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255},readASCII:function(e,t,n){for(var r="",o=0;o<n;o++)r+=String.fromCharCode(e[t+o]);return r},writeASCII:function(e,t,n){for(var r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,n){for(var o,a="",i=0;i<n;i++)a+="%"+r.bin.pad(e[t+i].toString(16));try{o=decodeURIComponent(a)}catch(o){return r.bin.readASCII(e,t,n)}return o},writeUTF8:function(e,t,n){for(var r=n.length,o=0,a=0;a<r;a++){var i=n.charCodeAt(a);if(0==(4294967168&i))e[t+o]=i,o++;else if(0==(4294965248&i))e[t+o]=192|i>>6,e[t+o+1]=128|i>>0&63,o+=2;else if(0==(4294901760&i))e[t+o]=224|i>>12,e[t+o+1]=128|i>>6&63,e[t+o+2]=128|i>>0&63,o+=3;else{if(0!=(4292870144&i))throw"e";e[t+o]=240|i>>18,e[t+o+1]=128|i>>12&63,e[t+o+2]=128|i>>6&63,e[t+o+3]=128|i>>0&63,o+=4}}return o},sizeUTF8:function(e){for(var t=e.length,n=0,r=0;r<t;r++){var o=e.charCodeAt(r);if(0==(4294967168&o))n++;else if(0==(4294965248&o))n+=2;else if(0==(4294901760&o))n+=3;else{if(0!=(4292870144&o))throw"e";n+=4}}return n}},r.F={},r.F.deflateRaw=function(e,t,n,o){var a=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][o],i=r.F.U,s=r.F._goodIndex;r.F._hash;var u=r.F._putsE,c=0,l=n<<3,f=0,p=e.length;if(0==o){for(;c<p;)u(t,l,c+(C=Math.min(65535,p-c))==p?1:0),l=r.F._copyExact(e,c,C,t,l+8),c+=C;return l>>>3}var h=i.lits,d=i.strt,v=i.prev,m=0,g=0,y=0,b=0,x=0,w=0;for(p>2&&(d[w=r.F._hash(e,0)]=0),c=0;c<p;c++){if(x=w,c+1<p-2){w=r.F._hash(e,c+1);var E=c+1&32767;v[E]=d[w],d[w]=E}if(f<=c){(m>14e3||g>26697)&&p-c>100&&(f<c&&(h[m]=c-f,m+=2,f=c),l=r.F._writeBlock(c==p-1||f==p?1:0,h,m,b,e,y,c-y,t,l),m=g=b=0,y=c);var A=0;c<p-2&&(A=r.F._bestMatch(e,c,v,x,Math.min(a[2],p-c),a[3]));var C=A>>>16,S=65535&A;if(0!=A){S=65535&A;var _=s(C=A>>>16,i.of0);i.lhst[257+_]++;var I=s(S,i.df0);i.dhst[I]++,b+=i.exb[_]+i.dxb[I],h[m]=C<<23|c-f,h[m+1]=S<<16|_<<8|I,m+=2,f=c+C}else i.lhst[e[c]]++;g++}}for(y==c&&0!=e.length||(f<c&&(h[m]=c-f,m+=2,f=c),l=r.F._writeBlock(1,h,m,b,e,y,c-y,t,l),m=0,g=0,m=g=b=0,y=c);0!=(7&l);)l++;return l>>>3},r.F._bestMatch=function(e,t,n,o,a,i){var s=32767&t,u=n[s],c=s-u+32768&32767;if(u==s||o!=r.F._hash(e,t-c))return 0;for(var l=0,f=0,p=Math.min(32767,t);c<=p&&0!=--i&&u!=s;){if(0==l||e[t+l]==e[t+l-c]){var h=r.F._howLong(e,t,c);if(h>l){if(f=c,(l=h)>=a)break;c+2<h&&(h=c+2);for(var d=0,v=0;v<h-2;v++){var m=t-c+v+32768&32767,g=m-n[m]+32768&32767;g>d&&(d=g,u=m)}}}c+=(s=u)-(u=n[s])+32768&32767}return l<<16|f},r.F._howLong=function(e,t,n){if(e[t]!=e[t-n]||e[t+1]!=e[t+1-n]||e[t+2]!=e[t+2-n])return 0;var r=t,o=Math.min(e.length,t+258);for(t+=3;t<o&&e[t]==e[t-n];)t++;return t-r},r.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(e,t,n,o,a,i,s,u,c){var l,f,p,h,d,v,m,g,y,b=r.F.U,x=r.F._putsF,w=r.F._putsE;b.lhst[256]++,f=(l=r.F.getTrees())[0],p=l[1],h=l[2],d=l[3],v=l[4],m=l[5],g=l[6],y=l[7];var E=32+(0==(c+3&7)?0:8-(c+3&7))+(s<<3),A=o+r.F.contSize(b.fltree,b.lhst)+r.F.contSize(b.fdtree,b.dhst),C=o+r.F.contSize(b.ltree,b.lhst)+r.F.contSize(b.dtree,b.dhst);C+=14+3*m+r.F.contSize(b.itree,b.ihst)+(2*b.ihst[16]+3*b.ihst[17]+7*b.ihst[18]);for(var S=0;S<286;S++)b.lhst[S]=0;for(S=0;S<30;S++)b.dhst[S]=0;for(S=0;S<19;S++)b.ihst[S]=0;var _=E<A&&E<C?0:A<C?1:2;if(x(u,c,e),x(u,c+1,_),c+=3,0==_){for(;0!=(7&c);)c++;c=r.F._copyExact(a,i,s,u,c)}else{var I,R;if(1==_&&(I=b.fltree,R=b.fdtree),2==_){r.F.makeCodes(b.ltree,f),r.F.revCodes(b.ltree,f),r.F.makeCodes(b.dtree,p),r.F.revCodes(b.dtree,p),r.F.makeCodes(b.itree,h),r.F.revCodes(b.itree,h),I=b.ltree,R=b.dtree,w(u,c,d-257),w(u,c+=5,v-1),w(u,c+=5,m-4),c+=4;for(var T=0;T<m;T++)w(u,c+3*T,b.itree[1+(b.ordr[T]<<1)]);c+=3*m,c=r.F._codeTiny(g,b.itree,u,c),c=r.F._codeTiny(y,b.itree,u,c)}for(var P=i,N=0;N<n;N+=2){for(var O=t[N],D=O>>>23,k=P+(8388607&O);P<k;)c=r.F._writeLit(a[P++],I,u,c);if(0!=D){var F=t[N+1],M=F>>16,L=F>>8&255,U=255&F;w(u,c=r.F._writeLit(257+L,I,u,c),D-b.of0[L]),c+=b.exb[L],x(u,c=r.F._writeLit(U,R,u,c),M-b.df0[U]),c+=b.dxb[U],P+=D}}c=r.F._writeLit(256,I,u,c)}return c},r.F._copyExact=function(e,t,n,r,o){var a=o>>>3;return r[a]=n,r[a+1]=n>>>8,r[a+2]=255-r[a],r[a+3]=255-r[a+1],a+=4,r.set(new Uint8Array(e.buffer,t,n),a),o+(n+4<<3)},r.F.getTrees=function(){for(var e=r.F.U,t=r.F._hufTree(e.lhst,e.ltree,15),n=r.F._hufTree(e.dhst,e.dtree,15),o=[],a=r.F._lenCodes(e.ltree,o),i=[],s=r.F._lenCodes(e.dtree,i),u=0;u<o.length;u+=2)e.ihst[o[u]]++;for(u=0;u<i.length;u+=2)e.ihst[i[u]]++;for(var c=r.F._hufTree(e.ihst,e.itree,7),l=19;l>4&&0==e.itree[1+(e.ordr[l-1]<<1)];)l--;return[t,n,c,a,s,l,o,i]},r.F.getSecond=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(e[n+1]);return t},r.F.nonZero=function(e){for(var t="",n=0;n<e.length;n+=2)0!=e[n+1]&&(t+=(n>>1)+",");return t},r.F.contSize=function(e,t){for(var n=0,r=0;r<t.length;r++)n+=t[r]*e[1+(r<<1)];return n},r.F._codeTiny=function(e,t,n,o){for(var a=0;a<e.length;a+=2){var i=e[a],s=e[a+1];o=r.F._writeLit(i,t,n,o);var u=16==i?2:17==i?3:7;i>15&&(r.F._putsE(n,o,s,u),o+=u)}return o},r.F._lenCodes=function(e,t){for(var n=e.length;2!=n&&0==e[n-1];)n-=2;for(var r=0;r<n;r+=2){var o=e[r+1],a=r+3<n?e[r+3]:-1,i=r+5<n?e[r+5]:-1,s=0==r?-1:e[r-1];if(0==o&&a==o&&i==o){for(var u=r+5;u+2<n&&e[u+2]==o;)u+=2;(c=Math.min(u+1-r>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),r+=2*c-2}else if(o==s&&a==o&&i==o){for(u=r+5;u+2<n&&e[u+2]==o;)u+=2;var c=Math.min(u+1-r>>>1,6);t.push(16,c-3),r+=2*c-2}else t.push(o,0)}return n>>>1},r.F._hufTree=function(e,t,n){var o=[],a=e.length,i=t.length,s=0;for(s=0;s<i;s+=2)t[s]=0,t[s+1]=0;for(s=0;s<a;s++)0!=e[s]&&o.push({lit:s,f:e[s]});var u=o.length,c=o.slice(0);if(0==u)return 0;if(1==u){var l=o[0].lit;return c=0==l?1:0,t[1+(l<<1)]=1,t[1+(c<<1)]=1,1}o.sort((function(e,t){return e.f-t.f}));var f=o[0],p=o[1],h=0,d=1,v=2;for(o[0]={lit:-1,f:f.f+p.f,l:f,r:p,d:0};d!=u-1;)f=h!=d&&(v==u||o[h].f<o[v].f)?o[h++]:o[v++],p=h!=d&&(v==u||o[h].f<o[v].f)?o[h++]:o[v++],o[d++]={lit:-1,f:f.f+p.f,l:f,r:p};var m=r.F.setDepth(o[d-1],0);for(m>n&&(r.F.restrictDepth(c,n,m),m=n),s=0;s<u;s++)t[1+(c[s].lit<<1)]=c[s].d;return m},r.F.setDepth=function(e,t){return-1!=e.lit?(e.d=t,t):Math.max(r.F.setDepth(e.l,t+1),r.F.setDepth(e.r,t+1))},r.F.restrictDepth=function(e,t,n){var r=0,o=1<<n-t,a=0;for(e.sort((function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d})),r=0;r<e.length&&e[r].d>t;r++){var i=e[r].d;e[r].d=t,a+=o-(1<<n-i)}for(a>>>=n-t;a>0;)(i=e[r].d)<t?(e[r].d++,a-=1<<t-i-1):r++;for(;r>=0;r--)e[r].d==t&&a<0&&(e[r].d--,a++);0!=a&&console.log("debt left")},r.F._goodIndex=function(e,t){var n=0;return t[16|n]<=e&&(n|=16),t[8|n]<=e&&(n|=8),t[4|n]<=e&&(n|=4),t[2|n]<=e&&(n|=2),t[1|n]<=e&&(n|=1),n},r.F._writeLit=function(e,t,n,o){return r.F._putsF(n,o,t[e<<1]),o+t[1+(e<<1)]},r.F.inflate=function(e,t){var n=Uint8Array;if(3==e[0]&&0==e[1])return t||new n(0);var o=r.F,a=o._bitsF,i=o._bitsE,s=o._decodeTiny,u=o.makeCodes,c=o.codes2map,l=o._get17,f=o.U,p=null==t;p&&(t=new n(e.length>>>2<<3));for(var h,d,v=0,m=0,g=0,y=0,b=0,x=0,w=0,E=0,A=0;0==v;)if(v=a(e,A,1),m=a(e,A+1,2),A+=3,0!=m){if(p&&(t=r.F._check(t,E+(1<<17))),1==m&&(h=f.flmap,d=f.fdmap,x=511,w=31),2==m){g=i(e,A,5)+257,y=i(e,A+5,5)+1,b=i(e,A+10,4)+4,A+=14;for(var C=0;C<38;C+=2)f.itree[C]=0,f.itree[C+1]=0;var S=1;for(C=0;C<b;C++){var _=i(e,A+3*C,3);f.itree[1+(f.ordr[C]<<1)]=_,_>S&&(S=_)}A+=3*b,u(f.itree,S),c(f.itree,S,f.imap),h=f.lmap,d=f.dmap,A=s(f.imap,(1<<S)-1,g+y,e,A,f.ttree);var I=o._copyOut(f.ttree,0,g,f.ltree);x=(1<<I)-1;var R=o._copyOut(f.ttree,g,y,f.dtree);w=(1<<R)-1,u(f.ltree,I),c(f.ltree,I,h),u(f.dtree,R),c(f.dtree,R,d)}for(;;){var T=h[l(e,A)&x];A+=15&T;var P=T>>>4;if(P>>>8==0)t[E++]=P;else{if(256==P)break;var N=E+P-254;if(P>264){var O=f.ldef[P-257];N=E+(O>>>3)+i(e,A,7&O),A+=7&O}var D=d[l(e,A)&w];A+=15&D;var k=D>>>4,F=f.ddef[k],M=(F>>>4)+a(e,A,15&F);for(A+=15&F,p&&(t=r.F._check(t,E+(1<<17)));E<N;)t[E]=t[E++-M],t[E]=t[E++-M],t[E]=t[E++-M],t[E]=t[E++-M];E=N}}}else{0!=(7&A)&&(A+=8-(7&A));var L=4+(A>>>3),U=e[L-4]|e[L-3]<<8;p&&(t=r.F._check(t,E+U)),t.set(new n(e.buffer,e.byteOffset+L,U),E),A=L+U<<3,E+=U}return t.length==E?t:t.slice(0,E)},r.F._check=function(e,t){var n=e.length;if(t<=n)return e;var r=new Uint8Array(Math.max(n<<1,t));return r.set(e,0),r},r.F._decodeTiny=function(e,t,n,o,a,i){for(var s=r.F._bitsE,u=r.F._get17,c=0;c<n;){var l=e[u(o,a)&t];a+=15&l;var f=l>>>4;if(f<=15)i[c]=f,c++;else{var p=0,h=0;16==f?(h=3+s(o,a,2),a+=2,p=i[c-1]):17==f?(h=3+s(o,a,3),a+=3):18==f&&(h=11+s(o,a,7),a+=7);for(var d=c+h;c<d;)i[c]=p,c++}}return a},r.F._copyOut=function(e,t,n,r){for(var o=0,a=0,i=r.length>>>1;a<n;){var s=e[a+t];r[a<<1]=0,r[1+(a<<1)]=s,s>o&&(o=s),a++}for(;a<i;)r[a<<1]=0,r[1+(a<<1)]=0,a++;return o},r.F.makeCodes=function(e,t){for(var n,o,a,i,s=r.F.U,u=e.length,c=s.bl_count,l=0;l<=t;l++)c[l]=0;for(l=1;l<u;l+=2)c[e[l]]++;var f=s.next_code;for(n=0,c[0]=0,o=1;o<=t;o++)n=n+c[o-1]<<1,f[o]=n;for(a=0;a<u;a+=2)0!=(i=e[a+1])&&(e[a]=f[i],f[i]++)},r.F.codes2map=function(e,t,n){for(var o=e.length,a=r.F.U.rev15,i=0;i<o;i+=2)if(0!=e[i+1])for(var s=i>>1,u=e[i+1],c=s<<4|u,l=t-u,f=e[i]<<l,p=f+(1<<l);f!=p;)n[a[f]>>>15-t]=c,f++},r.F.revCodes=function(e,t){for(var n=r.F.U.rev15,o=15-t,a=0;a<e.length;a+=2){var i=e[a]<<t-e[a+1];e[a]=n[i]>>>o}},r.F._putsE=function(e,t,n){n<<=7&t;var r=t>>>3;e[r]|=n,e[r+1]|=n>>>8},r.F._putsF=function(e,t,n){n<<=7&t;var r=t>>>3;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},r.F._bitsE=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},r.F._bitsF=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},r.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},r.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},r.F.U=(t=Uint16Array,n=Uint32Array,{next_code:new t(16),bl_count:new t(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new t(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new n(32),flmap:new t(512),fltree:[],fdmap:new t(32),fdtree:[],lmap:new t(32768),ltree:[],ttree:[],dmap:new t(32768),dtree:[],imap:new t(512),itree:[],rev15:new t(32768),lhst:new n(286),dhst:new n(30),ihst:new n(19),lits:new n(15e3),strt:new t(65536),prev:new t(32768)}),function(){for(var e=r.F.U,t=0;t<32768;t++){var n=t;n=(4278255360&(n=(4042322160&(n=(3435973836&(n=(2863311530&n)>>>1|(1431655765&n)<<1))>>>2|(858993459&n)<<2))>>>4|(252645135&n)<<4))>>>8|(16711935&n)<<8,e.rev15[t]=(n>>>16|n<<16)>>>17}function o(e,t,n){for(;0!=t--;)e.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];o(e.fltree,144,8),o(e.fltree,112,9),o(e.fltree,24,7),o(e.fltree,8,8),r.F.makeCodes(e.fltree,9),r.F.codes2map(e.fltree,9,e.flmap),r.F.revCodes(e.fltree,9),o(e.fdtree,32,5),r.F.makeCodes(e.fdtree,5),r.F.codes2map(e.fdtree,5,e.fdmap),r.F.revCodes(e.fdtree,5),o(e.itree,19,0),o(e.ltree,286,0),o(e.dtree,30,0),o(e.ttree,320,0)}()})),UZIP=Object.freeze(_mergeNamespaces({__proto__:null,default:UZIP_1},[UZIP_1])),UPNG={},N,W,H;UPNG.toRGBA8=function(e){var t=e.width,n=e.height;if(null==e.tabs.acTL)return[UPNG.toRGBA8.decodeImage(e.data,t,n,e).buffer];var r=[];null==e.frames[0].data&&(e.frames[0].data=e.data);for(var o=t*n*4,a=new Uint8Array(o),i=new Uint8Array(o),s=new Uint8Array(o),u=0;u<e.frames.length;u++){var c=e.frames[u],l=c.rect.x,f=c.rect.y,p=c.rect.width,h=c.rect.height,d=UPNG.toRGBA8.decodeImage(c.data,p,h,e);if(0!=u)for(var v=0;v<o;v++)s[v]=a[v];if(0==c.blend?UPNG._copyTile(d,p,h,a,t,n,l,f,0):1==c.blend&&UPNG._copyTile(d,p,h,a,t,n,l,f,1),r.push(a.buffer.slice(0)),0==c.dispose);else if(1==c.dispose)UPNG._copyTile(i,p,h,a,t,n,l,f,0);else if(2==c.dispose)for(v=0;v<o;v++)a[v]=s[v]}return r},UPNG.toRGBA8.decodeImage=function(e,t,n,r){var o=t*n,a=UPNG.decode._getBPP(r),i=Math.ceil(t*a/8),s=new Uint8Array(4*o),u=new Uint32Array(s.buffer),c=r.ctype,l=r.depth,f=UPNG._bin.readUshort;if(6==c){var p=o<<2;if(8==l)for(var h=0;h<p;h+=4)s[h]=e[h],s[h+1]=e[h+1],s[h+2]=e[h+2],s[h+3]=e[h+3];if(16==l)for(h=0;h<p;h++)s[h]=e[h<<1]}else if(2==c){var d=r.tabs.tRNS;if(null==d){if(8==l)for(h=0;h<o;h++){var v=3*h;u[h]=255<<24|e[v+2]<<16|e[v+1]<<8|e[v]}if(16==l)for(h=0;h<o;h++)v=6*h,u[h]=255<<24|e[v+4]<<16|e[v+2]<<8|e[v]}else{var m=d[0],g=d[1],y=d[2];if(8==l)for(h=0;h<o;h++){var b=h<<2;v=3*h,u[h]=255<<24|e[v+2]<<16|e[v+1]<<8|e[v],e[v]==m&&e[v+1]==g&&e[v+2]==y&&(s[b+3]=0)}if(16==l)for(h=0;h<o;h++)b=h<<2,v=6*h,u[h]=255<<24|e[v+4]<<16|e[v+2]<<8|e[v],f(e,v)==m&&f(e,v+2)==g&&f(e,v+4)==y&&(s[b+3]=0)}}else if(3==c){var x=r.tabs.PLTE,w=r.tabs.tRNS,E=w?w.length:0;if(1==l)for(var A=0;A<n;A++){var C=A*i,S=A*t;for(h=0;h<t;h++){b=S+h<<2;var _=3*(I=e[C+(h>>3)]>>7-((7&h)<<0)&1);s[b]=x[_],s[b+1]=x[_+1],s[b+2]=x[_+2],s[b+3]=I<E?w[I]:255}}if(2==l)for(A=0;A<n;A++)for(C=A*i,S=A*t,h=0;h<t;h++)b=S+h<<2,_=3*(I=e[C+(h>>2)]>>6-((3&h)<<1)&3),s[b]=x[_],s[b+1]=x[_+1],s[b+2]=x[_+2],s[b+3]=I<E?w[I]:255;if(4==l)for(A=0;A<n;A++)for(C=A*i,S=A*t,h=0;h<t;h++)b=S+h<<2,_=3*(I=e[C+(h>>1)]>>4-((1&h)<<2)&15),s[b]=x[_],s[b+1]=x[_+1],s[b+2]=x[_+2],s[b+3]=I<E?w[I]:255;if(8==l)for(h=0;h<o;h++){var I;b=h<<2,_=3*(I=e[h]),s[b]=x[_],s[b+1]=x[_+1],s[b+2]=x[_+2],s[b+3]=I<E?w[I]:255}}else if(4==c){if(8==l)for(h=0;h<o;h++){b=h<<2;var R=e[T=h<<1];s[b]=R,s[b+1]=R,s[b+2]=R,s[b+3]=e[T+1]}if(16==l)for(h=0;h<o;h++){var T;b=h<<2,R=e[T=h<<2],s[b]=R,s[b+1]=R,s[b+2]=R,s[b+3]=e[T+2]}}else if(0==c)for(m=r.tabs.tRNS?r.tabs.tRNS:-1,A=0;A<n;A++){var P=A*i,N=A*t;if(1==l)for(var O=0;O<t;O++){var D=(R=255*(e[P+(O>>>3)]>>>7-(7&O)&1))==255*m?0:255;u[N+O]=D<<24|R<<16|R<<8|R}else if(2==l)for(O=0;O<t;O++)D=(R=85*(e[P+(O>>>2)]>>>6-((3&O)<<1)&3))==85*m?0:255,u[N+O]=D<<24|R<<16|R<<8|R;else if(4==l)for(O=0;O<t;O++)D=(R=17*(e[P+(O>>>1)]>>>4-((1&O)<<2)&15))==17*m?0:255,u[N+O]=D<<24|R<<16|R<<8|R;else if(8==l)for(O=0;O<t;O++)D=(R=e[P+O])==m?0:255,u[N+O]=D<<24|R<<16|R<<8|R;else if(16==l)for(O=0;O<t;O++)R=e[P+(O<<1)],D=f(e,P+(O<<h))==m?0:255,u[N+O]=D<<24|R<<16|R<<8|R}return s},UPNG.decode=function(e){for(var t,n=new Uint8Array(e),r=8,o=UPNG._bin,a=o.readUshort,i=o.readUint,s={tabs:{},frames:[]},u=new Uint8Array(n.length),c=0,l=0,f=[137,80,78,71,13,10,26,10],p=0;p<8;p++)if(n[p]!=f[p])throw"The input is not a PNG file!";for(;r<n.length;){var h=o.readUint(n,r);r+=4;var d=o.readASCII(n,r,4);if(r+=4,"IHDR"==d)UPNG.decode._IHDR(n,r,s);else if("CgBI"==d)s.tabs[d]=n.slice(r,r+4);else if("IDAT"==d){for(p=0;p<h;p++)u[c+p]=n[r+p];c+=h}else if("acTL"==d)s.tabs[d]={num_frames:i(n,r),num_plays:i(n,r+4)},t=new Uint8Array(n.length);else if("fcTL"==d){var v;0!=l&&((v=s.frames[s.frames.length-1]).data=UPNG.decode._decompress(s,t.slice(0,l),v.rect.width,v.rect.height),l=0);var m={x:i(n,r+12),y:i(n,r+16),width:i(n,r+4),height:i(n,r+8)},g=a(n,r+22);g=a(n,r+20)/(0==g?100:g);var y={rect:m,delay:Math.round(1e3*g),dispose:n[r+24],blend:n[r+25]};s.frames.push(y)}else if("fdAT"==d){for(p=0;p<h-4;p++)t[l+p]=n[r+p+4];l+=h-4}else if("pHYs"==d)s.tabs[d]=[o.readUint(n,r),o.readUint(n,r+4),n[r+8]];else if("cHRM"==d)for(s.tabs[d]=[],p=0;p<8;p++)s.tabs[d].push(o.readUint(n,r+4*p));else if("tEXt"==d||"zTXt"==d){null==s.tabs[d]&&(s.tabs[d]={});var b=o.nextZero(n,r),x=o.readASCII(n,r,b-r),w=r+h-b-1;if("tEXt"==d)C=o.readASCII(n,b+1,w);else{var E=UPNG.decode._inflate(n.slice(b+2,b+2+w));C=o.readUTF8(E,0,E.length)}s.tabs[d][x]=C}else if("iTXt"==d){null==s.tabs[d]&&(s.tabs[d]={}),b=0;var A=r;b=o.nextZero(n,A),x=o.readASCII(n,A,b-A);var C,S=n[A=b+1];n[A+1],A+=2,b=o.nextZero(n,A),o.readASCII(n,A,b-A),A=b+1,b=o.nextZero(n,A),o.readUTF8(n,A,b-A),w=h-((A=b+1)-r),0==S?C=o.readUTF8(n,A,w):(E=UPNG.decode._inflate(n.slice(A,A+w)),C=o.readUTF8(E,0,E.length)),s.tabs[d][x]=C}else if("PLTE"==d)s.tabs[d]=o.readBytes(n,r,h);else if("hIST"==d){var _=s.tabs.PLTE.length/3;for(s.tabs[d]=[],p=0;p<_;p++)s.tabs[d].push(a(n,r+2*p))}else if("tRNS"==d)3==s.ctype?s.tabs[d]=o.readBytes(n,r,h):0==s.ctype?s.tabs[d]=a(n,r):2==s.ctype&&(s.tabs[d]=[a(n,r),a(n,r+2),a(n,r+4)]);else if("gAMA"==d)s.tabs[d]=o.readUint(n,r)/1e5;else if("sRGB"==d)s.tabs[d]=n[r];else if("bKGD"==d)0==s.ctype||4==s.ctype?s.tabs[d]=[a(n,r)]:2==s.ctype||6==s.ctype?s.tabs[d]=[a(n,r),a(n,r+2),a(n,r+4)]:3==s.ctype&&(s.tabs[d]=n[r]);else if("IEND"==d)break;r+=h,o.readUint(n,r),r+=4}return 0!=l&&((v=s.frames[s.frames.length-1]).data=UPNG.decode._decompress(s,t.slice(0,l),v.rect.width,v.rect.height),l=0),s.data=UPNG.decode._decompress(s,u,s.width,s.height),delete s.compress,delete s.interlace,delete s.filter,s},UPNG.decode._decompress=function(e,t,n,r){var o=UPNG.decode._getBPP(e),a=Math.ceil(n*o/8),i=new Uint8Array((a+1+e.interlace)*r);return t=e.tabs.CgBI?UPNG.inflateRaw(t,i):UPNG.decode._inflate(t,i),0==e.interlace?t=UPNG.decode._filterZero(t,e,0,n,r):1==e.interlace&&(t=UPNG.decode._readInterlace(t,e)),t},UPNG.decode._inflate=function(e,t){return UPNG.inflateRaw(new Uint8Array(e.buffer,2,e.length-6),t)},UPNG.inflateRaw=(H={},H.H={},H.H.N=function(e,t){var n,r,o=Uint8Array,a=0,i=0,s=0,u=0,c=0,l=0,f=0,p=0,h=0;if(3==e[0]&&0==e[1])return t||new o(0);var d=H.H,v=d.b,m=d.e,g=d.R,y=d.n,b=d.A,x=d.Z,w=d.m,E=null==t;for(E&&(t=new o(e.length>>>2<<5));0==a;)if(a=v(e,h,1),i=v(e,h+1,2),h+=3,0!=i){if(E&&(t=H.H.W(t,p+(1<<17))),1==i&&(n=w.J,r=w.h,l=511,f=31),2==i){s=m(e,h,5)+257,u=m(e,h+5,5)+1,c=m(e,h+10,4)+4,h+=14;for(var A=1,C=0;C<38;C+=2)w.Q[C]=0,w.Q[C+1]=0;for(C=0;C<c;C++){var S=m(e,h+3*C,3);w.Q[1+(w.X[C]<<1)]=S,S>A&&(A=S)}h+=3*c,y(w.Q,A),b(w.Q,A,w.u),n=w.w,r=w.d,h=g(w.u,(1<<A)-1,s+u,e,h,w.v);var _=d.V(w.v,0,s,w.C);l=(1<<_)-1;var I=d.V(w.v,s,u,w.D);f=(1<<I)-1,y(w.C,_),b(w.C,_,n),y(w.D,I),b(w.D,I,r)}for(;;){var R=n[x(e,h)&l];h+=15&R;var T=R>>>4;if(T>>>8==0)t[p++]=T;else{if(256==T)break;var P=p+T-254;if(T>264){var N=w.q[T-257];P=p+(N>>>3)+m(e,h,7&N),h+=7&N}var O=r[x(e,h)&f];h+=15&O;var D=O>>>4,k=w.c[D],F=(k>>>4)+v(e,h,15&k);for(h+=15&k;p<P;)t[p]=t[p++-F],t[p]=t[p++-F],t[p]=t[p++-F],t[p]=t[p++-F];p=P}}}else{0!=(7&h)&&(h+=8-(7&h));var M=4+(h>>>3),L=e[M-4]|e[M-3]<<8;E&&(t=H.H.W(t,p+L)),t.set(new o(e.buffer,e.byteOffset+M,L),p),h=M+L<<3,p+=L}return t.length==p?t:t.slice(0,p)},H.H.W=function(e,t){var n=e.length;if(t<=n)return e;var r=new Uint8Array(n<<1);return r.set(e,0),r},H.H.R=function(e,t,n,r,o,a){for(var i=H.H.e,s=H.H.Z,u=0;u<n;){var c=e[s(r,o)&t];o+=15&c;var l=c>>>4;if(l<=15)a[u]=l,u++;else{var f=0,p=0;16==l?(p=3+i(r,o,2),o+=2,f=a[u-1]):17==l?(p=3+i(r,o,3),o+=3):18==l&&(p=11+i(r,o,7),o+=7);for(var h=u+p;u<h;)a[u]=f,u++}}return o},H.H.V=function(e,t,n,r){for(var o=0,a=0,i=r.length>>>1;a<n;){var s=e[a+t];r[a<<1]=0,r[1+(a<<1)]=s,s>o&&(o=s),a++}for(;a<i;)r[a<<1]=0,r[1+(a<<1)]=0,a++;return o},H.H.n=function(e,t){for(var n,r,o,a,i=H.H.m,s=e.length,u=i.j,c=0;c<=t;c++)u[c]=0;for(c=1;c<s;c+=2)u[e[c]]++;var l=i.K;for(n=0,u[0]=0,r=1;r<=t;r++)n=n+u[r-1]<<1,l[r]=n;for(o=0;o<s;o+=2)0!=(a=e[o+1])&&(e[o]=l[a],l[a]++)},H.H.A=function(e,t,n){for(var r=e.length,o=H.H.m.r,a=0;a<r;a+=2)if(0!=e[a+1])for(var i=a>>1,s=e[a+1],u=i<<4|s,c=t-s,l=e[a]<<c,f=l+(1<<c);l!=f;)n[o[l]>>>15-t]=u,l++},H.H.l=function(e,t){for(var n=H.H.m.r,r=15-t,o=0;o<e.length;o+=2){var a=e[o]<<t-e[o+1];e[o]=n[a]>>>r}},H.H.M=function(e,t,n){n<<=7&t;var r=t>>>3;e[r]|=n,e[r+1]|=n>>>8},H.H.I=function(e,t,n){n<<=7&t;var r=t>>>3;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},H.H.e=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},H.H.b=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},H.H.Z=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},H.H.i=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},H.H.m=(N=Uint16Array,W=Uint32Array,{K:new N(16),j:new N(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new N(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new W(32),J:new N(512),_:[],h:new N(32),$:[],w:new N(32768),C:[],v:[],d:new N(32768),D:[],u:new N(512),Q:[],r:new N(32768),s:new W(286),Y:new W(30),a:new W(19),t:new W(15e3),k:new N(65536),g:new N(32768)}),function(){for(var e=H.H.m,t=0;t<32768;t++){var n=t;n=(4278255360&(n=(4042322160&(n=(3435973836&(n=(2863311530&n)>>>1|(1431655765&n)<<1))>>>2|(858993459&n)<<2))>>>4|(252645135&n)<<4))>>>8|(16711935&n)<<8,e.r[t]=(n>>>16|n<<16)>>>17}function r(e,t,n){for(;0!=t--;)e.push(0,n)}for(t=0;t<32;t++)e.q[t]=e.S[t]<<3|e.T[t],e.c[t]=e.p[t]<<4|e.z[t];r(e._,144,8),r(e._,112,9),r(e._,24,7),r(e._,8,8),H.H.n(e._,9),H.H.A(e._,9,e.J),H.H.l(e._,9),r(e.$,32,5),H.H.n(e.$,5),H.H.A(e.$,5,e.h),H.H.l(e.$,5),r(e.Q,19,0),r(e.C,286,0),r(e.D,30,0),r(e.v,320,0)}(),H.H.N),UPNG.decode._readInterlace=function(e,t){for(var n=t.width,r=t.height,o=UPNG.decode._getBPP(t),a=o>>3,i=Math.ceil(n*o/8),s=new Uint8Array(r*i),u=0,c=[0,0,4,0,2,0,1],l=[0,4,0,2,0,1,0],f=[8,8,8,4,4,2,2],p=[8,8,4,4,2,2,1],h=0;h<7;){for(var d=f[h],v=p[h],m=0,g=0,y=c[h];y<r;)y+=d,g++;for(var b=l[h];b<n;)b+=v,m++;var x=Math.ceil(m*o/8);UPNG.decode._filterZero(e,t,u,m,g);for(var w=0,E=c[h];E<r;){for(var A=l[h],C=u+w*x<<3;A<n;){var S;if(1==o&&(S=(S=e[C>>3])>>7-(7&C)&1,s[E*i+(A>>3)]|=S<<7-((7&A)<<0)),2==o&&(S=(S=e[C>>3])>>6-(7&C)&3,s[E*i+(A>>2)]|=S<<6-((3&A)<<1)),4==o&&(S=(S=e[C>>3])>>4-(7&C)&15,s[E*i+(A>>1)]|=S<<4-((1&A)<<2)),o>=8)for(var _=E*i+A*a,I=0;I<a;I++)s[_+I]=e[(C>>3)+I];C+=o,A+=v}w++,E+=d}m*g!=0&&(u+=g*(1+x)),h+=1}return s},UPNG.decode._getBPP=function(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth},UPNG.decode._filterZero=function(e,t,n,r,o){var a=UPNG.decode._getBPP(t),i=Math.ceil(r*a/8),s=UPNG.decode._paeth;a=Math.ceil(a/8);var u=0,c=1,l=e[n],f=0;if(l>1&&(e[n]=[0,0,1][l-2]),3==l)for(f=a;f<i;f++)e[f+1]=e[f+1]+(e[f+1-a]>>>1)&255;for(var p=0;p<o;p++)if(f=0,0==(l=e[(c=(u=n+p*i)+p+1)-1]))for(;f<i;f++)e[u+f]=e[c+f];else if(1==l){for(;f<a;f++)e[u+f]=e[c+f];for(;f<i;f++)e[u+f]=e[c+f]+e[u+f-a]}else if(2==l)for(;f<i;f++)e[u+f]=e[c+f]+e[u+f-i];else if(3==l){for(;f<a;f++)e[u+f]=e[c+f]+(e[u+f-i]>>>1);for(;f<i;f++)e[u+f]=e[c+f]+(e[u+f-i]+e[u+f-a]>>>1)}else{for(;f<a;f++)e[u+f]=e[c+f]+s(0,e[u+f-i],0);for(;f<i;f++)e[u+f]=e[c+f]+s(e[u+f-a],e[u+f-i],e[u+f-a-i])}return e},UPNG.decode._paeth=function(e,t,n){var r=e+t-n,o=r-e,a=r-t,i=r-n;return o*o<=a*a&&o*o<=i*i?e:a*a<=i*i?t:n},UPNG.decode._IHDR=function(e,t,n){var r=UPNG._bin;n.width=r.readUint(e,t),t+=4,n.height=r.readUint(e,t),t+=4,n.depth=e[t],t++,n.ctype=e[t],t++,n.compress=e[t],t++,n.filter=e[t],t++,n.interlace=e[t],t++},UPNG._bin={nextZero:function(e,t){for(;0!=e[t];)t++;return t},readUshort:function(e,t){return e[t]<<8|e[t+1]},writeUshort:function(e,t,n){e[t]=n>>8&255,e[t+1]=255&n},readUint:function(e,t){return 16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3])},writeUint:function(e,t,n){e[t]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},readASCII:function(e,t,n){for(var r="",o=0;o<n;o++)r+=String.fromCharCode(e[t+o]);return r},writeASCII:function(e,t,n){for(var r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},readBytes:function(e,t,n){for(var r=[],o=0;o<n;o++)r.push(e[t+o]);return r},pad:function(e){return e.length<2?"0".concat(e):e},readUTF8:function(e,t,n){for(var r,o="",a=0;a<n;a++)o+="%".concat(UPNG._bin.pad(e[t+a].toString(16)));try{r=decodeURIComponent(o)}catch(r){return UPNG._bin.readASCII(e,t,n)}return r}},UPNG._copyTile=function(e,t,n,r,o,a,i,s,u){for(var c=Math.min(t,o),l=Math.min(n,a),f=0,p=0,h=0;h<l;h++)for(var d=0;d<c;d++)if(i>=0&&s>=0?(f=h*t+d<<2,p=(s+h)*o+i+d<<2):(f=(-s+h)*t-i+d<<2,p=h*o+d<<2),0==u)r[p]=e[f],r[p+1]=e[f+1],r[p+2]=e[f+2],r[p+3]=e[f+3];else if(1==u){var v=e[f+3]*(1/255),m=e[f]*v,g=e[f+1]*v,y=e[f+2]*v,b=r[p+3]*(1/255),x=r[p]*b,w=r[p+1]*b,E=r[p+2]*b,A=1-v,C=v+b*A,S=0==C?0:1/C;r[p+3]=255*C,r[p+0]=(m+x*A)*S,r[p+1]=(g+w*A)*S,r[p+2]=(y+E*A)*S}else if(2==u)v=e[f+3],m=e[f],g=e[f+1],y=e[f+2],b=r[p+3],x=r[p],w=r[p+1],E=r[p+2],v==b&&m==x&&g==w&&y==E?(r[p]=0,r[p+1]=0,r[p+2]=0,r[p+3]=0):(r[p]=m,r[p+1]=g,r[p+2]=y,r[p+3]=v);else if(3==u){if(v=e[f+3],m=e[f],g=e[f+1],y=e[f+2],b=r[p+3],x=r[p],w=r[p+1],E=r[p+2],v==b&&m==x&&g==w&&y==E)continue;if(v<220&&b>20)return!1}return!0},UPNG.encode=function(e,t,n,r,o,a,i){null==r&&(r=0),null==i&&(i=!1);var s=UPNG.encode.compress(e,t,n,r,[!1,!1,!1,0,i]);return UPNG.encode.compressPNG(s,-1),UPNG.encode._main(s,t,n,o,a)},UPNG.encodeLL=function(e,t,n,r,o,a,i,s){for(var u={ctype:0+(1==r?0:2)+(0==o?0:4),depth:a,frames:[]},c=(r+o)*a,l=c*t,f=0;f<e.length;f++)u.frames.push({rect:{x:0,y:0,width:t,height:n},img:new Uint8Array(e[f]),blend:0,dispose:1,bpp:Math.ceil(c/8),bpl:Math.ceil(l/8)});return UPNG.encode.compressPNG(u,0,!0),UPNG.encode._main(u,t,n,i,s)},UPNG.encode._main=function(e,t,n,r,o){null==o&&(o={});var a=UPNG.crc.crc,i=UPNG._bin.writeUint,s=UPNG._bin.writeUshort,u=UPNG._bin.writeASCII,c=8,l=e.frames.length>1,f=!1,p=33+(l?20:0);if(null!=o.sRGB&&(p+=13),null!=o.pHYs&&(p+=21),3==e.ctype){for(var h=e.plte.length,d=0;d<h;d++)e.plte[d]>>>24!=255&&(f=!0);p+=8+3*h+4+(f?8+1*h+4:0)}for(var v=0;v<e.frames.length;v++)l&&(p+=38),p+=(C=e.frames[v]).cimg.length+12,0!=v&&(p+=4);p+=12;var m=new Uint8Array(p),g=[137,80,78,71,13,10,26,10];for(d=0;d<8;d++)m[d]=g[d];if(i(m,c,13),u(m,c+=4,"IHDR"),i(m,c+=4,t),i(m,c+=4,n),m[c+=4]=e.depth,m[++c]=e.ctype,m[++c]=0,m[++c]=0,m[++c]=0,i(m,++c,a(m,c-17,17)),c+=4,null!=o.sRGB&&(i(m,c,1),u(m,c+=4,"sRGB"),m[c+=4]=o.sRGB,i(m,++c,a(m,c-5,5)),c+=4),null!=o.pHYs&&(i(m,c,9),u(m,c+=4,"pHYs"),i(m,c+=4,o.pHYs[0]),i(m,c+=4,o.pHYs[1]),m[c+=4]=o.pHYs[2],i(m,++c,a(m,c-13,13)),c+=4),l&&(i(m,c,8),u(m,c+=4,"acTL"),i(m,c+=4,e.frames.length),i(m,c+=4,null!=o.loop?o.loop:0),i(m,c+=4,a(m,c-12,12)),c+=4),3==e.ctype){for(i(m,c,3*(h=e.plte.length)),u(m,c+=4,"PLTE"),c+=4,d=0;d<h;d++){var y=3*d,b=e.plte[d],x=255&b,w=b>>>8&255,E=b>>>16&255;m[c+y+0]=x,m[c+y+1]=w,m[c+y+2]=E}if(i(m,c+=3*h,a(m,c-3*h-4,3*h+4)),c+=4,f){for(i(m,c,h),u(m,c+=4,"tRNS"),c+=4,d=0;d<h;d++)m[c+d]=e.plte[d]>>>24&255;i(m,c+=h,a(m,c-h-4,h+4)),c+=4}}var A=0;for(v=0;v<e.frames.length;v++){var C=e.frames[v];l&&(i(m,c,26),u(m,c+=4,"fcTL"),i(m,c+=4,A++),i(m,c+=4,C.rect.width),i(m,c+=4,C.rect.height),i(m,c+=4,C.rect.x),i(m,c+=4,C.rect.y),s(m,c+=4,r[v]),s(m,c+=2,1e3),m[c+=2]=C.dispose,m[++c]=C.blend,i(m,++c,a(m,c-30,30)),c+=4);var S=C.cimg;i(m,c,(h=S.length)+(0==v?0:4));var _=c+=4;u(m,c,0==v?"IDAT":"fdAT"),c+=4,0!=v&&(i(m,c,A++),c+=4),m.set(S,c),i(m,c+=h,a(m,_,c-_)),c+=4}return i(m,c,0),u(m,c+=4,"IEND"),i(m,c+=4,a(m,c-4,4)),c+=4,m.buffer},UPNG.encode.compressPNG=function(e,t,n){for(var r=0;r<e.frames.length;r++){var o=e.frames[r];o.rect.width;var a=o.rect.height,i=new Uint8Array(a*o.bpl+a);o.cimg=UPNG.encode._filterZero(o.img,a,o.bpp,o.bpl,i,t,n)}},UPNG.encode.compress=function(e,t,n,r,o){for(var a=o[0],i=o[1],s=o[2],u=o[3],c=o[4],l=6,f=8,p=255,h=0;h<e.length;h++)for(var d=new Uint8Array(e[h]),v=d.length,m=0;m<v;m+=4)p&=d[m+3];var g=255!=p,y=UPNG.encode.framize(e,t,n,a,i,s),b={},x=[],w=[];if(0!=r){var E=[];for(m=0;m<y.length;m++)E.push(y[m].img.buffer);var A=UPNG.encode.concatRGBA(E),C=UPNG.quantize(A,r),S=0,_=new Uint8Array(C.abuf);for(m=0;m<y.length;m++){var I=(j=y[m].img).length;for(w.push(new Uint8Array(C.inds.buffer,S>>2,I>>2)),h=0;h<I;h+=4)j[h]=_[S+h],j[h+1]=_[S+h+1],j[h+2]=_[S+h+2],j[h+3]=_[S+h+3];S+=I}for(m=0;m<C.plte.length;m++)x.push(C.plte[m].est.rgba)}else for(h=0;h<y.length;h++){var R=y[h],T=new Uint32Array(R.img.buffer),P=R.rect.width,N=(v=T.length,new Uint8Array(v));for(w.push(N),m=0;m<v;m++){var O=T[m];if(0!=m&&O==T[m-1])N[m]=N[m-1];else if(m>P&&O==T[m-P])N[m]=N[m-P];else{var D=b[O];if(null==D&&(b[O]=D=x.length,x.push(O),x.length>=300))break;N[m]=D}}}var k=x.length;for(k<=256&&0==c&&(f=k<=2?1:k<=4?2:k<=16?4:8,f=Math.max(f,u)),h=0;h<y.length;h++){(R=y[h]).rect.x,R.rect.y,P=R.rect.width;var F=R.rect.height,M=R.img;new Uint32Array(M.buffer);var L=4*P,U=4;if(k<=256&&0==c){L=Math.ceil(f*P/8);for(var B=new Uint8Array(L*F),G=w[h],W=0;W<F;W++){m=W*L;var V=W*P;if(8==f)for(var $=0;$<P;$++)B[m+$]=G[V+$];else if(4==f)for($=0;$<P;$++)B[m+($>>1)]|=G[V+$]<<4-4*(1&$);else if(2==f)for($=0;$<P;$++)B[m+($>>2)]|=G[V+$]<<6-2*(3&$);else if(1==f)for($=0;$<P;$++)B[m+($>>3)]|=G[V+$]<<7-1*(7&$)}M=B,l=3,U=1}else if(0==g&&1==y.length){B=new Uint8Array(P*F*3);var H=P*F;for(m=0;m<H;m++){var j,z=4*m;B[j=3*m]=M[z],B[j+1]=M[z+1],B[j+2]=M[z+2]}M=B,l=2,U=3,L=3*P}R.img=M,R.bpl=L,R.bpp=U}return{ctype:l,depth:f,plte:x,frames:y}},UPNG.encode.framize=function(e,t,n,r,o,a){for(var i=[],s=0;s<e.length;s++){var u,c=new Uint8Array(e[s]),l=new Uint32Array(c.buffer),f=0,p=0,h=t,d=n,v=r?1:0;if(0!=s){for(var m=a||r||1==s||0!=i[s-2].dispose?1:2,g=0,y=1e9,b=0;b<m;b++){for(var x=new Uint8Array(e[s-1-b]),w=new Uint32Array(e[s-1-b]),E=t,A=n,C=-1,S=-1,_=0;_<n;_++)for(var I=0;I<t;I++)l[k=_*t+I]!=w[k]&&(I<E&&(E=I),I>C&&(C=I),_<A&&(A=_),_>S&&(S=_));-1==C&&(E=A=C=S=0),o&&(1==(1&E)&&E--,1==(1&A)&&A--);var R=(C-E+1)*(S-A+1);R<y&&(y=R,g=b,f=E,p=A,h=C-E+1,d=S-A+1)}x=new Uint8Array(e[s-1-g]),1==g&&(i[s-1].dispose=2),u=new Uint8Array(h*d*4),UPNG._copyTile(x,t,n,u,h,d,-f,-p,0),1==(v=UPNG._copyTile(c,t,n,u,h,d,-f,-p,3)?1:0)?UPNG.encode._prepareDiff(c,t,n,u,{x:f,y:p,width:h,height:d}):UPNG._copyTile(c,t,n,u,h,d,-f,-p,0)}else u=c.slice(0);i.push({rect:{x:f,y:p,width:h,height:d},img:u,blend:v,dispose:0})}if(r)for(s=0;s<i.length;s++)if(1!=(F=i[s]).blend){var T=F.rect,P=i[s-1].rect,N=Math.min(T.x,P.x),O=Math.min(T.y,P.y),D={x:N,y:O,width:Math.max(T.x+T.width,P.x+P.width)-N,height:Math.max(T.y+T.height,P.y+P.height)-O};i[s-1].dispose=1,s-1!=0&&UPNG.encode._updateFrame(e,t,n,i,s-1,D,o),UPNG.encode._updateFrame(e,t,n,i,s,D,o)}if(1!=e.length)for(var k=0;k<i.length;k++){var F;(F=i[k]).rect.width,F.rect.height}return i},UPNG.encode._updateFrame=function(e,t,n,r,o,a,i){for(var s=Uint8Array,u=Uint32Array,c=new s(e[o-1]),l=new u(e[o-1]),f=o+1<e.length?new s(e[o+1]):null,p=new s(e[o]),h=new u(p.buffer),d=t,v=n,m=-1,g=-1,y=0;y<a.height;y++)for(var b=0;b<a.width;b++){var x=a.x+b,w=a.y+y,E=w*t+x,A=h[E];0==A||0==r[o-1].dispose&&l[E]==A&&(null==f||0!=f[4*E+3])||(x<d&&(d=x),x>m&&(m=x),w<v&&(v=w),w>g&&(g=w))}-1==m&&(d=v=m=g=0),i&&(1==(1&d)&&d--,1==(1&v)&&v--),a={x:d,y:v,width:m-d+1,height:g-v+1};var C=r[o];C.rect=a,C.blend=1,C.img=new Uint8Array(a.width*a.height*4),0==r[o-1].dispose?(UPNG._copyTile(c,t,n,C.img,a.width,a.height,-a.x,-a.y,0),UPNG.encode._prepareDiff(p,t,n,C.img,a)):UPNG._copyTile(p,t,n,C.img,a.width,a.height,-a.x,-a.y,0)},UPNG.encode._prepareDiff=function(e,t,n,r,o){UPNG._copyTile(e,t,n,r,o.width,o.height,-o.x,-o.y,2)},UPNG.encode._filterZero=function(e,t,n,r,o,a,i){var s,u=[],c=[0,1,2,3,4];-1!=a?c=[a]:(t*r>5e5||1==n)&&(c=[0]),i&&(s={level:0});for(var l,f=UZIP,p=0;p<c.length;p++){for(var h=0;h<t;h++)UPNG.encode._filterLine(o,e,h,r,n,c[p]);u.push(f.deflate(o,s))}var d=1e9;for(p=0;p<u.length;p++)u[p].length<d&&(l=p,d=u[p].length);return u[l]},UPNG.encode._filterLine=function(e,t,n,r,o,a){var i=n*r,s=i+n,u=UPNG.decode._paeth;if(e[s]=a,s++,0==a)if(r<500)for(var c=0;c<r;c++)e[s+c]=t[i+c];else e.set(new Uint8Array(t.buffer,i,r),s);else if(1==a){for(c=0;c<o;c++)e[s+c]=t[i+c];for(c=o;c<r;c++)e[s+c]=t[i+c]-t[i+c-o]+256&255}else if(0==n){for(c=0;c<o;c++)e[s+c]=t[i+c];if(2==a)for(c=o;c<r;c++)e[s+c]=t[i+c];if(3==a)for(c=o;c<r;c++)e[s+c]=t[i+c]-(t[i+c-o]>>1)+256&255;if(4==a)for(c=o;c<r;c++)e[s+c]=t[i+c]-u(t[i+c-o],0,0)+256&255}else{if(2==a)for(c=0;c<r;c++)e[s+c]=t[i+c]+256-t[i+c-r]&255;if(3==a){for(c=0;c<o;c++)e[s+c]=t[i+c]+256-(t[i+c-r]>>1)&255;for(c=o;c<r;c++)e[s+c]=t[i+c]+256-(t[i+c-r]+t[i+c-o]>>1)&255}if(4==a){for(c=0;c<o;c++)e[s+c]=t[i+c]+256-u(0,t[i+c-r],0)&255;for(c=o;c<r;c++)e[s+c]=t[i+c]+256-u(t[i+c-o],t[i+c-r],t[i+c-o-r])&255}}},UPNG.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var n=t,r=0;r<8;r++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update:function(e,t,n,r){for(var o=0;o<r;o++)e=UPNG.crc.table[255&(e^t[n+o])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^UPNG.crc.update(4294967295,e,t,n)}},UPNG.quantize=function(e,t){var n,r=new Uint8Array(e),o=r.slice(0),a=new Uint32Array(o.buffer),i=UPNG.quantize.getKDtree(o,t),s=i[0],u=i[1],c=UPNG.quantize.planeDst,l=r,f=a,p=l.length,h=new Uint8Array(r.length>>2);if(r.length<2e7)for(var d=0;d<p;d+=4){var v=l[d]*(1/255),m=l[d+1]*(1/255),g=l[d+2]*(1/255),y=l[d+3]*(1/255);n=UPNG.quantize.getNearest(s,v,m,g,y),h[d>>2]=n.ind,f[d>>2]=n.est.rgba}else for(d=0;d<p;d+=4){for(v=l[d]*(1/255),m=l[d+1]*(1/255),g=l[d+2]*(1/255),y=l[d+3]*(1/255),n=s;n.left;)n=c(n.est,v,m,g,y)<=0?n.left:n.right;h[d>>2]=n.ind,f[d>>2]=n.est.rgba}return{abuf:o.buffer,inds:h,plte:u}},UPNG.quantize.getKDtree=function(e,t,n){null==n&&(n=1e-4);var r=new Uint32Array(e.buffer),o={i0:0,i1:e.length,bst:null,est:null,tdst:0,left:null,right:null};o.bst=UPNG.quantize.stats(e,o.i0,o.i1),o.est=UPNG.quantize.estats(o.bst);for(var a=[o];a.length<t;){for(var i=0,s=0,u=0;u<a.length;u++)a[u].est.L>i&&(i=a[u].est.L,s=u);if(i<n)break;var c=a[s],l=UPNG.quantize.splitPixels(e,r,c.i0,c.i1,c.est.e,c.est.eMq255);if(c.i0>=l||c.i1<=l)c.est.L=0;else{var f={i0:c.i0,i1:l,bst:null,est:null,tdst:0,left:null,right:null};f.bst=UPNG.quantize.stats(e,f.i0,f.i1),f.est=UPNG.quantize.estats(f.bst);var p={i0:l,i1:c.i1,bst:null,est:null,tdst:0,left:null,right:null};for(p.bst={R:[],m:[],N:c.bst.N-f.bst.N},u=0;u<16;u++)p.bst.R[u]=c.bst.R[u]-f.bst.R[u];for(u=0;u<4;u++)p.bst.m[u]=c.bst.m[u]-f.bst.m[u];p.est=UPNG.quantize.estats(p.bst),c.left=f,c.right=p,a[s]=f,a.push(p)}}for(a.sort((function(e,t){return t.bst.N-e.bst.N})),u=0;u<a.length;u++)a[u].ind=u;return[o,a]},UPNG.quantize.getNearest=function(e,t,n,r,o){if(null==e.left)return e.tdst=UPNG.quantize.dist(e.est.q,t,n,r,o),e;var a=UPNG.quantize.planeDst(e.est,t,n,r,o),i=e.left,s=e.right;a>0&&(i=e.right,s=e.left);var u=UPNG.quantize.getNearest(i,t,n,r,o);if(u.tdst<=a*a)return u;var c=UPNG.quantize.getNearest(s,t,n,r,o);return c.tdst<u.tdst?c:u},UPNG.quantize.planeDst=function(e,t,n,r,o){var a=e.e;return a[0]*t+a[1]*n+a[2]*r+a[3]*o-e.eMq},UPNG.quantize.dist=function(e,t,n,r,o){var a=t-e[0],i=n-e[1],s=r-e[2],u=o-e[3];return a*a+i*i+s*s+u*u},UPNG.quantize.splitPixels=function(e,t,n,r,o,a){var i=UPNG.quantize.vecDot;for(r-=4;n<r;){for(;i(e,n,o)<=a;)n+=4;for(;i(e,r,o)>a;)r-=4;if(n>=r)break;var s=t[n>>2];t[n>>2]=t[r>>2],t[r>>2]=s,n+=4,r-=4}for(;i(e,n,o)>a;)n-=4;return n+4},UPNG.quantize.vecDot=function(e,t,n){return e[t]*n[0]+e[t+1]*n[1]+e[t+2]*n[2]+e[t+3]*n[3]},UPNG.quantize.stats=function(e,t,n){for(var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=[0,0,0,0],a=n-t>>2,i=t;i<n;i+=4){var s=e[i]*(1/255),u=e[i+1]*(1/255),c=e[i+2]*(1/255),l=e[i+3]*(1/255);o[0]+=s,o[1]+=u,o[2]+=c,o[3]+=l,r[0]+=s*s,r[1]+=s*u,r[2]+=s*c,r[3]+=s*l,r[5]+=u*u,r[6]+=u*c,r[7]+=u*l,r[10]+=c*c,r[11]+=c*l,r[15]+=l*l}return r[4]=r[1],r[8]=r[2],r[9]=r[6],r[12]=r[3],r[13]=r[7],r[14]=r[11],{R:r,m:o,N:a}},UPNG.quantize.estats=function(e){var t=e.R,n=e.m,r=e.N,o=n[0],a=n[1],i=n[2],s=n[3],u=0==r?0:1/r,c=[t[0]-o*o*u,t[1]-o*a*u,t[2]-o*i*u,t[3]-o*s*u,t[4]-a*o*u,t[5]-a*a*u,t[6]-a*i*u,t[7]-a*s*u,t[8]-i*o*u,t[9]-i*a*u,t[10]-i*i*u,t[11]-i*s*u,t[12]-s*o*u,t[13]-s*a*u,t[14]-s*i*u,t[15]-s*s*u],l=c,f=UPNG.M4,p=[Math.random(),Math.random(),Math.random(),Math.random()],h=0,d=0;if(0!=r)for(var v=0;v<16&&(p=f.multVec(l,p),d=Math.sqrt(f.dot(p,p)),p=f.sml(1/d,p),!(0!=v&&Math.abs(d-h)<1e-9));v++)h=d;var m=[o*u,a*u,i*u,s*u];return{Cov:c,q:m,e:p,L:h,eMq255:f.dot(f.sml(255,m),p),eMq:f.dot(p,m),rgba:(Math.round(255*m[3])<<24|Math.round(255*m[2])<<16|Math.round(255*m[1])<<8|Math.round(255*m[0])<<0)>>>0}},UPNG.M4={multVec:function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]]},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},sml:function(e,t){return[e*t[0],e*t[1],e*t[2],e*t[3]]}},UPNG.encode.concatRGBA=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n].byteLength;var r=new Uint8Array(t),o=0;for(n=0;n<e.length;n++){for(var a=new Uint8Array(e[n]),i=a.length,s=0;s<i;s+=4){var u=a[s],c=a[s+1],l=a[s+2],f=a[s+3];0==f&&(u=c=l=0),r[o+s]=u,r[o+s+1]=c,r[o+s+2]=l,r[o+s+3]=f}o+=i}return r.buffer};var BROWSER_NAME={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",MOBILE_SAFARI:"MOBILE_SAFARI",ETC:"ETC"},_BROWSER_NAME$CHROME$,MAX_CANVAS_SIZE=(_BROWSER_NAME$CHROME$={},_defineProperty(_BROWSER_NAME$CHROME$,BROWSER_NAME.CHROME,16384),_defineProperty(_BROWSER_NAME$CHROME$,BROWSER_NAME.FIREFOX,11180),_defineProperty(_BROWSER_NAME$CHROME$,BROWSER_NAME.DESKTOP_SAFARI,16384),_defineProperty(_BROWSER_NAME$CHROME$,BROWSER_NAME.IE,8192),_defineProperty(_BROWSER_NAME$CHROME$,BROWSER_NAME.MOBILE_SAFARI,4096),_defineProperty(_BROWSER_NAME$CHROME$,BROWSER_NAME.ETC,8192),_BROWSER_NAME$CHROME$),isBrowser="undefined"!=typeof window,moduleMapper=isBrowser&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),CustomFile=isBrowser&&(moduleMapper&&moduleMapper.getOriginalSymbol(window,"File")||void 0!==window.File&&File),CustomFileReader=isBrowser&&(moduleMapper&&moduleMapper.getOriginalSymbol(window,"FileReader")||void 0!==window.FileReader&&FileReader);function getFilefromDataUrl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();return new Promise((function(r){for(var o=e.split(","),a=o[0].match(/:(.*?);/)[1],i=globalThis.atob(o[1]),s=i.length,u=new Uint8Array(s);s--;)u[s]=i.charCodeAt(s);var c=new Blob([u],{type:a});c.name=t,c.lastModified=n,r(c)}))}function getDataUrlFromFile(e){return new Promise((function(t,n){var r=new CustomFileReader;r.onload=function(){return t(r.result)},r.onerror=function(e){return n(e)},r.readAsDataURL(e)}))}function loadImage(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=function(e){return n(e)},r.src=e}))}function getBrowserName(){if(void 0!==getBrowserName.cachedResult)return getBrowserName.cachedResult;var e=BROWSER_NAME.ETC,t=navigator.userAgent;return/Chrom(e|ium)/i.test(t)?e=BROWSER_NAME.CHROME:/iP(ad|od|hone)/i.test(t)&&/WebKit/i.test(t)&&!/(CriOS|FxiOS|OPiOS|mercury)/i.test(t)?e=BROWSER_NAME.MOBILE_SAFARI:/Safari/i.test(t)?e=BROWSER_NAME.DESKTOP_SAFARI:/Firefox/i.test(t)?e=BROWSER_NAME.FIREFOX:(/MSIE/i.test(t)||1==!!document.documentMode)&&(e=BROWSER_NAME.IE),getBrowserName.cachedResult=e,getBrowserName.cachedResult}function approximateBelowMaximumCanvasSizeOfBrowser(e,t){for(var n=getBrowserName(),r=MAX_CANVAS_SIZE[n],o=e,a=t,i=o*a,s=o>a?a/o:o/a;i>r*r;){var u=(r+o)/2,c=(r+a)/2;u<c?(a=c,o=c*s):(a=u*s,o=u),i=o*a}return{width:o,height:a}}function getNewCanvasAndCtx(e,t){var n,r;try{if(null===(r=(n=new OffscreenCanvas(e,t)).getContext("2d")))throw new Error("getContext of OffscreenCanvas returns null")}catch(e){r=(n=document.createElement("canvas")).getContext("2d")}return n.width=e,n.height=t,[n,r]}function drawImageInCanvas(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=approximateBelowMaximumCanvasSizeOfBrowser(e.width,e.height),r=n.width,o=n.height,a=getNewCanvasAndCtx(r,o),i=_slicedToArray(a,2),s=i[0],u=i[1];return t&&/jpe?g/.test(t)&&(u.fillStyle="white",u.fillRect(0,0,s.width,s.height)),u.drawImage(e,0,0,s.width,s.height),s}function isIOS(){return void 0!==isIOS.cachedResult||(isIOS.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document),isIOS.cachedResult}function drawFileInCanvas(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,r){var o,a,i=function(){try{return a=drawImageInCanvas(o,t.fileType||e.type),n([o,a])}catch(e){return r(e)}},s=function(t){try{var n=function(e){try{throw e}catch(e){return r(e)}};try{return getDataUrlFromFile(e).then((function(e){try{return loadImage(e).then((function(e){try{return o=e,function(){try{return i()}catch(e){return r(e)}}()}catch(e){return n(e)}}),n)}catch(e){return n(e)}}),n)}catch(e){n(e)}}catch(e){return r(e)}};try{if(isIOS()||[BROWSER_NAME.DESKTOP_SAFARI,BROWSER_NAME.MOBILE_SAFARI].includes(getBrowserName()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(e).then((function(e){try{return o=e,i()}catch(e){return s()}}),s)}catch(e){s()}}))}function canvasToFile(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return new Promise((function(a,i){var s,u,c;if("image/png"===t)return u=e.getContext("2d").getImageData(0,0,e.width,e.height).data,c=UPNG.encode([u],e.width,e.height,256*o),(s=new Blob([c],{type:t})).name=n,s.lastModified=r,l.call(this);{return"function"==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?e.convertToBlob({type:t,quality:o}).then(function(e){try{return(s=e).name=n,s.lastModified=r,a.call(this)}catch(e){return i(e)}}.bind(this),i):getFilefromDataUrl(e.toDataURL(t,o),n,r).then(function(e){try{return s=e,a.call(this)}catch(e){return i(e)}}.bind(this),i);function a(){return l.call(this)}}function l(){return a(s)}}))}function cleanupCanvasMemory(e){e.width=0,e.height=0}function isAutoOrientationInBrowser(){return new Promise((function(e,t){var n,r,o,a;return void 0!==isAutoOrientationInBrowser.cachedResult?e(isAutoOrientationInBrowser.cachedResult):getFilefromDataUrl("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(i){try{return drawFileInCanvas(n=i).then((function(i){try{return canvasToFile(r=i[1],n.type,n.name,n.lastModified).then((function(n){try{return o=n,cleanupCanvasMemory(r),drawFileInCanvas(o).then((function(n){try{return a=n[0],isAutoOrientationInBrowser.cachedResult=1===a.width&&2===a.height,e(isAutoOrientationInBrowser.cachedResult)}catch(e){return t(e)}}),t)}catch(e){return t(e)}}),t)}catch(e){return t(e)}}),t)}catch(e){return t(e)}}),t)}))}function getExifOrientation(e){return new Promise((function(t,n){var r=new CustomFileReader;r.onload=function(e){var n=new DataView(e.target.result);if(65496!=n.getUint16(0,!1))return t(-2);for(var r=n.byteLength,o=2;o<r;){if(n.getUint16(o+2,!1)<=8)return t(-1);var a=n.getUint16(o,!1);if(o+=2,65505==a){if(1165519206!=n.getUint32(o+=2,!1))return t(-1);var i=18761==n.getUint16(o+=6,!1);o+=n.getUint32(o+4,i);var s=n.getUint16(o,i);o+=2;for(var u=0;u<s;u++)if(274==n.getUint16(o+12*u,i))return t(n.getUint16(o+12*u+8,i))}else{if(65280!=(65280&a))break;o+=n.getUint16(o,!1)}}return t(-1)},r.onerror=function(e){return n(e)},r.readAsArrayBuffer(e)}))}function handleMaxWidthOrHeight(e,t){var n,r=e.width,o=e.height,a=t.maxWidthOrHeight,i=e;if(isFinite(a)&&(r>a||o>a)){var s=_slicedToArray(getNewCanvasAndCtx(r,o),2);i=s[0],n=s[1],r>o?(i.width=a,i.height=o/r*a):(i.width=r/o*a,i.height=a),n.drawImage(e,0,0,i.width,i.height),cleanupCanvasMemory(e)}return i}function followExifOrientation(e,t){var n=e.width,r=e.height,o=_slicedToArray(getNewCanvasAndCtx(n,r),2),a=o[0],i=o[1];switch(t>4&&t<9?(a.width=r,a.height=n):(a.width=n,a.height=r),t){case 2:i.transform(-1,0,0,1,n,0);break;case 3:i.transform(-1,0,0,-1,n,r);break;case 4:i.transform(1,0,0,-1,0,r);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,r,0);break;case 7:i.transform(0,-1,-1,0,r,n);break;case 8:i.transform(0,-1,1,0,0,n)}return i.drawImage(e,0,0,n,r),cleanupCanvasMemory(e),a}function compress(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise((function(r,o){var a,i,s,u,c,l,f,p,h,d,v,m,g,y,b,x,w,E;function A(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;a+=e,t.onProgress(Math.min(a,100))}function C(e){a=Math.min(Math.max(e,a),100),t.onProgress(a)}return a=n,i=t.maxIteration||10,s=1024*t.maxSizeMB*1024,A(),drawFileInCanvas(e,t).then(function(n){try{var a=_slicedToArray(n,2);return u=a[1],A(),c=handleMaxWidthOrHeight(u,t),A(),new Promise((function(n,r){var o;if(!(o=t.exifOrientation))return getExifOrientation(e).then(function(e){try{return o=e,a.call(this)}catch(e){return r(e)}}.bind(this),r);function a(){return n(o)}return a.call(this)})).then(function(n){try{return l=n,A(),isAutoOrientationInBrowser().then(function(n){try{return f=n?c:followExifOrientation(c,l),A(),p=t.initialQuality||1,h=t.fileType||e.type,canvasToFile(f,h,e.name,e.lastModified,p).then(function(t){try{{if(d=t,A(),v=d.size>s,m=d.size>e.size,!v&&!m)return C(100),r(d);var n;function a(){if(i--&&(b>s||b>g)){var t,n,r=_slicedToArray(getNewCanvasAndCtx(t=v?.95*E.width:E.width,n=v?.95*E.height:E.height),2);return w=r[0],r[1].drawImage(E,0,0,t,n),p*=.95,canvasToFile(w,h,e.name,e.lastModified,p).then((function(e){try{return x=e,cleanupCanvasMemory(E),E=w,b=x.size,C(Math.min(99,Math.floor((y-b)/(y-s)*100))),a}catch(e){return o(e)}}),o)}return[1]}return g=e.size,y=d.size,b=y,E=f,(n=function(e){for(;e;){if(e.then)return void e.then(n,o);try{if(e.pop){if(e.length)return e.pop()?l.call(this):e;e=a}else e=e.call(this)}catch(e){return o(e)}}}.bind(this))(a);function l(){return cleanupCanvasMemory(E),cleanupCanvasMemory(w),cleanupCanvasMemory(c),cleanupCanvasMemory(f),cleanupCanvasMemory(u),C(100),r(x)}}}catch(e){return o(e)}}.bind(this),o)}catch(e){return o(e)}}.bind(this),o)}catch(e){return o(e)}}.bind(this),o)}catch(e){return o(e)}}.bind(this),o)}))}var charAt=stringMultibyte.charAt,STRING_ITERATOR="String Iterator",setInternalState$2=internalState.set,getInternalState=internalState.getterFor(STRING_ITERATOR);defineIterator(String,"String",(function(e){setInternalState$2(this,{type:STRING_ITERATOR,string:toString(e),index:0})}),(function(){var e,t=getInternalState(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=charAt(n,r),t.index+=e.length,{value:e,done:!1})}));var domIterables={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},classList=documentCreateElement("span").classList,DOMTokenListPrototype=classList&&classList.constructor&&classList.constructor.prototype,domTokenListPrototype=DOMTokenListPrototype===Object.prototype?void 0:DOMTokenListPrototype,ITERATOR$2=wellKnownSymbol("iterator"),TO_STRING_TAG=wellKnownSymbol("toStringTag"),ArrayValues=es_array_iterator.values,handlePrototype$1=function(e,t){if(e){if(e[ITERATOR$2]!==ArrayValues)try{createNonEnumerableProperty(e,ITERATOR$2,ArrayValues)}catch(t){e[ITERATOR$2]=ArrayValues}if(e[TO_STRING_TAG]||createNonEnumerableProperty(e,TO_STRING_TAG,t),domIterables[t])for(var n in es_array_iterator)if(e[n]!==es_array_iterator[n])try{createNonEnumerableProperty(e,n,es_array_iterator[n])}catch(t){e[n]=es_array_iterator[n]}}};for(var COLLECTION_NAME$1 in domIterables)handlePrototype$1(global$1[COLLECTION_NAME$1]&&global$1[COLLECTION_NAME$1].prototype,COLLECTION_NAME$1);handlePrototype$1(domTokenListPrototype,"DOMTokenList");var ITERATOR$1=wellKnownSymbol("iterator"),nativeUrl=!fails((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),isPure&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[ITERATOR$1]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),callWithSafeIterationClosing=function(e,t,n,r){try{return r?t(anObject(n)[0],n[1]):t(n)}catch(t){iteratorClose(e,"throw",t)}},arrayFrom=function(e){var t=toObject(e),n=isConstructor(this),r=arguments.length,o=r>1?arguments[1]:void 0,a=void 0!==o;a&&(o=functionBindContext(o,r>2?arguments[2]:void 0,2));var i,s,u,c,l,f,p=getIteratorMethod(t),h=0;if(!p||this==Array&&isArrayIteratorMethod(p))for(i=toLength(t.length),s=n?new this(i):Array(i);i>h;h++)f=a?o(t[h],h):t[h],createProperty(s,h,f);else for(l=(c=getIterator(t,p)).next,s=n?new this:[];!(u=l.call(c)).done;h++)f=a?callWithSafeIterationClosing(c,o,[u.value,h],!0):u.value,createProperty(s,h,f);return s.length=h,s},maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexNonASCII=/[^\0-\u007E]/,regexSeparators=/[.\u3002\uFF0E\uFF61]/g,OVERFLOW_ERROR="Overflow: input needs wider integers to process",baseMinusTMin=base-tMin,floor$2=Math.floor,stringFromCharCode=String.fromCharCode,ucs2decode=function(e){for(var t=[],n=0,r=e.length;n<r;){var o=e.charCodeAt(n++);if(o>=55296&&o<=56319&&n<r){var a=e.charCodeAt(n++);56320==(64512&a)?t.push(((1023&o)<<10)+(1023&a)+65536):(t.push(o),n--)}else t.push(o)}return t},digitToBasic=function(e){return e+22+75*(e<26)},adapt=function(e,t,n){var r=0;for(e=n?floor$2(e/damp):e>>1,e+=floor$2(e/t);e>baseMinusTMin*tMax>>1;r+=base)e=floor$2(e/baseMinusTMin);return floor$2(r+(baseMinusTMin+1)*e/(e+skew))},encode=function(e){var t,n,r=[],o=(e=ucs2decode(e)).length,a=initialN,i=0,s=initialBias;for(t=0;t<e.length;t++)(n=e[t])<128&&r.push(stringFromCharCode(n));var u=r.length,c=u;for(u&&r.push(delimiter);c<o;){var l=maxInt;for(t=0;t<e.length;t++)(n=e[t])>=a&&n<l&&(l=n);var f=c+1;if(l-a>floor$2((maxInt-i)/f))throw RangeError(OVERFLOW_ERROR);for(i+=(l-a)*f,a=l,t=0;t<e.length;t++){if((n=e[t])<a&&++i>maxInt)throw RangeError(OVERFLOW_ERROR);if(n==a){for(var p=i,h=base;;h+=base){var d=h<=s?tMin:h>=s+tMax?tMax:h-s;if(p<d)break;var v=p-d,m=base-d;r.push(stringFromCharCode(digitToBasic(d+v%m))),p=floor$2(v/m)}r.push(stringFromCharCode(digitToBasic(p))),s=adapt(i,f,c==u),i=0,++c}}++i,++a}return r.join("")},stringPunycodeToAscii=function(e){var t,n,r=[],o=e.toLowerCase().replace(regexSeparators,".").split(".");for(t=0;t<o.length;t++)n=o[t],r.push(regexNonASCII.test(n)?"xn--"+encode(n):n);return r.join(".")},nativeFetch=getBuiltIn("fetch"),NativeRequest=getBuiltIn("Request"),RequestPrototype=NativeRequest&&NativeRequest.prototype,Headers=getBuiltIn("Headers"),ITERATOR=wellKnownSymbol("iterator"),URL_SEARCH_PARAMS="URLSearchParams",URL_SEARCH_PARAMS_ITERATOR=URL_SEARCH_PARAMS+"Iterator",setInternalState$1=internalState.set,getInternalParamsState=internalState.getterFor(URL_SEARCH_PARAMS),getInternalIteratorState=internalState.getterFor(URL_SEARCH_PARAMS_ITERATOR),plus=/\+/g,sequences=Array(4),percentSequence=function(e){return sequences[e-1]||(sequences[e-1]=RegExp("((?:%[\\da-f]{2}){"+e+"})","gi"))},percentDecode=function(e){try{return decodeURIComponent(e)}catch(t){return e}},deserialize=function(e){var t=e.replace(plus," "),n=4;try{return decodeURIComponent(t)}catch(e){for(;n;)t=t.replace(percentSequence(n--),percentDecode);return t}},find=/[!'()~]|%20/g,replace$1={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},replacer=function(e){return replace$1[e]},serialize=function(e){return encodeURIComponent(e).replace(find,replacer)},parseSearchParams=function(e,t){if(t)for(var n,r,o=t.split("&"),a=0;a<o.length;)(n=o[a++]).length&&(r=n.split("="),e.push({key:deserialize(r.shift()),value:deserialize(r.join("="))}))},updateSearchParams=function(e){this.entries.length=0,parseSearchParams(this.entries,e)},validateArgumentsLength=function(e,t){if(e<t)throw TypeError("Not enough arguments")},URLSearchParamsIterator=createIteratorConstructor((function(e,t){setInternalState$1(this,{type:URL_SEARCH_PARAMS_ITERATOR,iterator:getIterator(getInternalParamsState(e).entries),kind:t})}),"Iterator",(function(){var e=getInternalIteratorState(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n})),URLSearchParamsConstructor=function(){anInstance(this,URLSearchParamsConstructor,URL_SEARCH_PARAMS);var e,t,n,r,o,a,i,s,u,c=arguments.length>0?arguments[0]:void 0,l=this,f=[];if(setInternalState$1(l,{type:URL_SEARCH_PARAMS,entries:f,updateURL:function(){},updateSearchParams:updateSearchParams}),void 0!==c)if(isObject(c))if(e=getIteratorMethod(c))for(n=(t=getIterator(c,e)).next;!(r=n.call(t)).done;){if((i=(a=(o=getIterator(anObject(r.value))).next).call(o)).done||(s=a.call(o)).done||!a.call(o).done)throw TypeError("Expected sequence with length 2");f.push({key:toString(i.value),value:toString(s.value)})}else for(u in c)has$1(c,u)&&f.push({key:u,value:toString(c[u])});else parseSearchParams(f,"string"==typeof c?"?"===c.charAt(0)?c.slice(1):c:toString(c))},URLSearchParamsPrototype=URLSearchParamsConstructor.prototype;if(redefineAll(URLSearchParamsPrototype,{append:function(e,t){validateArgumentsLength(arguments.length,2);var n=getInternalParamsState(this);n.entries.push({key:toString(e),value:toString(t)}),n.updateURL()},delete:function(e){validateArgumentsLength(arguments.length,1);for(var t=getInternalParamsState(this),n=t.entries,r=toString(e),o=0;o<n.length;)n[o].key===r?n.splice(o,1):o++;t.updateURL()},get:function(e){validateArgumentsLength(arguments.length,1);for(var t=getInternalParamsState(this).entries,n=toString(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){validateArgumentsLength(arguments.length,1);for(var t=getInternalParamsState(this).entries,n=toString(e),r=[],o=0;o<t.length;o++)t[o].key===n&&r.push(t[o].value);return r},has:function(e){validateArgumentsLength(arguments.length,1);for(var t=getInternalParamsState(this).entries,n=toString(e),r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){validateArgumentsLength(arguments.length,1);for(var n,r=getInternalParamsState(this),o=r.entries,a=!1,i=toString(e),s=toString(t),u=0;u<o.length;u++)(n=o[u]).key===i&&(a?o.splice(u--,1):(a=!0,n.value=s));a||o.push({key:i,value:s}),r.updateURL()},sort:function(){var e,t,n,r=getInternalParamsState(this),o=r.entries,a=o.slice();for(o.length=0,n=0;n<a.length;n++){for(e=a[n],t=0;t<n;t++)if(o[t].key>e.key){o.splice(t,0,e);break}t===n&&o.push(e)}r.updateURL()},forEach:function(e){for(var t,n=getInternalParamsState(this).entries,r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3),o=0;o<n.length;)r((t=n[o++]).value,t.key,this)},keys:function(){return new URLSearchParamsIterator(this,"keys")},values:function(){return new URLSearchParamsIterator(this,"values")},entries:function(){return new URLSearchParamsIterator(this,"entries")}},{enumerable:!0}),redefine(URLSearchParamsPrototype,ITERATOR,URLSearchParamsPrototype.entries,{name:"entries"}),redefine(URLSearchParamsPrototype,"toString",(function(){for(var e,t=getInternalParamsState(this).entries,n=[],r=0;r<t.length;)e=t[r++],n.push(serialize(e.key)+"="+serialize(e.value));return n.join("&")}),{enumerable:!0}),setToStringTag(URLSearchParamsConstructor,URL_SEARCH_PARAMS),_export({global:!0,forced:!nativeUrl},{URLSearchParams:URLSearchParamsConstructor}),!nativeUrl&&isCallable(Headers)){var wrapRequestOptions=function(e){if(isObject(e)){var t,n=e.body;if(classof(n)===URL_SEARCH_PARAMS)return(t=e.headers?new Headers(e.headers):new Headers).has("content-type")||t.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),objectCreate(e,{body:createPropertyDescriptor(0,String(n)),headers:createPropertyDescriptor(0,t)})}return e};if(isCallable(nativeFetch)&&_export({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return nativeFetch(e,arguments.length>1?wrapRequestOptions(arguments[1]):{})}}),isCallable(NativeRequest)){var RequestConstructor=function(e){return anInstance(this,RequestConstructor,"Request"),new NativeRequest(e,arguments.length>1?wrapRequestOptions(arguments[1]):{})};RequestPrototype.constructor=RequestConstructor,RequestConstructor.prototype=RequestPrototype,_export({global:!0,forced:!0},{Request:RequestConstructor})}}var web_urlSearchParams={URLSearchParams:URLSearchParamsConstructor,getState:getInternalParamsState},codeAt=stringMultibyte.codeAt,NativeURL=global$1.URL,URLSearchParams$1=web_urlSearchParams.URLSearchParams,getInternalSearchParamsState=web_urlSearchParams.getState,setInternalState=internalState.set,getInternalURLState=internalState.getterFor("URL"),floor$1=Math.floor,pow=Math.pow,INVALID_AUTHORITY="Invalid authority",INVALID_SCHEME="Invalid scheme",INVALID_HOST="Invalid host",INVALID_PORT="Invalid port",ALPHA=/[A-Za-z]/,ALPHANUMERIC=/[\d+-.A-Za-z]/,DIGIT=/\d/,HEX_START=/^0x/i,OCT=/^[0-7]+$/,DEC=/^\d+$/,HEX=/^[\dA-Fa-f]+$/,FORBIDDEN_HOST_CODE_POINT=/[\0\t\n\r #%/:<>?@[\\\]^|]/,FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT=/[\0\t\n\r #/:<>?@[\\\]^|]/,LEADING_AND_TRAILING_C0_CONTROL_OR_SPACE=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,TAB_AND_NEW_LINE=/[\t\n\r]/g,EOF,parseHost=function(e,t){var n,r,o;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return INVALID_HOST;if(!(n=parseIPv6(t.slice(1,-1))))return INVALID_HOST;e.host=n}else if(isSpecial(e)){if(t=stringPunycodeToAscii(t),FORBIDDEN_HOST_CODE_POINT.test(t))return INVALID_HOST;if(null===(n=parseIPv4(t)))return INVALID_HOST;e.host=n}else{if(FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT.test(t))return INVALID_HOST;for(n="",r=arrayFrom(t),o=0;o<r.length;o++)n+=percentEncode(r[o],C0ControlPercentEncodeSet);e.host=n}},parseIPv4=function(e){var t,n,r,o,a,i,s,u=e.split(".");if(u.length&&""==u[u.length-1]&&u.pop(),(t=u.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(o=u[r]))return e;if(a=10,o.length>1&&"0"==o.charAt(0)&&(a=HEX_START.test(o)?16:8,o=o.slice(8==a?1:2)),""===o)i=0;else{if(!(10==a?DEC:8==a?OCT:HEX).test(o))return e;i=parseInt(o,a)}n.push(i)}for(r=0;r<t;r++)if(i=n[r],r==t-1){if(i>=pow(256,5-t))return null}else if(i>255)return null;for(s=n.pop(),r=0;r<n.length;r++)s+=n[r]*pow(256,3-r);return s},parseIPv6=function(e){var t,n,r,o,a,i,s,u=[0,0,0,0,0,0,0,0],c=0,l=null,f=0,p=function(){return e.charAt(f)};if(":"==p()){if(":"!=e.charAt(1))return;f+=2,l=++c}for(;p();){if(8==c)return;if(":"!=p()){for(t=n=0;n<4&&HEX.test(p());)t=16*t+parseInt(p(),16),f++,n++;if("."==p()){if(0==n)return;if(f-=n,c>6)return;for(r=0;p();){if(o=null,r>0){if(!("."==p()&&r<4))return;f++}if(!DIGIT.test(p()))return;for(;DIGIT.test(p());){if(a=parseInt(p(),10),null===o)o=a;else{if(0==o)return;o=10*o+a}if(o>255)return;f++}u[c]=256*u[c]+o,2!=++r&&4!=r||c++}if(4!=r)return;break}if(":"==p()){if(f++,!p())return}else if(p())return;u[c++]=t}else{if(null!==l)return;f++,l=++c}}if(null!==l)for(i=c-l,c=7;0!=c&&i>0;)s=u[c],u[c--]=u[l+i-1],u[l+--i]=s;else if(8!=c)return;return u},findLongestZeroSequence=function(e){for(var t=null,n=1,r=null,o=0,a=0;a<8;a++)0!==e[a]?(o>n&&(t=r,n=o),r=null,o=0):(null===r&&(r=a),++o);return o>n&&(t=r,n=o),t},serializeHost=function(e){var t,n,r,o;if("number"==typeof e){for(t=[],n=0;n<4;n++)t.unshift(e%256),e=floor$1(e/256);return t.join(".")}if("object"==typeof e){for(t="",r=findLongestZeroSequence(e),n=0;n<8;n++)o&&0===e[n]||(o&&(o=!1),r===n?(t+=n?":":"::",o=!0):(t+=e[n].toString(16),n<7&&(t+=":")));return"["+t+"]"}return e},C0ControlPercentEncodeSet={},fragmentPercentEncodeSet=objectAssign({},C0ControlPercentEncodeSet,{" ":1,'"':1,"<":1,">":1,"`":1}),pathPercentEncodeSet=objectAssign({},fragmentPercentEncodeSet,{"#":1,"?":1,"{":1,"}":1}),userinfoPercentEncodeSet=objectAssign({},pathPercentEncodeSet,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),percentEncode=function(e,t){var n=codeAt(e,0);return n>32&&n<127&&!has$1(t,e)?e:encodeURIComponent(e)},specialSchemes={ftp:21,file:null,http:80,https:443,ws:80,wss:443},isSpecial=function(e){return has$1(specialSchemes,e.scheme)},includesCredentials=function(e){return""!=e.username||""!=e.password},cannotHaveUsernamePasswordPort=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},isWindowsDriveLetter=function(e,t){var n;return 2==e.length&&ALPHA.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)},startsWithWindowsDriveLetter=function(e){var t;return e.length>1&&isWindowsDriveLetter(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},shortenURLsPath=function(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&isWindowsDriveLetter(t[0],!0)||t.pop()},isSingleDot=function(e){return"."===e||"%2e"===e.toLowerCase()},isDoubleDot=function(e){return".."===(e=e.toLowerCase())||"%2e."===e||".%2e"===e||"%2e%2e"===e},SCHEME_START={},SCHEME={},NO_SCHEME={},SPECIAL_RELATIVE_OR_AUTHORITY={},PATH_OR_AUTHORITY={},RELATIVE={},RELATIVE_SLASH={},SPECIAL_AUTHORITY_SLASHES={},SPECIAL_AUTHORITY_IGNORE_SLASHES={},AUTHORITY={},HOST={},HOSTNAME={},PORT={},FILE={},FILE_SLASH={},FILE_HOST={},PATH_START={},PATH={},CANNOT_BE_A_BASE_URL_PATH={},QUERY={},FRAGMENT={},parseURL=function(e,t,n,r){var o,a,i,s,u=n||SCHEME_START,c=0,l="",f=!1,p=!1,h=!1;for(n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(LEADING_AND_TRAILING_C0_CONTROL_OR_SPACE,"")),t=t.replace(TAB_AND_NEW_LINE,""),o=arrayFrom(t);c<=o.length;){switch(a=o[c],u){case SCHEME_START:if(!a||!ALPHA.test(a)){if(n)return INVALID_SCHEME;u=NO_SCHEME;continue}l+=a.toLowerCase(),u=SCHEME;break;case SCHEME:if(a&&(ALPHANUMERIC.test(a)||"+"==a||"-"==a||"."==a))l+=a.toLowerCase();else{if(":"!=a){if(n)return INVALID_SCHEME;l="",u=NO_SCHEME,c=0;continue}if(n&&(isSpecial(e)!=has$1(specialSchemes,l)||"file"==l&&(includesCredentials(e)||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=l,n)return void(isSpecial(e)&&specialSchemes[e.scheme]==e.port&&(e.port=null));l="","file"==e.scheme?u=FILE:isSpecial(e)&&r&&r.scheme==e.scheme?u=SPECIAL_RELATIVE_OR_AUTHORITY:isSpecial(e)?u=SPECIAL_AUTHORITY_SLASHES:"/"==o[c+1]?(u=PATH_OR_AUTHORITY,c++):(e.cannotBeABaseURL=!0,e.path.push(""),u=CANNOT_BE_A_BASE_URL_PATH)}break;case NO_SCHEME:if(!r||r.cannotBeABaseURL&&"#"!=a)return INVALID_SCHEME;if(r.cannotBeABaseURL&&"#"==a){e.scheme=r.scheme,e.path=r.path.slice(),e.query=r.query,e.fragment="",e.cannotBeABaseURL=!0,u=FRAGMENT;break}u="file"==r.scheme?FILE:RELATIVE;continue;case SPECIAL_RELATIVE_OR_AUTHORITY:if("/"!=a||"/"!=o[c+1]){u=RELATIVE;continue}u=SPECIAL_AUTHORITY_IGNORE_SLASHES,c++;break;case PATH_OR_AUTHORITY:if("/"==a){u=AUTHORITY;break}u=PATH;continue;case RELATIVE:if(e.scheme=r.scheme,a==EOF)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query;else if("/"==a||"\\"==a&&isSpecial(e))u=RELATIVE_SLASH;else if("?"==a)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query="",u=QUERY;else{if("#"!=a){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.path.pop(),u=PATH;continue}e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query,e.fragment="",u=FRAGMENT}break;case RELATIVE_SLASH:if(!isSpecial(e)||"/"!=a&&"\\"!=a){if("/"!=a){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,u=PATH;continue}u=AUTHORITY}else u=SPECIAL_AUTHORITY_IGNORE_SLASHES;break;case SPECIAL_AUTHORITY_SLASHES:if(u=SPECIAL_AUTHORITY_IGNORE_SLASHES,"/"!=a||"/"!=l.charAt(c+1))continue;c++;break;case SPECIAL_AUTHORITY_IGNORE_SLASHES:if("/"!=a&&"\\"!=a){u=AUTHORITY;continue}break;case AUTHORITY:if("@"==a){f&&(l="%40"+l),f=!0,i=arrayFrom(l);for(var d=0;d<i.length;d++){var v=i[d];if(":"!=v||h){var m=percentEncode(v,userinfoPercentEncodeSet);h?e.password+=m:e.username+=m}else h=!0}l=""}else if(a==EOF||"/"==a||"?"==a||"#"==a||"\\"==a&&isSpecial(e)){if(f&&""==l)return INVALID_AUTHORITY;c-=arrayFrom(l).length+1,l="",u=HOST}else l+=a;break;case HOST:case HOSTNAME:if(n&&"file"==e.scheme){u=FILE_HOST;continue}if(":"!=a||p){if(a==EOF||"/"==a||"?"==a||"#"==a||"\\"==a&&isSpecial(e)){if(isSpecial(e)&&""==l)return INVALID_HOST;if(n&&""==l&&(includesCredentials(e)||null!==e.port))return;if(s=parseHost(e,l))return s;if(l="",u=PATH_START,n)return;continue}"["==a?p=!0:"]"==a&&(p=!1),l+=a}else{if(""==l)return INVALID_HOST;if(s=parseHost(e,l))return s;if(l="",u=PORT,n==HOSTNAME)return}break;case PORT:if(!DIGIT.test(a)){if(a==EOF||"/"==a||"?"==a||"#"==a||"\\"==a&&isSpecial(e)||n){if(""!=l){var g=parseInt(l,10);if(g>65535)return INVALID_PORT;e.port=isSpecial(e)&&g===specialSchemes[e.scheme]?null:g,l=""}if(n)return;u=PATH_START;continue}return INVALID_PORT}l+=a;break;case FILE:if(e.scheme="file","/"==a||"\\"==a)u=FILE_SLASH;else{if(!r||"file"!=r.scheme){u=PATH;continue}if(a==EOF)e.host=r.host,e.path=r.path.slice(),e.query=r.query;else if("?"==a)e.host=r.host,e.path=r.path.slice(),e.query="",u=QUERY;else{if("#"!=a){startsWithWindowsDriveLetter(o.slice(c).join(""))||(e.host=r.host,e.path=r.path.slice(),shortenURLsPath(e)),u=PATH;continue}e.host=r.host,e.path=r.path.slice(),e.query=r.query,e.fragment="",u=FRAGMENT}}break;case FILE_SLASH:if("/"==a||"\\"==a){u=FILE_HOST;break}r&&"file"==r.scheme&&!startsWithWindowsDriveLetter(o.slice(c).join(""))&&(isWindowsDriveLetter(r.path[0],!0)?e.path.push(r.path[0]):e.host=r.host),u=PATH;continue;case FILE_HOST:if(a==EOF||"/"==a||"\\"==a||"?"==a||"#"==a){if(!n&&isWindowsDriveLetter(l))u=PATH;else if(""==l){if(e.host="",n)return;u=PATH_START}else{if(s=parseHost(e,l))return s;if("localhost"==e.host&&(e.host=""),n)return;l="",u=PATH_START}continue}l+=a;break;case PATH_START:if(isSpecial(e)){if(u=PATH,"/"!=a&&"\\"!=a)continue}else if(n||"?"!=a)if(n||"#"!=a){if(a!=EOF&&(u=PATH,"/"!=a))continue}else e.fragment="",u=FRAGMENT;else e.query="",u=QUERY;break;case PATH:if(a==EOF||"/"==a||"\\"==a&&isSpecial(e)||!n&&("?"==a||"#"==a)){if(isDoubleDot(l)?(shortenURLsPath(e),"/"==a||"\\"==a&&isSpecial(e)||e.path.push("")):isSingleDot(l)?"/"==a||"\\"==a&&isSpecial(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&isWindowsDriveLetter(l)&&(e.host&&(e.host=""),l=l.charAt(0)+":"),e.path.push(l)),l="","file"==e.scheme&&(a==EOF||"?"==a||"#"==a))for(;e.path.length>1&&""===e.path[0];)e.path.shift();"?"==a?(e.query="",u=QUERY):"#"==a&&(e.fragment="",u=FRAGMENT)}else l+=percentEncode(a,pathPercentEncodeSet);break;case CANNOT_BE_A_BASE_URL_PATH:"?"==a?(e.query="",u=QUERY):"#"==a?(e.fragment="",u=FRAGMENT):a!=EOF&&(e.path[0]+=percentEncode(a,C0ControlPercentEncodeSet));break;case QUERY:n||"#"!=a?a!=EOF&&("'"==a&&isSpecial(e)?e.query+="%27":e.query+="#"==a?"%23":percentEncode(a,C0ControlPercentEncodeSet)):(e.fragment="",u=FRAGMENT);break;case FRAGMENT:a!=EOF&&(e.fragment+=percentEncode(a,fragmentPercentEncodeSet))}c++}},URLConstructor=function(e){var t,n,r=anInstance(this,URLConstructor,"URL"),o=arguments.length>1?arguments[1]:void 0,a=toString(e),i=setInternalState(r,{type:"URL"});if(void 0!==o)if(o instanceof URLConstructor)t=getInternalURLState(o);else if(n=parseURL(t={},toString(o)))throw TypeError(n);if(n=parseURL(i,a,null,t))throw TypeError(n);var s=i.searchParams=new URLSearchParams$1,u=getInternalSearchParamsState(s);u.updateSearchParams(i.query),u.updateURL=function(){i.query=String(s)||null},descriptors||(r.href=serializeURL.call(r),r.origin=getOrigin.call(r),r.protocol=getProtocol.call(r),r.username=getUsername.call(r),r.password=getPassword.call(r),r.host=getHost.call(r),r.hostname=getHostname.call(r),r.port=getPort.call(r),r.pathname=getPathname.call(r),r.search=getSearch.call(r),r.searchParams=getSearchParams.call(r),r.hash=getHash.call(r))},URLPrototype=URLConstructor.prototype,serializeURL=function(){var e=getInternalURLState(this),t=e.scheme,n=e.username,r=e.password,o=e.host,a=e.port,i=e.path,s=e.query,u=e.fragment,c=t+":";return null!==o?(c+="//",includesCredentials(e)&&(c+=n+(r?":"+r:"")+"@"),c+=serializeHost(o),null!==a&&(c+=":"+a)):"file"==t&&(c+="//"),c+=e.cannotBeABaseURL?i[0]:i.length?"/"+i.join("/"):"",null!==s&&(c+="?"+s),null!==u&&(c+="#"+u),c},getOrigin=function(){var e=getInternalURLState(this),t=e.scheme,n=e.port;if("blob"==t)try{return new URLConstructor(t.path[0]).origin}catch(e){return"null"}return"file"!=t&&isSpecial(e)?t+"://"+serializeHost(e.host)+(null!==n?":"+n:""):"null"},getProtocol=function(){return getInternalURLState(this).scheme+":"},getUsername=function(){return getInternalURLState(this).username},getPassword=function(){return getInternalURLState(this).password},getHost=function(){var e=getInternalURLState(this),t=e.host,n=e.port;return null===t?"":null===n?serializeHost(t):serializeHost(t)+":"+n},getHostname=function(){var e=getInternalURLState(this).host;return null===e?"":serializeHost(e)},getPort=function(){var e=getInternalURLState(this).port;return null===e?"":String(e)},getPathname=function(){var e=getInternalURLState(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},getSearch=function(){var e=getInternalURLState(this).query;return e?"?"+e:""},getSearchParams=function(){return getInternalURLState(this).searchParams},getHash=function(){var e=getInternalURLState(this).fragment;return e?"#"+e:""},accessorDescriptor=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(descriptors&&objectDefineProperties(URLPrototype,{href:accessorDescriptor(serializeURL,(function(e){var t=getInternalURLState(this),n=toString(e),r=parseURL(t,n);if(r)throw TypeError(r);getInternalSearchParamsState(t.searchParams).updateSearchParams(t.query)})),origin:accessorDescriptor(getOrigin),protocol:accessorDescriptor(getProtocol,(function(e){var t=getInternalURLState(this);parseURL(t,toString(e)+":",SCHEME_START)})),username:accessorDescriptor(getUsername,(function(e){var t=getInternalURLState(this),n=arrayFrom(toString(e));if(!cannotHaveUsernamePasswordPort(t)){t.username="";for(var r=0;r<n.length;r++)t.username+=percentEncode(n[r],userinfoPercentEncodeSet)}})),password:accessorDescriptor(getPassword,(function(e){var t=getInternalURLState(this),n=arrayFrom(toString(e));if(!cannotHaveUsernamePasswordPort(t)){t.password="";for(var r=0;r<n.length;r++)t.password+=percentEncode(n[r],userinfoPercentEncodeSet)}})),host:accessorDescriptor(getHost,(function(e){var t=getInternalURLState(this);t.cannotBeABaseURL||parseURL(t,toString(e),HOST)})),hostname:accessorDescriptor(getHostname,(function(e){var t=getInternalURLState(this);t.cannotBeABaseURL||parseURL(t,toString(e),HOSTNAME)})),port:accessorDescriptor(getPort,(function(e){var t=getInternalURLState(this);cannotHaveUsernamePasswordPort(t)||(""==(e=toString(e))?t.port=null:parseURL(t,e,PORT))})),pathname:accessorDescriptor(getPathname,(function(e){var t=getInternalURLState(this);t.cannotBeABaseURL||(t.path=[],parseURL(t,toString(e),PATH_START))})),search:accessorDescriptor(getSearch,(function(e){var t=getInternalURLState(this);""==(e=toString(e))?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",parseURL(t,e,QUERY)),getInternalSearchParamsState(t.searchParams).updateSearchParams(t.query)})),searchParams:accessorDescriptor(getSearchParams),hash:accessorDescriptor(getHash,(function(e){var t=getInternalURLState(this);""!=(e=toString(e))?("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",parseURL(t,e,FRAGMENT)):t.fragment=null}))}),redefine(URLPrototype,"toJSON",(function(){return serializeURL.call(this)}),{enumerable:!0}),redefine(URLPrototype,"toString",(function(){return serializeURL.call(this)}),{enumerable:!0}),NativeURL){var nativeCreateObjectURL=NativeURL.createObjectURL,nativeRevokeObjectURL=NativeURL.revokeObjectURL;nativeCreateObjectURL&&redefine(URLConstructor,"createObjectURL",(function(e){return nativeCreateObjectURL.apply(NativeURL,arguments)})),nativeRevokeObjectURL&&redefine(URLConstructor,"revokeObjectURL",(function(e){return nativeRevokeObjectURL.apply(NativeURL,arguments)}))}setToStringTag(URLConstructor,"URL"),_export({global:!0,forced:!nativeUrl,sham:!descriptors},{URL:URLConstructor});var $forEach=arrayIteration.forEach,STRICT_METHOD=arrayMethodIsStrict("forEach"),arrayForEach=STRICT_METHOD?[].forEach:function(e){return $forEach(this,e,arguments.length>1?arguments[1]:void 0)},handlePrototype=function(e){if(e&&e.forEach!==arrayForEach)try{createNonEnumerableProperty(e,"forEach",arrayForEach)}catch(t){e.forEach=arrayForEach}};for(var COLLECTION_NAME in domIterables)handlePrototype(global$1[COLLECTION_NAME]&&global$1[COLLECTION_NAME].prototype);handlePrototype(domTokenListPrototype);var propertyIsEnumerable=objectPropertyIsEnumerable.f,createMethod=function(e){return function(t){for(var n,r=toIndexedObject(t),o=objectKeys(r),a=o.length,i=0,s=[];a>i;)n=o[i++],descriptors&&!propertyIsEnumerable.call(r,n)||s.push(e?[n,r[n]]:r[n]);return s}},objectToArray={entries:createMethod(!0),values:createMethod(!1)},$entries=objectToArray.entries;_export({target:"Object",stat:!0},{entries:function(e){return $entries(e)}});var getOwnPropertyDescriptor=objectGetOwnPropertyDescriptor.f,$startsWith="".startsWith,min$1=Math.min,CORRECT_IS_REGEXP_LOGIC=correctIsRegexpLogic("startsWith"),MDN_POLYFILL_BUG=!(CORRECT_IS_REGEXP_LOGIC||(descriptor=getOwnPropertyDescriptor(String.prototype,"startsWith"),!descriptor||descriptor.writable)),descriptor;_export({target:"String",proto:!0,forced:!MDN_POLYFILL_BUG&&!CORRECT_IS_REGEXP_LOGIC},{startsWith:function(e){var t=toString(requireObjectCoercible(this));notARegexp(e);var n=toLength(min$1(arguments.length>1?arguments[1]:void 0,t.length)),r=toString(e);return $startsWith?$startsWith.call(t,r,n):t.slice(n,n+r.length)===r}});var floor=Math.floor,replace="".replace,SUBSTITUTION_SYMBOLS=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,SUBSTITUTION_SYMBOLS_NO_NAMED=/\$([$&'`]|\d{1,2})/g,getSubstitution=function(e,t,n,r,o,a){var i=n+e.length,s=r.length,u=SUBSTITUTION_SYMBOLS_NO_NAMED;return void 0!==o&&(o=toObject(o),u=SUBSTITUTION_SYMBOLS),replace.call(a,u,(function(a,u){var c;switch(u.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(i);case"<":c=o[u.slice(1,-1)];break;default:var l=+u;if(0===l)return a;if(l>s){var f=floor(l/10);return 0===f?a:f<=s?void 0===r[f-1]?u.charAt(1):r[f-1]+u.charAt(1):a}c=r[l-1]}return void 0===c?"":c}))},REPLACE=wellKnownSymbol("replace"),max=Math.max,min=Math.min,maybeToString=function(e){return void 0===e?e:String(e)},REPLACE_KEEPS_$0="$0"==="a".replace(/./,"$0"),REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE=!!/./[REPLACE]&&""===/./[REPLACE]("a","$0"),REPLACE_SUPPORTS_NAMED_GROUPS=!fails((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));fixRegexpWellKnownSymbolLogic("replace",(function(e,t,n){var r=REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE?"$":"$0";return[function(e,n){var r=requireObjectCoercible(this),o=null==e?void 0:getMethod(e,REPLACE);return o?o.call(e,r,n):t.call(toString(r),e,n)},function(e,o){var a=anObject(this),i=toString(e);if("string"==typeof o&&-1===o.indexOf(r)&&-1===o.indexOf("$<")){var s=n(t,a,i,o);if(s.done)return s.value}var u=isCallable(o);u||(o=toString(o));var c=a.global;if(c){var l=a.unicode;a.lastIndex=0}for(var f=[];;){var p=regexpExecAbstract(a,i);if(null===p)break;if(f.push(p),!c)break;""===toString(p[0])&&(a.lastIndex=advanceStringIndex(i,toLength(a.lastIndex),l))}for(var h="",d=0,v=0;v<f.length;v++){p=f[v];for(var m=toString(p[0]),g=max(min(toInteger(p.index),i.length),0),y=[],b=1;b<p.length;b++)y.push(maybeToString(p[b]));var x=p.groups;if(u){var w=[m].concat(y,g,i);void 0!==x&&w.push(x);var E=toString(o.apply(void 0,w))}else E=getSubstitution(m,i,g,y,x,o);g>=d&&(h+=i.slice(d,g)+E,d=g+m.length)}return h+i.slice(d)}]}),!REPLACE_SUPPORTS_NAMED_GROUPS||!REPLACE_KEEPS_$0||REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE);var IS_CONCAT_SPREADABLE=wellKnownSymbol("isConcatSpreadable"),MAX_SAFE_INTEGER=9007199254740991,MAXIMUM_ALLOWED_INDEX_EXCEEDED="Maximum allowed index exceeded",IS_CONCAT_SPREADABLE_SUPPORT=engineV8Version>=51||!fails((function(){var e=[];return e[IS_CONCAT_SPREADABLE]=!1,e.concat()[0]!==e})),SPECIES_SUPPORT=arrayMethodHasSpeciesSupport("concat"),isConcatSpreadable=function(e){if(!isObject(e))return!1;var t=e[IS_CONCAT_SPREADABLE];return void 0!==t?!!t:isArray(e)},FORCED=!IS_CONCAT_SPREADABLE_SUPPORT||!SPECIES_SUPPORT;_export({target:"Array",proto:!0,forced:FORCED},{concat:function(e){var t,n,r,o,a,i=toObject(this),s=arraySpeciesCreate(i,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(isConcatSpreadable(a=-1===t?i:arguments[t])){if(u+(o=toLength(a.length))>MAX_SAFE_INTEGER)throw TypeError(MAXIMUM_ALLOWED_INDEX_EXCEEDED);for(n=0;n<o;n++,u++)n in a&&createProperty(s,u,a[n])}else{if(u>=MAX_SAFE_INTEGER)throw TypeError(MAXIMUM_ALLOWED_INDEX_EXCEEDED);createProperty(s,u++,a)}return s.length=u,s}});var cnt=0,imageCompressionLibUrl,worker;function createWorker(e){var t=[];return"function"==typeof e?t.push("(".concat(e,")()")):t.push(e),new Worker(URL.createObjectURL(new Blob(t)))}function createSourceObject(e){return URL.createObjectURL(new Blob([e],{type:"application/javascript"}))}function stringify(e){return JSON.stringify(e,(function(e,t){return"function"==typeof t?"BIC_FN:::(function () { return ".concat(t.toString()," })()"):t}))}function parse(o){if("string"==typeof o)return o;var result={};return Object.entries(o).forEach((function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];if("string"==typeof value&&value.startsWith("BIC_FN:::"))try{result[key]=eval(value.replace(/^BIC_FN:::/,""))}catch(e){throw e}else result[key]=parse(value)})),result}function generateLib(){return createSourceObject("\n    // reconstruct library\n    function imageCompression (){return (".concat(imageCompression,").apply(null, arguments)}\n\n    imageCompression.getDataUrlFromFile = ").concat(imageCompression.getDataUrlFromFile,"\n    imageCompression.getFilefromDataUrl = ").concat(imageCompression.getFilefromDataUrl,"\n    imageCompression.loadImage = ").concat(imageCompression.loadImage,"\n    imageCompression.drawImageInCanvas = ").concat(imageCompression.drawImageInCanvas,"\n    imageCompression.drawFileInCanvas = ").concat(imageCompression.drawFileInCanvas,"\n    imageCompression.canvasToFile = ").concat(imageCompression.canvasToFile,"\n    imageCompression.getExifOrientation = ").concat(imageCompression.getExifOrientation,"\n    imageCompression.handleMaxWidthOrHeight = ").concat(imageCompression.handleMaxWidthOrHeight,"\n    imageCompression.followExifOrientation = ").concat(imageCompression.followExifOrientation,"\n    imageCompression.cleanupCanvasMemory = ").concat(imageCompression.cleanupCanvasMemory,"\n    imageCompression.isAutoOrientationInBrowser = ").concat(imageCompression.isAutoOrientationInBrowser,"\n    imageCompression.approximateBelowMaximumCanvasSizeOfBrowser = ").concat(imageCompression.approximateBelowMaximumCanvasSizeOfBrowser,"\n    imageCompression.getBrowserName = ").concat(imageCompression.getBrowserName,"\n\n    // functions / objects\n    getDataUrlFromFile = imageCompression.getDataUrlFromFile\n    getFilefromDataUrl = imageCompression.getFilefromDataUrl\n    loadImage = imageCompression.loadImage\n    drawImageInCanvas = imageCompression.drawImageInCanvas\n    drawFileInCanvas = imageCompression.drawFileInCanvas\n    canvasToFile = imageCompression.canvasToFile\n    getExifOrientation = imageCompression.getExifOrientation\n    handleMaxWidthOrHeight = imageCompression.handleMaxWidthOrHeight\n    followExifOrientation = imageCompression.followExifOrientation\n    cleanupCanvasMemory = imageCompression.cleanupCanvasMemory\n    isAutoOrientationInBrowser = imageCompression.isAutoOrientationInBrowser\n    approximateBelowMaximumCanvasSizeOfBrowser = imageCompression.approximateBelowMaximumCanvasSizeOfBrowser\n    getBrowserName = imageCompression.getBrowserName\n    isIOS = ").concat(isIOS,"\n    \n    getNewCanvasAndCtx = ").concat(getNewCanvasAndCtx,"\n    CustomFileReader = FileReader\n    CustomFile = File\n    MAX_CANVAS_SIZE = ").concat(JSON.stringify(MAX_CANVAS_SIZE),"\n    BROWSER_NAME = ").concat(JSON.stringify(BROWSER_NAME),"\n    function compress (){return (").concat(compress,").apply(null, arguments)}\n\n    // core-js\n    function _slicedToArray(arr, n) { return arr }\n    function _typeof(a) { return typeof a }\n    function _objectSpread2(target) {\n      for (var i = 1; i < arguments.length; i++) {\n        var source = arguments[i] != null ? arguments[i] : {};\n  \n        Object.assign(target, source)\n      }\n  \n      return target;\n    }\n\n    // Libraries\n    const parse = ").concat(parse,"\n    const UPNG = {}\n    UPNG.toRGBA8 = ").concat(UPNG.toRGBA8,"\n    UPNG.toRGBA8.decodeImage = ").concat(UPNG.toRGBA8.decodeImage,"\n    UPNG.decode = ").concat(UPNG.decode,"\n    UPNG.decode._decompress = ").concat(UPNG.decode._decompress,"\n    UPNG.decode._inflate = ").concat(UPNG.decode._inflate,"\n    UPNG.decode._readInterlace = ").concat(UPNG.decode._readInterlace,"\n    UPNG.decode._getBPP = ").concat(UPNG.decode._getBPP," \n    UPNG.decode._filterZero = ").concat(UPNG.decode._filterZero,"\n    UPNG.decode._paeth = ").concat(UPNG.decode._paeth,"\n    UPNG.decode._IHDR = ").concat(UPNG.decode._IHDR,"\n    UPNG._bin = parse(").concat(stringify(UPNG._bin),")\n    UPNG._copyTile = ").concat(UPNG._copyTile,"\n    UPNG.encode = ").concat(UPNG.encode,"\n    UPNG.encodeLL = ").concat(UPNG.encodeLL," \n    UPNG.encode._main = ").concat(UPNG.encode._main,"\n    UPNG.encode.compressPNG = ").concat(UPNG.encode.compressPNG," \n    UPNG.encode.compress = ").concat(UPNG.encode.compress,"\n    UPNG.encode.framize = ").concat(UPNG.encode.framize," \n    UPNG.encode._updateFrame = ").concat(UPNG.encode._updateFrame," \n    UPNG.encode._prepareDiff = ").concat(UPNG.encode._prepareDiff," \n    UPNG.encode._filterZero = ").concat(UPNG.encode._filterZero," \n    UPNG.encode._filterLine = ").concat(UPNG.encode._filterLine,"\n    UPNG.encode.concatRGBA = ").concat(UPNG.encode.concatRGBA,"\n    UPNG.crc = parse(").concat(stringify(UPNG.crc),")\n    UPNG.crc.table = ( function() {\n    var tab = new Uint32Array(256);\n    for (var n=0; n<256; n++) {\n      var c = n;\n      for (var k=0; k<8; k++) {\n        if (c & 1)  c = 0xedb88320 ^ (c >>> 1);\n        else        c = c >>> 1;\n      }\n      tab[n] = c;  }\n    return tab;  })()\n    UPNG.quantize = ").concat(UPNG.quantize," \n    UPNG.quantize.getKDtree = ").concat(UPNG.quantize.getKDtree," \n    UPNG.quantize.getNearest = ").concat(UPNG.quantize.getNearest," \n    UPNG.quantize.planeDst = ").concat(UPNG.quantize.planeDst," \n    UPNG.quantize.dist = ").concat(UPNG.quantize.dist,"     \n    UPNG.quantize.splitPixels = ").concat(UPNG.quantize.splitPixels," \n    UPNG.quantize.vecDot = ").concat(UPNG.quantize.vecDot," \n    UPNG.quantize.stats = ").concat(UPNG.quantize.stats," \n    UPNG.quantize.estats = ").concat(UPNG.quantize.estats,"\n    UPNG.M4 = parse(").concat(stringify(UPNG.M4),")\n    UPNG.encode.concatRGBA = ").concat(UPNG.encode.concatRGBA,'\n    UPNG.inflateRaw=function(){\n    var H={};H.H={};H.H.N=function(N,W){var R=Uint8Array,i=0,m=0,J=0,h=0,Q=0,X=0,u=0,w=0,d=0,v,C;\n      if(N[0]==3&&N[1]==0)return W?W:new R(0);var V=H.H,n=V.b,A=V.e,l=V.R,M=V.n,I=V.A,e=V.Z,b=V.m,Z=W==null;\n      if(Z)W=new R(N.length>>>2<<5);while(i==0){i=n(N,d,1);m=n(N,d+1,2);d+=3;if(m==0){if((d&7)!=0)d+=8-(d&7);\n        var D=(d>>>3)+4,q=N[D-4]|N[D-3]<<8;if(Z)W=H.H.W(W,w+q);W.set(new R(N.buffer,N.byteOffset+D,q),w);d=D+q<<3;\n        w+=q;continue}if(Z)W=H.H.W(W,w+(1<<17));if(m==1){v=b.J;C=b.h;X=(1<<9)-1;u=(1<<5)-1}if(m==2){J=A(N,d,5)+257;\n        h=A(N,d+5,5)+1;Q=A(N,d+10,4)+4;d+=14;var E=d,j=1;for(var c=0;c<38;c+=2){b.Q[c]=0;b.Q[c+1]=0}for(var c=0;\n                                                                                                        c<Q;c++){var K=A(N,d+c*3,3);b.Q[(b.X[c]<<1)+1]=K;if(K>j)j=K}d+=3*Q;M(b.Q,j);I(b.Q,j,b.u);v=b.w;C=b.d;\n        d=l(b.u,(1<<j)-1,J+h,N,d,b.v);var r=V.V(b.v,0,J,b.C);X=(1<<r)-1;var S=V.V(b.v,J,h,b.D);u=(1<<S)-1;M(b.C,r);\n        I(b.C,r,v);M(b.D,S);I(b.D,S,C)}while(!0){var T=v[e(N,d)&X];d+=T&15;var p=T>>>4;if(p>>>8==0){W[w++]=p}else if(p==256){break}else{var z=w+p-254;\n        if(p>264){var _=b.q[p-257];z=w+(_>>>3)+A(N,d,_&7);d+=_&7}var $=C[e(N,d)&u];d+=$&15;var s=$>>>4,Y=b.c[s],a=(Y>>>4)+n(N,d,Y&15);\n        d+=Y&15;while(w<z){W[w]=W[w++-a];W[w]=W[w++-a];W[w]=W[w++-a];W[w]=W[w++-a]}w=z}}}return W.length==w?W:W.slice(0,w)};\n      H.H.W=function(N,W){var R=N.length;if(W<=R)return N;var V=new Uint8Array(R<<1);V.set(N,0);return V};\n      H.H.R=function(N,W,R,V,n,A){var l=H.H.e,M=H.H.Z,I=0;while(I<R){var e=N[M(V,n)&W];n+=e&15;var b=e>>>4;\n        if(b<=15){A[I]=b;I++}else{var Z=0,m=0;if(b==16){m=3+l(V,n,2);n+=2;Z=A[I-1]}else if(b==17){m=3+l(V,n,3);\n          n+=3}else if(b==18){m=11+l(V,n,7);n+=7}var J=I+m;while(I<J){A[I]=Z;I++}}}return n};H.H.V=function(N,W,R,V){var n=0,A=0,l=V.length>>>1;\n        while(A<R){var M=N[A+W];V[A<<1]=0;V[(A<<1)+1]=M;if(M>n)n=M;A++}while(A<l){V[A<<1]=0;V[(A<<1)+1]=0;A++}return n};\n      H.H.n=function(N,W){var R=H.H.m,V=N.length,n,A,l,M,I,e=R.j;for(var M=0;M<=W;M++)e[M]=0;for(M=1;M<V;M+=2)e[N[M]]++;\n        var b=R.K;n=0;e[0]=0;for(A=1;A<=W;A++){n=n+e[A-1]<<1;b[A]=n}for(l=0;l<V;l+=2){I=N[l+1];if(I!=0){N[l]=b[I];\n          b[I]++}}};H.H.A=function(N,W,R){var V=N.length,n=H.H.m,A=n.r;for(var l=0;l<V;l+=2)if(N[l+1]!=0){var M=l>>1,I=N[l+1],e=M<<4|I,b=W-I,Z=N[l]<<b,m=Z+(1<<b);\n        while(Z!=m){var J=A[Z]>>>15-W;R[J]=e;Z++}}};H.H.l=function(N,W){var R=H.H.m.r,V=15-W;for(var n=0;n<N.length;\n                                                                                                 n+=2){var A=N[n]<<W-N[n+1];N[n]=R[A]>>>V}};H.H.M=function(N,W,R){R=R<<(W&7);var V=W>>>3;N[V]|=R;N[V+1]|=R>>>8};\n      H.H.I=function(N,W,R){R=R<<(W&7);var V=W>>>3;N[V]|=R;N[V+1]|=R>>>8;N[V+2]|=R>>>16};H.H.e=function(N,W,R){return(N[W>>>3]|N[(W>>>3)+1]<<8)>>>(W&7)&(1<<R)-1};\n      H.H.b=function(N,W,R){return(N[W>>>3]|N[(W>>>3)+1]<<8|N[(W>>>3)+2]<<16)>>>(W&7)&(1<<R)-1};H.H.Z=function(N,W){return(N[W>>>3]|N[(W>>>3)+1]<<8|N[(W>>>3)+2]<<16)>>>(W&7)};\n      H.H.i=function(N,W){return(N[W>>>3]|N[(W>>>3)+1]<<8|N[(W>>>3)+2]<<16|N[(W>>>3)+3]<<24)>>>(W&7)};H.H.m=function(){var N=Uint16Array,W=Uint32Array;\n        return{K:new N(16),j:new N(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new N(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new W(32),J:new N(512),_:[],h:new N(32),$:[],w:new N(32768),C:[],v:[],d:new N(32768),D:[],u:new N(512),Q:[],r:new N(1<<15),s:new W(286),Y:new W(30),a:new W(19),t:new W(15e3),k:new N(1<<16),g:new N(1<<15)}}();\n      (function(){var N=H.H.m,W=1<<15;for(var R=0;R<W;R++){var V=R;V=(V&2863311530)>>>1|(V&1431655765)<<1;\n        V=(V&3435973836)>>>2|(V&858993459)<<2;V=(V&4042322160)>>>4|(V&252645135)<<4;V=(V&4278255360)>>>8|(V&16711935)<<8;\n        N.r[R]=(V>>>16|V<<16)>>>17}function n(A,l,M){while(l--!=0)A.push(0,M)}for(var R=0;R<32;R++){N.q[R]=N.S[R]<<3|N.T[R];\n        N.c[R]=N.p[R]<<4|N.z[R]}n(N._,144,8);n(N._,255-143,9);n(N._,279-255,7);n(N._,287-279,8);H.H.n(N._,9);\n        H.H.A(N._,9,N.J);H.H.l(N._,9);n(N.$,32,5);H.H.n(N.$,5);H.H.A(N.$,5,N.h);H.H.l(N.$,5);n(N.Q,19,0);n(N.C,286,0);\n        n(N.D,30,0);n(N.v,320,0)}());return H.H.N}()\n    \n    const UZIP = {}\n    UZIP["parse"] = ').concat(UZIP_1.parse,"\n    UZIP._readLocal = ").concat(UZIP_1._readLocal,"\n    UZIP.inflateRaw = ").concat(UZIP_1.inflateRaw,"\n    UZIP.inflate = ").concat(UZIP_1.inflate,"\n    UZIP.deflate = ").concat(UZIP_1.deflate,"\n    UZIP.deflateRaw = ").concat(UZIP_1.deflateRaw,"\n    UZIP.encode = ").concat(UZIP_1.encode,"\n    UZIP._noNeed = ").concat(UZIP_1._noNeed,"\n    UZIP._writeHeader = ").concat(UZIP_1._writeHeader,"\n    UZIP.crc = parse(").concat(stringify(UZIP_1.crc),")\n    UZIP.crc.table = ( function() {\n      var tab = new Uint32Array(256);\n      for (var n=0; n<256; n++) {\n        var c = n;\n        for (var k=0; k<8; k++) {\n          if (c & 1)  c = 0xedb88320 ^ (c >>> 1);\n          else        c = c >>> 1;\n        }\n        tab[n] = c;  }\n      return tab;  })()\n    \n    UZIP.adler = ").concat(UZIP_1.adler,"\n    UZIP.bin = parse(").concat(stringify(UZIP_1.bin),")\n    UZIP.F = {}\n    UZIP.F.deflateRaw = ").concat(UZIP_1.F.deflateRaw,"\n    UZIP.F._bestMatch = ").concat(UZIP_1.F._bestMatch,"\n    UZIP.F._howLong = ").concat(UZIP_1.F._howLong,"\n    UZIP.F._hash = ").concat(UZIP_1.F._hash,"\n    UZIP.saved = ").concat(UZIP_1.saved,"\n    UZIP.F._writeBlock = ").concat(UZIP_1.F._writeBlock,"\n    UZIP.F._copyExact = ").concat(UZIP_1.F._copyExact,"\n    UZIP.F.getTrees = ").concat(UZIP_1.F.getTrees,"\n    UZIP.F.getSecond = ").concat(UZIP_1.F.getSecond,"\n    UZIP.F.nonZero = ").concat(UZIP_1.F.nonZero,"\n    UZIP.F.contSize = ").concat(UZIP_1.F.contSize,"\n    UZIP.F._codeTiny = ").concat(UZIP_1.F._codeTiny," \n    UZIP.F._lenCodes = ").concat(UZIP_1.F._lenCodes," \n    UZIP.F._hufTree = ").concat(UZIP_1.F._hufTree," \n    UZIP.F.setDepth = ").concat(UZIP_1.F.setDepth," \n    UZIP.F.restrictDepth = ").concat(UZIP_1.F.restrictDepth,"\n    UZIP.F._goodIndex = ").concat(UZIP_1.F._goodIndex," \n    UZIP.F._writeLit = ").concat(UZIP_1.F._writeLit," \n    UZIP.F.inflate = ").concat(UZIP_1.F.inflate," \n    UZIP.F._check = ").concat(UZIP_1.F._check," \n    UZIP.F._decodeTiny = ").concat(UZIP_1.F._decodeTiny," \n    UZIP.F._copyOut = ").concat(UZIP_1.F._copyOut," \n    UZIP.F.makeCodes = ").concat(UZIP_1.F.makeCodes," \n    UZIP.F.codes2map = ").concat(UZIP_1.F.codes2map," \n    UZIP.F.revCodes = ").concat(UZIP_1.F.revCodes," \n\n    // used only in deflate\n    UZIP.F._putsE = ").concat(UZIP_1.F._putsE,"\n    UZIP.F._putsF = ").concat(UZIP_1.F._putsF,"\n  \n    UZIP.F._bitsE = ").concat(UZIP_1.F._bitsE,"\n    UZIP.F._bitsF = ").concat(UZIP_1.F._bitsF,"\n\n    UZIP.F._get17 = ").concat(UZIP_1.F._get17,"\n    UZIP.F._get25 = ").concat(UZIP_1.F._get25,"\n    UZIP.F.U = function(){\n      var u16=Uint16Array, u32=Uint32Array;\n      return {\n        next_code : new u16(16),\n        bl_count  : new u16(16),\n        ordr : [ 16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15 ],\n        of0  : [3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],\n        exb  : [0,0,0,0,0,0,0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4,  4,  5,  5,  5,  5,  0,  0,  0,  0],\n        ldef : new u16(32),\n        df0  : [1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577, 65535, 65535],\n        dxb  : [0,0,0,0,1,1,2, 2, 3, 3, 4, 4, 5, 5,  6,  6,  7,  7,  8,  8,   9,   9,  10,  10,  11,  11,  12,   12,   13,   13,     0,     0],\n        ddef : new u32(32),\n        flmap: new u16(  512),  fltree: [],\n        fdmap: new u16(   32),  fdtree: [],\n        lmap : new u16(32768),  ltree : [],  ttree:[],\n        dmap : new u16(32768),  dtree : [],\n        imap : new u16(  512),  itree : [],\n        //rev9 : new u16(  512)\n        rev15: new u16(1<<15),\n        lhst : new u32(286), dhst : new u32( 30), ihst : new u32(19),\n        lits : new u32(15000),\n        strt : new u16(1<<16),\n        prev : new u16(1<<15)\n      };\n    } ();\n\n    (function(){\n      var U = UZIP.F.U;\n      var len = 1<<15;\n      for(var i=0; i<len; i++) {\n        var x = i;\n        x = (((x & 0xaaaaaaaa) >>> 1) | ((x & 0x55555555) << 1));\n        x = (((x & 0xcccccccc) >>> 2) | ((x & 0x33333333) << 2));\n        x = (((x & 0xf0f0f0f0) >>> 4) | ((x & 0x0f0f0f0f) << 4));\n        x = (((x & 0xff00ff00) >>> 8) | ((x & 0x00ff00ff) << 8));\n        U.rev15[i] = (((x >>> 16) | (x << 16)))>>>17;\n      }\n  \n      function pushV(tgt, n, sv) {  while(n--!=0) tgt.push(0,sv);  }\n  \n      for(var i=0; i<32; i++) {  U.ldef[i]=(U.of0[i]<<3)|U.exb[i];  U.ddef[i]=(U.df0[i]<<4)|U.dxb[i];  }\n  \n      pushV(U.fltree, 144, 8);  pushV(U.fltree, 255-143, 9);  pushV(U.fltree, 279-255, 7);  pushV(U.fltree,287-279,8);\n      /*\n        var i = 0;\n        for(; i<=143; i++) U.fltree.push(0,8);\n        for(; i<=255; i++) U.fltree.push(0,9);\n        for(; i<=279; i++) U.fltree.push(0,7);\n        for(; i<=287; i++) U.fltree.push(0,8);\n        */\n      UZIP.F.makeCodes(U.fltree, 9);\n      UZIP.F.codes2map(U.fltree, 9, U.flmap);\n      UZIP.F.revCodes (U.fltree, 9)\n  \n      pushV(U.fdtree,32,5);\n      //for(i=0;i<32; i++) U.fdtree.push(0,5);\n      UZIP.F.makeCodes(U.fdtree, 5);\n      UZIP.F.codes2map(U.fdtree, 5, U.fdmap);\n      UZIP.F.revCodes (U.fdtree, 5)\n  \n      pushV(U.itree,19,0);  pushV(U.ltree,286,0);  pushV(U.dtree,30,0);  pushV(U.ttree,320,0);\n      /*\n        for(var i=0; i< 19; i++) U.itree.push(0,0);\n        for(var i=0; i<286; i++) U.ltree.push(0,0);\n        for(var i=0; i< 30; i++) U.dtree.push(0,0);\n        for(var i=0; i<320; i++) U.ttree.push(0,0);\n        */\n    })()\n    "))}function generateWorkerScript(){return createWorker("\n    let scriptImported = false\n    self.addEventListener('message', async (e) => {\n      const { file, id, imageCompressionLibUrl, options } = e.data\n      options.onProgress = (progress) => self.postMessage({ progress, id })\n      try {\n        if (!scriptImported) {\n          // console.log('[worker] importScripts', imageCompressionLibUrl)\n          self.importScripts(imageCompressionLibUrl)\n          scriptImported = true\n        }\n        // console.log('[worker] self', self)\n        const compressedFile = await imageCompression(file, options)\n        self.postMessage({ file: compressedFile, id })\n      } catch (e) {\n        // console.error('[worker] error', e)\n        self.postMessage({ error: e.message + '\\n' + e.stack, id })\n      }\n    })\n  ")}function compressOnWebWorker(e,t){return new Promise((function(n,r){var o=cnt+=1;imageCompressionLibUrl||(imageCompressionLibUrl=generateLib()),worker||(worker=generateWorkerScript()),worker.addEventListener("message",(function e(a){if(a.data.id===o){if(void 0!==a.data.progress)return void t.onProgress(a.data.progress);worker.removeEventListener("message",e),a.data.error&&r(new Error(a.data.error)),n(a.data.file)}})),worker.addEventListener("error",r),worker.postMessage({file:e,id:o,imageCompressionLibUrl:imageCompressionLibUrl,options:_objectSpread2(_objectSpread2({},t),{},{onProgress:void 0})})}))}function imageCompression(e,t){return new Promise((function(n,r){var o,a,i,s,u,c;if(o=_objectSpread2({},t),i=0,s=o.onProgress,o.maxSizeMB=o.maxSizeMB||Number.POSITIVE_INFINITY,u="boolean"!=typeof o.useWebWorker||o.useWebWorker,delete o.useWebWorker,o.onProgress=function(e){i=e,"function"==typeof s&&s(i)},!(e instanceof Blob||e instanceof CustomFile))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(e.type))return r(new Error("The file given is not an image"));if(c="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,!u||"function"!=typeof Worker||c)return compress(e,o).then(function(e){try{return a=e,p.call(this)}catch(e){return r(e)}}.bind(this),r);var l=function(){try{return p.call(this)}catch(e){return r(e)}}.bind(this),f=function(t){try{return compress(e,o).then((function(e){try{return a=e,l()}catch(e){return r(e)}}),r)}catch(e){return r(e)}};try{return compressOnWebWorker(e,o).then((function(e){try{return a=e,l()}catch(e){return f()}}),f)}catch(e){f()}function p(){try{a.name=e.name,a.lastModified=e.lastModified}catch(e){}return n(a)}}))}imageCompression.getDataUrlFromFile=getDataUrlFromFile,imageCompression.getFilefromDataUrl=getFilefromDataUrl,imageCompression.loadImage=loadImage,imageCompression.drawImageInCanvas=drawImageInCanvas,imageCompression.drawFileInCanvas=drawFileInCanvas,imageCompression.canvasToFile=canvasToFile,imageCompression.getExifOrientation=getExifOrientation,imageCompression.handleMaxWidthOrHeight=handleMaxWidthOrHeight,imageCompression.followExifOrientation=followExifOrientation,imageCompression.cleanupCanvasMemory=cleanupCanvasMemory,imageCompression.isAutoOrientationInBrowser=isAutoOrientationInBrowser,imageCompression.approximateBelowMaximumCanvasSizeOfBrowser=approximateBelowMaximumCanvasSizeOfBrowser,imageCompression.getBrowserName=getBrowserName,imageCompression.version="1.0.17"}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=function(e,t){for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return function(){"use strict";function e(e,t,n,r,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function t(t){return function(){var n=this,r=arguments;return new Promise((function(o,a){var i=t.apply(n,r);function s(t){e(i,o,a,s,u,"next",t)}function u(t){e(i,o,a,s,u,"throw",t)}s(void 0)}))}}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EndSDK:function(){return Qm},GlobalGatewayImageCompressionOption:function(){return jm},InitSDK:function(){return Zm},StartAcuantBackDocumentCapture:function(){return qm},StartAcuantBarcodeCapture:function(){return Km},StartAcuantFrontDocumentCapture:function(){return zm},StartAcuantPassportCapture:function(){return Xm},StartAcuantSelfieCapture:function(){return Ym}});var n=__webpack_require__(757),r=__webpack_require__.n(n);function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function s(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,s)}u((r=r.apply(e,t||[])).next())}))}function u(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var c=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return l(n,t[0],t[1]),t.join("=")})),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=n[0],o=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,o)}))}},e}();function l(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function f(){return p}var p=null,h=new Map,d=new Map;function v(e,t){var n=b(e,t);return h.get(n)}function m(e){for(var t=h.entries(),n=[];;){var r=t.next(),o=r.done,a=r.value;if(o)break;var i=a[0],s=a[1];i.split("_")[0]===e&&n.push(s)}return n}function g(e){var t=e.kernelName,n=e.backendName,r=b(t,n);if(h.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");h.set(r,e)}function y(e){var t=e.kernelName;d.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),d.set(t,e)}function b(e,t){return t+"_"+e}function x(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function w(e,t,n){return Math.max(e,Math.min(t,n))}function E(e){return e%2==0?e:e+1}function A(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function C(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function S(e,t,n){void 0===n&&(n=""),C(T(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))}function _(e){C(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function I(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||$(e)&&!n)for(var r=0;r<e.length;++r)I(e[r],t,n);else t.push(e);return t}function R(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function T(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function P(e){return e%1==0}function N(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function O(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function D(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function k(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,o){var a=0,i=function(){if(e())r();else{a++;var s=t(a);null!=n&&a>=n?o():setTimeout(i,s)}};i()}))}function F(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(-1===e[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function M(e,t){var n=t.length;return C((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e})),C(e.every((function(e){return P(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function L(e,t){for(var n=[],r=[],o=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||o?null:M(t,e).sort(),i=0,s=0;s<e.length;++s){if(null!=a){if(a[i]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==a[i]||a[i]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[i]<=s&&i++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function U(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function B(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function G(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function W(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function V(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function $(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function H(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function j(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function z(e){return"string"==typeof e||e instanceof String}function q(e){return"boolean"==typeof e}function K(e){return"number"==typeof e}function X(e){return Array.isArray(e)?X(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":K(e)?"float32":z(e)?"string":q(e)?"bool":"float32"}function Y(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Z(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function Q(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function J(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=I(e)),n&&G(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)0!==Math.round(e[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function ee(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var o=new Array;if(1===n.length)for(var a=n[0],i=0;i<a;i++)o[i]=r[t+i];else{a=n[0];var s=n.slice(1),u=s.reduce((function(e,t){return e*t}));for(i=0;i<a;i++)o[i]=e(t+i*u,s,r)}return o}(0,e,t)}function te(e,t){for(var n=ne(e,t),r=0;r<n.length;r++)n[r]=1;return n}function ne(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function re(){return f().platform.now()}function oe(e){e.forEach((function(t){C(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))}function ae(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",f().platform.encode(e,t)}function ie(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",f().platform.decode(e,t)}function se(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],o=0;o<e.length-1;++o)r+=n[o]*e[o];return r}function ue(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),o=0;o<r.length-1;++o)r[o]=Math.floor(e/n[o]),e-=r[o]*n[o];return r[r.length-1]=e,r}Object.freeze({shuffle:x,clamp:w,nearestLargerEven:E,sum:A,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var o=Number(e[r])-Number(t[r]);n+=o*o}return n},assert:C,assertShapesMatch:S,assertNonNull:_,flatten:I,sizeFromShape:R,isScalarShape:function(e){return 0===e.length},arraysEqual:T,isInt:P,tanh:N,sizeToSquarishShape:O,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return x(t),t},rightPad:D,repeatedTry:k,inferFromImplicitShape:F,parseAxisParam:M,squeezeShape:L,getTypedArrayFromDType:U,getArrayFromDType:B,checkConversionForErrors:G,isValidDtype:W,hasEncodingLoss:V,isTypedArray:$,bytesPerElement:H,bytesFromStringArray:j,isString:z,isBoolean:q,isNumber:K,inferDtype:X,isFunction:Y,nearestDivisor:Z,computeStrides:Q,toTypedArray:J,toNestedArray:ee,makeOnesTypedArray:te,makeZerosTypedArray:ne,now:re,assertNonNegativeIntegerDimensions:oe,fetch:function(e,t){return f().platform.fetch(e,t)},encodeString:ae,decodeString:ie,locToIndex:se,indexToLoc:ue});var ce=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new le)}return e.prototype.profileKernel=function(e,t,n){var r,o=this,a=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var o=e[r];if(isNaN(o)||!isFinite(o))return console.warn("Found "+o+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),a.then((function(a){var i="";null!=a.getExtraProfileInfo&&(i=a.getExtraProfileInfo()),o.logger.logKernelProfile(e,n,r,a.kernelMs,t,i)}))}))})),r},e}(),le=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,o,a){var i="number"==typeof r?D(r+"ms",9):r.error,s=D(e,25),u=t.rank,c=t.size,l=D(t.shape.toString(),14),f="";for(var p in o){var h=o[p].shape||t.shape,d=h.length;f+=p+": "+d+"D "+(d>0?h:"")+" "}console.log("%c"+s+"\t%c"+i+"\t%c"+u+"D "+l+"\t%c"+c+"\t%c"+f+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();function fe(e,t,n){return D(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":z(e)?"'"+e+"'":"bool"===n?pe(e):parseFloat(e.toFixed(7)).toString(),t)}function pe(e){return 0===e?"false":"true"}function he(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var de=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=R(e),null!=n){var o=n.length;C(o===this.size,(function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||B(t,this.size),this.strides=Q(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),C(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var o=this.locToIndex(n);this.values[o]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,o=e;r<o.length;r++){var a=o[r];if(a<0||a>=this.shape[n]){var i="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(i)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return ve().makeTensor(this.values,this.shape,this.dtype)},e}(),ve=null,me=null,ge=null,ye=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=R(e),this.strides=Q(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),C(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,o){return this.throwIfDisposed(),this.reshape([e,t,n,r,o])},e.prototype.asType=function(e){return this.throwIfDisposed(),me.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,me.buffer(this.shape,this.dtype,e)]}}))}))},e.prototype.bufferSync=function(){return me.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ee(this.shape,e)]}}))}))},e.prototype.arraySync=function(){return ee(this.shape,this.dataSync())},e.prototype.data=function(){return s(this,void 0,void 0,(function(){var e,t;return u(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=ve().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map((function(e){return ie(e)}))]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var e=ve().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return ie(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ve().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(ve().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),me.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),me.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),me.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),me.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),me.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),me.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),me.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var o=Q(t),a=function(e,t,n,r){var o=R(t),a=r[r.length-1],i=new Array(a).fill(0),s=t.length,u="complex64"===n?he(e):e;if(s>1)for(var c=0;c<o/a;c++)for(var l=c*a,f=0;f<a;f++)i[f]=Math.max(i[f],fe(u[l+f],0,n).length);return i}(e,t,n,o),i=t.length,s=function e(t,n,r,o,a,i){void 0===i&&(i=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[fe(he(t)[0],0,r)]:"bool"===r?[pe(t[0])]:[t[0].toString()];if(1===c){if(u>20){var l=3*s,f=Array.from(t.slice(0,l)),p=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(f=he(f),p=he(p)),["["+f.map((function(e,t){return fe(e,a[t],r)})).join(", ")+", ..., "+p.map((function(e,t){return fe(e,a[u-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?he(t):Array.from(t)).map((function(e,t){return fe(e,a[t],r)})).join(", ")+"]"]}var h=n.slice(1),d=o.slice(1),v=o[0]*s,m=[];if(u>20){for(var g=0;g<3;g++){var y=(b=g*v)+v;m.push.apply(m,e(t.slice(b,y),h,r,d,a,!1))}for(m.push("..."),g=u-3;g<u;g++)y=(b=g*v)+v,m.push.apply(m,e(t.slice(b,y),h,r,d,a,g===u-1))}else for(g=0;g<u;g++){var b;y=(b=g*v)+v,m.push.apply(m,e(t.slice(b,y),h,r,d,a,g===u-1))}var x=2===c?",":"";for(m[0]="["+m[0]+x,g=1;g<m.length-1;g++)m[g]=" "+m[g]+x;var w=",\n";for(g=2;g<c;g++)w+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":w),m}(e,t,n,o,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+i),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),me.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),me.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),me.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),me.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),me.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),me.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),me.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),me.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),me.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),me.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),me.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),me.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,o){return void 0===n&&(n=.001),ge("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,r,n)},e.prototype.batchNorm=function(e,t,n,r,o){return void 0===o&&(o=.001),this.throwIfDisposed(),me.batchNorm(this,e,t,n,r,o)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),me.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),me.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),me.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),me.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),me.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),me.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),me.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),me.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),me.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),me.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),me.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),me.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),me.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),me.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),me.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),me.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),me.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),me.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),me.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),me.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),me.div(this,e)},e.prototype.divNoNan=function(e){return this.throwIfDisposed(),me.divNoNan(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),me.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),me.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),me.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),me.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),me.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),me.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),me.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),me.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),me.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),me.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),me.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),me.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),me.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),me.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),me.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),me.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),me.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),me.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),me.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),me.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),me.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),me.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),me.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),me.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),me.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),me.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),me.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),me.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),me.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),me.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),me.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),me.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),me.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),me.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),me.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),me.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),me.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),me.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),me.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),me.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),me.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),me.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),me.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),me.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),me.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),me.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),me.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),me.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),me.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),me.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),me.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),me.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),me.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),me.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),me.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),me.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),me.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),me.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),me.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),me.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),me.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),me.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),me.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),me.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),me.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),me.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),me.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),me.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),me.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),me.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),me.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),me.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),me.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),me.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,o,a){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),me.conv1d(this,e,t,n,r,o,a)},e.prototype.conv2d=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),me.conv2d(this,e,t,n,r,o,a)},e.prototype.conv2dTranspose=function(e,t,n,r,o){return this.throwIfDisposed(),me.conv2dTranspose(this,e,t,n,r,o)},e.prototype.depthwiseConv2D=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),me.depthwiseConv2d(this,e,t,n,r,o,a)},e.prototype.separableConv2d=function(e,t,n,r,o,a){return void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),me.separableConv2d(this,e,t,n,r,o,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),me.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),me.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),me.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,o){return this.throwIfDisposed(),me.pool(this,e,t,n,r,o)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),ve().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),me.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),me.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),me.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),me.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),this.throwIfDisposed(),me.stridedSlice(this,e,t,n,r,o,a,i,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),me.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),me.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),me.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),me.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),me.spectral.irfft(this)},e}();Object.defineProperty(ye,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var be,xe,we,Ee,Ae,Ce=function(e){function t(t,n,r,o){var a=e.call(this,t.shape,t.dtype,t.dataId,o)||this;return a.trainable=n,a.name=r,a}return i(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!T(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");ve().disposeTensor(this),this.dataId=e.dataId,ve().incRef(this,null)},t.prototype.dispose=function(){ve().disposeVariable(this),this.isDisposedInternal=!0},t}(ye);Object.defineProperty(Ce,Symbol.hasInstance,{value:function(e){return e instanceof ye&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(be||(be={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(xe||(xe={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(we||(we={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Ee||(Ee={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Ae||(Ae={}));var Se={float32:Ee,int32:xe,bool:we,complex64:Ae};function _e(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Se[e][t]}function Ie(e){return _e(e,"int32")}function Re(e,t){if(e.dtype===t.dtype)return[e,t];var n=_e(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Te(e,t){C(e.dtype===t.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"}))}function Pe(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof ye)n.push(t);else if(o=t,Array.isArray(o)||"object"==typeof o){var o,a=t;for(var i in a){var s=a[i];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}Object.freeze({makeTypesMatch:Re,assertTypesMatch:Te,isTensorInList:function(e,t){return t.some((function(t){return t.id===e.id}))},getTensorsInContainer:Pe});var Ne,Oe=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),De=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Oe}return e.prototype.ready=function(){return s(this,void 0,void 0,(function(){var e,t,n;return u(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return s(this,void 0,void 0,(function(){var t,n,r;return u(this,(function(o){switch(o.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=o.sent(),[3,3];case 2:r=n,o.label=3;case 3:if(!r)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new ce(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var e=this;m(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(e){var t=this;m(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var o=++this.pendingBackendInitId,a=r.then((function(n){return!(o<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return!(o<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),1))}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),o=r.success,a=r.asyncInit;if(a||o)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,o=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun((function(){return r.startScope(o)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){return e.toFloat()}}}),[]),t},e.prototype.runKernel=function(e,t,n,r,o){return this.runKernelFunc(null,t,null,e,n,r,o)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),o=0;n.forEach((function(e){o+="complex64"===e.dtype?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-t-o-a;if(i>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+i+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,o,a,i){var s,u=this;void 0===a&&(a=[]),void 0===i&&(i=[]);var c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var f,p=function(e){l&&(c=e.map((function(e){return u.keep(u.clone(e))})))},h=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=v(r,this.backendName);return f=null!=g?function(){var e=u.backend.numDataIds();m=g.kernelFunc({inputs:t,attrs:o,backend:u.backend});var n=Array.isArray(m)?m:[m];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)})),c=s.filter((function(e,t){return i[t]}));return p((a||[]).slice().concat(c)),s}:function(){var t=u.backend.numDataIds();m=u.tidy((function(){return e(u.backend,p)}));var n=Array.isArray(m)?m:[m];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n},this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,(function(){return f()})):f()})),l&&this.addTapeNode(r,t,s,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-h,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShapes:s.map((function(e){return e.shape}))}),Array.isArray(m)?s:s[0]},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var o=e;"string"===n&&z(e[0])&&(o=e.map((function(e){return ae(e)})));var a=r.write(o,t,n),i=new ye(t,n,a,this.nextTensorId());if(this.incRef(i,r),"string"===n){var s=this.state.tensorInfo.get(a),u=j(o);this.state.numBytes+=u-s.bytes,s.bytes=u}return i},e.prototype.makeTensorFromDataId=function(e,t,n,r){var o=new ye(t,n=n||"float32",e,this.nextTensorId());return this.incRef(o,r),o},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var o=new Ce(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*H(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Ce||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return s(this,void 0,void 0,(function(){var t,n;return u(this,(function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,o){var a=this,i={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:o},s=function(e){return d.get(e)}(e);null!=s&&(r=s.gradFunc),null!=r&&(i.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],o=ne(r.size,r.dtype);return a.makeTensor(o,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],o)}),this.state.activeTape.push(i)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=Pe(e),r=new Set(n.map((function(e){return e.id}))),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||r.has(a.id)||a.dispose()}var i=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==i.id||t.track(e)}))},e.prototype.gradients=function(e,t,n,r){var o=this;if(void 0===r&&(r=!1),C(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun((function(){return o.startTape()}),(function(){return o.endTape()}),(function(){return o.tidy("forward",e)}));C(a instanceof ye,(function(){return"The result y returned by f() must be a tensor."}));var i=function(e,t,n){for(var r={},o={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var i=(d=e[a]).inputs;for(var s in i){for(var u=i[s],c=!1,l=0;l<t.length;l++)if(r[u.id]){d.outputs.forEach((function(e){return r[e.id]=!0})),c=!0,o[d.id]=!0;break}if(c)break}}var f={};f[n.id]=!0;var p={};for(a=e.length-1;a>=0;a--)for(i=(d=e[a]).inputs,l=0;l<d.outputs.length;l++)if(f[d.outputs[l].id]){for(var s in i)f[i[s].id]=!0,p[d.id]=!0;break}var h=[];for(a=0;a<e.length;a++){var d;if(o[(d=e[a]).id]&&p[d.id]){var v={};for(var s in d.inputs){var m=d.inputs[s];r[m.id]&&(v[s]=m)}var g=Object.assign({},d);g.inputs=v,g.outputs=d.outputs,h.push(g)}}return h}(this.state.activeTape,t,a);if(!r&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,r,s={};s[a.id]=null==n?(r=te(R(e=a.shape),"float32"),ke.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var o=t[r],a=[];if(o.outputs.forEach((function(t){var n=e[t.id];null!=n?a.push(n):a.push(null)})),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.kernelName+".");var i=o.gradient(a),s=function(t){if(!(t in i))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(i)+".");var r=n((function(){return i[t]()}));if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=o.inputs[t];if(!T(r.shape,a.shape))throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=t.length-1;o>=0;o--)r(o)}(s,i,(function(e){return o.tidy(e)}));var u=t.map((function(e){return s[e.id]}));return 0===o.state.gradientDepth&&(o.state.activeTape.forEach((function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()})),o.state.activeTape=null),{value:a,grads:u}}))},e.prototype.customGrad=function(e){var t=this;return C(Y(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];C(r.every((function(e){return e instanceof ye})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return r.forEach((function(e,t){a[t]=e})),t.runKernelFunc((function(t,o){return C((n=e.apply(void 0,r.concat([o]))).value instanceof ye,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),C(Y(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),a,(function(e,t){var o=n.gradFunc(e,t),a=Array.isArray(o)?o:[o];C(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),C(a.every((function(e){return e instanceof ye})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var i={};return a.forEach((function(e,t){i[t]=function(){return e}})),i}))}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return s(this,void 0,void 0,(function(){var t,n;return u(this,(function(r){switch(r.label){case 0:return t=re(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=re()-t,[2,n]}}))}))},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Oe,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),ke=function(){var e=function(){if(null==Ne){var e=void 0;if("undefined"!=typeof window)e=window;else if(void 0!==__webpack_require__.g)e=__webpack_require__.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Ne=e}return Ne}();if(null==e._tfengine){var t=new c(e);e._tfengine=new De(t)}return function(e){p=e}(e._tfengine.ENV),ve=function(){return e._tfengine},e._tfengine}();function Fe(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Me=f();Me.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Me.registerFlag("IS_BROWSER",(function(){return Fe()})),Me.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node})),Me.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Me.registerFlag("PROD",(function(){return!1})),Me.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Me.getBool("DEBUG")})),Me.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Me.registerFlag("IS_TEST",(function(){return!1}));var Le,Ue,Be,Ge={},We={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Ve(e,t){Ge[e]=t}function $e(e){e in Ge||(Ge[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete Ge[e]}),!1),1===e?t.getContext("webgl",We)||t.getContext("experimental-webgl",We):t.getContext("webgl2",We)}(e));var t=Ge[e];return t.isContextLost()?(delete Ge[e],$e(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Ge[e])}function He(e,t){return[t,e]}function je(e){var t=R(e);return O(Math.ceil(t/4))}function ze(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function qe(e,t){var n,r,o,a,i,s,u,c,l,p=e;return 2===f().getNumber("WEBGL_VERSION")?(n=p.R32F,r=p.R16F,o=p.RGBA16F,a=p.RGBA32F,i=p.RED,s=4,u=1,c=p.HALF_FLOAT,l=p.FLOAT):(n=e.RGBA,r=e.RGBA,o=e.RGBA,a=p.RGBA,i=e.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function Ke(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+Ye(e,t))}(e),r}function Xe(e){return!!(f().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Ye(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Ze(e,t,n){return xt(e,t,(function(){return e.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function Qe(e,t,n){var r=xt(e,t,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Ke(e,t,(function(){return e.shaderSource(r,n)})),Ke(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Je(e,t,n){var r=xt(e,t,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Ke(e,t,(function(){return e.shaderSource(r,n)})),Ke(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=nt.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],o=e.split("\n"),a=o.length.toString().length+2,i=o.map((function(e,t){return D((t+1).toString(),a)+e})),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var c=i.slice(0,r-1),l=i.slice(r-1,r),f=i.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+D(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Le||(Le={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Ue||(Ue={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Be||(Be={}));var et,tt,nt=/ERROR: [0-9]+:([0-9]+):/g;function rt(e,t){return xt(e,t,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function ot(e,t,n){if(Ke(e,t,(function(){return e.linkProgram(n)})),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function at(e,t,n){if(Ke(e,t,(function(){return e.validateProgram(n)})),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function it(e,t,n){var r=xt(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Ke(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),Ke(e,t,(function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function st(e,t,n){var r=xt(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Ke(e,t,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),Ke(e,t,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function ut(e,t){return xt(e,t,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function ct(e,t){var n=f().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function lt(e,t){return xt(e,t,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function ft(e,t,n,r,o,a,i,s){var u=e.getAttribLocation(n,r);return-1!==u&&(Ke(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,o)})),Ke(e,t,(function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,i,s)})),Ke(e,t,(function(){return e.enableVertexAttribArray(u)})),!0)}function pt(e,t,n,r){wt(e,r),Ke(e,t,(function(){return e.activeTexture(e.TEXTURE0+r)})),Ke(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)}))}function ht(e,t,n,r){return xt(e,t,(function(){return e.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function dt(e,t,n){return e.getUniformLocation(t,n)}function vt(e,t,n,r,o,a){Ke(e,t,(function(){return pt(e,t,r,a)})),Ke(e,t,(function(){return e.uniform1i(o,a)}))}function mt(e,t,n,r){Ke(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),Ke(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}))}function gt(e,t,n){Ke(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),Ke(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function yt(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+bt(e,t))}function bt(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function xt(e,t,n,r){var o=Ke(e,t,(function(){return n()}));if(null==o)throw new Error(r);return o}function wt(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Et(e,t){return void 0===t&&(t=2),R(e.slice(0,e.length-t))}function At(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Ct(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Et(e)].concat(At(e))),t}function St(e,t){var n;void 0===t&&(t=!1);var r=f().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?E(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var o=L(e);e=o.newShape}var a=R(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var i=Et(e),s=2,u=2;return e.length&&(s=(n=At(e))[0],u=n[1]),O(a=i*(s/2)*(u/2)).map((function(e){return 2*e}))}return O(a)}function _t(e){return e%2==0}function It(e,t){if(T(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(_t(n)&&_t(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&_t(e[0])&&_t(t[0])}function Rt(e){if(null==et){var t=$e(e);et=t.getParameter(t.MAX_TEXTURE_SIZE)}return et}function Tt(e){if(null==tt){var t=$e(e);tt=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,tt)}function Pt(e){if(0===e)return 0;var t=$e(e);return Nt(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Nt(t,"EXT_disjoint_timer_query")?1:0}function Nt(e,t){return null!=e.getExtension(t)}function Ot(e){try{if(null!=$e(e))return!0}catch(e){return!1}return!1}function Dt(e){if(0===e)return!1;var t=$e(e);if(1===e){if(!Nt(t,"OES_texture_float"))return!1}else if(!Nt(t,"EXT_color_buffer_float"))return!1;return Ft(t)}function kt(e){if(0===e)return!1;var t=$e(e);if(1!==e){if(Nt(t,"EXT_color_buffer_float"))return Ft(t);if(Nt(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=qe(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),a}(t,n)}return!1}return!!Nt(t,"OES_texture_float")&&!!Nt(t,"WEBGL_color_buffer_float")&&Ft(t)}function Ft(e){var t=qe(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),o}function Mt(e){return 2===e&&null!=$e(e).fenceSync}var Lt=Object.freeze({callAndCheck:Ke,canBeRepresented:Xe,getWebGLErrorMessage:Ye,getExtensionOrThrow:Ze,createVertexShader:Qe,createFragmentShader:Je,createProgram:rt,linkProgram:ot,validateProgram:at,createStaticVertexBuffer:it,createStaticIndexBuffer:st,getNumChannels:function(){return 2===f().getNumber("WEBGL_VERSION")?1:4},createTexture:ut,validateTextureSize:ct,createFramebuffer:lt,bindVertexBufferToProgramAttribute:ft,bindTextureUnit:pt,unbindTextureUnit:function(e,t,n){wt(e,n),Ke(e,t,(function(){return e.activeTexture(e.TEXTURE0+n)})),Ke(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:ht,getProgramUniformLocation:dt,bindTextureToProgramUniformSampler:vt,bindCanvasToFramebuffer:function(e,t){Ke(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),Ke(e,t,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),Ke(e,t,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))},bindColorTextureToFramebuffer:mt,unbindColorTextureFromFramebuffer:gt,validateFramebuffer:yt,getFramebufferErrorMessage:bt,getBatchDim:Et,getRowsCols:At,getShapeAs3D:Ct,getTextureShapeFromLogicalShape:St,isReshapeFree:It,getWebGLMaxTextureSize:Rt,resetMaxTextureSize:function(){et=null},resetMaxTexturesInShader:function(){tt=null},getMaxTexturesInShader:Tt,getWebGLDisjointQueryTimerVersion:Pt,hasExtension:Nt,isWebGLVersionEnabled:Ot,isCapableOfRenderingToFloatTexture:Dt,isDownloadFloatTextureEnabled:kt,isWebGLFenceEnabled:Mt}),Ut=f();function Bt(e){f().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Gt(e,t){return ke.tidy(e,t)}function Wt(e){Pe(e).forEach((function(e){return e.dispose()}))}function Vt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];f().getBool("IS_TEST")||console.warn.apply(console,e)}function $t(e,t){var n=e;if($(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||$(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&f().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||$(t)){C(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),C(t.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"}));for(var o=n.slice(1),a=0;a<t.length;++a)e(t[a],o,r.concat(a))}else C(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(e,r,[]),r}function Ht(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function jt(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof ye)return Ht(r,e.dtype,t,n),e;var o=X(e);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Ht(r,o,t,n),null==e||!$(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var i=$t(e,o);$(e)||Array.isArray(e)||(e=[e]);var s="string"!==o?J(e,o,f().getBool("DEBUG")):I(e,[],!0);return ke.makeTensor(s,i,o)}function zt(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return jt(e,t+"["+r+"]",n)}),r)}function qt(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Kt(e,t,n){for(var r=e.length+t.length,o=[],a=0,i=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(e[a++]):o.push(t[i++]);return o}function Xt(e,t){for(var n=[],r=e.length,o=0;o<r;o++)-1===t.indexOf(o)&&n.push(e[o]);return[n,t.map((function(t){return e[t]}))]}function Yt(e,t){return Kt(e,t.map((function(e){return 1})),t)}function Zt(e,t,n){C(qt(t,n),(function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."}))}function Qt(e,t){if(qt(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function Jt(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function en(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function tn(e,t){var n=e[0].length;e.forEach((function(e,t){C(e.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"}))})),C(t>=0&&t<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=e[0];e.forEach((function(e,o){for(var a=0;a<n;a++)C(a===t||e[a]===r[a],(function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."}))}))}function nn(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function rn(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];ke.startScope(n);try{var o=r.apply(void 0,e);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),ke.endScope(o),o}catch(e){throw ke.endScope(null),e}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}Ut.registerFlag("HAS_WEBGL",(function(){return Ut.getNumber("WEBGL_VERSION")>0})),Ut.registerFlag("WEBGL_VERSION",(function(){return Ot(2)?2:Ot(1)?1:0})),Ut.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===Ut.get("WEBGL_VERSION")})),Ut.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Ut.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Ut.registerFlag("WEBGL_PACK",(function(){return Ut.getBool("HAS_WEBGL")})),Ut.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_PACK_CLIP",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Ut.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_PACK_REDUCE",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_CONV_IM2COL",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return Rt(Ut.getNumber("WEBGL_VERSION"))})),Ut.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return Tt(Ut.getNumber("WEBGL_VERSION"))})),Ut.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=Ut.getNumber("WEBGL_VERSION");return 0===e?0:Pt(e)})),Ut.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Ut.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e})),Ut.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return Dt(Ut.getNumber("WEBGL_VERSION"))})),Ut.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Ut.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ut.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Ut.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return kt(Ut.getNumber("WEBGL_VERSION"))})),Ut.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Mt(Ut.getNumber("WEBGL_VERSION"))})),Ut.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Ut.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),ge=Bt;var on=rn({complex_:function(e,t){var n=jt(e,"real","complex"),r=jt(t,"imag","complex");return S(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),ke.runKernelFunc((function(e){return e.complex(n,r)}),{$real:n,$imag:r})}}),an=rn({real_:function(e){var t=jt(e,"input","real");return ke.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),sn=rn({imag_:function(e){var t=jt(e,"input","imag");return ke.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}});function un(e,t,n){return cn(e,t,$t(e,n),n)}function cn(e,t,n,r){if(null==r&&(r=X(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!$(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){oe(t);var o=R(t),a=R(n);C(o===a,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+a}));for(var i=0;i<n.length;++i){var s=n[i],u=i!==n.length-1||s!==R(t.slice(i));C(n[i]===t[i]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "}))}}return $(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?J(e,r,f().getBool("DEBUG")):I(e,[],!0),ke.makeTensor(e,t,r)}function ln(e,t){if(($(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&$(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return cn(e,[],[],t)}function fn(e,t){_(e);var n=$t(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return cn(e,null,n,t)}function pn(e,t,n){if(_(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=$t(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return cn(e,t,r,n)}function hn(e,t,n){if(_(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=$t(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return cn(e,t,r,n)}function dn(e,t,n){if(_(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=$t(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return cn(e,t,r,n)}function vn(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=vn(e,"float32"),r=mn(e,"float32");return on(n,r)}var o=te(R(e),t);return ke.makeTensor(o,e,t)}function mn(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=mn(e,"float32"),r=mn(e,"float32");return on(n,r)}var o=ne(R(e),t);return ke.makeTensor(o,e,t)}function gn(e,t,n){return ke.runKernelFunc((function(r){return r.fill(e,t,n)}),{})}function yn(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return mn([0],r);var o=ne(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return fn(o,r)}var bn=rn({onesLike_:function(e){var t=jt(e,"x","onesLike");if("complex64"===t.dtype){var n=bn(an(t)),r=xn(sn(t));return on(n,r)}return ke.runKernelFunc((function(e){return e.onesLike(t)}),{$x:t},(function(e,t){return{$x:function(){return xn(e)}}}))}}),xn=rn({zerosLike_:function(e){var t=jt(e,"x","zerosLike");return ke.runKernelFunc((function(e){return e.zerosLike(t)}),{$x:t},(function(e,t){return{$x:function(){return xn(e)}}}))}}),wn=rn({concat_:function(e,t){void 0===t&&(t=0),C(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=zt(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")})),t=M(t,n[0].shape)[0];var r=nn(n.map((function(e){return e.shape})),t);if(0===R(r))return un([],r);if(1===(n=n.filter((function(e){return e.size>0}))).length)return n[0];var o=n.map((function(e){return e.shape}));tn(o,t);var a=n,i={axis:t};return ke.runKernelFunc((function(e){return e.concat(n,t)}),a,(function(e){var n=o.map((function(e){return e[t]}));return _n(e,n,t).map((function(e){return function(){return e}}))}),"Concat",i)}}),En=rn({concat1d_:function(e){return wn(e,0)}}),An=rn({concat2d_:function(e,t){return wn(e,t)}}),Cn=rn({concat3d_:function(e,t){return wn(e,t)}}),Sn=rn({concat4d_:function(e,t){return wn(e,t)}}),_n=rn({split_:function(e,t,n){void 0===n&&(n=0);var r,o=jt(e,"x","split");return n=M(n,o.shape)[0],"number"==typeof t?(C(o.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(o.shape[n]/t)):(C(o.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t),ke.runKernelFunc((function(e){return e.split(o,r,n)}),{$x:o},(function(e){return{$x:function(){return wn(e,n)}}}))}});function In(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self&&self;var Rn=In((function(e){!function(e,t,n){function r(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function o(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function a(e,t){var n=new r(e),a=t&&t.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}t&&t.exports?t.exports=a:this.alea=a}(0,e)})),Tn=In((function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function a(e,t){var n=new r(e),a=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}t&&t.exports?t.exports=a:this.xor128=a}(0,e)})),Pn=In((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function a(e,t){var n=new r(e),a=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}t&&t.exports?t.exports=a:this.xorwow=a}(0,e)})),Nn=In((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function o(e,t){return t.x=e.x.slice(),t.i=e.i,t}function a(e,t){null==e&&(e=+new Date);var n=new r(e),a=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,a&&(a.x&&o(a,n),i.state=function(){return o(n,{})}),i}t&&t.exports?t.exports=a:this.xorshift7=a}(0,e)})),On=In((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,a=t.i;return t.w=r=r+1640531527|0,n=o[a+34&127],e=o[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,o,a,i,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),o=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=i+1640531527|0,o=0==(n=s[127&a]^=r+i)?o+1:0);for(o>=128&&(s[127&(t&&t.length||0)]=-1),o=127,a=512;a>0;--a)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;e.w=i,e.X=s,e.i=o}(t,e)}function o(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function a(e,t){null==e&&(e=+new Date);var n=new r(e),a=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,a&&(a.X&&o(a,n),i.state=function(){return o(n,{})}),i}t&&t.exports?t.exports=a:this.xor4096=a}(0,e)})),Dn=In((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function a(e,t){var n=new r(e),a=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}t&&t.exports?t.exports=a:this.tychei=a}(0,e)})),kn=In((function(e){!function(t,n){var r,o=this,a=256,i="random",s=n.pow(a,6),u=n.pow(2,52),c=2*u,l=255;function f(e,l,f){var m=[],g=d(function e(t,n){var r,o=[],a=typeof t;if(n&&"object"==a)for(r in t)try{o.push(e(t[r],n-1))}catch(e){}return o.length?o:"string"==a?t:t+"\0"}((l=1==l?{entropy:!0}:l||{}).entropy?[e,v(t)]:null==e?function(){try{var e;return r&&(e=r.randomBytes)?e=e(a):(e=new Uint8Array(a),(o.crypto||o.msCrypto).getRandomValues(e)),v(e)}catch(e){var n=o.navigator,i=n&&n.plugins;return[+new Date,o,i,o.screen,v(t)]}}():e,3),m),y=new p(m),b=function(){for(var e=y.g(6),t=s,n=0;e<u;)e=(e+n)*a,t*=a,n=y.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,d(v(y.S),t),(l.pass||f||function(e,t,r,o){return o&&(o.S&&h(o,y),e.state=function(){return h(y,{})}),r?(n[i]=e,t):e})(b,g,"global"in l?l.global:this==n,l.state)}function p(e){var t,n=e.length,r=this,o=0,i=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=l&i+e[o%n]+(t=s[o])],s[i]=t;(r.g=function(e){for(var t,n=0,o=r.i,i=r.j,s=r.S;e--;)t=s[o=l&o+1],n=n*a+s[l&(s[o]=s[i=l&i+t])+(s[i]=t)];return r.i=o,r.j=i,n})(a)}function h(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function d(e,t){for(var n,r=e+"",o=0;o<r.length;)t[l&o]=l&(n^=19*t[l&o])+r.charCodeAt(o++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(n["seed"+i]=f,d(n.random(),t),e.exports){e.exports=f;try{r=__webpack_require__(902)}catch(e){}}}([],Math)}));kn.alea=Rn,kn.xor128=Tn,kn.xorwow=Pn,kn.xorshift7=Nn,kn.xor4096=On,kn.tychei=Dn;var Fn=kn.alea,Mn=function(){function e(e,t,n,r,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=Fn(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var o=void 0,a=void 0,i=void 0;do{i=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a}while(i>=1||0===i);var s=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),Ln=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var o=r||Math.random();this.randu=Fn(o.toString()),this.randn=new Mn(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,o,a;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-a+Math.log(a)),(o=this.randu())<t||Math.log(o)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),Un=function(){function e(e,t,n,r){var o=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Fn(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function Bn(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",oe(e),new de(e,t,n)}var Gn=rn({batchToSpaceND_:function(e,t,n){var r=jt(e,"x","batchToSpaceND"),o=t.reduce((function(e,t){return e*t}));return C(r.rank>=1+t.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length})),C(n.length===t.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length})),C(r.shape[0]%o==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o})),ke.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),Wn=rn({broadcastTo_:function(e,t){var n=jt(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var o=n.shape.slice();o.length<t.length;)o.unshift(1);n=n.reshape(o)}for(var a=Array.from(t),i=t.length-1;i>=0;i--)if(n.shape[i]===t[i])a[i]=1;else if(1!==n.shape[i])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=a.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));return 0===s.length?n.clone():ke.runKernelFunc((function(e){return e.tile(n,a)}),{input:n},(function(e){return{input:function(){return e.sum(s,!0)}}}))}}),Vn=rn({cast_:function(e,t){var n=jt(e,"x","cast");if(!W(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return ke.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},(function(e){return{x:function(){return e.clone()}}}),"Cast",r)}}),$n=rn({clone_:function(e){var t=jt(e,"x","clone",null);return ke.runKernelFunc((function(){return ke.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{$x:t},(function(e){return{$x:function(){return e.toFloat()}}}))}}),Hn=rn({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=jt(e,"x","cumsum"),a=Qt([t|=0],o.rank),i=o;null!=a&&(i=o.transpose(a));var s=en(1,o.rank)[0],u=ke.runKernelFunc((function(e){return e.cumsum(i,s,n,r)}),{permutedX:i},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=a&&(u=u.transpose(a)),u}}),jn=rn({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=jt(e,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];return C(o*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+"  for depthToSpace with input shape\n      "+r.shape})),C(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape})),C(i%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+i+" for depthToSpace with input shape "+r.shape})),ke.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),zn=rn({expandDims_:function(e,t){void 0===t&&(t=0);var n=jt(e,"x","expandDims",null);C(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&(C(-(n.rank+1)<=t,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),t=n.rank+t+1),r.splice(t,0,1),ar(n,r)}}),qn=rn({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var o=Bn([e,t],r),a=e<=t?e:t,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return cr(zn(s,0),[n[0],1,1]);if(2===n.length)return cr(zn(zn(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return cr(zn(zn(zn(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),Kn=rn({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var o=jt(e,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);n=n||Math.random();var s=1===i?o.as2D(1,-1):o,u=ke.runKernelFunc((function(e){return e.multinomial(s,r,t,n)}),{logits2D:s});return 1===i?u.as1D():u}}),Xn=rn({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=jt(e,"indices","oneHot","int32"),a=o.shape.concat([t]);return o=o.flatten(),ke.runKernelFunc((function(e){return e.oneHot(o,t,n,r)}),{$indices:o},(function(e){return{$indices:function(){return mn(o.shape,"float32")}}})).reshape(a)}}),Yn=rn({pad_:function(e,t,n){void 0===n&&(n=0);var r=jt(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:n};return ke.runKernelFunc((function(e){return e.pad(r,t,n)}),{x:r},(function(e){var n=t.map((function(e){return e[0]}));return{x:function(){return e.slice(n,r.shape)}}}),"PadV2",o)}}),Zn=rn({pad1d_:function(e,t,n){return void 0===n&&(n=0),C(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),Yn(e,[t],n)}}),Qn=rn({pad2d_:function(e,t,n){return void 0===n&&(n=0),C(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Yn(e,t,n)}}),Jn=rn({pad3d_:function(e,t,n){return void 0===n&&(n=0),C(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Yn(e,t,n)}}),er=rn({pad4d_:function(e,t,n){return void 0===n&&(n=0),C(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Yn(e,t,n)}}),tr=rn({rand_:function(e,t,n){var r=R(e),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var a=0;a<r;a++)o[a]=t();return ke.makeTensor(o,e,n)}}),nr=rn({randomNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Mn(t,n,r,!1,o),i=Bn(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),rr=rn({randomGamma_:function(e,t,n,r,o){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var a=new Ln(t,n,r,o),i=Bn(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),or=rn({randomUniform_:function(e,t,n,r,o){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=Bn(e,r),i=new Un(t,n,null,o),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),ar=rn({reshape_:function(e,t){var n=jt(e,"x","reshape",null);t=F(t,n.size),C(n.size===R(t),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:t};return ke.runKernelFunc((function(e){return e.reshape(n,t)}),{x:n},(function(e){return{x:function(){return e.reshape(n.shape)}}}),"Reshape",r)}}),ir=rn({spaceToBatchND_:function(e,t,n){var r=jt(e,"x","spaceToBatchND");return C(r.rank>=1+t.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length})),C(n.length===t.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length})),C(r.shape.reduce((function(e,r,o){return o>0&&o<=t.length?e&&(r+n[o-1][0]+n[o-1][1])%t[o-1]==0:e}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()})),ke.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),sr=rn({squeeze_:function(e,t){var n=jt(e,"x","squeeze");return ar(n,L(n.shape,t).newShape)}}),ur=rn({stack_:function(e,t){void 0===t&&(t=0);var n=zt(e,"tensors","stack");if(C(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,a=n[0].dtype;C(t<=r,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){S(o,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){C(a===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=n.map((function(e){return e.expandDims(t)}));return wn(i,t)}}),cr=rn({tile_:function(e,t){var n=jt(e,"x","tile",null);C(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."}));var r=[n],o={reps:t};return ke.runKernelFunc((function(e,r){var o=e.tile(n,t);return r([n]),o}),{x:n},(function(e,n){var r=n[0];return{x:function(){var n=xn(r);if(1===r.rank)for(var o=0;o<t[0];++o)n=n.add(e.slice([o*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(o=0;o<t[0];++o)for(var a=0;a<t[1];++a)n=n.add(e.slice([o*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(o=0;o<t[0];++o)for(a=0;a<t[1];++a)for(var i=0;i<t[2];++i)n=n.add(e.slice([o*r.shape[0],a*r.shape[1],i*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(o=0;o<t[0];++o)for(a=0;a<t[1];++a)for(i=0;i<t[2];++i)for(var s=0;s<t[3];++s)n=n.add(e.slice([o*r.shape[0],a*r.shape[1],i*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}}),"Tile",o,r)}}),lr=rn({truncatedNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Mn(t,n,r,!0,o),i=Bn(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),fr=rn({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=jt(e,"x","unstack");C(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),t<0&&(t+=n.shape.length);var r={axis:t};return ke.runKernelFunc((function(e){return e.unstack(n,t)}),{x:n},(function(e){return{x:function(){return ur(e,t)}}}),"Unpack",r)}});function pr(e,t,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var a=t.length,i=0;i<a;++i)o=o.concat([e[i+1]/t[i],t[i]]);o=o.concat(e.slice(a+1))}return o}function hr(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var a=[],i=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?i.push(o):a.push(o);r.push.apply(r,a),r.push(0),r.push.apply(r,i)}return r}function dr(e,t,n,r){void 0===r&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?o.push(t[a-1]*e[a]):o.push(e[a]/t[a-1]):o.push(e[a]);return o}function vr(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function mr(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}function gr(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,a=0;a<n.length-1;++a)o*=n[a];var i=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=i[a],s.push(i[a]);var c=Q(e.shape).map((function(e){return e/u})).concat([1]).slice(0,r);return[s,o,u,c]}function yr(e){return e<=30?e:Z(e,Math.floor(Math.sqrt(e)))}function br(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(a+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(a+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(a+" update.rank != "+(o+e.length-r));for(var i=0;i<o;++i)if(n.shape[i]!==t.shape[i])throw new Error(a+" updates.shape["+i+"] ("+n.shape[i]+") != indices.shape["+i+"] ("+t.shape[i]+").");for(i=0;i<n.rank-o;++i)if(n.shape[i+o]!==e[i+r])throw new Error(a+" updates.shape["+(i+o)+"] ("+n.shape[i+o]+") != shape["+(i+o)+"] ("+e[i+o]+")")}function xr(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}br(n,t,e)}function wr(e,t,n){for(var r=t.shape.length,o=r>1?t.shape[r-1]:1,a=n.length,i=1,s=o;s<a;++s)i*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:R(t.shape)/u,sliceSize:i,strides:Q(n.slice(0,o)).concat([1]),outputSize:R(n)}}function Er(e,t,n){C(e.rank===t.length,(function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."})),C(e.rank===n.length,(function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."}));for(var r=function(r){C(t[r]+n[r]<=e.shape[r],(function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"}))},o=0;o<e.rank;++o)r(o)}function Ar(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Cr(e,t,n){for(var r=[],o=0;o<e.length;o++)r[o]=Math.ceil((t[o]-e[o])/n[o]);return r}function Sr(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),w(0,a,s-1)}function _r(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),i>0?w(0,a,s):w(-1,a,s-1)}function Ir(e,t,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function Rr(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Tr(e){return ke.customGrad(e)}Object.freeze({prepareAndValidate:gr}),Object.freeze({validateUpdateShape:br,validateInput:xr,calculateShapes:wr}),Object.freeze({assertParamsValid:Er,maskToAxes:Ar,computeOutShape:Cr,startForAxis:Sr,stopForAxis:_r,isSliceContinous:Ir,computeFlatOffset:Rr});var Pr=rn({softmax_:function(e,t){void 0===t&&(t=-1);var n=jt(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return ke.runKernelFunc((function(e,r){var o=e.softmax(n,t);return r([o]),o}),{logits:n},(function(e,n){var r=n[0],o=e.mul(r);return{logits:function(){return o.sub(o.sum([t],!0).mul(r))}}}),"Softmax",{dim:t},[],[!0])}}),Nr=rn({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=jt(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return Tr((function(e,n){var r=e.max(t,!0),o=e.sub(r),a=o.toFloat().sub(o.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}}))(n)}}),Or=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),Dr=function(){function e(){}return e.prototype.time=function(e){return kr("time")},e.prototype.read=function(e){return kr("read")},e.prototype.readSync=function(e){return kr("readSync")},e.prototype.numDataIds=function(){return kr("numDataIds")},e.prototype.disposeData=function(e){return kr("disposeData")},e.prototype.write=function(e,t,n){return kr("write")},e.prototype.move=function(e,t,n,r){return kr("move")},e.prototype.memory=function(){return kr("memory")},e.prototype.floatPrecision=function(){return kr("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return kr("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,kr("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return kr("slice")},e.prototype.stridedSlice=function(e,t,n,r){return kr("stridedSlice")},e.prototype.unstack=function(e,t){return kr("unstack")},e.prototype.reverse=function(e,t){return kr("reverse")},e.prototype.concat=function(e,t){return kr("concat")},e.prototype.neg=function(e){return kr("neg")},e.prototype.add=function(e,t){return kr("add")},e.prototype.addN=function(e){return kr("addN")},e.prototype.subtract=function(e,t){return kr("subtract")},e.prototype.multiply=function(e,t){return kr("multiply")},e.prototype.realDivide=function(e,t){return kr("realDivide")},e.prototype.floorDiv=function(e,t){return kr("floorDiv")},e.prototype.sum=function(e,t){return kr("sum")},e.prototype.prod=function(e,t){return kr("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return kr("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return kr("argMin")},e.prototype.argMax=function(e,t){return kr("argMax")},e.prototype.equal=function(e,t){return kr("equal")},e.prototype.notEqual=function(e,t){return kr("notEqual")},e.prototype.less=function(e,t){return kr("less")},e.prototype.lessEqual=function(e,t){return kr("lessEqual")},e.prototype.greater=function(e,t){return kr("greater")},e.prototype.greaterEqual=function(e,t){return kr("greaterEqual")},e.prototype.logicalNot=function(e){return kr("logicalNot")},e.prototype.logicalAnd=function(e,t){return kr("logicalAnd")},e.prototype.logicalOr=function(e,t){return kr("logicalOr")},e.prototype.where=function(e){return kr("where")},e.prototype.select=function(e,t,n){return kr("select")},e.prototype.topk=function(e,t,n){return kr("topk")},e.prototype.min=function(e,t){return kr("min")},e.prototype.minimum=function(e,t){return kr("minimum")},e.prototype.mod=function(e,t){return kr("mod")},e.prototype.max=function(e,t){return kr("max")},e.prototype.maximum=function(e,t){return kr("maximum")},e.prototype.all=function(e,t){return kr("all")},e.prototype.any=function(e,t){return kr("any")},e.prototype.squaredDifference=function(e,t){return kr("squaredDifference")},e.prototype.ceil=function(e){return kr("ceil")},e.prototype.floor=function(e){return kr("floor")},e.prototype.round=function(e){return kr("round")},e.prototype.sign=function(e){return kr("sign")},e.prototype.isNaN=function(e){return kr("isNaN")},e.prototype.isInf=function(e){return kr("isInf")},e.prototype.isFinite=function(e){return kr("isFinite")},e.prototype.pow=function(e,t){return kr("pow")},e.prototype.exp=function(e){return kr("exp")},e.prototype.expm1=function(e){return kr("expm1")},e.prototype.softmax=function(e,t){return kr("softmax")},e.prototype.log=function(e){return kr("log")},e.prototype.log1p=function(e){return kr("log1p")},e.prototype.sqrt=function(e){return kr("sqrt")},e.prototype.rsqrt=function(e){return kr("rsqrt")},e.prototype.square=function(e){return kr("square")},e.prototype.reciprocal=function(e){return kr("reciprocal")},e.prototype.relu=function(e){return kr("relu")},e.prototype.relu6=function(e){return kr("relu6")},e.prototype.prelu=function(e,t){return kr("prelu")},e.prototype.elu=function(e){return kr("elu")},e.prototype.eluDer=function(e,t){return kr("eluDer")},e.prototype.selu=function(e){return kr("selu")},e.prototype.int=function(e){return kr("int")},e.prototype.clip=function(e,t,n){return kr("clip")},e.prototype.abs=function(e){return kr("abs")},e.prototype.complexAbs=function(e){return kr("complexAbs")},e.prototype.sigmoid=function(e){return kr("sigmoid")},e.prototype.softplus=function(e){return kr("softplus")},e.prototype.sin=function(e){return kr("sin")},e.prototype.cos=function(e){return kr("cos")},e.prototype.tan=function(e){return kr("tan")},e.prototype.asin=function(e){return kr("asin")},e.prototype.acos=function(e){return kr("acos")},e.prototype.atan=function(e){return kr("atan")},e.prototype.atan2=function(e,t){return kr("atan2")},e.prototype.sinh=function(e){return kr("sinh")},e.prototype.cosh=function(e){return kr("cosh")},e.prototype.tanh=function(e){return kr("tanh")},e.prototype.asinh=function(e){return kr("asinh")},e.prototype.acosh=function(e){return kr("acosh")},e.prototype.atanh=function(e){return kr("atanh")},e.prototype.erf=function(e){return kr("erf")},e.prototype.step=function(e,t){return kr("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,kr("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return kr("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return kr("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return kr("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,kr("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return kr("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return kr("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return kr("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return kr("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return kr("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return kr("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return kr("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return kr("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return kr("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return kr("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return kr("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return kr("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return kr("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return kr("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return kr("reshape")},e.prototype.cast=function(e,t){return kr("cast")},e.prototype.tile=function(e,t){return kr("tile")},e.prototype.pad=function(e,t,n){return kr("pad")},e.prototype.transpose=function(e,t){return kr("transpose")},e.prototype.gather=function(e,t,n){return kr("gather")},e.prototype.gatherND=function(e,t){return kr("gatherND")},e.prototype.scatterND=function(e,t,n){return kr("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return kr("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return kr("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return kr("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return kr("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return kr("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return kr("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,o,a){return kr("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){return kr("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){return kr("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return kr("multinomial")},e.prototype.oneHot=function(e,t,n,r){return kr("oneHot")},e.prototype.cumsum=function(e,t,n,r){return kr("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,o){return kr("nonMaxSuppression")},e.prototype.fft=function(e){return kr("fft")},e.prototype.ifft=function(e){return kr("ifft")},e.prototype.complex=function(e,t){return kr("complex")},e.prototype.real=function(e){return kr("real")},e.prototype.imag=function(e){return kr("imag")},e.prototype.cropAndResize=function(e,t,n,r,o,a){return kr("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return kr("depthToSpace")},e.prototype.split=function(e,t,n){return kr("split")},e.prototype.sparseToDense=function(e,t,n,r){return kr("sparseToDense")},e.prototype.diag=function(e){return kr("diag")},e.prototype.fill=function(e,t,n){return kr("fill")},e.prototype.onesLike=function(e){return kr("onesLike")},e.prototype.zerosLike=function(e){return kr("zerosLike")},e.prototype.linspace=function(e,t,n){return kr("linspace")},e.prototype.dispose=function(){return kr("dispose")},e}();function kr(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Fr(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var a=n-1-o,i=e[a]||1;(t[t.length-1-o]||1)>1&&1===i&&r.unshift(a)}return r}function Mr(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],a=t.length-r-1,i=t[a];(null==o||1===o&&i>1)&&n.unshift(a)}return n}function Lr(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var a=e[e.length-o-1];null==a&&(a=1);var i=t[t.length-o-1];if(null==i&&(i=1),1===a)n.unshift(i);else if(1===i)n.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}function Ur(e,t,n,r,o,a,i){void 0===i&&(i="channelsLast");var s,u=$r(t),c=u[0],l=u[1];if("channelsLast"===i)s=[c,l,e[3],e[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);s=[c,l,e[1],e[1]]}return Gr(e,s,n,r,o,a,!1,i)}function Br(e,t,n,r,o,a,i){void 0===i&&(i="NDHWC");var s,u,c=Hr(t),l=c[0],f=c[1],p=c[2];if("NDHWC"===i)u="channelsLast",s=[l,f,p,e[4],e[4]];else{if("NCDHW"!==i)throw new Error("Unknown dataFormat "+i);u="channelsFirst",s=[l,f,p,e[1],e[1]]}return Wr(e,s,n,r,o,!1,u,a)}function Gr(e,t,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],p=u[3];if("channelsLast"===s)c=e[0],l=e[1],f=e[2],p=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=e[0],p=e[1],l=e[2],f=e[3]}var h,d=t[0],v=t[1],m=t[3],g=$r(n),y=g[0],b=g[1],x=$r(r),w=x[0],E=x[1],A=jr(d,w),S=jr(v,E),_=function(e,t,n,r,o,a,i,s){var u,c,l;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,o){null==r&&(r=Vr(e,t,n));var a=e[1],i=zr((e[0]-t+2*r)/n+1,o);C(P(i),(function(){return"The output # of rows ("+i+") must be an integer. Change the stride and/or zero pad parameters"}));var s=zr((a-t+2*r)/n+1,o);return C(P(s),(function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"})),[i,s]}([t,n],a,r,e,s);c=f[0],l=f[1]}else if("same"===e){c=Math.ceil(t/r),l=Math.ceil(n/o);var p=Math.max(0,(c-1)*r+a-t),h=Math.max(0,(l-1)*o+i-n),d=Math.floor(p/2),v=p-d,m=Math.floor(h/2);u={top:d,bottom:v,left:m,right:h-m,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-a+1)/r),l=Math.ceil((n-i+1)/o)}return{padInfo:u,outHeight:c,outWidth:l}}(o,l,f,y,b,A,S,a),I=_.padInfo,R=_.outHeight,T=_.outWidth,N=i?m*p:m;return"channelsFirst"===s?h=[c,N,R,T]:"channelsLast"===s&&(h=[c,R,T,N]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:f,inChannels:p,outHeight:R,outWidth:T,outChannels:N,padInfo:I,strideHeight:y,strideWidth:b,filterHeight:d,filterWidth:v,effectiveFilterHeight:A,effectiveFilterWidth:S,dilationHeight:w,dilationWidth:E,inShape:e,outShape:h,filterShape:t}}function Wr(e,t,n,r,o,a,i,s){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],p=u[3],h=u[4];if("channelsLast"===i)c=e[0],l=e[1],f=e[2],p=e[3],h=e[4];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);c=e[0],h=e[1],l=e[2],f=e[3],p=e[4]}var d,v=t[0],m=t[1],g=t[2],y=t[4],b=Hr(n),x=b[0],w=b[1],E=b[2],A=Hr(r),S=A[0],_=A[1],I=A[2],R=jr(v,S),T=jr(m,_),N=jr(g,I),O=function(e,t,n,r,o,a,i,s,u,c,l){var f,p,h,d;if("number"==typeof e){f={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,o,a){null==o&&(o=Vr(e,t,r));var i=e[1],s=e[2],u=zr((e[0]-t+2*o)/r+1,a);C(P(u),(function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"}));var c=zr((i-t+2*o)/r+1,a);C(P(c),(function(){return"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters"}));var l=zr((s-t+2*o)/r+1,a);return C(P(l),(function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"})),[u,c,l,1]}([t,n,r,1],s,0,o,e,l);p=v[0],h=v[1],d=v[2]}else if("same"===e){var m=((p=Math.ceil(t/o))-1)*o+s-t,g=((h=Math.ceil(n/a))-1)*a+u-n,y=((d=Math.ceil(r/i))-1)*i+c-r,b=Math.floor(m/2),x=m-b,w=Math.floor(g/2),E=g-w,A=Math.floor(y/2);f={top:w,bottom:E,left:A,right:y-A,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((t-s+1)/o),h=Math.ceil((n-u+1)/a),d=Math.ceil((r-c+1)/i)}return{padInfo:f,outDepth:p,outHeight:h,outWidth:d}}(o,l,f,p,x,w,E,R,T,N,s),D=O.padInfo,k=O.outDepth,F=O.outHeight,M=O.outWidth,L=a?y*h:y;return"channelsFirst"===i?d=[c,L,k,F,M]:"channelsLast"===i&&(d=[c,k,F,M,L]),{batchSize:c,dataFormat:i,inDepth:l,inHeight:f,inWidth:p,inChannels:h,outDepth:k,outHeight:F,outWidth:M,outChannels:L,padInfo:D,strideDepth:x,strideHeight:w,strideWidth:E,filterDepth:v,filterHeight:m,filterWidth:g,effectiveFilterDepth:R,effectiveFilterHeight:T,effectiveFilterWidth:N,dilationDepth:S,dilationHeight:_,dilationWidth:I,inShape:e,outShape:d,filterShape:t}}function Vr(e,t,n,r){void 0===r&&(r=1);var o=jr(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}function $r(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Hr(e){return"number"==typeof e?[e,e,e]:e}function jr(e,t){return t<=1?e:e+(e-1)*(t-1)}function zr(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function qr(e){var t=$r(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}function Kr(e,t){return qr(e)||qr(t)}function Xr(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function Yr(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=mn(e.shape),o=e.toFloat(),a=n.complex(o,r);return r.dispose(),o.dispose(),a}if(!V(e.dtype,t))return ke.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var i=n.real(e);return a=i.cast(t),i.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=ln(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function Zr(e,t){return ke.makeTensorFromDataId(e.dataId,t,e.dtype)}function Qr(e,t,n){var r=(t-e)/(n-1),o=ne(n,"float32");o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return fn(o,"float32")}function Jr(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function eo(e,t){return{real:e[2*t],imag:e[2*t+1]}}function to(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function no(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function ro(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,o=e.length,a=0,i=!1;r<o;){var s=n(t,e[a=r+(o-r>>>1)]);s>0?r=a+1:(o=a,i=!s)}return i?r:-r-1}(e,t,n||oo)}(e,t,n),o=r<0?-(r+1):r;e.splice(o,0,t)}function oo(e,t){return e>t?1:e<t?-1:0}function ao(e,t,n,r,o){return so(e,t,n,r,o,0).selectedIndices}function io(e,t,n,r,o,a){var i=so(e,t,n,r,o,a,!0);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function so(e,t,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1);for(var u=Array.from(t).map((function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}})).filter((function(e){return e.score>o})).sort(lo),c=a>0?-.5/a:0,l=[],f=[];l.length<n&&u.length>0;){var p=u.pop(),h=p.score,d=p.boxIndex,v=p.suppressBeginIndex;if(h<o)break;for(var m=!1,g=l.length-1;g>=v;--g){var y=uo(e,d,l[g]);if(y>=r){m=!0;break}if(p.score=p.score*co(r,c,y),p.score<=o)break}p.suppressBeginIndex=l.length,m||(p.score===h?(l.push(d),f.push(p.score)):p.score>o&&ro(u,p,lo))}var b=l.length;return s&&(l.fill(0,b),f.fill(0,b)),{selectedIndices:fn(l,"int32"),selectedScores:fn(f,"float32"),numValidOutputs:ln(b,"int32")}}function uo(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),p=Math.max(o[1],o[3]),h=(s-a)*(u-i),d=(f-c)*(p-l);if(h<=0||d<=0)return 0;var v=Math.max(a,c),m=Math.max(i,l),g=Math.min(s,f),y=Math.min(u,p),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(h+d-b)}function co(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function lo(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function fo(e,t,n){var r=new Array(e.rank).fill(0),o=e.shape.slice();return t.map((function(t){o[n]=t;var a=e.slice(r,o);return r[n]+=t,a}))}function po(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var o=Bn(n,e.dtype);for(r=0;r<o.values.length;++r){for(var a=o.indexToLoc(r),i=new Array(e.rank),s=0;s<i.length;s++)i[s]=a[s]%e.shape[s];var u=e.locToIndex(i);o.values[r]=e.values[u]}return o.toTensor()}function ho(e,t,n,r,o){for(var a=t[t.length-1],i=[e.length/a,a],s=i[0],u=i[1],c=U(n,s*r),l=U("int32",s*r),f=0;f<s;f++){for(var p=f*u,h=e.subarray(p,p+u),d=[],v=0;v<h.length;v++)d.push({value:h[v],index:v});d.sort((function(e,t){return t.value-e.value}));var m=f*r,g=c.subarray(m,m+r),y=l.subarray(m,m+r);for(v=0;v<r;v++)g[v]=d[v].value,y[v]=d[v].index}var b=t.slice();return b[b.length-1]=r,[un(c,b,n),un(l,b,"int32")]}function vo(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=Bn(e,"int32"),a=Bn([n.length,e.length],"int32");for(r=0;r<n.length;r++){var i=o.indexToLoc(n[r]),s=r*e.length;a.values.set(i,s)}return a.toTensor()}Object.freeze({castTensor:Yr,reshapeTensor:Zr,linspaceImpl:Qr,upcastType:_e,axesAreInnerMostDims:qt,combineLocations:Kt,computeOutAndReduceShapes:Xt,expandShapeToKeepDim:Yt,assertAxesAreInnerMostDims:Zt,getAxesPermutation:Qt,getUndoAxesPermutation:Jt,getInnerMostAxes:en,getBroadcastDims:Fr,getReductionAxes:Mr,assertAndGetBroadcastShape:Lr,assertParamsConsistent:tn,computeOutShape:nn,computePool2DInfo:Ur,computePool3DInfo:Br,computeConv2DInfo:Gr,computeConv3DInfo:Wr,computeDefaultPad:Vr,tupleValuesAreOne:qr,eitherStridesOrDilationsAreOne:Kr,convertConv2DDataFormat:Xr,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:yr});var mo=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},go=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},yo=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,a=e.inSize,i=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function bo(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return e+"."+t}))}function xo(e,t){return 1===t?[e]:bo(e,t)}function wo(){var e,t,n,r,o,a,i,s,u,c;return 2===f().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",o="texture",a="outputColor",i="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",o="texture2D",a="gl_FragColor",i="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Eo(e,t,n){void 0===n&&(n="index");var r=Q(t);return r.map((function(t,o){return"int "+e[o]+" = "+n+" / "+t+"; "+(o===r.length-1?"int "+e[o+1]+" = "+n+" - "+e[o]+" * "+t:"index -= "+e[o]+" * "+t)+";"})).join("")}function Ao(e){var t=Q(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var Co="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function So(e,t,n,r){var o=[];e.forEach((function(e){var t=R(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?o.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(o.push("uniform sampler2D "+e.name+";"),o.push("uniform int offset"+e.name+";"))}));var a,i,s=o.join("\n"),u=e.map((function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?Io(e):_o(e);var o=e.shapeInfo.logicalShape,a=t.logicalShape;return o.length<=a.length&&(r+=n?function(e,t){var n,r,o=e.name,a=o.charAt(0).toUpperCase()+o.slice(1),i="get"+a+"AtOutCoords",s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,c=Fr(e.shapeInfo.logicalShape,t.logicalShape),l=ko(u),f=u-s,p=["x","y","z","w","u","v"];n=0===s?"":u<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords."+p[e+f]+" = 0;"})).join("\n"),r=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+p[t+f]})).join(", ");var h="return outputValue;",d=1===R(e.shapeInfo.logicalShape),v=1===R(t.logicalShape);if(1!==s||d||v){if(d&&!v)h=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var m=s-2,g=s-1;c.indexOf(m)>-1&&c.indexOf(g)>-1?h="return vec4(outputValue.x);":c.indexOf(m)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(g)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+i+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+a+"("+r+");\n      "+h+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",a=t.texShape,i=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&T(i,a))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var c,l,f=ko(u),p=Fr(e.shapeInfo.logicalShape,t.logicalShape),h=u-s,d=["x","y","z","w","u","v"];return c=0===s?"":u<2&&p.length>=1?"coords = 0;":p.map((function(e){return"coords."+d[e+h]+" = 0;"})).join("\n"),l=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+d[t+h]})).join(", "),"\n    float "+o+"() {\n      "+f+" coords = getOutputCoords();\n      "+c+"\n      return get"+r+"("+l+");\n    }\n  "}(e,t)),r}(e,t,r)})).join("\n"),c=t.texShape,l=wo(),f=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(l),p=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Ro+"\n    "+To+"\n    "+Po+"\n  "}(l);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(T(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),o=r*Math.ceil(e[e.length-2]/2),a=o,i="",s="b, r, c",u=2;u<e.length-1;u++)i="\n      int b"+u+" = index / "+(a*=e[e.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+i,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+i+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,o,a,i}(t.logicalShape,c),i=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(l)):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return T(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=Eo(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=Eo(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=Eo(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=Eo(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,c),i=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(p+=No),[p,f,i,s,a,u,n].join("\n")}function _o(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===o&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+i[0]+", "+i[1]+", "+Oo(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+Do(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===a&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=Oo(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+i+") + 0.5) / "+o+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+i+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+a+", index + "+i+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape;if(null!=o&&T(t,o)){var a=o[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+a+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var i=L(t),s=i.newShape,u=i.keptDims,c=s;if(c.length<t.length)return"\n      "+_o(Fo(e,c))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+Mo(["row","col"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+Do(e)+"\n      }\n    ";var l=o[0],f=o[1],p=Oo(n);return 1===f?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===l?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+p+";\n    vec2 uv = uvFromFlat("+l+", "+f+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[1]*t[2],a=t[2],i=L(t),s=i.newShape,u=i.keptDims,c=s;if(c.length<t.length)return"\n        "+_o(Fo(e,c))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+Mo(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+a+", 1)));\n        "+Do(e)+"\n      }\n    ";var l=e.shapeInfo.texShape,f=l[0],p=l[1],h=e.shapeInfo.flatOffset;return p===o&&null==h?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+p+".0, "+f+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":p===a&&null==h?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+p+".0, "+f+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+a+" + depth + "+Oo(n)+";\n        vec2 uv = uvFromFlat("+f+", "+p+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[3],a=t[2]*o,i=t[1]*a,s=L(t),u=s.newShape,c=s.keptDims;if(u.length<t.length)return"\n      "+_o(Fo(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+Mo(["row","col","depth","depth2"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+i+", "+a+", "+o+", 1)));\n        "+Do(e)+"\n      }\n    ";var l=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,p=f[0],h=f[1];return h===i&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":h===o&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+i+" + col * "+a+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+p+", "+h+", index + "+Oo(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],a=t[3]*o,i=t[2]*a,s=t[1]*i,u=L(t),c=u.newShape,l=u.keptDims;if(c.length<t.length)return"\n      "+_o(Fo(e,c))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+Mo(["row","col","depth","depth2","depth3"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+i+", "+a+", "+o+")) +\n          depth3;\n        "+Do(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,h=p[0],d=p[1];return d===s&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+i+", "+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+d+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":d===o&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+d+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+i+" + depth * "+a+" +\n          depth2 * "+o+" + depth3 + "+Oo(n)+";\n      vec2 uv = uvFromFlat("+h+", "+d+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=L(t),a=o.newShape,i=o.keptDims;if(a.length<t.length)return"\n      "+_o(Fo(e,a))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+Mo(["row","col","depth","depth2","depth3","depth4"],i)+");\n      }\n    ";var s=t[5],u=t[4]*s,c=t[3]*u,l=t[2]*c,f=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+l+", "+c+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+Do(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],v=h[1];return v===f&&null==p?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+l+", "+c+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":v===s&&null==p?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+l+" + depth * "+c+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+Oo(n)+";\n      vec2 uv = uvFromFlat("+d+", "+v+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function Io(e){var t;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1)+"() {\n      return "+wo().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=wo();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=o[0],i=o[1],s=wo();if(null!=o&&T(t,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===t[0])return"\n        "+Io(Fo(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+Mo(["b","row","col"],[1,2])+");\n        }\n      ";var i=a[0],s=a[1],u=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+i+", "+s+", "+u*Math.ceil(t[1]/2)+", "+u+", b, row, col);\n      return "+wo().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=i[0],u=i[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),f="int b, int row, int col",p="b * "+l+" + (row / 2) * "+c+" + (col / 2)",h=2;h<n-1;h++)f="int b"+h+", "+f,p="b"+h+" * "+(l*=t[n-h-1])+" + "+p;return"\n    vec4 "+o+"("+f+") {\n      int index = "+p+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+wo().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var Ro="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",To="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Po="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",No="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Oo(e){return"offset"+e}function Do(e){var t=e.name,n=R(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function ko(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function Fo(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Mo(e,t){return t.map((function(t){return e[t]})).join(", ")}var Lo=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,C(e.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var o=e[e.length-1],a=Math.ceil(o/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,c=u.length,l=ko(c),f=xo("coords",c);if(1===a){var p=ko(s=c+1);i="\n        "+p+" sourceLocR = "+p+"("+f.join()+", 0);\n        ++"+f[c-1]+";\n        "+p+" sourceLocG = "+p+"("+f.join()+", 0);\n        ++"+f[c-2]+";\n        "+p+" sourceLocA = "+p+"("+f.join()+", 0);\n        --"+f[c-1]+";\n        "+p+" sourceLocB = "+p+"("+f.join()+", 0);\n        --"+f[c-2]+";"}else s=c,i="\n        "+l+" sourceLocR = coords;\n        ++"+f[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+f[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+f[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+f[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),d="."+h[s-1],v=h.map((function(e){return"int "+e})),m=xo("sourceLocR",s-1).concat("inIdx.r"),g=xo("sourceLocG",s-1).concat("inIdx.g"),y=xo("sourceLocB",s-1).concat("inIdx.b"),b=xo("sourceLocA",s-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",E="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",A=r?"":"\n      float getBestIndicesAChannel("+v.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+v.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+A+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+f[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+f[c-2]+" < "+(u[c-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+d+", sourceLocG"+d+",\n          sourceLocB"+d+", sourceLocA"+d+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+E+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+E+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},Uo=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=s-1-e.padInfo.top,l=u-1-e.padInfo.left,f=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float avgMultiplier = float("+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+i+") {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Bo=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,h=l-1-e.padInfo.front,d=f-1-e.padInfo.top,v=p-1-e.padInfo.left,m=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+h+", "+d+", "+v+");\n      const float avgMultiplier = float("+m+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+o+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+f+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+p+";\n                wC += "+c+") {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Go=function(e,t,n,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],Lr(e,t),Lr(e,n);var i="0.0";null!=r&&(Lr(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";null!=o&&(Lr(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+i+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Wo=function(e,t,n,r,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Lr(e,t),Lr(e,n);var i="vec4(0.0)";null!=r&&(Lr(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(Lr(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+i+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},Vo=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Lr(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},$o="return a + b;",Ho="return a - b;",jo="return a * b;",zo="return (a < 0.) ? b * a : a;",qo=function(e,t,n){this.variableNames=["A","B"],this.outputShape=Lr(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Ko="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Xo=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Lr(t,n);var o=this.outputShape.length,a="";if(r)if(0===o||1===R(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+ko(o)+" coords = getOutputCoords();\n        ",1===o)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var i=xo("coords",o);a+="\n            bool nextRowOutOfBounds =\n              ("+i[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+i[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},Yo=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Zo=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Qo=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Jo=function(e){this.outputShape=[],this.outputShape=nn(e,1),this.variableNames=e.map((function(e,t){return"T"+t}));var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var o=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var a=t.length,i=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},ea=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=nn(e,t);var n=this.outputShape,r=n.length,o=ko(r),a=xo("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(e,t){return"T"+t}));var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var c=i[t],l=i.slice(-2),f=i.join(),p="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+f+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var h=s[u-1];p+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+ta(i,c,h)+"),\n            vec2("+ta(l,c,h)+"));\n        }"}var d=s.length,v=s[s.length-1];p+="\n        return getChannel(\n          getT"+d+"("+ta(i,c,v)+"),\n          vec2("+ta(l,c,v)+"));",this.userCode="\n      float getValue("+i.map((function(e){return"int "+e}))+") {\n        "+p+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[r-1]+" = "+a[r-1]+" + 1;\n        if ("+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[r-2]+" = "+a[r-2]+" + 1;\n        if ("+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[r-1]+" = "+a[r-1]+" - 1;\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            "+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "};function ta(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?e+" - "+n:e})).join()}var na=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+a+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ra=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a="channelsLast"===e.dataFormat,i=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=a?1:2,c=a?2:3,l=a?3:1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+c+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},oa=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,a=e.padInfo.top,i=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+o+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+i+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},aa=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+c+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+o+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ia=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},sa=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ua=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,a=e.padInfo.left,i=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,p=4*Math.floor(e.inChannels/4),h=e.inChannels%4,d="channelsLast"===e.dataFormat,v=d?1:2,m=d?2:3,g=d?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+i+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+v+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+p+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+d+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+d+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+p+") *\n                    getW(wR, wC, "+p+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+p+", xR, xC) *\n                    getW(wR, wC, "+p+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+p+", d2),\n                getW(wR, wC, "+p+" + 1, d2)\n              );\n\n              if ("+d+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+p+"),\n                  getX(batch, xR, xC, "+p+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+p+", xR, xC),\n                  getX(batch, "+p+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+p+", d2),\n                getW(wR, wC, "+p+" + 1, d2),\n                getW(wR, wC, "+p+" + 2, d2)\n              );\n\n              if ("+d+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+p+"),\n                  getX(batch, xR, xC, "+p+" + 1),\n                  getX(batch, xR, xC, "+p+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+p+", xR, xC),\n                  getX(batch, "+p+" + 1, xR, xC),\n                  getX(batch, "+p+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+b+"\n        setOutput(result);\n      }\n    "},ca=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterDepth,f=e.filterHeight,p=e.filterWidth,h=4*Math.floor(e.inChannels/4),d=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+p+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===d)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===d)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===d)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},la=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,a=e.inWidth,i=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,p=e.filterHeight,h=e.filterWidth,d=e.outChannels/e.inChannels,v="",m="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",m="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+v+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+d+";\n        int q = d2 - d1 * "+d+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+p+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+f+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+m+"\n        setOutput(result);\n      }\n    "},fa=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,a=e.inWidth,i=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,p=e.filterHeight,h=e.filterWidth,d=h,v="int xR; int xC; int xCOffset;",m=0;m<p;m++)for(var g=0;g<h;g++)v+="\n          vec4 xTexelR"+m+"C"+2*g+" = vec4(0.);\n          vec4 wR"+m+"C"+g+" = vec4(0.);\n          vec4 xR"+m+"C"+g+" = vec4(0.);";for(m=0;m<p;m++)for(var y=0;y<d;y++){if(v+="\n          xR = xRCorner + "+m*l+";\n          xC = xCCorner + "+(g=2*y)*f+";\n        ",1===c){if(g<h&&(v+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    xTexelR"+m+"C"+g+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+".xy);\n                } else {\n                  xR"+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = xTexelR"+m+"C"+g+";\n              ",g+1<h)){var b=s%2==0?E(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(v+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",f>1&&(v+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+g+" = vec4(0.);\n                    }\n                  "),v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".xy);\n                "):v+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+";\n                "}}else g<h&&(v+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(v+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n              ",g+1<h&&(v+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+".xy, final.xy);\n                ")):(v+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+".xy);\n              ",g+1<h&&(v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n                ")),v+="}");g<h&&(v+="\n            vec4 wTexelR"+m+"C"+g+" = getW("+m+", "+g+", d1, q);\n            wR"+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+".xz);\n          ",g+1<h&&(v+="\n              vec4 wTexelR"+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+", d1, q);\n              wR"+m+"C"+(g+1)+" =\n                vec4(wTexelR"+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<p;m++)for(g=0;g<h;g++)v+="dotProd += xR"+m+"C"+g+" * wR"+m+"C"+g+";";var x="",w="";n&&(x=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var A=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+v+"\n\n        vec4 result = dotProd;\n        "+A+"\n        "+w+"\n        setOutput(result);\n      }\n    "},pa=function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],i=e[1],s=e[2],u=e[3],c=t[0],l=n[0],f=n[1];this.outputShape=[c,l,f,u];var p="bilinear"===r?1:0,h=[i-1+".0",s-1+".0"],d=h[0],v=h[1],m=l>1?[""+(i-1)/(l-1),"(y2-y1) * height_ratio","y1*"+d+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+d],g=m[0],y=m[1],b=m[2],x=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],w=x[0],E=x[1],A=x[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+E+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+d+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+A+";\n        if( in_x < 0.0 || in_x > "+v+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+p+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},ha=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+ko(r)+" coords = getOutputCoords();\n        int end = "+da(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+da(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function da(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var va=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Le.DENSE;var t=je(e),n=wo();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Eo(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},ma=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Le.DENSE;var t=je(e),n=wo();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Eo(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},ga=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),ya=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},ba=function(e){this.variableNames=["A"],this.outTexUsage=Ue.DOWNLOAD;var t=wo();this.outputShape=e,this.userCode="\n      "+Co+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},xa=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ue.DOWNLOAD;var t=wo();this.outputShape=e,this.userCode="\n      "+Co+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},wa=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=wo(),o=t[0],a=t[1];this.outputShape=e;var i="result";n&&(i="floor(result * 255. + 0.5)"),this.userCode="\n      "+Ao(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+i+", 0., 0., 0.);\n      }\n    "},Ea=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=wo(),o=t[0],a=t[1];this.outputShape=e;var i="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;i+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+e[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Ao(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+i+"\n\n        "+r.output+" = "+s+";\n      }\n    "},Aa=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Ca=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),Sa=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=ko(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=0;a<e.length;a++)a===t?o.push("int(getIndices("+r[a]+"))"):o.push(""+r[a]);return o.join()}(e,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},_a=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=ko(t.length),o=ko(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Ia(e,t){var n=wo();return Qe(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Ra(e,t){return it(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Ta(e,t){return st(e,t,new Uint16Array([0,1,2,2,1,3]))}function Pa(e,t,n,r,o,a,i){ct(n,r);var s=ut(e,t),u=e.TEXTURE_2D;return Ke(e,t,(function(){return e.bindTexture(u,s)})),Ke(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),Ke(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),Ke(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)})),Ke(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)})),Ke(e,t,(function(){return e.texImage2D(u,0,o,n,r,0,a,i,null)})),Ke(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function Na(e,t,n,r,o){var a=He(n,r);return Pa(e,t,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function Oa(e,t,n,r,o){var a=He(n,r);return Pa(e,t,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function Da(e,t,n,r,o){var a=He(n,r);return Pa(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function ka(e,t,n,r,o){var a=ze(n,r);return Pa(e,t,a[0],a[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function Fa(e,t,n,r,o){var a=ze(n,r);return Pa(e,t,a[0],a[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function Ma(e,t,n,r){return Ke(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),ft(e,t,n,"clipSpacePos",r,3,20,0)&&ft(e,t,n,"uv",r,2,20,12)}function La(e,t,n,r,o,a,i){var s,u,c;Ke(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),a instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=e.UNSIGNED_BYTE,c=e.RGBA):(s=new Float32Array(r*o*4),u=e.FLOAT,c=i.internalFormatPackedFloat),s.set(a),Ke(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,c,r,o,0,e.RGBA,u,s)})),Ke(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function Ua(e,t,n,r){Ke(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),r.data instanceof Uint8Array?Ke(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):Ke(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),Ke(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function Ba(e,t,n,r,o){var a=e.createBuffer();Ke(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*n*r;return Ke(e,t,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),Ke(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)})),Ke(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}function Ga(e,t,n){var r=e,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function Wa(e,t,n,r,o){var a=He(n,r),i=a[0],s=a[1],u=new Uint8Array(n*r*4);return Ke(e,t,(function(){return e.readPixels(0,0,i,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function Va(e,t,n,r,o,a,i,s){var u=e,c=new Float32Array(function(e,t){var n=ze(e,t);return n[0]*n[1]*4}(a,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function $a(e,t,n,r){var o=new Float32Array(n*r*4);return Ke(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,o)})),o}var Ha=Object.freeze({createVertexShader:Ia,createVertexBuffer:Ra,createIndexBuffer:Ta,createFloat32MatrixTexture:Na,createFloat16MatrixTexture:Oa,createUnsignedBytesMatrixTexture:Da,createPackedMatrixTexture:ka,createFloat16PackedMatrixTexture:Fa,bindVertexProgramAttributeStreams:Ma,uploadDenseMatrixToTexture:La,uploadPixelDataToTexture:Ua,createBufferFromOutputTexture:Ba,downloadFloat32MatrixFromBuffer:Ga,downloadByteEncodedFloatMatrixFromOutputTexture:Wa,downloadPackedMatrixFromBuffer:Va,downloadMatrixFromPackedOutputTexture:$a}),ja=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=f().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,Ve(t,e)):this.gl=$e(t);var n="WEBGL_color_buffer_float";if(1===f().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=Ze(this.gl,this.debug,"OES_texture_float"),Nt(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Ze(this.gl,this.debug,"OES_texture_half_float");else if(f().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Nt(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Ze(this.gl,this.debug,"EXT_color_buffer_half_float");else if(f().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Nt(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Nt(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Ra(this.gl,this.debug),this.indexBuffer=Ta(this.gl,this.debug),this.framebuffer=lt(this.gl,this.debug),this.textureConfig=qe(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return f().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Ke(t,this.debug,(function(){return t.finish()})),Ke(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Ke(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),Ke(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Ke(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Ke(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Na(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Oa(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Da(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Ua(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),La(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Fa(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),ka(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(gt(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Ke(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return Wa(r.gl,r.debug,t,n,r.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,o,a){return Va(this.gl,e,0,0,0,o,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Ga(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=Ba(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(f().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=o.clientWaitSync(a,0,0);return e===o.ALREADY_SIGNALED||e===o.CONDITION_SATISFIED},t=a}else f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return $a(r.gl,r.debug,t,n)}))},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=Je(t,this.debug,e),r=Ia(t,this.debug),o=rt(t,this.debug);return Ke(t,this.debug,(function(){return t.attachShader(o,r)})),Ke(t,this.debug,(function(){return t.attachShader(o,n)})),ot(t,this.debug,o),this.debug&&at(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=Ma(t,this.debug,this.program,this.vertexBuffer)),o},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Ke(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&at(this.gl,this.debug,this.program),Ke(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?ht(this.gl,this.debug,e,t):dt(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Ke(this.gl,this.debug,(function(){return n.gl.getAttribLocation(e,t)}))},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),vt(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=ze(t,n),o=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,o,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&at(this.gl,this.debug,this.program),yt(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Ke(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Ke(this.gl,this.debug,(function(){return e.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Ze(this.gl,this.debug,2===f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},e.prototype.endQuery=function(){if(2!==f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return s(this,void 0,void 0,(function(){var t=this;return u(this,(function(n){switch(n.label){case 0:return[4,k((function(){return t.disposed||t.isQueryAvailable(e,f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(e,f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||k((function(){return n.pollItems(),0===n.itemsToPoll.length}))},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),mt(this.gl,this.debug,e,this.framebuffer),this.debug&&yt(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(mt(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&yt(this.gl)):gt(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;mt(r,this.debug,e,this.framebuffer),this.debug&&yt(r),this.outputTexture=e,Ke(r,this.debug,(function(){return r.viewport(0,0,t,n)})),Ke(r,this.debug,(function(){return r.scissor(0,0,t,n)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var o=this;this.throwIfDisposed(),Ke(this.gl,this.debug,(function(){return o.gl.scissor(e,t,n,r)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function za(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach((function(e,n){var r=e.logicalShape,o=t[n],a=o.shape;if(!T(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!o.isUniform){var i=e.texShape,s=o.isUniform?null:o.texData.texShape;if(!T(i,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+i+" and "+s+" must match")}}))}var qa=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,o=n.inChannels,a=n.strideWidth,i=n.strideHeight,s=n.padInfo,u=n.outWidth,c=n.dilationWidth,l=n.dilationHeight,f=n.dataFormat,p=s.left,h=s.top,d=o*r,v=wo(),m="channelsLast"===f,g=m?0:1,y=m?1:2,b="",x=0;x<=1;x++)for(var w=0;w<=1;w++)b+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+x+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+i+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+d+");\n\n            if(d0 < "+t[g]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+p+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+d+".) / "+o+".));\n\n              if(d1 < "+t[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+m+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+v.output+" = result;\n      }\n    "},Ka=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},Xa=function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Ya=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+i+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+i+"; j <= "+i+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "},Za=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,a=e.effectiveFilterWidth,i=o-1-e.padInfo.top,s=a-1-e.padInfo.left,u=o*a-1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Qa=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=s-1-e.padInfo.front,f=u-1-e.padInfo.top,p=c-1-e.padInfo.left,h=s*u*c-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+f+", "+p+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+o+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+i+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+h+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ja=function(e,t,n,r,o,a,i){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=null),void 0===i&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),c=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",f=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",d="";a&&(h=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",d="result = activation(result);");var v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+f[0]+" * "+p[0]+");\n          result += ("+f[1]+" * "+p[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+v+"\n\n        "+d+"\n\n        setOutput(result);\n      }\n    "},ei=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),ti=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},ni=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=xo("rc",t),r=ko(t),o=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",o=e-2;o<e;o++)r+=n[o]+" >= "+t[o],o<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),i=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var a=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),i=2;i<e;i++)a=t[t.length-1-i]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}},ri=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,o=ko(r),a=t.map((function(e){return e[0]})).join(","),i=t.map((function(t,n){return t[0]+e[n]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+i+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},oi=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));for(var r=e.length,o=ko(r),a=t.map((function(e){return e[0]})).join(","),i=t.map((function(t,n){return t[0]+e[n]})).join(","),s=xo("rc",r),u=xo("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],p=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",d=0,v=1===r?2:4;d<v;d++)h+="\n        "+f[d]+"\n        if ("+p+") {\n          result["+d+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+d+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";h+=1===r?"} ":"}}",this.userCode="\n      const "+o+" start = "+o+"("+a+");\n      const "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+h+"\n        setOutput(result);\n      }\n    "},ai=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;var p="avg"===t,h="0.0";if(p||(h="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+a+");\n        const ivec2 pads = ivec2("+l+", "+f+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+i+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var d=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(d="avgValue / count");var v=4*Math.floor(r/4),m=r%4,g="\n      if ("+p+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+l+", "+f+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+i+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+v+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+v+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+d+");\n      }\n    "}},ii=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,h=e.padInfo.front,d=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;var m="avg"===t,g="0.0";if(m||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+a+", "+i+");\n        const ivec3 pads = ivec3("+h+", "+d+", "+v+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+f+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+p+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+f+" * "+p+" +\n                      wR * "+p+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var b=4*Math.floor(r/4),x=r%4,w="\n      if ("+m+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+h+", "+d+", "+v+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},si=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=Math.ceil(o/n);this.outputShape=[r,a];var i="0.0",s="";"prod"===t?i="1.0":"min"===t?(i="1.0 / 1e-20",s="min"):"max"===t&&(i="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,f="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",p="vec4";"all"===t?(i="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"===t&&(i="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");var h="";o%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+i+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+i+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===l)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===l)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "},ui=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Eo(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Ao(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},ci=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],c=[n&&s>1?o-1:o,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=c[0]/l[0],p=c[1]/l[1],h=1/f,d=1/p,v=2*Math.ceil(h)+2,m=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},li=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},fi=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},pi=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],c=[n&&s>1?o-1:o,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=c[0]/l[0],p=c[1]/l[1],h=1/f,d=1/p,v=2*Math.ceil(h)+2,m=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},hi=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},di=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map((function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),o=ko(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},vi=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=xo("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],i=ko(n);function s(n){var r=e.map((function(r,o){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+i+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+o+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},mi=function(e,t,n,r,o,a,i){void 0===i&&(i=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=ko(o.length),u=ko(a.length),c="";1===n?c="i":2===n&&(c="i, j");var l="getIndices("+c+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var p="getUpdates("+f+")",h=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+h+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+p+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},gi=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=e.numSegments,i=a*Math.ceil(o/n);this.outputShape=[r,i];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";o%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},yi=function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&i.push(""+a[u]);r=i.join(),o=s.join()}var c=ko(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},bi=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=ko(this.rank),r="uniform int start["+this.rank+"];",o=function(e){if(1===e)return"sourceLoc";if(e<=6)return xi.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map((function(e,t){return"sourceLoc."+xi[t]+" = start["+t+"] + coords."+xi[t]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+o+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),xi=["x","y","z","w","u","v"],wi=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=ko(this.rank),n=xo("coords",this.rank),r=xo("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+o+")",i="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map((function(e,t){return"start["+t+"]"})).join()+");":e.map((function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+i+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Ei=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=ko(n.length),a=ko(n.length),i="";if(1===r)i="coords * strides + begin";else{var s=0;i=n.map((function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"})).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+e+");\n      "+o+" strides = "+o+"("+t+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+i+"));\n      }\n    "},Ai=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,o=Ci(t,n),a=Si(e,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var i=this.freeTextures[a].shift();return this.usedTextures[a].push(i),i}return this.numUsedTextures++,this.log(),o===Be.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Be.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Be.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Be.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Be.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var o=Si(t,Ci(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],i=a.indexOf(e);if(i<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(i,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function Ci(e,t){if(e===Ue.UPLOAD)return Be.PACKED_2X2_FLOAT32;if(e===Ue.RENDER||null==e)return function(e){return f().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Be.PACKED_2X2_FLOAT32:Be.UNPACKED_FLOAT32:e?Be.PACKED_2X2_FLOAT16:Be.UNPACKED_FLOAT16}(t);if(e===Ue.DOWNLOAD||e===Ue.PIXELS)return Be.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function Si(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var _i=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=ko(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<e.length;o++)r.push("imod("+n[o]+", "+e[o]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},Ii=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=ko(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),o=0;o<e.length;o++)r[e[o]]=n[o];return r.join()}(t);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},Ri=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=ko(this.rank),a=bo("rc",this.rank),i=new Array(this.rank);for(r=0;r<t.length;r++)i[t[r]]=a[r];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+i.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Ti=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Pi="if (isnan(x)) return x;",Ni="return abs(x);",Oi=Pi+"\n  return (x < 0.0) ? 0.0 : x;\n",Di=Pi+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",ki="return (x >= 0.0) ? x : (exp(x) - 1.0);",Fi="return -x;",Mi="return ceil(x);",Li="return floor(x);",Ui="return exp(x);",Bi="return exp(x) - 1.0;",Gi="return x;",Wi="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Vi="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",$i="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Hi=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},ji=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=xo("rc",t),r=ko(t),o=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),i=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+i+"));\n      }\n    "},zi={};function qi(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?Wi:Oi;if("elu"===e)return t?$i:ki;if("relu6"===e)return t?Vi:Di;if("prelu"===e)return t?Ko:zo;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var Ki=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!f().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var o=$e(f().getNumber("WEBGL_VERSION"));r.binaryCache=((n=f().getNumber("WEBGL_VERSION"))in zi||(zi[n]={}),zi[n]),r.gpgpu=new ja(o),r.canvas=o.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new Ai(r.gpgpu),r.numMBBeforeWarning=null==f().global.screen?1024:f().global.screen.height*f().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new Or(r,ke),r}return i(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(f().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Ue.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(f().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Ue.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,o=t.complexTensors,a=t.slice,i=t.shape,s=t.isPacked;if(null!=a){var u;u=s?new Hi(i,Gi):new Ti(i,Gi);var c=this.runWebGLProgram(u,[{dataId:e,shape:i,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeData(c.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var f,p,h=null!=this.activeTimers;return h&&(f=re()),p="complex64"===r?Jr(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(e),h&&(this.downloadWaitMs+=re()-f),this.convertAndCacheOnCPU(e,p)},t.prototype.read=function(e){return s(this,void 0,void 0,(function(){var t,n,r,o,a,i,s,c,l,p,h,d,v,m,g,y,b,x,w,E,A,C;return u(this,(function(u){switch(u.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise((function(e){return t.push(e)}))];if(n=this.texData.get(e),r=n.values,o=n.shape,a=n.slice,i=n.dtype,s=n.complexTensors,c=n.isPacked,null!=a)return l=c?new Hi(o,Gi):new Ti(o,Gi),p=this.runWebGLProgram(l,[{dataId:e,shape:o,dtype:i}],i),h=this.read(p.dataId),this.disposeData(p.dataId),[2,h];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!f().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===f().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,"complex64"!==i&&f().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(e),m=this.texData.get(v.dataId),d=(C=this.gpgpu).createBufferFromTexture.apply(C,[m.texture].concat(je(o)))),this.pendingRead.set(e,[]),"complex64"===i?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:u.sent(),u.label=2;case 2:return"complex64"!==i?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return y=u.sent(),b=y[0],x=y[1],g=Jr(b,x),[3,5];case 4:null==d?g=this.getValuesFromTexture(e):(w=R(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,w)),u.label=5;case 5:return null!=v&&this.disposeData(v.dataId),E=this.convertAndCacheOnCPU(e,g),A=this.pendingRead.get(e),this.pendingRead.delete(e),A.forEach((function(e){return e(E)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,E]}}))}))},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!Xe(n)){if(f().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,a=n.isPacked,i=R(r);if(f().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),u=this.texData.get(s.dataId),c=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(je(r))).subarray(0,i);return this.disposeData(s.dataId),c}var l=f().getBool("WEBGL_PACK")&&!0===a,p=l?Ct(r):r,h=l?new xa(p):new ba(p),d=this.runWebGLProgram(h,[{shape:p,dtype:o,dataId:e}],"float32"),v=this.texData.get(d.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,i);return this.disposeData(d.dataId),m},t.prototype.time=function(e){return s(this,void 0,void 0,(function(){var t,n,r,o,a,i,s;return u(this,(function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),o=I(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),a=I(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=t,r&&(this.programTimersStack=null),i={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return s=u.sent(),i.kernelMs=A(s),i.getExtraProfileInfo=function(){return s.map((function(e,t){return{name:a[t],ms:e}})).map((function(e){return e.name+": "+e.ms})).join(", ")},[3,3];case 2:i.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,i]}}))}))},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:re(),endMs:null}},t.prototype.endTimer=function(e){return f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=re(),e)},t.prototype.getQueryTime=function(e){return s(this,void 0,void 0,(function(){var t;return u(this,(function(n){return f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]}))}))},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,o=t.texShape,a=t.usage,i=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(n,o,a,i)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return f().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=ke.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every((function(e){return null==n.texData.get(e.dataId).texture&&e.size<t}))},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:ke.keep(e.clone()),imag:ke.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===R(n))return un([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,o=Ir(e.shape,t,n);if(r||!o){var a=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wi(n):new bi(n),i=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,i)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),o=this.makeOutput(n,e.dtype),a=this.texData.get(o.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var i=Rr(t,e.strides);r.slice&&(i+=r.slice.flatOffset),a.slice={flatOffset:i,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),o},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var o=Cr(t,n,r);if(o.some((function(e){return 0===e})))return un([],o);var a=new Ei(t,r,o);return this.compileAndRun(a,[e])},t.prototype.reverse=function(e,t){var n=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vi(e.shape,t):new di(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map((function(e){return an(e)})),r=e.map((function(e){return sn(e)}));return on(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>f().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(e.length/2),a=this.concat(e.slice(0,o),t),i=this.concat(e.slice(o),t);return this.concat([a,i],t)}if(f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new ea(e.map((function(e){return e.shape})),t);return this.compileAndRun(s,e)}var u=nn(e.map((function(e){return e.shape})),t),c=e.map((function(e){return e.as2D(-1,R(e.shape.slice(t)))})),l=new Jo(c.map((function(e){return e.shape})));return this.compileAndRun(l,c).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Fi,e.dtype);var t=new Ti(e.shape,Fi);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var o=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],i=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===o||1===a)&&i>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var u=1===a?e:e.as3D(s,i,1),c=1===a?2:1,l=1===a?t.as3D(s,1,i):t;return this.multiply(u,l).sum(c,!0)}var f=_e(e.dtype,t.dtype),p=new Ja(e.shape,[s,o,a],n,r);return this.compileAndRun(p,[e,t],f)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,o=e.transposeB,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],c=o?n.shape[1]:n.shape[2],l=t.shape[0],f=_e(t.dtype,n.dtype),p=null!=a,h=null!=s,d=i?qi(i,!0):null,v=new Ja(t.shape,[l,u,c],r,o,p,d,h),m=[t,n];return a&&m.push(a),s&&m.push(s),this.compileAndRun(v,m,f)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),o=new Vo("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new Vo("return areal * bimag + aimag * breal;",e.shape,t.shape),i=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(o,i),u=this.compileAndRun(a,i),c=this.complex(s,u);return s.dispose(),u.dispose(),c}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,jo,e.dtype);var l=new qo(jo,e.shape,t.shape);return this.compileAndRun(l,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,o,a){var i=[e,t,n],s=null;null!=a&&(s=a.shape,i.push(a));var u=null;if(null!=o&&(u=o.shape,i.push(o)),f().getBool("WEBGL_PACK_NORMALIZATION")){var c=new Wo(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,i)}var l=new Go(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,i)},t.prototype.localResponseNormalization4D=function(e,t,n,r,o){var a=f().getBool("WEBGL_PACK_NORMALIZATION")?new Ya(e.shape,t,n,r,o):new Ka(e.shape,t,n,r,o);return this.compileAndRun(a,[e])},t.prototype.LRNGrad=function(e,t,n,r,o,a,i){var s=new Xa(t.shape,r,o,a,i);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map((function(e){return ie(e)}));return po(Bn(e.shape,e.dtype,n),t)}var r=new _i(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new oi(e.shape,t,n):new ri(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ri(e.shape,t):new Ii(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new Sa(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){C(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),o=pr(e.shape,t,r),a=hr(o.length,t.length),i=dr(e.shape,t,r),s=vr(n,t.length),u=mr(i,n,t.length);return e.reshape(o).transpose(a).reshape(i).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){C(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=pr(i.shape,t,r,!1),u=hr(s.length,t.length,!1),c=dr(i.shape,t,r,!1);return i.reshape(s).transpose(u).reshape(c)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],o=e.shape[1],a=yr(o),i=new si({windowSize:a,inSize:o,batchSize:r},t),s=this.compileAndRun(i,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],o=e.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var a=yr(o),i=new yo({windowSize:a,inSize:o,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var u=this.compileAndRun(i,s,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,o=yr(r[r.length-1]),a=new Lo(r,o,t,null==n),i=null==n?[e]:[e,n],s=this.compileAndRun(a,i,"int32");return s.rank===e.rank?this.argReducePacked(e,t,s):s},t.prototype.sum=function(e,t){Zt("sum",t,e.rank);var n=Xt(e.shape,t),r=n[0],o=R(n[1]),a=e.as2D(-1,o),i=Ie(e.dtype);return this.reduce(a,"sum",i).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=Xt(e.shape,t),r=n[0],o=R(n[1]),a=e.as2D(-1,o),i=Ie(e.dtype);return this.reduce(a,"prod",i).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,o=Qt([r],e.rank),a=e;null!=o&&(a=e.transpose(o),r=en(1,e.rank)[0]);var i=function(e,t,n){for(var r=[],o=e.length,a=0;a<o;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=R([a.shape[r]]),u=a.as2D(-1,s),c=Ie(e.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",t,c,n).reshape(i);return null!=o&&(l=l.transpose(Jt(o))),l},t.prototype.segOpCompute=function(e,t,n,r,o){var a=e.shape[0],i=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=Z(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Z(e,n+1);return n}(i,o),u=new gi({windowSize:s,inSize:i,batchSize:a,numSegments:o},t),c=this.compileAndRun(u,[e,n],r);return c.shape[1]===o?c:(n=yn(0,o).tile([i/s]),this.segOpCompute(c,t,n,r,o))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(Zt("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!f().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var o=Xt(e.shape,r),a=o[0],i=R(o[1]),s=e.as2D(-1,i);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new ha(e.shape,n,r);return this.compileAndRun(o,[e])},t.prototype.equal=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new qo("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new qo("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new qo("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new qo("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new qo("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new qo("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new Ti(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new qo("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new qo("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new yi(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],_e(t.dtype,n.dtype))},t.prototype.where=function(e){Vt("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return vo(e.shape,t)},t.prototype.topk=function(e,t,n){return ho(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){Zt("min",t,e.rank);var n=Xt(e.shape,t),r=n[0],o=R(n[1]),a=e.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new qo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new qo("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);Zt("max",t,e.rank);var n=Xt(e.shape,t),r=n[0],o=R(n[1]),a=e.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new qo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){Zt("all",t,e.rank);var n=Xt(e.shape,t),r=n[0],o=R(n[1]),a=e.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(r)},t.prototype.any=function(e,t){Zt("any",t,e.rank);var n=Xt(e.shape,t),r=n[0],o=R(n[1]),a=e.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(r)},t.prototype.realDivide=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new qo("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return this.compileAndRun(n,[e,t],"float32")},t.prototype.floorDiv=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new qo("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,$o);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=_e(e.dtype,t.dtype);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,$o,n);var r=new qo($o,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new Hi(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,o){void 0===o&&(o=!1);var a=new Xo(n,e.shape,t.shape,o);return this.compileAndRun(a,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,o=this.texData.get(e.dataId),a=this.texData.get(t.dataId),i=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map((function(o){var a=o[0],i=o[1],s=r.makeComplexComponentTensorInfo(e,a),u=r.makeComplexComponentTensorInfo(t,i),c=new qo(n,e.shape,t.shape);return r.compileAndRun(c,[s,u],_e(a.dtype,i.dtype))})),s=i[0],u=i[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>f().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var o=e.map((function(e){return e.dtype})).reduce((function(e,t){return _e(e,t)})),a=e.map((function(e){return e.shape})),i=f().getBool("WEBGL_PACK")?new go(e[0].shape,a):new mo(e[0].shape,a);return this.compileAndRun(i,e,o)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Ho);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=_e(e.dtype,t.dtype);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Ho,e.dtype);var r=new qo(Ho,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new qo("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=_e(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Mi,e.dtype);var t=new Ti(e.shape,Mi);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Li,e.dtype);var t=new Ti(e.shape,Li);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new Ti(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new Ti(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new Ti(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new Ti(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new Ti(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ui,e.dtype);var t=new Ti(e.shape,Ui);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Bi,e.dtype);var t=new Ti(e.shape,Bi);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=M([t],e.shape),r=this.max(e,n),o=Yt(r.shape,n),a=this.subtract(e,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return this.realDivide(i,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new Ti(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new Ti(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new Ti(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new Ti(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new Ti(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=f().getBool("WEBGL_PACK")?new Hi(e.shape,Wi):new Ti(e.shape,Oi),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=f().getBool("WEBGL_PACK")?new Hi(e.shape,Vi):new Ti(e.shape,Di),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo(Ko,e.shape,t.shape):new qo(zo,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,$i,e.dtype);var t=new Ti(e.shape,ki);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new qo("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new Ti(e.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new Ti(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,o=(r=f().getBool("WEBGL_PACK_CLIP")?new Zo(e.shape):new Yo(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,o)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ni,e.dtype);var t=new Ti(e.shape,Ni);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new Qo(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new Ti(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new Ti(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new Ti(e.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new Ti(e.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new Ti(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new Ti(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new Ti(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new Ti(e.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new qo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new Ti(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new Ti(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new Ti(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new Ti(e.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new Ti(e.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new Ti(e.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new Ti(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new Ti(e.shape,function(e){return void 0===e&&(e=0),Pi+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,o,a){var i=e.shape,s=this.texData.get(e.dataId),u=n.inChannels,c=i[0]*i[1]*i[2],l=n.outChannels,p="channelsLast"===n.dataFormat,h=(1===c||1===l)&&u>1e3,d=i[2]%2!=0&&!!s.isPacked;if(h||!f().getBool("WEBGL_LAZILY_UNPACK")||!f().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!d){var v=p?i[0]*i[1]*i[2]:i[0]*i[2]*i[3],m=this.reshape(e,[1,v,n.inChannels]),g=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:g,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),n.outShape)}var y=p?i[0]*i[1]*(i[2]+1):i[0]*i[2]*(i[3]+1),b={dataId:e.dataId,shape:[1,y,n.inChannels],dtype:e.dtype},x=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,C(It(s.shape,b.shape),(function(){return"packed reshape "+s.shape+" to "+b.shape+" isn't free"}));var w=this.reshape(t,[1,n.inChannels,n.outChannels]),E=this.fusedBatchMatMul({a:b,b:w,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),A=this.texData.get(E.dataId);return C(A.isPacked,(function(){return"batchMatMul result is expected to be packed"})),s.shape=x,A.shape=n.outShape,ke.makeTensorFromDataId(E.dataId,n.outShape,E.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,o,a){var i=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,f="channelsLast"===n.dataFormat,p=i*s*u,h=l*c,d=[p,h],v=e.squeeze([0]),m=t.reshape([1,p,-1]),g=new qa(d,v.shape,n),y=this.compileAndRun(g,[v]).reshape([1,d[0],d[1]]),b=null!=r,x=null!=a,w=o?qi(o,!0):null,E=new Ja(y.shape,[1,h,n.outChannels],!0,!1,b,w,x),A=[y,m];r&&A.push(r),x&&A.push(a);var C=this.compileAndRun(E,A);return f?C.reshape([1,l,c,n.outChannels]):C.reshape([1,n.outChannels,l,c])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,o,a,i);if(f().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,o,a,i);var s=null!=o,u=null!=i,c=a?qi(a,!1):null,l=new ua(r,s,c,u),p=[t,n];return o&&p.push(o),i&&p.push(i),this.compileAndRun(l,p)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(f().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new ua(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new ra(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new na(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,o=e.convInfo,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=f().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,c=i?qi(i,u):null,l=[n,r],p=null!=a,h=null!=s;return p&&l.push(a),h&&l.push(s),u?(t=new fa(o,p,c,h),this.compileAndRun(t,l)):(t=new la(o,p,c,h),this.compileAndRun(t,l))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return f().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new fa(n),this.compileAndRun(r,[e,t])):(r=new la(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new sa(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new ia(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new ca(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new aa(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new oa(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new ai(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new ai(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var o=new ai(r,"max",!0),a=this.compileAndRun(o,[t]),i=new Za(r),s=this.compileAndRun(i,[e,a],t.dtype);return a.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new Uo(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return Yr(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},t.prototype.avgPool3d=function(e,t){var n=new ii(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new Bo(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new ii(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var o=new ii(r,"max",!0),a=this.compileAndRun(o,[t]),i=new Qa(r),s=this.compileAndRun(i,[e,a],t.dtype);return a.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!It(e.shape,t)&&(null===n.texture||!It(n.shape,t))){var r=this.packedReshape(e,t);return ke.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return Zr(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var o=f().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new fi(e.shape,t,n,r):new li(e.shape,t,n,r);return this.compileAndRun(o,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new ci(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var o=new hi(e.shape,t,n,r);return this.compileAndRun(o,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new pi(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var o=t?e:Pr(e),a=o.shape[0],i=o.shape[1],s=new ei(a,i,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[o],"int32",u)},t.prototype.oneHot=function(e,t,n,r){var o=new ti(e.size,t,n,r);return this.compileAndRun(o,[e])},t.prototype.diag=function(e){var t=new ya(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,o){return Vt("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),ao(e.dataSync(),t.dataSync(),n,r,o)},t.prototype.cropAndResize=function(e,t,n,r,o,a){var i=new pa(e.shape,t.shape,r,o,a);return this.compileAndRun(i,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){C(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var r=e.shape[0],o="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],i="NHWC"===n?e.shape[3]:e.shape[1],s=o*t,u=a*t,c=i/(t*t),l=new ga("NHWC"===n?[r,s,u,c]:[r,c,s,u],t,n);return this.compileAndRun(l,[e])},t.prototype.split=function(e,t,n){return fo(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=wr(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/i,i],l=e.reshape([a,o]),f=t.reshape([a,i]);if(0===u)return Zr(un([]),n);var p=ln(0),h=new mi(a,o,l.rank,f.rank,s,c);return this.compileAndRun(h,[f,l,p]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var o=wr(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.strides,u=o.outputSize,c=new mi(i,a,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(c,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new Aa("return real * expR - imag * expI;",e.shape,t),o=new Aa("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],i=this.compileAndRun(r,a),s=this.compileAndRun(o,a),u=this.complex(i,s).as2D(e.shape[0],e.shape[1]);return i.dispose(),s.dispose(),u},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=gr(e,t),a=o[0],i=o[1],s=o[2],u=o[3],c=t.reshape([i,r]),l=e.reshape([e.size/s,s]),f=new _a(r,u,[i,s]);return this.compileAndRun(f,[l,c]).reshape(a)},t.prototype.fill=function(e,t,n){if("string"===(n=n||X(t))){var r=B(n,R(e));return r.fill(t),ke.makeTensor(r,e,n,this)}var o=new Ca(e,t),a=o.getCustomSetupFunc(t);return this.compileAndRun(o,[],n,a)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return Qr(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return ke.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new ji(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new ni(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[Et(e.shape)].concat(At(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},o=[Et(t)].concat(At(t)),a=new ui(o,n),i=this.runWebGLProgram(a,[r],e.dtype,null,!0);return{dataId:i.dataId,shape:t,dtype:i.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,o=n.shape,a=n.dtype,i=Ct(o);return t=r?new ma(i):new va(i),{dtype:a,shape:o,dataId:this.runWebGLProgram(t,[{shape:i,dtype:a,dataId:e}],a,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,o){var a=this;void 0===o&&(o=!1);var i=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(i.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===Le.DENSE){var u=je(e.outputShape);s.texShape=u.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===R(i.shape))return s.values=U(i.dtype,0),i;var c=[],l=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&R(t.shape)<=f().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),c.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!It(n.shape,t.shape)){var r=t,o=t.shape;t.shape=n.shape,t=a.packedReshape(t,o),c.push(t),n=a.texData.get(t.dataId),r.shape=o}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(i.dataId);var p,h={shape:i.shape,texData:s,isUniform:!1},d=function(e,t,n){var r="";t.concat(n).forEach((function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t}));var o=e.userCode;return e.constructor.name+"_"+r+"_"+o}(e,l,h),v=this.getAndSaveBinary(d,(function(){return function(e,t,n,r){var o=t.userCode,a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((function(e){return e.shapeInfo})),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=So(a,s,o,t.packedInputs),c=e.createProgram(u),l=null,p=e.getUniformLocation(c,"NAN",!1);1===f().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(c,"INFINITY",!1));for(var h={},d=0;d<t.variableNames.length;d++){var v=t.variableNames[d];h[v]=e.getUniformLocation(c,v,!1),h["offset"+v]=e.getUniformLocation(c,"offset"+v,!1)}return{program:t,source:u,webGLProgram:c,uniformLocations:h,inShapeInfos:i,outShapeInfo:s,infLoc:l,nanLoc:p}}(a.gpgpu,e,l,h)})),m=null!=this.activeTimers;if(m&&(p=this.startTimer()),function(e,t,n,r,o){za(t.inShapeInfos,n),za([t.outShapeInfo],[r]);var a=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,i[0],i[1]):e.setOutputMatrixTexture(a,i[0],i[1]),e.setProgram(t.webGLProgram),1===f().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var o=t.program.variableNames[r],a=t.uniformLocations[o],i=t.uniformLocations["offset"+o];if(null!=a)if(n.isUniform)if(R(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=i&&e.gl.uniform1i(i,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)})),null!=o&&o(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,v,l,h,r),c.forEach((function(e){return a.disposeData(e.dataId)})),m&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)})),!f().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===o){var g=this.unpackTensor(i);return this.disposeData(i.dataId),g}return i},t.prototype.compileAndRun=function(e,t,n,r,o){void 0===o&&(o=!1),n=n||t[0].dtype;var a=this.runWebGLProgram(e,t,n,r,o);return ke.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(f().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Gt((function(){if(!f().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=f().getBool("DEBUG");f().set("DEBUG",!1);var n=e.abs(ln(1e-8)).dataSync()[0];if(f().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,a=n.values,i=n.texture,s=n.usage,u=n.isPacked;if(null==i){var c,l=null!=this.activeTimers;l&&(c=re());var f=n.texShape;if(null==f&&(f=St(r,u),n.texShape=f),null!=a){var p=Ct(r),h=void 0,d=f[1],v=f[0],m=a instanceof Uint8Array;u?(d=(t=ze(f[0],f[1]))[0],v=t[1],h=new Ea(p,[v,d],m)):h=new wa(p,[v,d],m);var g=this.makeTensorInfo([v,d],o);this.texData.get(g.dataId).usage=m?Ue.PIXELS:Ue.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(g.dataId),d,v,a);var y=this.runWebGLProgram(h,[g],o,null,!0),b=this.texData.get(y.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(g.dataId),this.texData.delete(y.dataId),n.values=null,l&&(this.uploadWaitMs+=re()-c)}else{var x=this.acquireTexture(f,s,o,u);n.texture=x}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*H(t)},t}(Dr);Fe()&&ke.registerBackend("webgl",(function(){return new Ki}),2);var Xi=rn({square_:function(e){var t=jt(e,"x","square"),n=[t];return ke.runKernelFunc((function(e,n){return n([t]),e.square(t)}),{x:t},null,"Square",{},n,[])}}),Yi="SquaredDifference",Zi=rn({squaredDifference_:function(e,t){var n,r=jt(e,"a","squaredDifference"),o=jt(t,"b","squaredDifference");n=Re(r,o),r=n[0],o=n[1],Lr(r.shape,o.shape);var a={a:r,b:o},i=[r,o];return ke.runKernelFunc((function(e,t){var n=e.squaredDifference(r,o);return t([r,o]),n}),a,(function(e,t){var n=t[0],r=t[1],o=ln(2);return{a:function(){return e.mul(n.sub(r).mul(o))},b:function(){return e.mul(r.sub(n).mul(o))}}}),Yi,{},i,[])}}),Qi=rn({abs_:function(e){var t=jt(e,"x","abs");return"complex64"===t.dtype?ke.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):ke.runKernelFunc((function(e,n){var r=e.abs(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}}),"Abs")}}),Ji=rn({acos_:function(e){var t=jt(e,"x","acos");return ke.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(ln(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),es=rn({acosh_:function(e){var t=jt(e,"x","acosh");return ke.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),ts=rn({asin_:function(e){var t=jt(e,"x","asin");return ke.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(ln(1).sub(n.toFloat().square()).sqrt())}}}))}}),ns=rn({asinh_:function(e){var t=jt(e,"x","asinh");return ke.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(ln(1).add(n.toFloat().square()).sqrt())}}}))}}),rs=rn({atan_:function(e){var t=jt(e,"x","atan");return ke.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),os=rn({atanh_:function(e){var t=jt(e,"x","atanh");return ke.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(ln(1).sub(n.toFloat().square()))}}}))}}),as=rn({ceil_:function(e){var t=jt(e,"x","ceil");return ke.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return xn(e)}}}))}}),is=rn({clipByValue_:function(e,t,n){var r=jt(e,"x","clipByValue");C(t<=n,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."}));var o=[r],a={min:t,max:n};return ke.runKernelFunc((function(e,o){var a=e.clip(r,t,n);return o([r]),a}),{x:r},(function(e,r){var o=r[0];return{x:function(){return e.where(o.greaterEqual(t).logicalAnd(o.lessEqual(n)),xn(e))}}}),"ClipByValue",a,o)}}),ss=rn({cos_:function(e){var t=jt(e,"x","cos"),n=[t];return ke.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}}),"Cos",{},n)}}),us=rn({cosh_:function(e){var t=jt(e,"x","cosh");return ke.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}}))}}),cs=rn({erf_:function(e){var t=jt(e,"x","erf");return C("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),ke.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),ls=rn({exp_:function(e){var t=jt(e,"x","exp");return ke.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},(function(e,t){return{x:function(){return e.mulStrict(t[0])}}}),"Exp",{},[],[!0])}}),fs=rn({expm1_:function(e){var t=jt(e,"x","expm1");return ke.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}}))}}),ps=rn({floor_:function(e){var t=jt(e,"x","floor");return ke.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return xn(e)}}}))}}),hs=rn({log_:function(e){var t=jt(e,"x","log"),n=[t];return ke.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}}),"Log",{},n)}}),ds=rn({log1p_:function(e){var t=jt(e,"x","log1p");return ke.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}}))}}),vs=rn({logSigmoid_:function(e){var t=jt(e,"x","logSigmoid");return ke.runKernelFunc((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),ms=rn({neg_:function(e){var t=jt(e,"x","neg"),n=[t];return ke.runKernelFunc((function(e){return e.neg(t)}),{x:t},(function(e){return{x:function(){return e.neg()}}}),"Neg",{},n)}}),gs=rn({reciprocal_:function(e){var t=jt(e,"x","reciprocal");return ke.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),ys=rn({round_:function(e){var t=jt(e,"x","round");return ke.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return xn(e)}}}))}}),bs=rn({rsqrt_:function(e){var t=jt(e,"x","rsqrt"),n=[t];return ke.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},n)}}),xs=rn({sigmoid_:function(e){var t=jt(e,"x","sigmoid");return ke.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(ln(1).sub(n)))}}}),"Sigmoid")}}),ws=rn({sign_:function(e){var t=jt(e,"x","sign");return ke.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return xn(e)}}}))}}),Es=rn({isNaN_:function(e){var t=jt(e,"x","isNaN");return ke.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return xn(e)}}}))}}),As=rn({isInf_:function(e){var t=jt(e,"x","isInf");return ke.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return xn(e)}}}))}}),Cs=rn({isFinite_:function(e){var t=jt(e,"x","isFinite");return ke.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return xn(e)}}}))}}),Ss=rn({sin_:function(e){var t=jt(e,"x","sin"),n=[t];return ke.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}}),"Sin",{},n)}}),_s=rn({sinh_:function(e){var t=jt(e,"x","sinh");return ke.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}}))}}),Is=rn({softplus_:function(e){var t=jt(e,"x","softplus");return ke.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),Rs=rn({sqrt_:function(e){var t=jt(e,"x","sqrt");return ke.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}))}}),Ts=rn({step_:function(e,t){void 0===t&&(t=0);var n=jt(e,"x","step");return ke.runKernelFunc((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return xn(e)}}}))}}),Ps=rn({tan_:function(e){var t=jt(e,"x","tan");return ke.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),Ns=rn({tanh_:function(e){var t=jt(e,"x","tanh");return ke.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return ln(1).sub(n.square()).mulStrict(e)}}}),"Tanh",{},null,[!0])}});function Os(e,t,n,r,o,a){var i,s,u=jt(e,"x","batchNorm"),c=jt(t,"mean","batchNorm"),l=jt(n,"variance","batchNorm");return null!=o&&(i=jt(o,"scale","batchNorm")),null!=r&&(s=jt(r,"offset","batchNorm")),C(2===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),C(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),C(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),null!=i&&C(2===i.rank||1===i.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."})),null!=s&&C(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),Fs(u,c,l,s,i,a)}function Ds(e,t,n,r,o,a){var i,s,u=jt(e,"x","batchNorm"),c=jt(t,"mean","batchNorm"),l=jt(n,"variance","batchNorm");return null!=o&&(i=jt(o,"scale","batchNorm")),null!=r&&(s=jt(r,"offset","batchNorm")),C(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),C(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),C(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),null!=i&&C(3===i.rank||1===i.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."})),null!=s&&C(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),Fs(u,c,l,s,i,a)}function ks(e,t,n,r,o,a){var i,s,u=jt(e,"x","batchNorm"),c=jt(t,"mean","batchNorm"),l=jt(n,"variance","batchNorm");return null!=o&&(i=jt(o,"scale","batchNorm")),null!=r&&(s=jt(r,"offset","batchNorm")),C(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),C(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),C(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),null!=i&&C(4===i.rank||1===i.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."})),null!=s&&C(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),Fs(u,c,l,s,i,a)}function Fs(e,t,n,r,o,a){null==a&&(a=.001);var i,s,u,c=jt(e,"x","batchNorm"),l=jt(t,"mean","batchNorm"),f=jt(n,"variance","batchNorm");null!=o&&(i=jt(o,"scale","batchNorm")),null!=r&&(s=jt(r,"offset","batchNorm")),C(l.rank===f.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),C(null==s||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),C(null==i||l.rank===i.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var p=[c,l,f,i];return ke.runKernelFunc((function(e,t){var n=e.batchNormalization(u,Ms(l),Ms(f),a,Ms(i),Ms(s));return t([c,l,f,i]),n}),{x:c,mean:l,variance:f,scale:i,offset:s},(function(e,t){var n=t,r=n[0],o=n[1],i=n[2],s=n[3],c=null==s?ln(1):s,l=Mr(o.shape,u.shape),f=[];if(1===o.rank){for(var p=0;p<u.shape.length-1;++p)f.push(u.shape[p]);f.push(1)}var h=r.sub(o),d=e.mul(c),v=bs(i.add(ln(a))),m=v.mul(v).mul(v).mul(ln(-.5));return{x:function(){return 1===o.rank?e.mul(cr(v.as4D(1,1,1,o.shape[0]),f)).mul(c).reshape(r.shape):e.mul(v).mul(c).reshape(r.shape)},mean:function(){var e=v.mul(ln(-1)).mul(d);return 1===o.rank&&(e=e.sum(l)),e.reshape(o.shape)},variance:function(){var e=m.mul(h).mul(d);return 1===o.rank&&(e=e.sum(l)),e.reshape(o.shape)},scale:function(){var t=h.mul(v),n=e.mul(t);return 1===o.rank&&(n=n.sum(l)),n.reshape(o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=t.sum(l)),t.reshape(o.shape)}}}),"BatchNormalization",{varianceEpsilon:a},p).reshape(c.shape)}function Ms(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function Ls(){Bt("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Us=rn({batchNormalization2d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),Ls(),Os(e,t,n,a,o,r)}}),Bs=rn({batchNormalization3d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),Ls(),Ds(e,t,n,a,o,r)}}),Gs=rn({batchNormalization4d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),Ls(),ks(e,t,n,a,o,r)}}),Ws=rn({batchNormalization_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),Ls(),Fs(e,t,n,a,o,r)}}),Vs=rn({batchNorm_:Fs}),$s=rn({batchNorm2d_:Os}),Hs=rn({batchNorm3d_:Ds}),js=rn({batchNorm4d_:ks}),zs=rn({logicalAnd_:function(e,t){var n=jt(e,"a","logicalAnd","bool"),r=jt(t,"b","logicalAnd","bool");return Lr(n.shape,r.shape),ke.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),qs=rn({logicalNot_:function(e){var t=jt(e,"x","logicalNot","bool");return ke.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),Ks=rn({logicalOr_:function(e,t){var n=jt(e,"a","logicalOr","bool"),r=jt(t,"b","logicalOr","bool");return Lr(n.shape,r.shape),ke.runKernelFunc((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),Xs=rn({logicalXor_:function(e,t){var n=jt(e,"a","logicalXor","bool"),r=jt(t,"b","logicalXor","bool");return Lr(n.shape,r.shape),Ks(e,t).logicalAnd(zs(e,t).logicalNot())}}),Ys=rn({where_:function(e,t,n){var r=jt(t,"a","where"),o=jt(n,"b","where"),a=jt(e,"condition","where","bool");return S(r.shape,o.shape,"Error in where: "),1===a.rank?C(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):S(a.shape,o.shape,"Error in where: "),ke.runKernelFunc((function(e,t){var n=e.select(a,r,o);return t([a]),n}),{$condition:a,$a:r,$b:o},(function(e,t){var n=t[0];return{$condition:function(){return xn(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),Zs=function(e){return s(this,void 0,void 0,(function(){var t,n,r;return u(this,(function(o){switch(o.label){case 0:return[4,(t=jt(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=vo(t.shape,n),e!==t&&t.dispose(),[2,r]}}))}))},Qs=rn({add_:function(e,t){var n,r=jt(e,"a","add"),o=jt(t,"b","add");n=Re(r,o),r=n[0],o=n[1];var a=Lr(r.shape,o.shape);return ke.runKernelFunc((function(e){return e.add(r,o)}),{a:r,b:o},(function(e){return{a:function(){var t=e,n=Mr(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=Mr(o.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(o.shape)}}}),"Add")}}),Js=rn({addN_:function(e){C(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),C(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return jt(e,"tensors"+t,"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!T(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return ke.runKernelFunc((function(e){return e.addN(t)}),r,(function(e){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}),"AddN")}}),eu=rn({addStrict_:function(e,t){var n=jt(e,"a","addStrict"),r=jt(t,"b","addStrict");return S(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),tu=rn({atan2_:function(e,t){var n,r=jt(e,"a","atan2"),o=jt(t,"b","atan2");n=Re(r,o),r=n[0],o=n[1];var a=Lr(r.shape,o.shape);return ke.runKernelFunc((function(e,t){var n=e.atan2(r,o);return t([r,o]),n}),{$a:r,$b:o},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Qs(n.square(),r.square()),o=e.mul(r.div(t)),i=Mr(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},$b:function(){var t=Qs(n.square(),r.square()),o=ms(e.mul(n.div(t))),i=Mr(r.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(r.shape)}}}))}}),nu=rn({div_:function(e,t){var n,r=jt(e,"a","div"),o=jt(t,"b","div");if(n=Re(r,o),r=n[0],o=n[1],"int32"===r.dtype&&"int32"===o.dtype)return au(r,o);var a=Lr(r.shape,o.shape);return ke.runKernelFunc((function(e,t){var n=e.realDivide(r,o);return t([r,o]),n}),{a:r,b:o},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),o=Mr(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=Mr(r.shape,a);o.length>0&&(t=t.sum(o).reshape(r.shape));var i=r.square();return t.div(i.toFloat()).neg()}}}),"Div")}}),ru=rn({divNoNan_:function(e,t){var n,r=jt(e,"a","div"),o=jt(t,"b","div");r=(n=Re(r,o))[0],o=n[1];var a=nu(r,o),i=xn(a),s=o.equal(i);return Ys(s,i,a)}}),ou=rn({divStrict_:function(e,t){var n=jt(e,"a","div"),r=jt(t,"b","div");return S(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),au=rn({floorDiv_:function(e,t){var n,r=jt(e,"a","floorDiv"),o=jt(t,"b","floorDiv");n=Re(r,o),r=n[0],o=n[1];var a=Lr(r.shape,o.shape);return ke.runKernelFunc((function(e,t){var n=e.floorDiv(r,o);return t([r,o]),n}),{a:r,b:o},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),o=Mr(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=Mr(r.shape,a);o.length>0&&(t=t.sum(o).reshape(r.shape));var i=r.square();return t.div(i.toFloat()).neg()}}}),"FloorDiv")}}),iu=rn({maximum_:function(e,t){var n,r=jt(e,"a","maximum"),o=jt(t,"b","maximum");return n=Re(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),Lr(r.shape,o.shape),ke.runKernelFunc((function(e,t){var n=e.maximum(r,o);return t([r,o]),n}),{a:r,b:o},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}}),"Maximum")}}),su=rn({maximumStrict_:function(e,t){var n=jt(e,"a","maximumStrict"),r=jt(t,"b","maximumStrict");return S(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),uu=rn({minimum_:function(e,t){var n,r=jt(e,"a","minimum"),o=jt(t,"b","minimum");return n=Re(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),Lr(r.shape,o.shape),ke.runKernelFunc((function(e,t){var n=e.minimum(r,o);return t([r,o]),n}),{a:r,b:o},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}}),"Minimum")}}),cu=rn({minimumStrict_:function(e,t){var n=jt(e,"a","minimumStrict"),r=jt(t,"b","minimumStrict");return S(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),lu=rn({mod_:function(e,t){var n,r=jt(e,"a","mod"),o=jt(t,"b","mod");n=Re(r,o),r=n[0],o=n[1];var a=Lr(r.shape,o.shape);return ke.runKernelFunc((function(e,t){var n=e.mod(r,o);return t([r,o]),n}),{$a:r,$b:o},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Mr(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),o=Mr(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}}))}}),fu=rn({modStrict_:function(e,t){var n=jt(e,"a","modStrict"),r=jt(t,"b","modStrict");return S(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),pu=rn({mul_:function(e,t){var n,r=jt(e,"a","mul"),o=jt(t,"b","mul");n=Re(r,o),r=n[0],o=n[1];var a=Lr(r.shape,o.shape);return ke.runKernelFunc((function(e,t){var n=e.multiply(r,o);return t([r,o]),n}),{a:r,b:o},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),o=Mr(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=Mr(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}}),"Mul")}}),hu=rn({mulStrict_:function(e,t){var n=jt(e,"a","mul"),r=jt(t,"b","mul");return S(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),du=rn({pow_:function(e,t){var n,r=jt(e,"base","pow"),o=jt(t,"exp","pow");n=Re(r,o),r=n[0],o=n[1];var a=Lr(r.shape,o.shape),i=[r,o];return ke.runKernelFunc((function(e,t){var n=e.pow(r,o);return t([r,o,n]),n}),{a:r,b:o},(function(e,t){var n=t[0],r=t[1],o=t[2];return{a:function(){var t=r.toFloat(),o=e.mul(t.mul(n.pow(t.sub(ln(1))))),i=Mr(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},b:function(){var t=n.greater(0),i=n.log().where(t,xn(n)),s=e.mul(o.mul(i)),u=Mr(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}}),"Pow",{},i,[!0])}}),vu=rn({powStrict_:function(e,t){return S(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),mu=rn({squaredDifferenceStrict_:function(e,t){var n=jt(e,"a","squaredDifferenceStrict"),r=jt(t,"b","squaredDifferenceStrict");return S(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),gu=rn({sub_:function(e,t){var n,r=jt(e,"a","sub"),o=jt(t,"b","sub");n=Re(r,o),r=n[0],o=n[1];var a=Lr(r.shape,o.shape);return ke.runKernelFunc((function(e){return e.subtract(r,o)}),{a:r,b:o},(function(e){return{a:function(){var t=e,n=Mr(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=Mr(o.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(o.shape)}}}),"Sub")}}),yu=rn({subStrict_:function(e,t){var n=jt(e,"a","subStrict"),r=jt(t,"b","subStrict");return S(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),bu=rn({equal_:function(e,t){var n,r=jt(e,"a","equal"),o=jt(t,"b","equal");return n=Re(r,o),r=n[0],o=n[1],Lr(r.shape,o.shape),ke.runKernelFunc((function(e){return e.equal(r,o)}),{$a:r,$b:o})}}),xu=rn({equalStrict_:function(e,t){var n=jt(e,"a","equalStrict"),r=jt(t,"b","equalStrict");return S(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),wu=rn({greater_:function(e,t){var n,r=jt(e,"a","greater"),o=jt(t,"b","greater");return n=Re(r,o),r=n[0],o=n[1],Lr(r.shape,o.shape),ke.runKernelFunc((function(e){return e.greater(r,o)}),{a:r,b:o},null,"Greater")}}),Eu=rn({greaterEqual_:function(e,t){var n,r=jt(e,"a","greaterEqual"),o=jt(t,"b","greaterEqual");return n=Re(r,o),r=n[0],o=n[1],Lr(r.shape,o.shape),ke.runKernelFunc((function(e,t){var n=e.greaterEqual(r,o);return t([r,o]),n}),{a:r,b:o},(function(e,t){var n=t[0],r=t[1];return{a:function(){return xn(n)},b:function(){return xn(r)}}}),"GreaterEqual")}}),Au=rn({greaterEqualStrict_:function(e,t){var n=jt(e,"a","greaterEqualStrict"),r=jt(t,"b","greaterEqualStrict");return S(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Cu=rn({greaterStrict_:function(e,t){var n=jt(e,"a","greaterStrict"),r=jt(t,"b","greaterStrict");return S(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Su=rn({less_:function(e,t){var n,r=jt(e,"a","less"),o=jt(t,"b","less");return n=Re(r,o),r=n[0],o=n[1],Lr(r.shape,o.shape),ke.runKernelFunc((function(e){return e.less(r,o)}),{a:r,b:o},null,"Less")}}),_u=rn({lessEqual_:function(e,t){var n,r=jt(e,"a","lessEqual"),o=jt(t,"b","lessEqual");return n=Re(r,o),r=n[0],o=n[1],Lr(r.shape,o.shape),ke.runKernelFunc((function(e,t){var n=e.lessEqual(r,o);return t([r,o]),n}),{a:r,b:o},null,"LessEqual")}}),Iu=rn({lessEqualStrict_:function(e,t){var n=jt(e,"a","lessEqualStrict"),r=jt(t,"b","lessEqualStrict");return S(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),Ru=rn({lessStrict_:function(e,t){var n=jt(e,"a","lessStrict"),r=jt(t,"b","lessStrict");return S(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Tu=rn({notEqual_:function(e,t){var n,r=jt(e,"a","notEqual"),o=jt(t,"b","notEqual");return n=Re(r,o),r=n[0],o=n[1],Lr(r.shape,o.shape),ke.runKernelFunc((function(e){return e.notEqual(r,o)}),{a:r,b:o},null,"NotEqual")}}),Pu=rn({notEqualStrict_:function(e,t){var n=jt(e,"a","notEqualStrict"),r=jt(t,"b","notEqualStrict");return S(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Nu(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Ou(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Du=rn({gather_:function(e,t,n){void 0===n&&(n=0);var r=jt(e,"x","gather"),o=jt(t,"indices","gather","int32");n=M(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],o=[],a=1,i=1,s=0;s<n;s++)o.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)o.push(t.shape[s]);for(s=n+1;s<e.rank;s++)o.push(e.shape[s]),i*=e.shape[s];return{batchSize:a,sliceSize:i,dimSize:r,outputShape:o}}(r,o,n);return ke.runKernelFunc((function(e,t){var a=e.gather(r,o.flatten(),n);return t([o]),a}),{x:r,indices:o},(function(e,t){var o=t[0];return{x:function(){var t=r.shape,a=o.size,i=t.slice(0,n),s=i.length,u=t.slice(n,t.length).slice(1),c=u.length,l=Nu(0,s),f=Nu(s+1,s+1+c),p=Ou([i,[a],u]),h=e.reshape(p),d=o.reshape([a]),v=Ou([[s],l,f]),m=h.transpose(v),g=ku(m,d,r.shape[n]),y=Jt(v);return g.transpose(y)},indices:function(){return o}}}),"Gather",{axis:n}).reshape(a.outputShape)}}),ku=rn({unsortedSegmentSum_:function(e,t,n){var r=jt(e,"x","unsortedSegmentSum"),o=jt(t,"segmentIds","unsortedSegmentSum","int32");return C(P(n),(function(){return"numSegments must be of dtype int"})),ke.runKernelFunc((function(e,t){var a=e.unsortedSegmentSum(r,o,n);return t([o]),a}),{$x:r},(function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=iu(t,xn(t)),r=Du(e,n),o=Eu(t,ln(0,"int32")),a=r.rank-o.rank,i=0;i<a;++i)o=zn(o,i+1);o=zs(o,vn(r.shape,"bool"));var s=xn(r);return Ys(o,r,s)}(e,n)}}}))}});function Fu(e,t,n,r,o,a,i){void 0===a&&(a="NHWC"),C(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),C(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),C(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),C(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var l="NHWC"===a?s[3]:s[1],f="NHWC"===a?u.shape[3]:u.shape[1];C(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."})),C(f===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+n.shape[3]+"."})),null!=i&&C(P(o),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var p=Xr(a),h=Gr(s,n.shape,r,1,o,i,!1,p),d=ke.runKernelFunc((function(e,t){var r=e.conv2dDerInput(u,n,h);return t([n,u]),r}),{dy4D:u,filter:n},(function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return Bu(e,n,r,o,a,1,i)},filter:function(){return Wu(e,s,n.shape,r,o,a,i)}}}));return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function Mu(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}function Lu(e,t,n,r,o){C(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var a=e,i=t,s=!1;4===t.rank&&(s=!0,i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],c=i.shape[4];C(5===a.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),C(5===i.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank})),C(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),C(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."})),C(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."}));var l=Wr(a,n.shape,r,1,o),f=ke.runKernelFunc((function(e){return e.conv3dDerInput(i,n,l)}),{dy5D:i});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var Uu=rn({conv1d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NWC"),void 0===a&&(a=1);var s=jt(e,"x","conv1d"),u=jt(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),C(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),C(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),null!=i&&C(P(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."})),C(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),C(Kr(n,a),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"})),C("NWC"===o,(function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."}));var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),p=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=Bu(p,f,[1,n],r,"NHWC",[1,a],i);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),Bu=rn({conv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=jt(e,"x","conv2d"),u=jt(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),C(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),C(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),null!=i&&C(P(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var f="NHWC"===o?c.shape[3]:c.shape[1];C(f===u.shape[2],(function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+u.shape[2]+"."})),C(Kr(n,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}));var p=Xr(o),h=Gr(c.shape,u.shape,n,a,r,i,!1,p),d=[u,c],v=ke.runKernelFunc((function(e,t){var n=e.conv2d(c,u,h);return t([u,c]),n}),{x:c,filter:u},(function(e,t){var i=t,s=i[0],u=i[1];return C(qr(a),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"})),{x:function(){return Vu(u.shape,e,s,n,r,o)},filter:function(){return Wu(u,e,s.shape,n,r,o)}}}),"Conv2D",h,d);return l?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),Gu=rn({conv3d_:function(e,t,n,r,o,a){void 0===o&&(o="NDHWC"),void 0===a&&(a=[1,1,1]);var i=jt(e,"x","conv3d"),s=jt(t,"filter","conv3d"),u=i,c=!1;4===i.rank&&(c=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),C(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),C(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),C(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),C(function(e,t){return Mu(e)||Mu(t)}(n,a),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),C("NDHWC"===o,(function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."}));var l=Wr(u.shape,s.shape,n,a,r),f=ke.runKernelFunc((function(e,t){var n=e.conv3d(u,s,l);return t([u,s]),n}),{x:u,$filter:s},(function(e,t){C(Mu(a),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}));var o=t[0],i=t[1];return{x:function(){return Lu(o.shape,e,i,n,r)},$filter:function(){return function(e,t,n,r,o){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var i=t;4===i.rank&&(i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),C(5===a.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."})),C(5===i.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+i.shape+"."})),C(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),C(a.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."})),C(i.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+i.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s=Wr(a.shape,n,r,1,o);return ke.runKernelFunc((function(e){return e.conv3dDerFilter(a,i,s)}),{x5D:a,dy5D:i})}(o,e,i.shape,n,r)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Wu=rn({conv2dDerFilter_:function(e,t,n,r,o,a,i){void 0===a&&(a="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),C(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),C(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),C(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var c="NHWC"===a?s.shape[3]:s.shape[1],l="NHWC"===a?u.shape[3]:u.shape[1];C(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."})),C(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."})),null!=i&&C(P(o),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var f=Xr(a),p=Gr(s.shape,n,r,1,o,i,!1,f);return ke.runKernelFunc((function(e){return e.conv2dDerFilter(s,u,p)}),{x4D:s,dy4D:u})}}),Vu=rn({conv2dDerInput_:Fu}),$u=rn({depthwiseConv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=jt(e,"x","depthwiseConv2d"),u=jt(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),C(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),C(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),C(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),null==a&&(a=[1,1]),C(Kr(n,a),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=i&&C(P(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var f=Gr(c.shape,u.shape,n,a,r,i,!0),p=[c,u],h=ke.runKernelFunc((function(e,t){var n=e.depthwiseConv2D(c,u,f);return t([c,u]),n}),{x:c,filter:u},(function(e,t){C(qr(a),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"}));var n=t[0],r=t[1];return{x:function(){return Hu(n.shape,e,r,f)},filter:function(){return ju(n,e,r.shape,f)}}}),"DepthwiseConv2dNative",f,p);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),Hu=rn({depthwiseConv2dDerInput_:function(e,t,n,r){var o=t,a=!1;3===t.rank&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=ke.runKernelFunc((function(e){return e.depthwiseConv2DDerInput(o,n,r)}),{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),ju=rn({depthwiseConv2dDerFilter_:function(e,t,n,r){var o=e;3===e.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),ke.runKernelFunc((function(e){return e.depthwiseConv2DDerFilter(o,a,r)}),{x4D:o,dy4D:a})}}),zu=rn({separableConv2d_:function(e,t,n,r,o,a,i){void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC");var s=jt(e,"x","separableConv2d"),u=jt(t,"depthwiseFilter","separableConv2d"),c=jt(n,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(3===s.rank&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");C(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),C(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),C(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),C(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),C(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var p=u.shape[2],h=u.shape[3];C(c.shape[2]===p*h,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+p*h+", but got "+c.shape[2]+"."}));var d=$u(l,u,r,o,i,a),v=Bu(d,c,1,"valid",i);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),qu=rn({conv2dTranspose_:function(e,t,n,r,o,a){return Fu(n,jt(e,"x","conv2dTranspose"),jt(t,"filter","conv2dTranspose"),r,o,"NHWC",a)}}),Ku=rn({conv3dTranspose_:function(e,t,n,r,o){return Lu(n,jt(e,"x","conv3dTranspose"),jt(t,"filter","conv3dTranspose"),r,o)}}),Xu=rn({matMul_:function(e,t,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=jt(e,"a","matMul"),i=jt(t,"b","matMul");o=Re(a,i),a=o[0],i=o[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],c=n?a.shape[a.rank-1]:a.shape[a.rank-2],l=r?i.shape[i.rank-2]:i.shape[i.rank-1],f=a.shape.slice(0,-2),p=i.shape.slice(0,-2),h=R(f),d=R(p);C(a.rank>=2&&i.rank>=2&&a.rank===i.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."})),C(T(f,p),(function(){return"Error in matMul: outer dimensions ("+f+") and ("+p+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."})),C(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var v=a.shape.slice(0,-2).concat([c,l]),m=n?a.as3D(h,s,c):a.as3D(h,c,s),g=r?i.as3D(d,l,u):i.as3D(d,u,l),y={transposeA:n,transposeB:r};return ke.runKernelFunc((function(e,t){var o=e.batchMatMul(m,g,n,r);return t([m,g]),o}),{a:m,b:g},(function(e,t){var o=t,a=o[0],i=o[1];return n||r?!n&&r?{a:function(){return e.matMul(i,!1,!1)},b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{a:function(){return i.matMul(e,!1,!0)},b:function(){return a.matMul(e,!1,!1)}}:{a:function(){return i.matMul(e,!0,!0)},b:function(){return e.matMul(a,!0,!0)}}:{a:function(){return e.matMul(i,!1,!0)},b:function(){return a.matMul(e,!0,!1)}}}),"BatchMatMul",y).reshape(v)}}),Yu=rn({dot_:function(e,t){var n=jt(e,"t1","dot"),r=jt(t,"t2","dot");C(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var o=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return C(o===a,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Zu=rn({outerProduct_:function(e,t){var n=jt(e,"v1","outerProduct"),r=jt(t,"v2","outerProduct");return C(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Qu=rn({reverse_:function(e,t){var n=jt(e,"x","reverse");if(0===n.rank)return n.clone();var r=M(t,n.shape);return ke.runKernelFunc((function(e){return e.reverse(n,r)}),{$x:n},(function(e){return{$x:function(){return e.reverse(r)}}})).reshapeAs(n)}}),Ju=rn({reverse1d_:function(e){var t=jt(e,"x","reverse");return C(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."})),Qu(t,0)}}),ec=rn({reverse2d_:function(e,t){var n=jt(e,"x","reverse");return C(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),Qu(n,t)}}),tc=rn({reverse3d_:function(e,t){var n=jt(e,"x","reverse");return C(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),Qu(n,t)}}),nc=rn({reverse4d_:function(e,t){var n=jt(e,"x","reverse");return C(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),Qu(n,t)}});function rc(e,t,n,r,o,a){var i=jt(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),null==r&&(r=[1,1]),C(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),C(Kr(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=a&&C(P(o),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var c=Ur(s.shape,t,n,r,o,a);if(1===c.filterWidth&&1===c.filterHeight&&T(c.inShape,c.outShape))return i.clone();var l=[s],f=ke.runKernelFunc((function(e,t){var n=e.maxPool(s,c);return t([s,n]),n}),{x:s},(function(e,a){var i=a[0],s=a[1];return{x:function(){return function(e,t,n,r,o,a,i,s){var u=jt(e,"dy","maxPoolBackprop"),c=jt(t,"input","maxPoolBackprop"),l=jt(n,"output","maxPoolBackprop");C(c.rank===u.rank,(function(){return"Rank of input ("+c.rank+") does not match rank of dy ("+u.rank+")"})),null==a&&(a=[1,1]),C(Kr(o,a),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"})),C(4===u.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),C(4===c.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."}));var f=Ur(c.shape,r,o,a,i,void 0);return ke.runKernelFunc((function(e){return e.maxPoolBackprop(u,c,l,f)}),{$dy:u,$input:c})}(e,i,s,t,n,r,o)}}}),"MaxPool",c,l);return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function oc(e,t,n,r,o,a){var i=jt(e,"x","avgPool","float32");null==r&&(r=[1,1]),C(Kr(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),C(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),null!=a&&C(P(o),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var c=Ur(s.shape,t,n,r,o,a);if(1===c.filterWidth&&1===c.filterHeight&&T(c.inShape,c.outShape))return i.clone();var l=ke.runKernelFunc((function(e){return e.avgPool(s,c)}),{x:s},(function(e){return{x:function(){return function(e,t,n,r,o,a){var i=jt(e,"dy","avgPoolBackprop"),s=jt(t,"input","avgPoolBackprop");C(s.rank===i.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+i.rank+")"})),null==o&&(o=[1,1]),C(Kr(r,o),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}));var u=s,c=i,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),C(4===c.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),C(4===u.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var f=Ur(u.shape,n,r,o,a),p=ke.runKernelFunc((function(e){return e.avgPoolBackprop(c,u,f)}),{dy4D:c,input4D:u});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}(e,s,t,n,r,o)}}}),"AvgPool",c);return l=l.cast(i.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var ac=rn({maxPool_:function(e,t,n,r,o){return rc(e,t,n,1,r,o)}}),ic=rn({avgPool_:function(e,t,n,r,o){return oc(e,t,n,1,r,o)}}),sc=rn({pool_:function(e,t,n,r,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===r&&(r="valid");var i=jt(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),C(Kr(a,o),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"}));var c,l=Ur(s.shape,t,a,o,r),f=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),o=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],o[t]]}))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];var p=1===f[0]&&1===f[1],h=function(e,t,n){var r=n.map((function(e){return e[0]})),o=n.map((function(e){return e[1]})),a=e.concat(r,o),i=t.map((function(e,t){return(e-a[t]%e)%e})),s=o.map((function(e,t){return e+i[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,i[t]]}))]}([l.inHeight,l.inWidth],f,c),d=h[0],v=h[1],m=p?r:"valid",g=p?s:ir(s,f,d),y=("avg"===n?function(){return oc(g,t,a,1,m)}:function(){return rc(g,t,a,1,m)})(),b=p?y:Gn(y,f,v);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),uc=rn({maxPool3d_:function(e,t,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=jt(e,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),C(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),C("NDHWC"===a,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),C(Kr(n,i),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"})),null!=o&&C(P(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var l=Br(u.shape,t,n,i,r,o,a),f=ke.runKernelFunc((function(e,t){var n=e.maxPool3d(u,l);return t([u,n]),n}),{x:u},(function(e,a){var s=a[0],u=a[1];return{x:function(){return function(e,t,n,r,o,a,i,s){var u=jt(e,"dy","maxPool3dBackprop"),c=jt(t,"input","maxPool3dBackprop"),l=jt(n,"output","maxPool3dBackprop"),f=u,p=c,h=l,d=!1;4===c.rank&&(d=!0,f=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),p=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),h=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),C(5===f.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+f.rank+"."})),C(5===p.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+p.rank+"."})),C(5===h.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+h.rank+"."})),null==a&&(a=[1,1,1]),C(Kr(o,a),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"})),null!=s&&C(P(i),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."}));var v=Br(p.shape,r,o,a,i,s),m=ke.runKernelFunc((function(e){return e.maxPool3dBackprop(f,p,h,v)}),{dy5D:f,input5D:p});return d?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}(e,s,u,t,n,i,r,o)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),cc=rn({avgPool3d_:function(e,t,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=jt(e,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),C(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),C("NDHWC"===a,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),C(Kr(n,i),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"})),null!=o&&C(P(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var l=Br(u.shape,t,n,i,r,o,a),f=ke.runKernelFunc((function(e){return e.avgPool3d(u,l)}),{x:u},(function(e){return{x:function(){return function(e,t,n,r,o,a,i){var s=jt(e,"dy","avgPool3dBackprop"),u=jt(t,"input","avgPool3dBackprop"),c=s,l=u,f=!1;4===u.rank&&(f=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),C(5===c.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."})),C(5===l.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."})),null==o&&(o=[1,1,1]),C(Kr(r,o),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"})),null!=i&&C(P(a),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."}));var p=Br(l.shape,n,r,o,a,i),h=ke.runKernelFunc((function(e){return e.avgPool3dBackprop(c,l,p)}),{dy5D:c,input5D:l});return f?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}(e,u,t,n,i,r,o)}}}));return f=f.cast(u.dtype),c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),lc=rn({slice_:function(e,t,n){var r,o,a=jt(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach((function(e){C(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),o=(o=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map((function(e,t){return e>=0?e:(C(-1===e,(function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."})),a.shape[t]-r[t])})),Er(a,r,o);var i=a.shape,s={begin:r,size:o};return ke.runKernelFunc((function(e){return e.slice(a,r,o)}),{x:a},(function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],i[n]-r[n]-o[n]]);return{x:function(){return e.pad(t)}}}),"Slice",s)}}),fc=rn({slice1d_:function(e,t,n){var r=jt(e,"x","slice1d");return C(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),lc(r,[t],[n])}}),pc=rn({slice2d_:function(e,t,n){var r=jt(e,"x","slice2d");return C(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),lc(r,t,n)}}),hc=rn({slice3d_:function(e,t,n){var r=jt(e,"x","slice3d");return C(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),lc(r,t,n)}}),dc=rn({slice4d_:function(e,t,n){var r=jt(e,"x","slice4d");return C(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),lc(r,t,n)}});function vc(e,t,n,r,o){return t.rank<n.rank&&(t=t.reshape(Yt(t.shape,r))),e.rank<n.rank&&(e=e.reshape(Yt(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==o?r:r.transpose(o)}}}var mc=rn({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=jt(e,"x","all","bool"),o=M(t,r.shape),a=o,i=Qt(a,r.rank);null!=i&&(r=r.transpose(i),a=en(a.length,r.rank));var s=ke.runKernelFunc((function(e){return e.all(r,a)}),{$x:r});if(n){var u=Yt(s.shape,o);return s.reshape(u)}return s}}),gc=rn({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=jt(e,"x","any","bool"),o=M(t,r.shape),a=o,i=Qt(a,r.rank);null!=i&&(r=r.transpose(i),a=en(a.length,r.rank));var s=ke.runKernelFunc((function(e){return e.any(r,a)}),{$x:r});if(n){var u=Yt(s.shape,o);return s.reshape(u)}return s}}),yc=rn({argMax_:function(e,t){void 0===t&&(t=0);var n=jt(e,"x","argMax");null==t&&(t=0);var r=M(t,n.shape),o=Qt(r,n.rank);null!=o&&(n=n.transpose(o),r=en(r.length,n.rank));var a={axis:r[0]},i=[n];return ke.runKernelFunc((function(e,t){var o=e.argMax(n,r[0]);return t([n]),o}),{x:n},(function(e,t){var n=t[0];return{x:function(){return xn(n)}}}),"ArgMax",a,i)}}),bc=rn({argMin_:function(e,t){void 0===t&&(t=0);var n=jt(e,"x","argMin");null==t&&(t=0);var r=M(t,n.shape),o=Qt(r,n.rank);return null!=o&&(n=n.transpose(o),r=en(r.length,n.rank)),ke.runKernelFunc((function(e,t){var o=e.argMin(n,r[0]);return t([n]),o}),{$x:n},(function(e,t){var n=t[0];return{$x:function(){return xn(n)}}}))}}),xc=rn({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=jt(e,"x","logSumExp"),o=M(t,r.shape),a=r.max(o,!0),i=r.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(n){var u=Yt(s.shape,o);return s.reshape(u)}return s}}),wc=rn({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=jt(e,"x","max"),o=r,a=M(t,r.shape),i=a,s=Qt(i,r.rank);null!=s&&(r=r.transpose(s),i=en(i.length,r.rank));var u=[r],c=ke.runKernelFunc((function(e,t){var n=e.max(r,i);return t([o,n]),n}),{x:r},(function(e,t){return vc(e,t[1],t[0],a,s)}),"Max",{axes:i},u,[!0]);if(n){var l=Yt(c.shape,a);c=c.reshape(l)}return c}}),Ec=rn({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=jt(e,"x","mean"),o=M(t,r.shape),a=R(Xt(r.shape,o)[1]);return Tr((function(e){var r=ln(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return o.forEach((function(e){n[e]=1})),t.reshape(n).mul(vn(e.shape,"float32")).div(a)}}}))(r)}}),Ac=rn({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=jt(e,"x","min"),o=r,a=M(t,r.shape),i=a,s=Qt(i,r.rank);null!=s&&(r=r.transpose(s),i=en(i.length,r.rank));var u=[r],c=ke.runKernelFunc((function(e,t){var n=e.min(r,i);return t([o,n]),n}),{x:r},(function(e,t){return vc(e,t[1],t[0],a,s)}),"Min",{axes:i},u,[!0]);if(n){var l=Yt(c.shape,a);c=c.reshape(l)}return c}}),Cc=rn({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=M(t,(e=jt(e,"x","moments")).shape),o=e.mean(r,n),a=o.shape;n||(a=Yt(o.shape,r));var i=e.toFloat().sub(o.reshape(a)).square();return{mean:o,variance:i.mean(r,n)}}}),Sc=rn({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=jt(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=M(t,r.shape);return Tr((function(e){var t=Qt(o,e.rank),r=o,a=e;null!=t&&(a=e.transpose(t),r=en(r.length,e.rank));var i=function(t){var n=e.shape.slice();return o.forEach((function(e){n[e]=1})),t.reshape(n).mul(vn(e.shape,"float32"))},s={axes:r},u=ke.runKernelFunc((function(e){return e.sum(a,r)}),{x:a},(function(e){return{x:function(){return i(e)}}}),"Sum",s);if(n){var c=Yt(u.shape,o);u=u.reshape(c)}return{value:u,gradFunc:i}}))(r)}}),_c=rn({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=jt(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=M(t,r.shape),a=Qt(o,r.rank),i=o,s=r;null!=a&&(s=r.transpose(a),i=en(i.length,r.rank));var u=ke.runKernelFunc((function(e){return e.prod(s,i)}),{permutedX:s});if(n){var c=Yt(u.shape,o);u=u.reshape(c)}return u}}),Ic=rn({elu_:function(e){var t=jt(e,"x","elu");return ke.runKernelFunc((function(e,n){var r=e.elu(t);return n([r]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return ke.runKernelFunc((function(t){return t.eluDer(e,n)}),{dy:e,y:n})}}}))}}),Rc=rn({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=jt(e,"x","leakyRelu");return iu(ln(t).mul(n),n)}}),Tc=rn({prelu_:function(e,t){var n=jt(e,"x","prelu"),r=jt(t,"alpha","prelu");return ke.runKernelFunc((function(e,t){var o=e.prelu(n,r);return t([n,r]),o}),{x:n,alpha:r},(function(e,t){var n=t[0],r=t[1],o=n.greater(0);return{x:function(){return Ys(o,e,e.mul(r))},alpha:function(){var t=Ys(o,xn(e),e.mul(n)),a=Mr(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}}),"Prelu")}}),Pc=rn({relu_:function(e){var t=jt(e,"x","relu");return"bool"===t.dtype?t.toInt():ke.runKernelFunc((function(e,n){var r=e.relu(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}}),"Relu")}}),Nc=rn({relu6_:function(e){var t=jt(e,"x","relu6");return"bool"===t.dtype?t.toInt():ke.runKernelFunc((function(e,n){var r=e.relu6(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}}),"Relu6")}}),Oc=rn({selu_:function(e){var t=jt(e,"x","selu");return ke.runKernelFunc((function(e,n){var r=e.selu(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){var t=n.greater(ln(0)),r=ln(1.7580993408473768),o=ln(1.0507009873554805),a=e.mul(o),i=e.mul(r).mul(n.toFloat().exp());return Ys(t,a,i)}}}))}}),Dc=rn({transpose_:function(e,t){var n=jt(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),C(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."})),t.forEach((function(e){C(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1)return n.clone();var r={perm:t};return ke.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},(function(e){var n=Jt(t);return{x:function(){return e.transpose(n)}}}),"Transpose",r)}}),kc=rn({localResponseNormalization_:function(e,t,n,r,o){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var a=jt(e,"x","localResponseNormalization");C(4===a.rank||3===a.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."})),C(P(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."}));var i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=ke.runKernelFunc((function(e,a){var s=e.localResponseNormalization4D(i,t,n,r,o);return a([i,s]),s}),{x4D:i},(function(e,a){var i=a[0],s=a[1];return{x4D:function(){return ke.runKernelFunc((function(a){return a.LRNGrad(e,i,s,t,n,r,o)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Fc=rn({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(ln(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=jt(e,"x","norm"),t,n),a=o.shape;if(r){var i=M(n,e.shape);a=Yt(o.shape,i)}return o.reshape(a)}}),Mc=rn({basicLSTMCell_:function(e,t,n,r,o,a){var i=jt(e,"forgetBias","basicLSTMCell"),s=jt(t,"lstmKernel","basicLSTMCell"),u=jt(n,"lstmBias","basicLSTMCell"),c=jt(r,"data","basicLSTMCell"),l=jt(o,"c","basicLSTMCell"),f=jt(a,"h","basicLSTMCell"),p=c.concat(f,1).matMul(s).add(u),h=p.shape[0],d=p.shape[1]/4,v=[h,d],m=p.slice([0,0],v),g=p.slice([0,d],v),y=p.slice([0,2*d],v),b=p.slice([0,3*d],v),x=m.sigmoid().mulStrict(g.tanh()).addStrict(l.mulStrict(i.add(y).sigmoid())),w=x.tanh().mulStrict(b.sigmoid());return[x,w]}}),Lc=rn({multiRNNCell_:function(e,t,n,r){for(var o=jt(t,"data","multiRNNCell"),a=zt(n,"c","multiRNNCell"),i=zt(r,"h","multiRNNCell"),s=o,u=[],c=0;c<e.length;c++){var l=e[c](s,a[c],i[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var f=[],p=[];for(c=0;c<u.length;c+=2)f.push(u[c]),p.push(u[c+1]);return[f,p]}}),Uc=rn({movingAverage_:function(e,t,n,r,o){void 0===o&&(o=!0);var a=jt(e,"v","movingAverage"),i=jt(t,"x","movingAverage"),s=jt(n,"decay","movingAverage");Te(a,i),C(T(a.shape,i.shape),(function(){return"Shape mismatch in v and x"}));var u=ln(1),c=u.sub(s),l=i.sub(a).mul(c);if(o){C(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var f=jt(r,"step","movingAverage");l=l.div(u.sub(du(s,f)))}return a.add(l)}}),Bc=rn({stridedSlice_:function(e,t,n,r,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==i)throw new Error("ellipsis mask is not yet supported");var c=jt(e,"x","stridedSlice"),l=Ar(s),f=c.shape.slice();l.forEach((function(e){t[e]=0,n[e]=1,f.splice(e,0,1)})),c=c.reshape(f);for(var p=0;p<c.rank;p++)t[p]=Sr(o,t,r,c.shape,p),n[p]=_r(a,n,r,c.shape,p),r[p]=r[p]||1;var h=Ar(u);h.forEach((function(e){n[e]=t[e]+1,r[e]=1}));var d=Cr(t,n,r),v=d.filter((function(e,t){return-1===h.indexOf(t)}));return r.every((function(e){return 1===e}))?lc(c,t,d).reshape(v):ke.runKernelFunc((function(e){return e.stridedSlice(c,t,n,r)}),{$x:c}).reshape(v)}}),Gc=rn({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=jt(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var a=ke.runKernelFunc((function(e){return e.topk(r,t,n)}),{$x:r});return{values:a[0],indices:a[1]}}}),Wc=rn({scatterND_:function(e,t,n){var r=jt(e,"indices","scatterND","int32"),o=jt(t,"updates","scatterND");return xr(o,r,n),ke.runKernelFunc((function(e){return e.scatterND(r,o,n)}),{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),Vc=rn({fft_:function(e){C("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return ke.runKernelFunc((function(e){return e.fft(r)}),{input:e}).reshape(e.shape)}}),$c=rn({ifft_:function(e){C("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return ke.runKernelFunc((function(e){return e.ifft(r)}),{input:e}).reshape(e.shape)}}),Hc=rn({rfft_:function(e,t){C("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],o=e.size/r;if(null!=t&&t<r){var a=e.shape.map((function(e){return 0})),i=e.shape.map((function(e){return e}));i[e.shape.length-1]=t,n=e.slice(a,i),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=e.concat(mn(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),c=on(n,u).as2D(o,r),l=Vc(c),f=Math.floor(r/2)+1,p=an(l),h=sn(l),d=p.split([f,r-f],p.shape.length-1),v=h.split([f,r-f],h.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=f,on(d[0],v[0]).reshape(m)}}),jc=rn({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=$c(r);return an(o)}var a=[n,2*(t-1)],i=an(e).as2D(n,t),s=sn(e).as2D(n,t),u=i.slice([0,1],[n,t-2]).reverse(1),c=s.slice([0,1],[n,t-2]).reverse(1).mul(ln(-1)),l=i.concat(u,1),f=s.concat(c,1);return r=on(l,f).as2D(a[0],a[1]),o=$c(r),an(o)}}),zc=Object.freeze({fft:Vc,ifft:$c,rfft:Hc,irfft:jc}),qc=rn({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var o=jt(e,"sparseIndices","sparseToDense","int32"),a=jt(t,"sparseValues","sparseToDense"),i=jt(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var o=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var i=t.size;if(0!==t.rank&&(1!==t.rank||i!==o))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+o+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,n,i),ke.runKernelFunc((function(e){return e.sparseToDense(o,a,n,i)}),{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}}),Kc=rn({gatherND_:function(e,t){var n=jt(t,"indices","gatherND","int32"),r=jt(e,"x","gatherND");return ke.runKernelFunc((function(e){return e.gatherND(r,n)}),{x:r,indices:n},null,"GatherNd")}}),Xc=rn({diag_:function(e){var t=jt(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return ke.runKernelFunc((function(e){return e.diag(t)}),{$x:t}).reshape(n)}}),Yc=rn({dropout_:function(e,t,n,r){var o=jt(e,"x","dropout");if(C("float32"===o.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."})),C(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got "+t+"."})),0===t)return e instanceof ye?o.clone():o;var a=function(e,t){if(null==t)return e.shape.slice();if(T(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(o,n),i=1-t,s=or(a,0,1,"float32",r).add(i).floor().div(i);return o.mul(s)}});function Zc(e,t,n){for(var r=1-e%2,o=new Float32Array(e),a=0;a<e;++a){var i=2*Math.PI*a/(e+r-1);o[a]=t-n*Math.cos(i)}return fn(o,"float32")}var Qc,Jc=rn({hannWindow_:function(e){return Zc(e,.5,.5)}}),el=rn({hammingWindow_:function(e){return Zc(e,.54,.46)}}),tl=rn({frame_:function(e,t,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var a=0,i=[];a+t<=e.size;)i.push(lc(e,a,t)),a+=n;if(r)for(;a<e.size;){var s=a+t-e.size,u=wn([lc(e,a,t-s),gn([s],o)]);i.push(u),a+=n}return 0===i.length?pn([],[0,t]):wn(i).as2D(i.length,t)}}),nl=rn({stft_:function(e,t,n,r,o){var a;void 0===o&&(o=Jc),null==r&&(a=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var i=tl(e,t,n),s=pu(i,o(t)),u=[],c=0;c<i.shape[0];c++)u.push(Hc(s.slice([c,0],[1,t]),r));return wn(u)}}),rl=Object.freeze({hannWindow:Jc,hammingWindow:el,frame:tl,stft:nl});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Qc||(Qc={}));var ol=rn({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=Qc.SUM_BY_NONZERO_WEIGHTS);var o=jt(e,"labels","absoluteDifference"),a=jt(t,"predictions","absoluteDifference"),i=null;null!=n&&(i=jt(n,"weights","absoluteDifference")),S(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return al(s,i,r)}}),al=rn({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=Qc.SUM_BY_NONZERO_WEIGHTS);var r=jt(e,"losses","computeWeightedLoss"),o=null;null!=t&&(o=jt(t,"weights","computeWeightedLoss"));var a=null==o?r:r.mul(o);if(n===Qc.NONE)return a;if(n===Qc.SUM)return a.sum();if(n===Qc.MEAN){if(null==o)return a.mean();var i=r.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(ln(i)):s}if(n===Qc.SUM_BY_NONZERO_WEIGHTS){if(null==o)return a.sum().div(ln(r.size));var u=o.mul(vn(r.shape)).notEqual(ln(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),il=rn({cosineDistance_:function(e,t,n,r,o){void 0===o&&(o=Qc.SUM_BY_NONZERO_WEIGHTS);var a=jt(e,"labels","cosineDistance"),i=jt(t,"predictions","cosineDistance"),s=null;null!=r&&(s=jt(r,"weights","cosineDistance")),S(a.shape,i.shape,"Error in cosineDistance: ");var u=ln(1).sub(a.mul(i).sum(n,!0));return al(u,s,o)}}),sl=rn({hingeLoss_:function(e,t,n,r){void 0===r&&(r=Qc.SUM_BY_NONZERO_WEIGHTS);var o=jt(e,"labels","hingeLoss"),a=jt(t,"predictions","hingeLoss"),i=null;null!=n&&(i=jt(n,"weights","hingeLoss")),S(o.shape,a.shape,"Error in hingeLoss: ");var s=ln(1);o=ln(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return al(u,i,r)}}),ul=rn({huberLoss_:function(e,t,n,r,o){void 0===r&&(r=1),void 0===o&&(o=Qc.SUM_BY_NONZERO_WEIGHTS);var a=jt(e,"labels","huberLoss"),i=jt(t,"predictions","huberLoss"),s=null;null!=n&&(s=jt(n,"weights","huberLoss")),S(a.shape,i.shape,"Error in huberLoss: ");var u=ln(r),c=i.sub(a).abs(),l=uu(c,u),f=c.sub(l),p=ln(.5).mul(l.square()).add(u.mul(f));return al(p,s,o)}}),cl=rn({logLoss_:function(e,t,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=Qc.SUM_BY_NONZERO_WEIGHTS);var a=jt(e,"labels","logLoss"),i=jt(t,"predictions","logLoss"),s=null;null!=n&&(s=jt(n,"weights","logLoss")),S(a.shape,i.shape,"Error in logLoss: ");var u=ln(1),c=ln(r),l=a.mul(i.add(c).log()).neg().sub(u.sub(a).mul(u.sub(i).add(c).log()));return al(l,s,o)}}),ll=rn({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=Qc.SUM_BY_NONZERO_WEIGHTS);var o=jt(e,"labels","meanSquaredError"),a=jt(t,"predictions","meanSquaredError"),i=null;null!=n&&(i=jt(n,"weights","meanSquaredError")),S(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return al(s,i,r)}}),fl=rn({sigmoidCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Qc.SUM_BY_NONZERO_WEIGHTS);var a=jt(e,"multiClassLabels","sigmoidCrossEntropy"),i=jt(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=jt(n,"weights","sigmoidCrossEntropy")),S(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=ln(r),c=ln(1),l=ln(.5);a=a.mul(c.sub(u)).add(l.mul(u))}var f=function(e,t){var n=jt(e,"labels","sigmoidCrossEntropyWithLogits"),r=jt(t,"logits","sigmoidCrossEntropyWithLogits");S(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),a=r.mul(n),i=r.abs().neg().exp().log1p();return o.sub(a).add(i)}(a,i);return al(f,s,o)}}),pl=rn({softmaxCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Qc.SUM_BY_NONZERO_WEIGHTS);var a=jt(e,"onehotLabels","softmaxCrossEntropy"),i=jt(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=jt(n,"weights","softmaxCrossEntropy")),S(a.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=ln(r),c=ln(1),l=ln(a.shape[1]);a=a.mul(c.sub(u)).add(u.div(l))}var f=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return Tr((function(e,t,r){var o=t.logSumExp([n],!0),a=t.toFloat().sub(o);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],o=t[1],a=Yt(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(o.exp())),e.reshape(a).mul(o.exp().sub(r.toFloat()))]}}}))(e,t)}(a,i);return al(f,s,o)}}),hl=Object.freeze({get Reduction(){return Qc},absoluteDifference:ol,computeWeightedLoss:al,cosineDistance:il,hingeLoss:sl,huberLoss:ul,logLoss:cl,meanSquaredError:ll,sigmoidCrossEntropy:fl,softmaxCrossEntropy:pl});function dl(e,t){return void 0===t&&(t=!1),ke.tidy((function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=qn(n),a=e.clone(),i=pn([[1]],[1,1]),s=i.clone(),u=n>=r?r:n,c=function(e){var t,u=a,c=s,l=o;t=ke.tidy((function(){var t=a.slice([e,e],[n-e,1]),u=t.norm(),c=a.slice([e,e],[1,1]),l=pn([[-1]]).where(c.greater(0),pn([[1]])),f=c.sub(l.mul(u)),p=t.div(f);s=1===p.shape[0]?i.clone():i.concat(p.slice([1,0],[p.shape[0]-1,p.shape[1]]),0);var h=l.matMul(f).div(u).neg(),d=a.slice([e,0],[n-e,r]),v=h.mul(s);if(0===e)a=d.sub(v.matMul(s.transpose().matMul(d)));else{var m=d.sub(v.matMul(s.transpose().matMul(d)));a=a.slice([0,0],[e,r]).concat(m,0)}var g=o.slice([0,e],[n,o.shape[1]-e]);if(0===e)o=g.sub(g.matMul(s).matMul(v.transpose()));else{var y=g.sub(g.matMul(s).matMul(v.transpose()));o=o.slice([0,0],[n,e]).concat(y,1)}return[s,a,o]})),s=t[0],a=t[1],o=t[2],Wt([u,c,l])},l=0;l<u;++l)c(l);return!t&&n>r&&(o=o.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[o,a]}))}var vl=rn({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=jt(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,a=r.shape.slice(-2),i=a[0],s=a[1];if(!(t<=i))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+i+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=i),n<0&&(n=s);var u=yn(0,i,1,"int32").reshape([-1,1]),c=yn(0,s,1,"int32"),l=gu(u,c),f=zs(l.lessEqual(ln(+t,"int32")),l.greaterEqual(ln(-n,"int32"))),p=mn([i,s],r.dtype);return ur(fr(r.reshape([-1,i,s])).map((function(e){return Ys(f,e,p)}))).reshape(o)}}),ml=rn({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,C(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){C(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"}))},o=1;o<e.length;++o)r(o)}else t=!0,e=_n(e,e.shape[0],0).map((function(e){return sr(e,[0])}));C(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."}));var a=[],i=e,s=function(e){a.push(ke.tidy((function(){var t=i[e];if(e>0)for(var n=0;n<e;++n){var r=Sc(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(Fc(t,"euclidean"))})))};for(o=0;o<e.length;++o)s(o);return t?ur(a,0):a}}),gl=rn({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return dl(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=fr(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],a=[];return r.forEach((function(e){var n=dl(e,t),r=n[0],i=n[1];o.push(r),a.push(i)})),[ur(o,0).reshape(e.shape),ur(a,0).reshape(e.shape)]}}),yl=Object.freeze({bandPart:vl,gramSchmidt:ml,qr:gl});function bl(e,t,n,r,o,a){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==a&&(a=0);var i=e.shape[0];return n=Math.min(n,i),C(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),C(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"})),C(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),C(1===t.rank,(function(){return"scores must be a 1D tensor"})),C(t.shape[0]===i,(function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+t.shape[0]})),C(0<=a&&a<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:a}}var xl=rn({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=jt(e,"images","resizeBilinear");C(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),C(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=ke.runKernelFunc((function(e,t){return t([o]),e.resizeBilinear(o,i,s,n)}),{x:o},(function(e,t){return{x:function(){return ke.runKernelFunc((function(r){return r.resizeBilinearBackprop(e,t[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:i,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),wl=rn({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=jt(e,"images","resizeNearestNeighbor");C(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),C(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),C("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=ke.runKernelFunc((function(e,t){return t([o]),e.resizeNearestNeighbor(o,i,s,n)}),{batchImages:o},(function(e,t){return{batchImages:function(){return ke.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)}),{})}}}));return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),El=rn({nonMaxSuppression_:function(e,t,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var a=jt(e,"boxes","nonMaxSuppression"),i=jt(t,"scores","nonMaxSuppression"),s=bl(a,i,n,r,o);n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return ke.runKernelFunc((function(e){return e.nonMaxSuppression(a,i,n,r,o)}),{boxes:a,scores:i},null,"NonMaxSuppressionV3",u)}}),Al=rn({nonMaxSuppressionWithScore_:function(e,t,n,r,o,a){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var i=jt(e,"boxes","nonMaxSuppression"),s=jt(t,"scores","nonMaxSuppression"),u=bl(i,s,n,r,o,a),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},l=ke.runKernel("NonMaxSuppressionV5",{boxes:i,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),Cl=rn({cropAndResize_:function(e,t,n,r,o,a){var i=jt(e,"image","cropAndResize"),s=jt(t,"boxes","cropAndResize","float32"),u=jt(n,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var c=s.shape[0];return C(4===i.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."})),C(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."})),C(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."})),C(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),C(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),C("bilinear"===o||"nearest"===o,(function(){return"method must be bilinear or nearest, but was "+o})),ke.runKernelFunc((function(e,t){return e.cropAndResize(i,s,u,r,o,a)}),{images:i,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:a,cropSize:r})}}),Sl=Object.freeze({resizeBilinear:xl,resizeNearestNeighbor:wl,nonMaxSuppression:El,nonMaxSuppressionAsync:function(e,t,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),s(this,void 0,void 0,(function(){var a,i,s,c,l,f,p;return u(this,(function(u){switch(u.label){case 0:return a=jt(e,"boxes","nonMaxSuppressionAsync"),i=jt(t,"scores","nonMaxSuppressionAsync"),s=bl(a,i,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([a.data(),i.data()])];case 1:return c=u.sent(),l=c[0],f=c[1],p=ao(l,f,n,r,o),a!==e&&a.dispose(),i!==t&&i.dispose(),[2,p]}}))}))},nonMaxSuppressionWithScore:Al,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,o,a){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0),s(this,void 0,void 0,(function(){var i,s,c,l,f,p,h;return u(this,(function(u){switch(u.label){case 0:return i=jt(e,"boxes","nonMaxSuppressionAsync"),s=jt(t,"scores","nonMaxSuppressionAsync"),c=bl(i,s,n,r,o,a),n=c.maxOutputSize,r=c.iouThreshold,o=c.scoreThreshold,a=c.softNmsSigma,[4,Promise.all([i.data(),s.data()])];case 1:return l=u.sent(),f=l[0],p=l[1],h=io(f,p,n,r,o,a),i!==e&&i.dispose(),s!==t&&s.dispose(),[2,h]}}))}))},cropAndResize:Cl}),_l=function(e,t){return!(e>0)||"linear"===t},Il=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},Rl=function(e,t){var n=t,r=Mr(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},Tl=function(e,t,n){if("linear"===t)return e;if("relu"===t)return Pc(e);if("elu"===t)return Ic(e);if("relu6"===t)return Nc(e);if("prelu"===t)return Tc(e,n);throw new Error("Unknown fused activation "+t+".")},Pl=rn({fusedMatMul_:function(e){var t,n=e.a,r=e.b,o=e.transposeA,a=void 0!==o&&o,i=e.transposeB,s=void 0!==i&&i,u=e.bias,c=e.activation,l=void 0===c?"linear":c,f=e.preluActivationWeights;if(!1===_l(ke.state.gradientDepth,l)){var p=Xu(n,r,a,s);return null!=u&&(p=Qs(p,u)),Tl(p,l,f)}var h=jt(n,"a","fused matMul"),d=jt(r,"b","fused matMul");t=Re(h,d),h=t[0],d=t[1];var v=a?h.shape[h.rank-2]:h.shape[h.rank-1],m=s?d.shape[d.rank-1]:d.shape[d.rank-2],g=a?h.shape[h.rank-1]:h.shape[h.rank-2],y=s?d.shape[d.rank-2]:d.shape[d.rank-1],b=h.shape.slice(0,-2),x=d.shape.slice(0,-2),w=R(b),E=R(x);C(h.rank>=2&&d.rank>=2&&h.rank===d.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+d.rank+"."})),C(T(b,x),(function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+x+") of Tensors with shapes "+h.shape+" and "+d.shape+" must match."})),C(v===m,(function(){return"Error in fused matMul: inner shapes ("+v+") and ("+m+") of Tensors with shapes "+h.shape+" and "+d.shape+" and transposeA="+a+" and transposeB="+s+" must match."}));var A,S,_=h.shape.slice(0,-2).concat([g,y]),I=a?h.as3D(w,v,g):h.as3D(w,g,v),P=s?d.as3D(E,y,m):d.as3D(E,m,y);null!=u&&Lr(_,(A=Re(A=jt(u,"bias","fused matMul"),h)[0]).shape),null!=f&&(S=jt(f,"prelu weights","fused matMul"));var N={a:I,b:P};null!=u&&(N.bias=A),null!=f&&(N.preluActivationWeights=S);var O=[I,P];return ke.runKernelFunc((function(e,t){var n=e.fusedBatchMatMul({a:I,b:P,transposeA:a,transposeB:s,bias:A,activation:l,preluActivationWeights:S});return t([I,P,n]),n}),N,(function(e,t){var n=t[0],r=t[1],o=t[2],i=Il(e,o,l),c={};return null!=u&&(c={bias:function(){return Rl(A,i)}}),a||s?!a&&s?Object.assign({a:function(){return i.matMul(r,!1,!1)},b:function(){return i.matMul(n,!0,!1)}},c):a&&!s?Object.assign({a:function(){return r.matMul(i,!1,!0)},b:function(){return n.matMul(i,!1,!1)}},c):Object.assign({a:function(){return r.matMul(i,!0,!0)},b:function(){return i.matMul(n,!0,!0)}},c):Object.assign({a:function(){return i.matMul(r,!1,!0)},b:function(){return n.matMul(i,!0,!1)}},c)}),"_FusedMatMul",{transposeA:a,transposeB:s,activation:l},O,[!0]).reshape(_)}}),Nl=rn({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,a=e.dataFormat,i=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,p=void 0===f?"linear":f,h=e.preluActivationWeights;if(p=p||"linear",!1===_l(ke.state.gradientDepth,p)){var d=Bu(t,n,r,o,i,u,c);return null!=l&&(d=Qs(d,l)),Tl(d,p,h)}var v=jt(t,"x","conv2d"),m=jt(n,"filter","conv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),C(4===g.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."})),C(4===m.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."})),null!=c&&C(P(o),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."})),C(g.shape[3]===m.shape[2],(function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+m.shape[2]+"."})),C(Kr(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),C("NHWC"===i,(function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."}));var b,x,w=Gr(g.shape,m.shape,r,u,o,c);null!=l&&(b=Re(b=jt(l,"bias","fused conv2d"),v)[0],Lr(w.outShape,b.shape)),null!=h&&(x=jt(h,"prelu weights","fused conv2d"));var E={x:g,filter:m};null!=l&&(E.bias=b),null!=h&&(E.preluActivationWeights=x);var A=[m,g],S=ke.runKernelFunc((function(e,t){var n=e.fusedConv2d({input:g,filter:m,convInfo:w,bias:b,activation:p,preluActivationWeights:x});return t([m,g,n]),n}),E,(function(e,t){var n=t,a=n[0],i=n[1],s=n[2],c=Il(e,s,p);C(qr(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var f={};return null!=l&&(f={bias:function(){return Rl(b,c)}}),Object.assign({x:function(){return Vu(i.shape,c,a,r,o)},filter:function(){return Wu(i,c,a.shape,r,o)}},f)}),"FusedConv2D",{convInfo:w,activation:p},A,[!0]);return y?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),Ol=rn({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,a=e.dataFormat,i=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,p=void 0===f?"linear":f,h=e.preluActivationWeights;if(!1===_l(ke.state.gradientDepth,p)){var d=$u(t,n,r,o,i,u,c);return null!=l&&(d=Qs(d,l)),Tl(d,p,h)}var v=jt(t,"x","depthwiseConv2d"),m=jt(n,"filter","depthwiseConv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),C(4===g.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."})),C(4===m.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."})),C(g.shape[3]===m.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."})),null==u&&(u=[1,1]),C(Kr(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),null!=c&&C(P(o),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."}));var b,x,w=Gr(g.shape,m.shape,r,u,o,c,!0);null!=l&&(b=Re(b=jt(l,"bias","fused conv2d"),v)[0],Lr(w.outShape,b.shape)),null!=h&&(x=jt(h,"prelu weights","fused depthwiseConv2d"));var E={x:g,filter:m};null!=l&&(E.bias=b),null!=h&&(E.preluActivationWeights=x);var A=[m,g],S=ke.runKernelFunc((function(e,t){var n=e.fusedDepthwiseConv2D({input:g,filter:m,convInfo:w,bias:b,activation:p,preluActivationWeights:x});return t([m,g,n]),n}),E,(function(e,t){C(qr(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var n=t[0],r=t[1],o=t[2],a=Il(e,o,p),i={};return null!=l&&(i={bias:function(){return Rl(b,a)}}),Object.assign({x:function(){return Hu(r.shape,a,n,w)},filter:function(){return ju(r,a,n.shape,w)}},i)}),"FusedDepthwiseConv2D",{convInfo:w,activation:p},A,[!0]);return y?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),Dl=Object.freeze({matMul:Pl,conv2d:Nl,depthwiseConv2d:Ol}),kl=Object.freeze({image:Sl,linalg:yl,losses:hl,spectral:zc,fused:Dl,signal:rl,square:Xi,squaredDifference:Zi,conv1d:Uu,conv2d:Bu,conv3d:Gu,depthwiseConv2d:$u,separableConv2d:zu,conv2dTranspose:qu,conv3dTranspose:Ku,op:rn,batchNormalization2d:Us,batchNormalization3d:Bs,batchNormalization4d:Gs,batchNormalization:Ws,batchNorm:Vs,batchNorm2d:$s,batchNorm3d:Hs,batchNorm4d:js,booleanMaskAsync:function(e,t,n){return s(this,void 0,void 0,(function(){var r,o,a,i,s,c,l,f,p,h,d,v,m;return u(this,(function(u){switch(u.label){case 0:for(r=jt(e,"tensor","boolMask"),o=jt(t,"mask","boolMask","bool"),a=null==n?0:n,i=o.rank,s=r.shape,C(i>0,(function(){return"mask cannot be scalar"})),S(s.slice(a,a+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=a;l<a+i;l++)c*=s[l];return f=s.slice(0,a).concat([c],s.slice(a+i)),p=r.reshape(f),h=o.reshape([-1]),[4,Zs(h)];case 1:return d=u.sent(),v=d.squeeze([1]),m=Du(p,v,a),e!==r&&r.dispose(),t!==o&&o.dispose(),v.dispose(),p.dispose(),h.dispose(),d.dispose(),[2,m]}}))}))},complex:on,real:an,imag:sn,concat:wn,concat1d:En,concat2d:An,concat3d:Cn,concat4d:Sn,split:_n,matMul:Xu,dot:Yu,outerProduct:Zu,reverse:Qu,reverse1d:Ju,reverse2d:ec,reverse3d:tc,reverse4d:nc,maxPool:ac,avgPool:ic,pool:sc,maxPool3d:uc,avgPool3d:cc,slice:lc,slice1d:fc,slice2d:pc,slice3d:hc,slice4d:dc,abs:Qi,acos:Ji,acosh:es,asin:ts,asinh:ns,atan:rs,atanh:os,ceil:as,clipByValue:is,cos:ss,cosh:us,erf:cs,exp:ls,expm1:fs,floor:ps,log:hs,log1p:ds,logSigmoid:vs,neg:ms,reciprocal:gs,round:ys,rsqrt:bs,sigmoid:xs,sign:ws,isNaN:Es,isInf:As,isFinite:Cs,sin:Ss,sinh:_s,softplus:Is,sqrt:Rs,step:Ts,tan:Ps,tanh:Ns,all:mc,any:gc,argMax:yc,argMin:bc,logSumExp:xc,max:wc,mean:Ec,min:Ac,moments:Cc,sum:Sc,prod:_c,equal:bu,equalStrict:xu,greater:wu,greaterEqual:Eu,greaterEqualStrict:Au,greaterStrict:Cu,less:Su,lessEqual:_u,lessEqualStrict:Iu,lessStrict:Ru,notEqual:Tu,notEqualStrict:Pu,add:Qs,addN:Js,addStrict:eu,atan2:tu,div:nu,divNoNan:ru,divStrict:ou,floorDiv:au,maximum:iu,maximumStrict:su,minimum:uu,minimumStrict:cu,mod:lu,modStrict:fu,mul:pu,mulStrict:hu,pow:du,powStrict:vu,squaredDifferenceStrict:mu,sub:gu,subStrict:yu,elu:Ic,leakyRelu:Rc,prelu:Tc,relu:Pc,relu6:Nc,selu:Oc,logicalAnd:zs,logicalNot:qs,logicalOr:Ks,logicalXor:Xs,where:Ys,whereAsync:Zs,buffer:Bn,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:Gn,broadcastTo:Wn,cast:Vn,clone:$n,cumsum:Hn,depthToSpace:jn,expandDims:zn,eye:qn,multinomial:Kn,oneHot:Xn,pad:Yn,pad1d:Zn,pad2d:Qn,pad3d:Jn,pad4d:er,rand:tr,randomNormal:nr,randomGamma:rr,randomUniform:or,reshape:ar,spaceToBatchND:ir,squeeze:sr,stack:ur,tile:cr,truncatedNormal:lr,unstack:fr,setdiff1dAsync:function(e,t){return s(this,void 0,void 0,(function(){var n,r,o,a,i,s,c,l,f,p;return u(this,(function(u){switch(u.label){case 0:return n=jt(e,"x","setdiff1d"),r=jt(t,"y","setdiff1d"),C(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),C(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),C(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return o=u.sent(),[4,r.data()];case 2:for(a=u.sent(),i=new Set(a),s=0,f=0;f<o.length;f++)i.has(o[f])||s++;for(c=new de([s],n.dtype),l=new de([s],"int32"),f=0,p=0;f<o.length;f++)i.has(o[f])||(c.values[p]=o[f],l.values[p]=f,p++);return[2,[c.toTensor(),l.toTensor()]]}}))}))},fill:gn,linspace:function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return ke.runKernelFunc((function(r){return r.linspace(e,t,n)}),{})},ones:vn,range:yn,scalar:ln,tensor:un,tensor1d:fn,tensor2d:pn,tensor3d:hn,tensor4d:dn,tensor5d:function(e,t,n){if(_(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=$t(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return cn(e,t,r,n)},tensor6d:function(e,t,n){if(_(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=$t(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return cn(e,t=t||r,r,n)},variable:function(e,t,n,r){return void 0===t&&(t=!0),ke.makeVariable(e,t,n,r)},zeros:mn,onesLike:bn,zerosLike:xn,transpose:Dc,softmax:Pr,logSoftmax:Nr,localResponseNormalization:kc,norm:Fc,gather:Du,unsortedSegmentSum:ku,basicLSTMCell:Mc,multiRNNCell:Lc,movingAverage:Uc,stridedSlice:Bc,topk:Gc,scatterND:Wc,fft:Vc,ifft:$c,rfft:Hc,irfft:jc,sparseToDense:qc,gatherND:Kc,diag:Xc,dropout:Yc,hannWindow:Jc,hammingWindow:el,frame:tl,stft:nl,inTopKAsync:function(e,t,n){return void 0===n&&(n=1),s(this,void 0,void 0,(function(){var r,o,a,i,s,c,l,f,p,h,d,v,m,g;return u(this,(function(u){switch(u.label){case 0:return r=jt(e,"predictions","inTopK"),o=jt(t,"targets","inTopK"),C(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),C(r.rank-1===o.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank})),S(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],C(n>0&&n<=a,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+n})),[4,r.data()];case 1:return i=u.sent(),[4,o.data()];case 2:for(s=u.sent(),c=[i.length/a,a],f=c[1],p=U("bool",l=c[0]),h=0;h<l;h++){for(d=h*f,v=i.subarray(d,d+f),m=[],g=0;g<v.length;g++)m.push({value:v[g],index:g});for(m.sort((function(e,t){return t.value-e.value})),p[h]=0,g=0;g<n;g++)if(m[g].index===s[h]){p[h]=1;break}}return e!==r&&r.dispose(),t!==o&&o.dispose(),[2,un(p,o.shape,"bool")]}}))}))}});function Fl(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&C("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors."}))}))}function Ml(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var Ll=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new Or(t,ke),t}return i(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,f().get("IS_NODE")&&Vt("\n============================\nHi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return s(this,void 0,void 0,(function(){return u(this,(function(t){return[2,this.readSync(e)]}))}))},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?Jr(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return ie(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Bn(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return ke.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return s(this,void 0,void 0,(function(){var t;return u(this,(function(n){return t=re(),e(),[2,{kernelMs:re()-t}]}))}))},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:ke.keep(e.clone()),imag:ke.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(Fl(e,"slice"),Ir(e.shape,t,n)){var r=Rr(t,e.strides),o=R(n);return un(this.readSync(e.dataId).subarray(r,r+o),n,e.dtype)}for(var a=Bn(n,e.dtype),i=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s).map((function(e,n){return e+t[n]}));a.values[s]=i.get.apply(i,u)}return a.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){Fl(e,"stridedSlice");var o=Cr(t,n,r);if(o.some((function(e){return 0===e})))return un([],o);for(var a=Bn(o,e.dtype),i=this.bufferSync(e),s=0;s<a.size;s++){for(var u=a.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+t[l];a.set.apply(a,[i.get.apply(i,c)].concat(u))}return a.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=Bn([e.size,e.size],e.dtype),r=n.values,o=0;o<t.length;o++)r[o*e.size+o]=t[o];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},t.prototype.reverse=function(e,t){Fl(e,"reverse");for(var n=Bn(e.shape,e.dtype),r=this.bufferSync(e),o=function(o){var a=n.indexToLoc(o),i=a.slice();t.forEach((function(t){return i[t]=e.shape[t]-1-i[t]})),n.set.apply(n,[r.get.apply(r,i)].concat(a))},a=0;a<n.size;a++)o(a);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map((function(e){return an(e)})),o=e.map((function(e){return sn(e)}));return on(this.concat(r,t),this.concat(o,t))}var a=e.map((function(e){var n=R(e.shape.slice(t));return e.as2D(-1,n)})),i=nn(a.map((function(e){return e.shape})),1),s=Bn(i,e[0].dtype).values;if(1===a[0].shape[0]){var u=0;a.forEach((function(e){s.set(n.readSync(e.dataId),u),u+=e.size}))}else{var c=0;a.forEach((function(e){for(var t=n.readSync(e.dataId),r=0,o=0;o<e.shape[0];++o)for(var a=o*i[1]+c,u=0;u<e.shape[1];++u)s[a+u]=t[r++];c+=e.shape[1]}))}var l=nn(e.map((function(e){return e.shape})),t);return un(s,l,e[0].dtype)},t.prototype.neg=function(e){return Fl(e,"neg"),this.multiply(ln(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e+n,imag:t+r}})):this.broadcastedBinaryOp(e,t,_e(e.dtype,t.dtype),(function(e,t){return e+t}))},t.prototype.addN=function(e){var t=this;Fl(e,"addN");for(var n=e.map((function(e){return t.readSync(e.dataId)})),r=Bn(e[0].shape,e[0].dtype),o=r.values,a=0;a<e.length;a++)for(var i=n[a],s=0;s<o.length;s++)o[s]+=i[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=M([t],e.shape),r=this.max(e,n),o=Yt(r.shape,n),a=this.subtract(e,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return this.realDivide(i,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e-n,imag:t-r}})):this.broadcastedBinaryOp(e,t,_e(e.dtype,t.dtype),(function(e,t){return e-t}))},t.prototype.pow=function(e,t){return Fl([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))},t.prototype.batchMatMul=function(e,t,n,r){Fl([e,t],"matMul");for(var o=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=l[0],p=l[1],h=l[2],d=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],v=d[0],m=d[1],g=d[2],y=a*i,b=Bn([s,a,i],e.dtype),x=b.values,w=this.blockSize,E=0;E<s;E++)for(var A=0;A<a;A+=w)for(var C=0;C<i;C+=w)for(var S=0;S<o;S+=w)for(var _=Math.min(A+w,a),I=Math.min(C+w,i),R=Math.min(S+w,o),T=A;T<_;T++)for(var P=C;P<I;P++){for(var N=0,O=S;O<R;O++)N+=u[E*f+T*p+O*h]*c[O*v+P*m+E*g];x[E*y+(T*i+P)]+=N}return b.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,o=e.transposeB,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=this.batchMatMul(t,n,r,o);return a&&(u=this.add(u,a)),i&&(u=Ml(this,u,i,s)),u},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})):this.broadcastedBinaryOp(e,t,_e(e.dtype,t.dtype),(function(e,t){return e*t}))},t.prototype.realDivide=function(e,t){return Fl([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",(function(e,t){return e/t}))},t.prototype.floorDiv=function(e,t){return Fl([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))},t.prototype.sum=function(e,t){Fl(e,"sum"),Zt("sum",t,e.rank);for(var n=Xt(e.shape,t),r=n[0],o=n[1],a=mn(r,_e(e.dtype,"int32")),i=R(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*i,f=0,p=0;p<i;++p)f+=u[l+p];s[c]=f}return a},t.prototype.prod=function(e,t){Fl(e,"sum");for(var n=Xt(e.shape,t),r=n[0],o=n[1],a=mn(r,_e(e.dtype,"int32")),i=R(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*i,f=1,p=0;p<i;++p)f*=u[l+p];s[c]=f}return a},t.prototype.unsortedSegmentSum=function(e,t,n){Fl(e,"unsortedSegmentSum");for(var r=[],o=e.rank-t.rank,a=0;a<o;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var i=ln(a,"int32"),s=bu(i,t).asType("float32").mul(e).sum(0);r.push(s)}return ur(r)},t.prototype.argMin=function(e,t){Fl(e,"argMin");var n=[t];Zt("argMin",n,e.rank);for(var r=Xt(e.shape,n),o=r[0],a=r[1],i=mn(o,"int32"),s=R(a),u=this.readSync(i.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var f=l*s,p=c[f],h=0,d=0;d<s;++d){var v=c[f+d];v<p&&(p=v,h=d)}u[l]=h}return i},t.prototype.argMax=function(e,t){Fl(e,"argMax");var n=[t];Zt("argMax",n,e.rank);for(var r=Xt(e.shape,n),o=r[0],a=r[1],i=mn(o,"int32"),s=R(a),u=this.readSync(i.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var f=l*s,p=c[f],h=0,d=0;d<s;++d){var v=c[f+d];v>p&&(p=v,h=d)}u[l]=h}return i},t.prototype.cumsum=function(e,t,n,r){if(Fl(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=_e(e.dtype,"int32"),a=mn(e.shape,o),i=this.readSync(a.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],c=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},l=0;l<s.length;l+=u)for(var f=0;f<u;f++){var p=c(l,f);if(0===f)i[p]=n?0:s[p];else{var h=c(l,f-1);i[p]=n?s[h]+i[h]:s[p]+i[h]}}return a},t.prototype.equal=function(e,t){return Fl([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))},t.prototype.notEqual=function(e,t){return Fl([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))},t.prototype.less=function(e,t){return Fl([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))},t.prototype.lessEqual=function(e,t){return Fl([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))},t.prototype.greater=function(e,t){return Fl([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))},t.prototype.greaterEqual=function(e,t){return Fl([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))},t.prototype.logicalNot=function(e){Fl(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return Fl([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))},t.prototype.logicalOr=function(e,t){return Fl([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))},t.prototype.select=function(e,t,n){Fl([e,t,n],"select");for(var r=this.readSync(e.dataId),o=this.readSync(t.dataId),a=this.readSync(n.dataId),i=mn(t.shape,_e(t.dtype,n.dtype)),s=this.readSync(i.dataId),u=0,c=0===e.rank||e.rank>1||1===t.rank?1:R(t.shape.slice(1)),l=0;l<r.length;l++)for(var f=0;f<c;f++)1===r[l]?s[u++]=o[l]:s[u++]=a[l];return i},t.prototype.where=function(e){Fl([e],"where");var t=this.readSync(e.dataId);return vo(e.shape,t)},t.prototype.topk=function(e,t,n){return Fl(e,"topk"),ho(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){Fl(e,"min"),Zt("min",t,e.rank);for(var n=Xt(e.shape,t),r=n[0],o=n[1],a=mn(r,e.dtype),i=R(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*i,f=u[l],p=0;p<i;++p){var h=u[l+p];h<f&&(f=h)}s[c]=f}return a},t.prototype.minimum=function(e,t){return Fl([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))},t.prototype.mod=function(e,t){return Fl([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))},t.prototype.max=function(e,t){Fl(e,"max"),Zt("max",t,e.rank);for(var n=Xt(e.shape,t),r=n[0],o=n[1],a=mn(r,e.dtype),i=R(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*i,f=u[l],p=0;p<i;++p){var h=u[l+p];h>f&&(f=h)}s[c]=f}return a},t.prototype.maximum=function(e,t){return Fl([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))},t.prototype.all=function(e,t){Fl(e,"all"),Zt("all",t,e.rank);for(var n=Xt(e.shape,t),r=n[0],o=n[1],a=mn(r,e.dtype),i=R(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*i,f=u[l],p=0;p<i;++p){var h=u[l+p];f=f&&h}s[c]=f}return a},t.prototype.any=function(e,t){Fl(e,"any"),Zt("any",t,e.rank);for(var n=Xt(e.shape,t),r=n[0],o=n[1],a=mn(r,e.dtype),i=R(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*i,f=u[l],p=0;p<i;++p){var h=u[l+p];f=f||h}s[c]=f}return a},t.prototype.squaredDifference=function(e,t){return Fl([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))},t.prototype.ceil=function(e){Fl(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){Fl(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){Fl(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){Fl(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){Fl(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){Fl(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){Fl(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=Math.floor(t[r]);t[r]-o<.5?n[r]=Math.floor(t[r]):t[r]-o>.5?n[r]=Math.ceil(t[r]):n[r]=o%2==0?o:o+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){Fl(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){Fl(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){Fl(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){Fl(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log1p(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){Fl(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.sqrt(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){Fl(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=1/Math.sqrt(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){Fl(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){Fl(e,"relu");for(var t=mn(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return t},t.prototype.relu6=function(e){Fl(e,"relu");for(var t=mn(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),o=0;o<r.length;++o)n[o]=Math.min(Math.max(0,r[o]),6);return t},t.prototype.prelu=function(e,t){return Fl([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return e<0?t*e:e}))},t.prototype.elu=function(e){Fl(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=n[r];t[r]=o>=0?o:Math.exp(o)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){Fl([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),o=this.readSync(e.dataId),a=0;a<r.length;++a){var i=r[a];n[a]=i>=1?o[a]:o[a]*(i+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){Fl(e,"selu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=n[r];t[r]=o>=0?1.0507009873554805*o:1.7580993408473768*(Math.exp(o)-1)}return this.makeOutput(t,e.shape,"float32")},t.prototype.clip=function(e,t,n){Fl(e,"clip");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>n?n:i<t?t:i}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var o=n[2*r],a=n[2*r+1];t[r]=Math.hypot(o,a)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){Fl(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){Fl(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){Fl(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var a,i=r[o]>-t,s=r[o]<t,u=Math.exp(r[o]);a=s?u:i?r[o]:Math.log(1+u),n[o]=a}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){Fl(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){Fl(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){Fl(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){Fl(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){Fl(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){Fl(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return Fl([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))},t.prototype.sinh=function(e){Fl(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){Fl(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){Fl(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=N(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){Fl(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){Fl(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){Fl(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){Fl(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=Math.sign(n[r]),a=Math.abs(n[r]),i=1/(1+.3275911*a);t[r]=o*(1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-a*a))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),Fl(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var a=r[o];isNaN(a)?n[o]=NaN:n[o]=a>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights,s=this.conv2d(t,n,r);return o&&(s=this.add(s,o)),a&&(s=Ml(this,s,a,i)),s},t.prototype.conv2d=function(e,t,n){Fl([e,t],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=Bn(n.outShape,e.dtype),f=e.strides[0],p=c?e.strides[1]:e.strides[2],h=c?e.strides[2]:1,d=c?1:e.strides[1],v=l.strides[0],m=c?l.strides[1]:l.strides[2],g=c?l.strides[2]:1,y=c?1:l.strides[1],b=this.readSync(e.dataId),x=this.readSync(t.dataId),w=l.values,E=0;E<n.batchSize;++E)for(var A=E*f,C=E*v,S=0;S<n.outHeight;++S)for(var _=C+S*m,I=S*n.strideHeight-u,R=0;R<r;R++){var T=I+R*a;if(!(T<0||T>=n.inHeight))for(var P=R*t.strides[0],N=A+T*p,O=0;O<n.outWidth;++O)for(var D=_+O*g,k=O*n.strideWidth-s,F=0;F<o;F++){var M=k+F*i;if(!(M<0||M>=n.inWidth))for(var L=N+M*h,U=P+F*t.strides[1],B=0;B<n.inChannels;++B){for(var G=b[L+B*d],W=0;W<n.outChannels;++W)w[D+W*y]+=G*x[U+W];U+=n.outChannels}}}return l.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,o=n.filterHeight,a=n.filterWidth,i=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,f=n.padInfo.top,p=Bn(n.outShape,e.dtype),h=this.readSync(e.dataId),d=this.readSync(t.dataId),v=p.values,m=0;m<n.batchSize;++m)for(var g=m*e.strides[0],y=m*p.strides[0],b=0;b<n.outDepth;++b)for(var x=y+b*p.strides[1],w=b*n.strideDepth-c,E=0;E<r;E++){var A=w+E*i;if(!(A<0||A>=n.inDepth))for(var C=E*t.strides[0],S=g+A*e.strides[1],_=0;_<n.outHeight;++_)for(var I=x+_*p.strides[2],R=_*n.strideHeight-f,T=0;T<o;T++){var P=R+T*s;if(!(P<0||P>=n.inHeight))for(var N=C+T*t.strides[1],O=S+P*e.strides[2],D=0;D<n.outWidth;++D)for(var k=I+D*n.outChannels,F=D*n.strideWidth-l,M=0;M<a;M++){var L=F+M*u;if(!(L<0||L>=n.inWidth))for(var U=N+M*t.strides[2],B=O+L*n.inChannels,G=U,W=0;W<n.inChannels;++W){for(var V=h[B+W],$=0;$<n.outChannels;++$)v[k+$]+=V*d[G+$];G+=n.outChannels}}}}return p.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){Fl([e,t],"conv2dDerInput");for(var r=Bn(n.inShape,"float32"),o=r.values,a=this.readSync(e.dataId),i=this.readSync(t.dataId),s=t.strides,u=s[0],c=s[1],l=s[2],f=n.batchSize,p=n.filterHeight,h=n.filterWidth,d=n.inChannels,v=n.inHeight,m=n.inWidth,g=n.outChannels,y=n.outHeight,b=n.outWidth,x=n.strideHeight,w=n.strideWidth,E=n.dataFormat,A=p-1-n.padInfo.top,C=h-1-n.padInfo.left,S="channelsLast"===E,_=r.strides[0],I=S?r.strides[1]:r.strides[2],R=S?r.strides[2]:1,T=S?1:r.strides[1],P=e.strides[0],N=S?e.strides[1]:e.strides[2],O=S?e.strides[2]:1,D=S?1:e.strides[1],k=0;k<f;++k)for(var F=0;F<d;++F)for(var M=0;M<v;++M)for(var L=M-A,U=Math.max(0,Math.ceil(L/x)),B=Math.min(y,(p+L)/x),G=0;G<m;++G){for(var W=G-C,V=Math.max(0,Math.ceil(W/w)),$=Math.min(b,(h+W)/w),H=0,j=U;j<B;++j)for(var z=j*x-L,q=V;q<$;++q)for(var K=P*k+N*j+O*q,X=u*(p-1-z)+c*(h-1-(q*w-W))+l*F,Y=0;Y<g;++Y)H+=a[K+D*Y]*i[X+Y];o[_*k+I*M+R*G+T*F]=H}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=Bn(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],c=a[3],l=this.readSync(e.dataId),f=e.strides,p=f[0],h=f[1],d=f[2],v=f[3],m=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],E=n.batchSize,A=n.filterDepth,C=n.filterHeight,S=n.filterWidth,_=n.inChannels,I=n.inDepth,R=n.inHeight,T=n.inWidth,P=n.outChannels,N=n.outDepth,O=n.outHeight,D=n.outWidth,k=n.strideDepth,F=n.strideHeight,M=n.strideWidth,L=A-1-n.padInfo.front,U=C-1-n.padInfo.top,B=S-1-n.padInfo.left,G=0;G<E;++G)for(var W=0;W<_;++W)for(var V=0;V<I;++V)for(var $=V-L,H=Math.max(0,Math.ceil($/k)),j=Math.min(N,(A+$)/k),z=0;z<R;++z)for(var q=z-U,K=Math.max(0,Math.ceil(q/F)),X=Math.min(O,(C+q)/F),Y=0;Y<T;++Y){for(var Z=Y-B,Q=Math.max(0,Math.ceil(Z/M)),J=Math.min(D,(S+Z)/M),ee=0,te=H;te<j;++te)for(var ne=te*k-$,re=K;re<X;++re)for(var oe=re*F-q,ae=Q;ae<J;++ae)for(var ie=p*G+h*te+d*re+v*ae,se=y*(A-1-ne)+b*(C-1-oe)+x*(S-1-(ae*M-Z))+w*W,ue=0;ue<P;++ue)ee+=l[ie+ue]*m[se+ue];o[i*G+s*V+u*z+c*Y+W]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){Fl([e,t],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s="channelsLast"===n.dataFormat,u=Bn(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,f=this.bufferSync(e),p=this.bufferSync(t),h=0;h<a;++h)for(var d=Math.max(0,Math.ceil((l-h)/r)),v=Math.min(n.outHeight,(n.inHeight+l-h)/r),m=0;m<i;++m)for(var g=Math.max(0,Math.ceil((c-m)/o)),y=Math.min(n.outWidth,(n.inWidth+c-m)/o),b=0;b<n.inChannels;++b)for(var x=0;x<n.outChannels;++x){for(var w=0,E=0;E<n.batchSize;++E)for(var A=d;A<v;++A)for(var C=h+A*r-l,S=g;S<y;++S){var _=m+S*o-c;w+=s?f.get(E,C,_,b)*p.get(E,A,S,x):f.get(E,b,C,_)*p.get(E,x,A,S)}u.set(w,h,m,b,x)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=Bn(n.filterShape,"float32"),l=c.values,f=c.strides,p=f[0],h=f[1],d=f[2],v=f[3],m=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],E=this.readSync(e.dataId),A=e.strides,C=A[0],S=A[1],_=A[2],I=A[3],R=n.padInfo.front,T=n.padInfo.left,P=n.padInfo.top,N=0;N<i;++N)for(var O=Math.max(0,Math.ceil((R-N)/r)),D=Math.min(n.outDepth,(n.inDepth+R-N)/r),k=N*p,F=0;F<s;++F)for(var M=Math.max(0,Math.ceil((P-F)/o)),L=Math.min(n.outHeight,(n.inHeight+P-F)/o),U=F*h+k,B=0;B<u;++B)for(var G=Math.max(0,Math.ceil((T-B)/a)),W=Math.min(n.outWidth,(n.inWidth+T-B)/a),V=B*d+U,$=0;$<n.inChannels;++$)for(var H=$*v+V,j=0;j<n.outChannels;++j){for(var z=0,q=0;q<n.batchSize;++q)for(var K=q*C,X=q*y,Y=O;Y<D;++Y)for(var Z=(N+Y*r-R)*S+K,Q=Y*b+X,J=M;J<L;++J)for(var ee=(F+J*o-P)*_+Z,te=J*x+Q,ne=G;ne<W;++ne){var re=ne*w+te;z+=E[(B+ne*a-T)*I+ee+$]*m[re+j]}l[H+j]=z}return c.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return o&&(s=this.add(s,o)),a&&(s=Ml(this,s,a,i)),s},t.prototype.depthwiseConv2D=function(e,t,n){Fl([e,t],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=Bn(n.outShape,e.dtype),f=this.readSync(e.dataId),p=this.readSync(t.dataId),h=l.values,d=0;d<n.batchSize;++d)for(var v=d*e.strides[0],m=d*l.strides[0],g=0;g<n.outHeight;++g)for(var y=m+g*l.strides[1],b=g*n.strideHeight-s,x=0;x<r;++x){var w=b+x*a;if(!(w<0||w>=n.inHeight))for(var E=x*t.strides[0],A=v+w*e.strides[1],C=0;C<n.outWidth;++C)for(var S=y+C*l.strides[2],_=C*n.strideWidth-u,I=0;I<o;++I){var R=_+I*i;if(!(R<0||R>=n.inWidth))for(var T=E+I*t.strides[1],P=A+R*n.inChannels,N=S,O=T,D=0;D<n.inChannels;++D){for(var k=f[P+D],F=0;F<c;++F)h[N+F]+=k*p[O+F];N+=c,O+=c}}}return l.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){Fl([e,t],"depthwiseConv2DDerInput");for(var r=Bn(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],c=this.readSync(e.dataId),l=e.strides,f=l[0],p=l[1],h=l[2],d=this.readSync(t.dataId),v=t.strides,m=v[0],g=v[1],y=v[2],b=n.batchSize,x=n.filterHeight,w=n.filterWidth,E=n.inChannels,A=n.inHeight,C=n.inWidth,S=n.outChannels,_=n.outHeight,I=n.outWidth,R=n.strideHeight,T=n.strideWidth,P=x-1-n.padInfo.top,N=w-1-n.padInfo.left,O=S/E,D=0;D<b;++D)for(var k=0;k<E;++k)for(var F=0;F<A;++F)for(var M=F-P,L=Math.max(0,Math.ceil(M/R)),U=Math.min(_,(x+M)/R),B=0;B<C;++B){for(var G=B-N,W=Math.max(0,Math.ceil(G/T)),V=Math.min(I,(w+G)/T),$=0,H=L;H<U;++H)for(var j=H*R-M,z=W;z<V;++z)for(var q=f*D+p*H+h*z,K=m*(x-1-j)+g*(w-1-(z*T-G))+y*k,X=0;X<O;++X)$+=c[q+(k*O+X)]*d[K+X];o[i*D+s*F+u*B+k]=$}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){Fl([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=Bn(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,f=this.bufferSync(e),p=this.bufferSync(t),h=0;h<a;++h)for(var d=Math.max(0,Math.ceil((c-h)/r)),v=Math.min(n.outHeight,(n.inHeight+c-h)/r),m=0;m<i;++m)for(var g=Math.max(0,Math.ceil((u-m)/o)),y=Math.min(n.outWidth,(n.inWidth+u-m)/o),b=0;b<n.outChannels;++b){for(var x=Math.trunc(b/l),w=b%l,E=0,A=0;A<n.batchSize;++A)for(var C=d;C<v;++C)for(var S=h+C*r-c,_=g;_<y;++_){var I=m+_*o-u;E+=f.get(A,S,I,x)*p.get(A,C,_,b)}s.set(E,h,m,x,w)}return s.toTensor()},t.prototype.tile=function(e,t){return Fl(e,"tile"),po(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){Fl(e,"pad");var r=t.map((function(t,n){return t[0]+e.shape[n]+t[1]})),o=t.map((function(e){return e[0]})),a=this.bufferSync(e),i=Bn(r,e.dtype);0!==n&&i.values.fill(n);for(var s=0;s<e.size;s++){var u=a.indexToLoc(s),c=u.map((function(e,t){return e+o[t]}));i.set.apply(i,[a.get.apply(a,u)].concat(c))}return i.toTensor()},t.prototype.transpose=function(e,t){Fl(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var o=this.readSync(e.dataId),a=Bn(n,e.dtype),i=this.bufferSync(e);for(r=0;r<e.size;++r){for(var s=i.indexToLoc(r),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[t[c]];var l=a.locToIndex(u);a.values[l]=o[r]}return a.toTensor()},t.prototype.gather=function(e,t,n){Fl([e,t],"gather");var r=e.shape.slice(),o=this.readSync(t.dataId);r[n]=o.length;for(var a=Bn(r,e.dtype),i=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s),c=u.slice();c[n]=o[u[n]];var l=i.locToIndex(c);a.values[s]=i.values[l]}return a.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){Fl([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),o=pr(e.shape,t,r),a=hr(o.length,t.length),i=dr(e.shape,t,r),s=vr(n,t.length),u=mr(i,n,t.length);return e.reshape(o).transpose(a).reshape(i).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){Fl([e],"spaceToBatchND");var r=t.reduce((function(e,t){return e*t})),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=pr(i.shape,t,r,!1),u=hr(s.length,t.length,!1),c=dr(i.shape,t,r,!1);return i.reshape(s).transpose(u).reshape(c)},t.prototype.pool=function(e,t,n){Fl(e,"pool");for(var r=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=t.padInfo.top,l=t.padInfo.left,f="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(e.dataId),h=Bn(t.outShape,e.dtype),d=h.values,v=t.outShape[1]*t.outShape[2]*t.outShape[3],m=t.outShape[2]*t.outShape[3],g=t.outShape[3],y=0;y<t.batchSize;++y)for(var b=y*v,x=y*e.strides[0],w=0;w<t.inChannels;++w)for(var E=0;E<t.outHeight;++E)for(var A=E*r-c,C=Math.max(0,A),S=Math.min(t.inHeight,s+A),_=b+E*m,I=0;I<t.outWidth;++I){for(var R=I*o-l,T=Math.max(0,R),P=Math.min(t.inWidth,u+R),N=f,O=0,D=0,k=C;k<S;k+=a){for(var F=x+k*e.strides[1],M=T;M<P;M+=i){var L=p[F+M*e.strides[2]+w];"max"===n&&L>N?N=L:"avg"===n&&(O+=L,D++)}if(isNaN(N))break}d[_+I*g+w]="avg"===n?O/D:N}return h.toTensor()},t.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},t.prototype.maxPoolPositions=function(e,t){for(var n=Bn(t.outShape,"int32"),r=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=t.padInfo.top,l=t.padInfo.left,f=this.bufferSync(e),p=0;p<t.batchSize;++p)for(var h=0;h<t.inChannels;++h)for(var d=0;d<t.outHeight;++d){for(var v=d*r-c,m=v;m<0;)m+=a;for(var g=Math.min(t.inHeight,s+v),y=0;y<t.outWidth;++y){for(var b=y*o-l,x=b;x<0;)x+=i;for(var w=Math.min(t.inWidth,u+b),E=Number.NEGATIVE_INFINITY,A=-1,C=m;C<g;C+=a)for(var S=C-v,_=x;_<w;_+=i){var I=_-b,R=f.get(p,C,_,h);R>E&&(E=R,A=S*u+I)}n.set(A,p,d,y,h)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){Fl([t,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(t,r),a=r.strideHeight,i=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,f=l-1-r.padInfo.left,p=c-1-r.padInfo.top,h=Bn(t.shape,"float32"),d=this.bufferSync(o),v=this.bufferSync(e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var x=y-p,w=b-f,E=0,A=0;A<c;A+=s){var C=(x+A)/a;if(!(C<0||C>=r.outHeight||Math.floor(C)!==C))for(var S=0;S<l;S+=u){var _=(w+S)/i;if(!(_<0||_>=r.outWidth||Math.floor(_)!==_)){var I=c*l-1-d.get(m,C,_,g)===A*l+S?1:0;0!==I&&(E+=v.get(m,C,_,g)*I)}}}h.set(E,m,y,b,g)}return h.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){Fl([e,t],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,f=l-1-n.padInfo.left,p=c-1-n.padInfo.top,h=Bn(t.shape,"float32"),d=1/(a*i),v=this.bufferSync(e),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var x=y-p,w=b-f,E=0,A=0;A<c;A+=s){var C=(x+A)/r;if(!(C<0||C>=n.outHeight||Math.floor(C)!==C))for(var S=0;S<l;S+=u){var _=(w+S)/o;_<0||_>=n.outWidth||Math.floor(_)!==_||(E+=v.get(m,C,_,g))}}h.set(E*d,m,y,b,g)}return h.toTensor()},t.prototype.pool3d=function(e,t,n){Fl(e,"pool3d");for(var r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,p=t.padInfo.front,h=t.padInfo.top,d=t.padInfo.left,v="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(e.dataId),g=Bn(t.outShape,e.dtype),y=g.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],E=t.outShape[4],A=0;A<t.batchSize;++A)for(var C=A*b,S=A*e.strides[0],_=0;_<t.inChannels;++_)for(var I=0;I<t.outDepth;++I){for(var R=I*r-p,T=R;T<0;)T+=i;for(var P=Math.min(t.inDepth,c+R),N=C+I*x,O=0;O<t.outHeight;++O){for(var D=O*o-h,k=D;k<0;)k+=s;for(var F=Math.min(t.inHeight,l+D),M=N+O*w,L=0;L<t.outWidth;++L){for(var U=L*a-d,B=U;B<0;)B+=u;for(var G=Math.min(t.inWidth,f+U),W=M+L*E,V=v,$=0,H=0,j=T;j<P;j+=i){for(var z=S+j*e.strides[1],q=k;q<F;q+=s){for(var K=z+q*e.strides[2],X=B;X<G;X+=u){var Y=m[K+X*e.strides[3]+_];if("max"===n&&Y>V?V=Y:"avg"===n&&($+=Y,H++),isNaN(V))break}if(isNaN(V))break}if(isNaN(V))break}y[W+_]="avg"===n?$/H:V}}}return g.toTensor()},t.prototype.avgPool3d=function(e,t){return Fl(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){Fl([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,f=n.dilationWidth,p=n.effectiveFilterDepth,h=n.effectiveFilterHeight,d=n.effectiveFilterWidth,v=p-1-n.padInfo.front,m=d-1-n.padInfo.left,g=h-1-n.padInfo.top,y=Bn(t.shape,"float32"),b=1/(i*s*u),x=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var E=0;E<n.inChannels;++E)for(var A=0;A<n.inDepth;++A)for(var C=0;C<n.inHeight;++C)for(var S=0;S<n.inWidth;++S){for(var _=A-v,I=C-g,R=S-m,T=0,P=0;P<p;P+=c){var N=(_+P)/r;if(!(N<0||N>=n.outDepth||Math.floor(N)!==N))for(var O=0;O<h;O+=l){var D=(I+O)/o;if(!(D<0||D>=n.outHeight||Math.floor(D)!==D))for(var k=0;k<d;k+=f){var F=(R+k)/a;F<0||F>=n.outWidth||Math.floor(F)!==F||(T+=x.get(w,N,D,F,E))}}}y.set(T*b,w,A,C,S,E)}return y.toTensor()},t.prototype.maxPool3d=function(e,t){return Fl(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=Bn(t.outShape,"int32"),r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,p=t.padInfo.front,h=t.padInfo.top,d=t.padInfo.left,v=this.bufferSync(e),m=0;m<t.batchSize;++m)for(var g=0;g<t.inChannels;++g)for(var y=0;y<t.outDepth;++y){for(var b=y*r-p,x=b;x<0;)x+=i;for(var w=Math.min(t.inDepth,c+b),E=0;E<t.outHeight;++E){for(var A=E*o-h,C=A;C<0;)C+=s;for(var S=Math.min(t.inHeight,l+A),_=0;_<t.outWidth;++_){for(var I=_*a-d,R=I;R<0;)R+=u;for(var T=Math.min(t.inWidth,f+I),P=Number.NEGATIVE_INFINITY,N=-1,O=x;O<w;O+=i)for(var D=O-b,k=C;k<S;k+=s)for(var F=k-A,M=R;M<T;M+=u){var L=M-I,U=v.get(m,O,k,M,g);U>=P&&(P=U,N=D*l*f+F*l+L)}n.set(N,m,y,E,_,g)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){Fl([t,n],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(t,r),a=r.strideDepth,i=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,p=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=f-1-r.padInfo.front,v=h-1-r.padInfo.left,m=p-1-r.padInfo.top,g=Bn(t.shape,"float32"),y=this.bufferSync(o),b=this.bufferSync(e),x=0;x<r.batchSize;++x)for(var w=0;w<r.inChannels;++w)for(var E=0;E<r.inDepth;++E)for(var A=0;A<r.inHeight;++A)for(var C=0;C<r.inWidth;++C){for(var S=E-d,_=A-m,I=C-v,R=0,T=0;T<f;T+=u){var P=(S+T)/a;if(!(P<0||P>=r.outDepth||Math.floor(P)!==P))for(var N=0;N<p;N+=c){var O=(_+N)/i;if(!(O<0||O>=r.outHeight||Math.floor(O)!==O))for(var D=0;D<h;D+=l){var k=(I+D)/s;if(!(k<0||k>=r.outWidth||Math.floor(k)!==k)){var F=f*p*h-1-y.get(x,P,O,k,w)===T*p*h+N*h+D?1:0;0!==F&&(R+=b.get(x,P,O,k,w)*F)}}}}g.set(R,x,E,A,C,w)}return g.toTensor()},t.prototype.cast=function(e,t){return Yr(e,t,this)},t.prototype.reshape=function(e,t){return Zr(e,t)},t.prototype.avgPool=function(e,t){return Fl(e,"avgPool"),this.pool(e,t,"avg").toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){Fl(e,"resizeBilinear");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],c=this.readSync(e.dataId),l=new Float32Array(R([a,t,n,u])),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],p=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=0,d=f[0]/p[0],v=f[1]/p[1],m=0;m<a;m++)for(var g=0;g<t;g++)for(var y=d*g,b=Math.floor(y),x=y-b,w=Math.min(i-1,Math.ceil(y)),E=m*e.strides[0]+b*e.strides[1],A=m*e.strides[0]+w*e.strides[1],C=0;C<n;C++)for(var S=v*C,_=Math.floor(S),I=S-_,T=Math.min(s-1,Math.ceil(S)),P=E+_*e.strides[2],N=A+_*e.strides[2],O=E+T*e.strides[2],D=A+T*e.strides[2],k=0;k<u;k++){var F=c[P+k],M=c[N+k],L=F+(c[O+k]-F)*I,U=L+(M+(c[D+k]-M)*I-L)*x;l[h++]=U}return un(l,[a,t,n,u])},t.prototype.resizeBilinearBackprop=function(e,t,n){Fl([e,t],"resizeBilinearBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],f=new Float32Array(o*a*i*s),p=[n&&c>1?a-1:a,n&&l>1?i-1:i],h=[n&&c>1?c-1:c,n&&l>1?l-1:l],d=p[0]/h[0],v=p[1]/h[1],m=this.readSync(e.dataId),g=0,y=0;y<o;y++)for(var b=y*t.strides[0],x=0;x<c;x++)for(var w=x*d,E=Math.floor(w),A=Math.min(Math.ceil(w),a-1),C=b+E*t.strides[1],S=b+A*t.strides[1],_=w-E,I=1-_,R=0;R<l;R++)for(var T=R*v,P=Math.floor(T),N=Math.min(Math.ceil(T),i-1),O=T-P,D=1-O,k=C+P*t.strides[2],F=C+N*t.strides[2],M=S+P*t.strides[2],L=S+N*t.strides[2],U=I*D,B=I*O,G=_*D,W=_*O,V=0;V<s;V++){var $=m[g++];f[k+V]+=$*U,f[F+V]+=$*B,f[M+V]+=$*G,f[L+V]+=$*W}return dn(f,[o,i,a,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){Fl(e,"resizeNearestNeighbor");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],c=this.readSync(e.dataId),l=new Float32Array(a*t*n*u),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],p=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=f[0]/p[0],d=f[1]/p[1],v=0,m=0;m<a;m++)for(var g=m*e.strides[0],y=0;y<t;y++)for(var b=h*y,x=g+Math.min(i-1,r?Math.round(b):Math.floor(b))*e.strides[1],w=0;w<n;w++)for(var E=d*w,A=x+Math.min(s-1,r?Math.round(E):Math.floor(E))*e.strides[2],C=0;C<u;C++){var S=c[A+C];l[v++]=S}return un(l,[a,t,n,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){Fl([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],f=new Float32Array(o*a*i*s),p=this.readSync(e.dataId),h=[n&&c>1?a-1:a,n&&l>1?i-1:i],d=[n&&c>1?c-1:c,n&&l>1?l-1:l],v=h[0]/d[0],m=h[1]/d[1],g=1/v,y=1/m,b=2*Math.ceil(g)+2,x=2*Math.ceil(y)+2,w=0;w<o;w++)for(var E=w*t.strides[0],A=0;A<a;A++)for(var C=E+A*t.strides[1],S=Math.floor(A*g),_=Math.floor(S-b/2),I=0;I<i;I++)for(var R=C+I*t.strides[2],T=Math.floor(I*y),P=Math.floor(T-x/2),N=0;N<s;N++){for(var O=0,D=0;D<b;D++){var k=D+_;if(!(k<0||k>=c)){var F=E+k*e.strides[1],M=k*v;if(A===Math.min(a-1,n?Math.round(M):Math.floor(M)))for(var L=0;L<x;L++){var U=L+P;if(!(U<0||U>=l)){var B=F+U*e.strides[2],G=U*m;I===Math.min(i-1,n?Math.round(G):Math.floor(G))&&(O+=p[B+N])}}}}f[R+N]=O}return dn(f,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,o,a){Fl([e,t,n,o,a],"batchNorm");for(var i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),c=o?this.readSync(o.dataId):new Float32Array([1]),l=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(i.length),p=l.length,h=c.length,d=u.length,v=s.length,m=0,g=0,y=0,b=0,x=0;x<i.length;++x)f[x]=l[m++]+(i[x]-s[g++])*c[y++]/Math.sqrt(u[b++]+r),m>=p&&(m=0),g>=v&&(g=0),y>=h&&(y=0),b>=d&&(b=0);return dn(f,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,o){Fl(e,"localResponseNormalization4D");var a=e.shape[3],i=a-1,s=this.readSync(e.dataId),u=e.size,c=new Float32Array(u);function l(e){for(var n=e%a,r=e-n+Math.max(0,n-t),o=e-n+Math.min(n+t,i),u=0;r<=o;r++){var c=s[r];u+=c*c}return u}for(var f=0;f<u;f++){var p=l(f),h=s[f]*Math.pow(n+r*p,-o);c[f]=h}return dn(c,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,o,a,i){Fl(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=this.readSync(n.dataId),f=new Float32Array(e.size),p=e.size,h=0;h<p;h++){for(var d=h%s,v=h-d+Math.max(0,d-r),m=h-d+Math.min(s,d+r+1),g=0,y=v;y<m;y++)g+=Math.pow(c[y],2);for(g=a*g+o,y=v;y<m;y++){var b=-2*a*i*c[y]*l[h]/g;h===y&&(b+=Math.pow(g,-i)),b*=u[h],f[y]+=b}}return dn(f,e.shape)},t.prototype.multinomial=function(e,t,n,r){Fl(e,"multinomial");for(var o=t?e:Pr(e),a=o.shape[0],i=o.shape[1],s=mn([a,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(o.dataId),l=0;l<a;++l){var f=l*i,p=new Float32Array(i-1);p[0]=c[f];for(var h=1;h<p.length;++h)p[h]=p[h-1]+c[f+h];for(var d=Fn(r.toString()),v=l*n,m=0;m<n;++m){var g=d();u[v+m]=p.length;for(var y=0;y<p.length;y++)if(g<p[y]){u[v+m]=y;break}}}return s},t.prototype.oneHot=function(e,t,n,r){Fl(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(r);for(var a=this.readSync(e.dataId),i=0;i<e.size;++i)a[i]>=0&&a[i]<t&&(o[i*t+a[i]]=n);return pn(o,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,o){return Fl(e,"nonMaxSuppression"),ao(this.readSync(e.dataId),this.readSync(t.dataId),n,r,o)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],o=Bn(e.shape,"float32"),a=Bn(e.shape,"float32"),i=an(e).as2D(n,r),s=sn(e).as2D(n,r),u=0;u<n;u++)for(var c=i.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),f=on(c,l),p=this.readSync(this.fftImpl(f,t).dataId),h=0;h<r;h++){var d=eo(p,h);o.values[u*r+h]=d.real,a.values[u*r+h]=d.imag}return on(o.toTensor(),a.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(o=on(an(o).div(ln(r)),sn(o).div(ln(r)))),o}var a=this.readSync(e.dataId),i=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return on(i.real,i.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),o=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=0;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),i=on(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=2;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),u=on(s.real,s.imag).as1D();i=this.fftRadix2(i,o,n),u=this.fftRadix2(u,o,n);var c=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),o=0;o<Math.ceil(e/2);o++){var a=(t?2:-2)*Math.PI*(o/e);n[o]=Math.cos(a),r[o]=Math.sin(a)}return{real:n,imag:r}}(t,n),l=on(c.real,c.imag).mul(u),f=i.add(l),p=i.sub(l),h=an(f).concat(an(p)),d=sn(f).concat(sn(p));return on(h,d).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),o=0;o<t;o++){for(var a=0,i=0,s=0;s<t;s++){var u=no(o*s,t,n),c=eo(e,s);a+=c.real*u.real-c.imag*u.imag,i+=c.real*u.imag+c.imag*u.real}n&&(a/=t,i/=t),to(r,a,i,o)}return r},t.prototype.depthToSpace=function(e,t,n){C("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),C(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));for(var r=e.shape[0],o=e.shape[1],a=e.shape[2],i=e.shape[3],s=o*t,u=a*t,c=i/(t*t),l=this.readSync(e.dataId),f=new Float32Array(r*s*u*c),p=0,h=0;h<r;++h)for(var d=0;d<s;++d)for(var v=Math.floor(d/t),m=d%t,g=0;g<u;++g)for(var y=Math.floor(g/t),b=(m*t+g%t)*c,x=0;x<c;++x){var w=x+b+i*(y+a*(v+o*h));f[p++]=l[w]}return dn(f,[r,s,u,c])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var o=Lr(e.shape,t.shape),a=Bn(o,n),i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Fr(e.shape,o),c=Fr(t.shape,o),l=a.values;if(u.length+c.length===0)for(var f=0;f<l.length;++f)l[f]=r(i[f%i.length],s[f%s.length]);else{var p=this.bufferSync(e),h=this.bufferSync(t),d=function(n){var o=a.indexToLoc(n),f=o.slice(-e.rank);u.forEach((function(e){return f[e]=0}));var d=p.locToIndex(f),v=o.slice(-t.rank);c.forEach((function(e){return v[e]=0}));var m=h.locToIndex(v);l[n]=r(i[d],s[m])};for(f=0;f<l.length;++f)d(f)}return a.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=Lr(e.shape,t.shape),o=Bn(r,"float32"),a=Bn(r,"float32"),i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Fr(e.shape,r),c=Fr(t.shape,r),l=o.values,f=a.values;if(u.length+c.length===0)for(var p=0;p<l.length;p++){var h=p%i.length,d=p%s.length,v=n(i[2*h],i[2*h+1],s[2*d],s[2*d+1]);l[p]=v.real,f[p]=v.imag}else{var m=this.bufferSync(this.data.get(e.dataId).complexTensors.real),g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var a=o.indexToLoc(r),p=a.slice(-e.rank);u.forEach((function(e){return p[e]=0}));var h=m.locToIndex(p),d=a.slice(-t.rank);c.forEach((function(e){return d[e]=0}));var v=g.locToIndex(d),y=n(i[2*h],i[2*h+1],s[2*v],s[2*v+1]);l[r]=y.real,f[r]=y.imag};for(p=0;p<l.length;p++)y(p)}return this.complex(o.toTensor(),a.toTensor())},t.prototype.split=function(e,t,n){return fo(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,o,a){for(var i=e.shape,s=i[0],u=i[1],c=i[2],l=i[3],f=t.shape[0],p=r[0],h=r[1],d=Bn([f,p,h,l],"float32"),v=this.readSync(t.dataId),m=this.readSync(n.dataId),g=this.readSync(e.dataId),y=e.strides,b=d.strides,x=0;x<f;x++){var w=4*x,E=v[w],A=v[w+1],C=v[w+2],S=v[w+3],_=m[x];if(!(_>=s))for(var I=p>1?(C-E)*(u-1)/(p-1):0,R=h>1?(S-A)*(c-1)/(h-1):0,T=0;T<p;T++){var P=p>1?E*(u-1)+T*I:.5*(E+C)*(u-1);if(P<0||P>u-1)for(var N=0;N<h;N++)for(var O=0;O<l;O++){var D=O+N*b[2]+T*b[1]+x*b[0];d.values[D]=a}else if("bilinear"===o){var k=Math.floor(P),F=Math.ceil(P),M=P-k;for(N=0;N<h;N++)if((j=h>1?A*(c-1)+N*R:.5*(A+S)*(c-1))<0||j>c-1)for(O=0;O<l;O++)D=O+N*b[2]+T*b[1]+x*b[0],d.values[D]=a;else{var L=Math.floor(j),U=Math.ceil(j),B=j-L;for(O=0;O<l;O++){var G=g[D=O+L*y[2]+k*y[1]+_*y[0]],W=g[D=O+U*y[2]+k*y[1]+_*y[0]],V=g[D=O+L*y[2]+F*y[1]+_*y[0]],$=G+(W-G)*B,H=V+(g[D=O+U*y[2]+F*y[1]+_*y[0]]-V)*B;D=O+N*b[2]+T*b[1]+x*b[0],d.values[D]=$+(H-$)*M}}}else for(N=0;N<h;++N){var j;if((j=h>1?A*(c-1)+N*R:.5*(A+S)*(c-1))<0||j>c-1)for(O=0;O<l;O++)D=O+N*b[2]+T*b[1]+x*b[0],d.values[D]=a;else{var z=Math.round(j),q=Math.round(P);for(O=0;O<l;O++){var K=O+z*y[2]+q*y[1]+_*y[0],X=O+N*b[2]+T*b[1]+x*b[0];d.values[X]=g[K]}}}}}return d.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var o=wr(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.sliceSize,u=o.strides,c=o.outputSize;return this.scatter(e,t,n,c,s,i,a,u,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=gr(e,t),a=o[0],i=o[1],s=o[2],u=o[3];if(0===i)return un([],a,e.dtype);for(var c=new de([i,s],e.dtype),l=this.readSync(t.dataId),f=this.readSync(e.dataId),p=0;p<i;p++){for(var h=[],d=0,v=0;v<r;v++){var m=l[p*r+v];d+=m*u[v],h.push(m)}if(d<0||d>=e.size/s)throw new Error("Invalid indices: "+h+" does not index into "+e.shape);for(var g=0;g<s;g++)c.values[p*s+g]=f[d*s+g]}return c.toTensor().reshape(a)},t.prototype.scatterND=function(e,t,n){var r=wr(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,c=ln(0);return this.scatter(e,t,n,u,i,a,o,s,c,!0)},t.prototype.fill=function(e,t,n){var r=B(n=n||X(t),R(e));return r.fill(t),ke.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=B(e.dtype,R(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return Qr(e,t,n)},t.prototype.scatter=function(e,t,n,r,o,a,i,s,u,c){var l=[r/o,o],f=this.readSync(e.dataId),p=this.readSync(t.dataId);if(0===r)return un([],n,t.dtype);var h=new de(l,t.dtype);h.values.fill(this.readSync(u.dataId)[0]);for(var d=0;d<a;d++){for(var v=[],m=0,g=0;g<i;g++){var y=f[d*i+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/o)throw new Error("Invalid indices: "+v+" does not index into "+n);for(var b=0;b<o;b++)c?h.values[m*o+b]+=p[d*o+b]:h.values[m*o+b]=0===t.rank?p[0]:p[d*o+b]}return h.toTensor().reshape(n)},t}(Dr);ke.registerBackend("cpu",(function(){return new Ll}),1);for(var Ul=0,Bl=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,p=n;Fl(a,"NonMaxSuppressionWithScore");var h=io(p.data.get(a.dataId).values,p.data.get(i.dataId).values,u,c,l,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n;Fl(r,"square");for(var a=o.data.get(r.dataId).values,i=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];i[s]=u*u}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Yi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,a=r.b,i=n;Fl([o,a],Yi);var s=i.data.get(o.dataId).values,u=i.data.get(a.dataId).values,c=function(e,t,n,r,o,a){var i=Lr(e,t),s=i.length,u=Q(i),c=U(o,R(i)),l=e.length,f=t.length,p=Q(e),h=Q(t),d=Fr(e,i),v=Fr(t,i);if(d.length+v.length===0)for(var m=0;m<c.length;++m)c[m]=a(n[m%n.length],r[m%r.length]);else{var g=function(e){var t=ue(e,s,u),o=t.slice(-l);d.forEach((function(e){return o[e]=0}));var i=se(o,l,p),m=t.slice(-f);v.forEach((function(e){return m[e]=0}));var g=se(m,f,h);c[e]=a(n[i],r[g])};for(m=0;m<c.length;++m)g(m)}return[c,i]}(o.shape,a.shape,s,u,o.dtype,(function(e,t){var n=e-t;return n*n})),l=c[0],f=c[1];return{dataId:i.write(l,f,o.dtype),shape:f,dtype:o.dtype}}}];Ul<Bl.length;Ul++)g(Bl[Ul]);for(var Gl,Wl=function(e){this.variableNames=["A"];var t=wo(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Vl=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=wo(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},$l=0,Hl=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.pixels,a=r.numChannels,i="undefined"!=typeof HTMLVideoElement&&o instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&o instanceof HTMLImageElement,u=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=u[0],l=u[1],p=[l,c],h=[l,c,a];(s||i)&&(null==Gl&&(Gl=document.createElement("canvas").getContext("2d")),Gl.canvas.width=c,Gl.canvas.height=l,Gl.drawImage(o,0,0,c,l),o=Gl.canvas);var d=n.makeTensorInfo(p,"int32");n.texData.get(d.dataId).usage=Ue.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),o);var v=f().getBool("WEBGL_PACK")?new Vl(h):new Wl(h),m=n.runWebGLProgram(v,[d],"int32");return n.disposeData(d.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;Vt("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,p=n,h=io(p.readSync(a.dataId),p.readSync(i.dataId),u,c,l,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n,a=new Ti(r.shape,"return x * x;");return o.runWebGLProgram(a,[r],r.dtype)}},{kernelName:Yi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,a=r.b,i=n,s=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("return (a - b) * (a - b);",o.shape,a.shape):new qo("return (a - b) * (a - b);",o.shape,a.shape);return i.compileAndRun(s,[o,a])}}];$l<Hl.length;$l++)g(Hl[$l]);for(var jl=0,zl=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:Yi,gradFunc:function(e,t){var n=t[0],r=t[1],o=ln(2);return{a:function(){return pu(e,pu(o,gu(n,r)))},b:function(){return pu(e,pu(o,gu(r,n)))}}}}];jl<zl.length;jl++)y(zl[jl]);var ql=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();f().get("IS_BROWSER")&&f().setPlatform("browser",new ql);var Kl,Xl=function(){function e(){this.util=__webpack_require__(753),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=f().global.fetch?f().global.fetch(e,t):(null==Kl&&(Kl=__webpack_require__(522)),Kl(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();f().get("IS_NODE")&&f().setPlatform("node",new Xl);var Yl={float32:4,int32:4,uint16:2,uint8:1,bool:1};function Zl(e,t){for(var n={},r=0,o=function(t){var o=t.name,a=t.dtype,i=t.shape,s=R(i),u=void 0;if("quantization"in t){var c=t.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=Yl[c.dtype],f=e.slice(r,r+s*l),p="uint8"===c.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===a)u=Float32Array.from(p,(function(e){return e*c.scale+c.min}));else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=Int32Array.from(p,(function(e){return Math.round(e*c.scale+c.min)}))}r+=s*l}else if("string"===a){var h=R(t.shape);u=[];for(var d=0;d<h;d++){var v=new Uint32Array(e.slice(r,r+4))[0];r+=4;var m=new Uint8Array(e.slice(r,r+v));u.push(m),r+=v}}else{var g=Yl[a];if(f=e.slice(r,r+s*g),"float32"===a)u=new Float32Array(f);else if("int32"===a)u=new Int32Array(f);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=new Uint8Array(f)}r+=s*g}n[o]=un(u,i,a)},a=0,i=t;a<i.length;a++)o(i[a]);return n}function Ql(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),o=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),o),o+=e.byteLength})),r.buffer}var Jl="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function ef(e){return Jl?Buffer.byteLength(e):new Blob([e]).size}function tf(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function nf(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function rf(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:ef(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:ef(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var of=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var o=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&o.push(n)})),o},e}(),af="://",sf=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){C(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(af)&&(t=t.slice(0,t.indexOf(af))),C(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();C(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '"+t+"'."})),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function uf(e){if(-1===e.indexOf(af))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+sf.getSchemes().join(","));return{scheme:e.split(af)[0],path:e.split(af)[1]}}function cf(e,t,n){return void 0===n&&(n=!1),s(this,void 0,void 0,(function(){var r,o,a,i,s,c,l,f,p;return u(this,(function(u){switch(u.label){case 0:return C(e!==t,(function(){return"Old path and new path are the same: '"+e+"'"})),C((r=of.getLoadHandlers(e)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+e+"."})),C(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."})),o=r[0],C((a=of.getSaveHandlers(t)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+t+"."})),C(a.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."})),i=a[0],s=uf(e).scheme,c=uf(e).path,l=s===uf(e).scheme,[4,o.load()];case 1:return f=u.sent(),n&&l?[4,sf.getManager(s).removeModel(c)]:[3,3];case 2:u.sent(),u.label=3;case 3:return[4,i.save(f)];case 4:return p=u.sent(),!n||l?[3,6]:[4,sf.getManager(s).removeModel(c)];case 5:u.sent(),u.label=6;case 6:return[2,p.modelArtifactsInfo]}}))}))}var lf="models_store",ff="model_info_store";function pf(){if(!f().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function hf(e){var t=e.result;t.createObjectStore(lf,{keyPath:"modelPath"}),t.createObjectStore(ff,{keyPath:"modelPath"})}var df=function(){function e(e){if(this.indexedDB=pf(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return s(this,void 0,void 0,(function(){return u(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},e.prototype.load=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(e,t){var n=this;return new Promise((function(e,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return hf(o)},o.onsuccess=function(){var a=o.result;if(null==t){var i=a.transaction(lf,"readonly"),s=i.objectStore(lf).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},i.oncomplete=function(){return a.close()}}else{var u,c=rf(t),l=a.transaction(ff,"readwrite"),f=l.objectStore(ff),p=f.put({modelPath:n.modelPath,modelArtifactsInfo:c});p.onsuccess=function(){var o=(u=a.transaction(lf,"readwrite")).objectStore(lf).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});o.onsuccess=function(){return e({modelArtifactsInfo:c})},o.onerror=function(e){var t=(f=l.objectStore(ff)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(o.error)},t.onerror=function(e){return a.close(),r(o.error)}}},p.onerror=function(e){return a.close(),r(p.error)},l.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},o.onerror=function(e){return r(o.error)}}))},e.URL_SCHEME="indexeddb://",e}(),vf=function(e){return f().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(df.URL_SCHEME)?(t=e.slice(df.URL_SCHEME.length),new df(t)):null;var t};of.registerSaveRouter(vf),of.registerLoadRouter(vf);var mf=function(){function e(){this.indexedDB=pf()}return e.prototype.listModels=function(){return s(this,void 0,void 0,(function(){var e=this;return u(this,(function(t){return[2,new Promise((function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return hf(r)},r.onsuccess=function(){var e=r.result,o=e.transaction(ff,"readonly"),a=o.objectStore(ff).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var o=r[n];e[o.modelPath]=o.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},o.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}}))]}))}))},e.prototype.removeModel=function(e){return s(this,void 0,void 0,(function(){var t=this;return u(this,(function(n){var r;return e=(r=e).startsWith(df.URL_SCHEME)?r.slice(df.URL_SCHEME.length):r,[2,new Promise((function(n,r){var o=t.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return hf(o)},o.onsuccess=function(){var t,a=o.result,i=a.transaction(ff,"readwrite"),s=i.objectStore(ff),u=s.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var o=s.delete(e),i=function(){var o=(t=a.transaction(lf,"readwrite")).objectStore(lf).delete(e);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(e){return r(u.error)}};o.onsuccess=i,o.onerror=function(e){return i(),a.close(),r(u.error)}},u.onerror=function(e){return a.close(),r(u.error)},i.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},o.onerror=function(e){return r(o.error)}}))]}))}))},e}();if(f().getBool("IS_BROWSER"))try{sf.registerManager(df.URL_SCHEME,new mf)}catch(a){}var gf="/",yf="tensorflowjs_models",bf="info",xf="model_topology",wf="weight_specs",Ef="weight_data",Af="model_metadata";function Cf(e){return{info:[yf,e,bf].join(gf),topology:[yf,e,xf].join(gf),weightSpecs:[yf,e,wf].join(gf),weightData:[yf,e,Ef].join(gf),modelMetadata:[yf,e,Af].join(gf)}}function Sf(e){var t=e.split(gf);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(gf)}var _f=function(){function e(e){if(!f().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Cf(this.modelPath)}return e.prototype.save=function(e){return s(this,void 0,void 0,(function(){var t,n,r;return u(this,(function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=rf(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(Jl)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,o=t.length;r<o;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]}))}))},e.prototype.load=function(){return s(this,void 0,void 0,(function(){var e,t,n,r,o,a,i;return u(this,(function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),null==(i=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(Jl){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(i),[2,t]}))}))},e.URL_SCHEME="localstorage://",e}(),If=function(e){return f().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(_f.URL_SCHEME)?(t=e.slice(_f.URL_SCHEME.length),new _f(t)):null;var t};of.registerSaveRouter(If),of.registerLoadRouter(If);var Rf=function(){function e(){C(f().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),C("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return e.prototype.listModels=function(){return s(this,void 0,void 0,(function(){var e,t,n,r,o,a;return u(this,(function(i){for(e={},t=yf+gf,n=gf+bf,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(t)&&o.endsWith(n)&&(a=Sf(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]}))}))},e.prototype.removeModel=function(e){return s(this,void 0,void 0,(function(){var t,n;return u(this,(function(r){var o;if(e=(o=e).startsWith(_f.URL_SCHEME)?o.slice(_f.URL_SCHEME.length):o,t=Cf(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]}))}))},e}();if(f().getBool("IS_BROWSER"))try{sf.registerManager(_f.URL_SCHEME,new Rf)}catch(a){}function Tf(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Pf=function(){function e(t){if(!f().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return s(this,void 0,void 0,(function(){var t,n,r,o,a,i;return u(this,(function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,Tf((function(){return a.dispatchEvent(new MouseEvent("click"))}))];case 2:return s.sent(),null==e.weightData?[3,4]:((i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=t,[4,Tf((function(){return i.dispatchEvent(new MouseEvent("click"))}))]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:rf(e)}]}}))}))},e.URL_SCHEME="downloads://",e}(),Nf=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return s(this,void 0,void 0,(function(){var e,t,n=this;return u(this,(function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(r,o){var a=new FileReader;a.onload=function(a){var i=JSON.parse(a.target.result),s=i.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=i.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,t)}catch(e){return void o(e)}var l=[],f=[],p=[];u.forEach((function(e){e.paths.forEach((function(e){f.push(e),p.push(null)})),l.push.apply(l,e.weights)})),u.forEach((function(e){e.paths.forEach((function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,o=f.indexOf(e);p[o]=n,-1===p.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:tf(p),format:i.format,generatedBy:i.generatedBy,convertedBy:i.convertedBy,userDefinedMetadata:i.userDefinedMetadata})},t.onerror=function(t){return o("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(c[e])}))}))}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map((function(e){return nf(e.name)})),o={},a=0,i=e;a<i.length;a++)i[a].paths.forEach((function(e){var a=nf(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");o[e]=t[r.indexOf(a)]}));if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return o},e}();function Of(e,t,n,r){!function(e){C(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){C(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),C(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),C(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t}))}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(e.map((function(a){return a.then((function(a){var i=n+ ++o/e.length*(r-n);return t(i),a})),a})))}function Df(e,t){return s(this,void 0,void 0,(function(){var n,r,o,a,i,s,c,l,p;return u(this,(function(u){switch(u.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?f().platform.fetch:t.fetchFunc,r=e.map((function(e){return n(e,t.requestInit,{isBinary:!0})})),o=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return i=u.sent(),[3,4];case 2:return[4,Of(r,t.onProgress,o,a)];case 3:i=u.sent(),u.label=4;case 4:return s=i.map((function(e){return e.arrayBuffer()})),c=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return p=u.sent(),[3,8];case 6:return[4,Of(s,t.onProgress,c,l)];case 7:p=u.sent(),u.label=8;case 8:return[2,p]}}))}))}function kf(e){var t=this;return function(n,r,o){return void 0===r&&(r=""),s(t,void 0,void 0,(function(){var t,a,i,s,c,l,f,p,h,d;return u(this,(function(u){switch(u.label){case 0:if(t=n.map((function(){return!1})),a={},i=null!=o?o.map((function(){return!1})):[],s=[],n.forEach((function(e,n){var r=0;e.weights.forEach((function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,c=Yl[u]*R(e.shape),l=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:c})};null!=o?o.forEach((function(t,n){t===e.name&&(l(),i[n]=!0)})):l(),s.push(e.name),r+=c}))})),!i.every((function(e){return e})))throw c=o.filter((function(e,t){return!i[t]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=t.reduce((function(e,t,n){return t&&e.push(n),e}),[]),f=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;f.push(t)}))})),[4,e(f)];case 1:return p=u.sent(),h={},d=0,l.forEach((function(e){for(var t=n[e].paths.length,r=0,o=0;o<t;o++)r+=p[d+o].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var l=new Uint8Array(p[d+c]);s.set(l,u),u+=l.byteLength}a[e].forEach((function(e){var t=Zl(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)h[n]=t[n]})),d+=t})),[2,h]}}))}))}}of.registerSaveRouter((function(e){return f().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Pf.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new Pf(e)}(e.slice(Pf.URL_SCHEME.length)):null}));var Ff=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(C("function"==typeof t.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=f().platform.fetch,C(null!=e&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&C(2===e.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return s(this,void 0,void 0,(function(){var t,n,r,o;return u(this,(function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:rf(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}}))}))},e.prototype.load=function(){return s(this,void 0,void 0,(function(){var e,t,n,r,o,a,i,s,c,l,f,p;return u(this,(function(u){switch(u.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=u.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");u.label=2;case 2:return u.trys.push([2,4,,5]),[4,e.json()];case 3:return t=u.sent(),[3,5];case 4:throw u.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,o=t.weightsManifest,a=t.generatedBy,i=t.convertedBy,s=t.format,c=t.userDefinedMetadata,null==r&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:p=u.sent(),l=p[0],f=p[1],u.label=7;case 7:return[2,{modelTopology:r,weightSpecs:l,weightData:f,userDefinedMetadata:c,generatedBy:a,convertedBy:i,format:s}]}}))}))},e.prototype.loadWeights=function(e){return s(this,void 0,void 0,(function(){var t,n,r,o,a,i,s,c,l,f,p;return u(this,(function(u){switch(u.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],o=n[1],a=this.weightPathPrefix||r,i=[],s=0,c=e;s<c.length;s++)l=c[s],i.push.apply(i,l.weights);return f=[],e.forEach((function(e){e.paths.forEach((function(e){f.push(a+e+o)}))})),[4,Df(f,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return p=u.sent(),[2,[i,tf(p)]]}}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function Mf(e){return null!=e.match(Ff.URL_SCHEME_REGEX)}var Lf=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every((function(e){return Mf(e)})):Mf(e))?Uf(e,{onProgress:t}):null};function Uf(e,t){return new Ff(e,t)}of.registerSaveRouter(Lf),of.registerLoadRouter(Lf);var Bf,Gf=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){return[2,this.modelArtifacts]}))}))},e}(),Wf=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return s(this,void 0,void 0,(function(){return u(this,(function(t){return[2,this.saveHandler(e)]}))}))},e}(),Vf=Object.freeze({browserFiles:function(e){return new Nf(e)},browserHTTPRequest:function(e,t){return Uf(e,t)},concatenateArrayBuffers:tf,decodeWeights:Zl,encodeWeights:function(e,t){return s(this,void 0,void 0,(function(){var n,r,o,a,i,c=this;return u(this,(function(l){switch(l.label){case 0:for(n=[],r=[],o=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e),a=function(a){var i=o[a],l=Array.isArray(e)?e[a].tensor:e[i];if("float32"!==l.dtype&&"int32"!==l.dtype&&"bool"!==l.dtype&&"string"!==l.dtype)throw new Error("Unsupported dtype in weight '"+i+"': "+l.dtype);var f={name:i,shape:l.shape,dtype:l.dtype};if("string"===l.dtype){var p=new Promise((function(e){return s(c,void 0,void 0,(function(){var t,n,r,o,a,i,s;return u(this,(function(u){switch(u.label){case 0:return[4,l.bytes()];case 1:for(t=u.sent(),n=t.reduce((function(e,t){return e+t.length}),0)+4*t.length,r=new Uint8Array(n),o=0,a=0;a<t.length;a++)i=t[a],s=new Uint8Array(new Uint32Array([i.length]).buffer),r.set(s,o),o+=4,r.set(i,o),o+=i.length;return e(r),[2]}}))}))}));r.push(p)}else r.push(l.data());null!=t&&(f.group=t),n.push(f)},i=0;i<o.length;++i)a(i);return[4,Promise.all(r)];case 1:return[2,{data:Ql(l.sent()),specs:n}]}}))}))},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Gf(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Gf({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Gf({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return of.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:rf,getSaveHandlers:function(e){return of.getSaveHandlers(e)},http:Uf,isHTTPScheme:Mf,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),s(this,void 0,void 0,(function(){return u(this,(function(o){return[2,kf((function(e){return Df(e,{requestInit:r})}))(e,t,n)]}))}))},registerLoadRouter:function(e){return of.registerLoadRouter(e)},registerSaveRouter:function(e){return of.registerSaveRouter(e)},weightsLoaderFactory:kf,withSaveHandler:function(e){return new Wf(e)},copyModel:function(e,t){return s(this,void 0,void 0,(function(){return u(this,(function(n){return[2,cf(e,t,!1)]}))}))},listModels:function(){return s(this,void 0,void 0,(function(){var e,t,n,r,o,a,i;return u(this,(function(s){switch(s.label){case 0:e=sf.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(o=r[n],[4,sf.getManager(o).listModels()]):[3,4];case 2:for(i in a=s.sent())t[o+af+i]=a[i];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},moveModel:function(e,t){return s(this,void 0,void 0,(function(){return u(this,(function(n){return[2,cf(e,t,!0)]}))}))},removeModel:function(e){return s(this,void 0,void 0,(function(){var t;return u(this,(function(n){return t=uf(e),[2,sf.getManager(t.scheme).removeModel(t.path)]}))}))}}),$f=rn({confusionMatrix_:function(e,t,n){var r=jt(e,"labels","confusionMatrix"),o=jt(t,"predictions","confusionMatrix");C(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),C(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),C(1===o.rank,(function(){return"Expected the rank of predictions to be 1, but got "+o.rank})),C(r.shape[0]===o.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."})),C(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var a=Xn(r.asType("int32"),n),i=Xn(o.asType("int32"),n);return a.transpose().matMul(i).asType("int32")}}),Hf=(Object.freeze({confusionMatrix:$f}),rn({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,a=!1,i=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)o=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);i=!0}if(o&&o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=v("FromPixels",ke.backendName))return ke.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,c=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],l=c[0],f=c[1];if(i?s=e.getContext("2d").getImageData(0,0,l,f).data:r||n?s=e.data:(a||o)&&(null==Bf&&(Bf=document.createElement("canvas").getContext("2d")),Bf.canvas.width=l,Bf.canvas.height=f,Bf.drawImage(e,0,0,l,f),s=Bf.getImageData(0,0,l,f).data),4===t)u=new Int32Array(s);else{var p=l*f;u=new Int32Array(p*t);for(var h=0;h<p;h++)for(var d=0;d<t;++d)u[h*t+d]=s[4*h+d]}return hn(u,[f,l,t],"int32")}})),jf=Object.freeze({toPixels:function(e,t){return s(this,void 0,void 0,(function(){var n,r,o,a,i,s,c,l,f,p,h,d,v,m,g,y,b,x,w,E,A,C,S;return u(this,(function(u){switch(u.label){case 0:if(n=jt(e,"img","toPixels"),e instanceof ye||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],a=r[1],(i=2===n.rank?1:n.shape[2])>4||2===i)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,n.data()];case 1:return s=u.sent(),c=n.min(),l=n.max(),[4,Promise.all([c.data(),l.data()])];case 2:if(f=u.sent(),p=f[0],h=f[1],d=p[0],v=h[0],c.dispose(),l.dispose(),"float32"===n.dtype){if(d<0||v>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+d+" - "+v+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(d<0||v>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+d+" - "+v+"].")}for(m="float32"===n.dtype?255:1,g=new Uint8ClampedArray(a*o*4),y=0;y<o*a;++y)b=void 0,x=void 0,w=void 0,E=void 0,1===i?(b=s[y]*m,x=s[y]*m,w=s[y]*m,E=255):3===i?(b=s[3*y]*m,x=s[3*y+1]*m,w=s[3*y+2]*m,E=255):4===i&&(b=s[4*y]*m,x=s[4*y+1]*m,w=s[4*y+2]*m,E=s[4*y+3]*m),g[0+(A=4*y)]=Math.round(b),g[A+1]=Math.round(x),g[A+2]=Math.round(w),g[A+3]=Math.round(E);return null!=t&&(t.width=a,t.height=o,C=t.getContext("2d"),S=new ImageData(g,a,o),C.putImageData(S,0,0)),n!==e&&n.dispose(),[2,g]}}))}))},fromPixels:Hf}),zf=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),qf=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function Kf(e){C(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),C("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),C(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),qf.register(e)}function Xf(){return 32===ke.backend.floatPrecision()?.001:.1}function Yf(e,t,n){var r=!0;if(($(e)||$(t))&&(r=!1),$(e)&&$(t)&&(r=!0),r){var o=e.constructor.name,a=t.constructor.name;if(o!==a)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var i=$t(e),s=$t(t);if(!T(i,s))throw new Error("Arrays have different shapes. Actual: ["+i+"]. Expected: ["+s+"]")}var u=$(e)?e:I(e),c=$(t)?t:I(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var f=u[l],p=c[l];if(!n(f,p))throw new Error("Arrays differ: actual["+l+"] = "+f+", expected["+l+"] = "+p+".\nActual:   "+u+".\nExpected: "+c+".")}}function Zf(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({Serializable:zf,SerializationMap:qf,registerClass:Kf}),Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=Xf()),Yf(e,t,(function(e,t){return Zf(e,t,n)}))},testEpsilon:Xf,expectPromiseToFail:function(e,t){e().then((function(){return t.fail()}),(function(){return t()}))},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return z(e)||z(e[0])||z(t)||z(t[0])?Yf(e,n,(function(e,t){return e==t})):Yf(e,t,(function(e,t){return Zf(e,t,0)}))},expectNumbersClose:function(e,t,n){if(null==n&&(n=Xf()),!Zf(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),Object.freeze({gpgpu_util:Ha,webgl_util:Lt,forceHalfFloat:function(){f().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Ki,setWebGLContext:Ve,GPGPUContext:ja});var Qf=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),o=r.value,a=r.grads;if(null!=n){var i=n.map((function(e){return{name:e.name,tensor:a[e.name]}}));this.applyGradients(i)}else this.applyGradients(a);return Wt(a),t?o:(o.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){C(Y(e),(function(){return"The f passed in variableGrads(f) must be a function"})),C(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof Ce})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],ke.registeredVariables)t.push(ke.registeredVariables[r]);var o=n?t.filter((function(e){return!e.trainable})):null,a=t.length;C((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."}));var i=ke.gradients(e,t,null,!0),s=i.value,u=i.grads;C(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),C(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=o&&o.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&Wt(this.iterations_)},t.prototype.saveIterations=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:ln(this.iterations_,"int32")}]}))}))},t.prototype.getWeights=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},t.prototype.setWeights=function(e){return s(this,void 0,void 0,(function(){return u(this,(function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},t.prototype.extractIterations=function(e){return s(this,void 0,void 0,(function(){var t;return u(this,(function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}}))}))},t}(zf);Object.defineProperty(Qf,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Jf=function(e){function t(t,n,r){void 0===r&&(r=null);var o=e.call(this)||this;return o.learningRate=t,o.rho=n,o.epsilon=r,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==r&&(o.epsilon=ke.backend.epsilon()),o}return i(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var o=ke.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:Gt((function(){return xn(o).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:Gt((function(){return xn(o).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Gt((function(){var e=i.mul(t.rho).add(a.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(i.add(t.epsilon).sqrt()).mul(a),r=s.mul(t.rho).add(n.square().mul(1-t.rho));i.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(o);o.assign(u)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Wt(this.accumulatedGrads.map((function(e){return e.variable}))),Wt(this.accumulatedUpdates.map((function(e){return e.variable}))))},t.prototype.getWeights=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return s(this,void 0,void 0,(function(){var t;return u(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(Qf);Kf(Jf);var ep=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return i(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var o=ke.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:Gt((function(){return gn(o.shape,t.initialAccumulatorValue).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedGrads[r].variable;Gt((function(){var e=i.add(a.square());i.assign(e);var n=a.div(e.add(ke.backend.epsilon()).sqrt()).mul(-t.learningRate).add(o);o.assign(n)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&Wt(this.accumulatedGrads.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return s(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(Qf);Kf(ep);var tp=function(e){function t(t,n,r,o){void 0===o&&(o=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Gt((function(){a.accBeta1=ln(n).variable(),a.accBeta2=ln(r).variable()})),null==o&&(a.epsilon=ke.backend.epsilon()),a}return i(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Gt((function(){var r=gu(1,t.accBeta1),o=gu(1,t.accBeta2);n.forEach((function(n,a){var i=ke.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Gt((function(){return xn(i).variable(!1)}))}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:n+"/v",variable:Gt((function(){return xn(i).variable(!1)}))});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,c=t.accumulatedSecondMoment[a].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=c.mul(t.beta2).add(s.square().mul(1-t.beta2)),p=l.div(r),h=f.div(o);u.assign(l),c.assign(f);var d=p.div(h.sqrt().add(t.epsilon)).mul(-t.learningRate).add(i);i.assign(d)}})),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Wt(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&Wt(this.accumulatedSecondMoment.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return s(this,void 0,void 0,(function(){var t,n=this;return u(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),Gt((function(){n.accBeta1.assign(du(n.beta1,n.iterations_+1)),n.accBeta2.assign(du(n.beta2,n.iterations_+1))})),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(Qf);Kf(tp);var np=function(e){function t(t,n,r,o,a){void 0===o&&(o=null),void 0===a&&(a=0);var i=e.call(this)||this;return i.learningRate=t,i.beta1=n,i.beta2=r,i.epsilon=o,i.decay=a,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Gt((function(){i.iteration=ln(0).variable(),i.accBeta1=ln(n).variable()})),null==o&&(i.epsilon=ke.backend.epsilon()),i}return i(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Gt((function(){var r=gu(1,t.accBeta1),o=nu(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach((function(n,a){var i=ke.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:xn(i).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:xn(i).variable(!1)});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,c=t.accumulatedWeightedInfNorm[a].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=c.mul(t.beta2),p=s.abs(),h=f.maximum(p);u.assign(l),c.assign(h);var d=o.div(r).mul(l.div(h.add(t.epsilon))).add(i);i.assign(d)}})),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Wt(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&Wt(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},t.prototype.setWeights=function(e){return s(this,void 0,void 0,(function(){return u(this,(function(e){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(Qf);Kf(np);var rp=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return i(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var a=ke.registeredVariables[n];Gt((function(){var e=t.c.mul(o).add(a);a.assign(e)}))}})),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(e){return ke.keep(e)}(ln(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}}))}))},t.prototype.setWeights=function(e){return s(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(Qf);Kf(rp);var op=function(e){function t(t,n,r){void 0===r&&(r=!1);var o=e.call(this,t)||this;return o.learningRate=t,o.momentum=n,o.useNesterov=r,o.accumulations=[],o.m=ln(o.momentum),o}return i(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var o=ke.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:Gt((function(){return xn(o).variable(!1)}))});var a=t.accumulations[r].variable,i=Array.isArray(e)?e[r].tensor:e[n];null!=i&&Gt((function(){var e,n=t.m.mul(a).add(i);e=t.useNesterov?t.c.mul(i.add(n.mul(t.m))).add(o):t.c.mul(n).add(o),a.assign(n),o.assign(e)}))})),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Wt(this.accumulations.map((function(e){return e.variable})))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return s(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(rp);Kf(op);var ap=function(e){function t(t,n,r,o,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===a&&(a=!1);var i=e.call(this)||this;if(i.learningRate=t,i.decay=n,i.momentum=r,i.epsilon=o,i.accumulatedMeanSquares=[],i.accumulatedMoments=[],i.accumulatedMeanGrads=[],i.centered=a,null==o&&(i.epsilon=ke.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return i}return i(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var o=ke.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:Gt((function(){return xn(o).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:Gt((function(){return xn(o).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:Gt((function(){return xn(o).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;Gt((function(){var e=i.mul(t.decay).add(a.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(a.mul(1-t.decay)),c=s.mul(t.momentum).add(a.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));i.assign(e),n.assign(u),s.assign(c);var l=o.sub(c);o.assign(l)}else{var f=i.mul(t.decay).add(a.square().mul(1-t.decay));c=s.mul(t.momentum).add(a.mul(t.learningRate).div(f.add(t.epsilon).sqrt())),i.assign(f),s.assign(c),l=o.sub(c),o.assign(l)}}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Wt(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Wt(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&Wt(this.accumulatedMoments.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return s(this,void 0,void 0,(function(){var t;return u(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}))),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(Qf);Kf(ap);var ip=function(){function e(){}return e.sgd=function(e){return new rp(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new op(e,t,n)},e.rmsprop=function(e,t,n,r,o){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new ap(e,t,n,r,o)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new tp(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new Jf(e,t,n)},e.adamax=function(e,t,n,r,o){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new np(e,t,n,r,o)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new ep(e,t)},e}();ip.sgd,ip.momentum,ip.adadelta,ip.adagrad,ip.rmsprop,ip.adamax,ip.adam,"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate,ye.prototype.squaredDifference=function(e){return Zi(this,e)},me=kl;var sp=function(e,t){return sp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},sp(e,t)};function up(e,t){function n(){this.constructor=e}sp(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var cp=function(){return cp=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},cp.apply(this,arguments)};function lp(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))}function fp(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function pp(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)r[o]=a[i];return r}var hp=function(){function e(e,t){if(!wp(e)||!wp(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function dp(e,t){return e instanceof ye&&e.shape.length===t}function vp(e){return dp(e,3)}function mp(e){return dp(e,4)}function gp(e){return e%2==0}function yp(e){return e&&e.width&&e.height}function bp(e){return e.reduce((function(e,t){return e.add(t)}),new Ap(0,0)).div(new Ap(e.length,e.length))}function xp(e,t,n){return Array(e).fill(0).map((function(e,r){return t+r*n}))}function wp(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}function Ep(e){return wp(e)&&0<=e&&e<=1}var Ap=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),Cp=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(wp),a=[r.x,r.y,r.width,r.height].every(wp);if(!a&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var i=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=i[0],u=i[1],c=i[2],l=i[3];e.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",n),this._x=s,this._y=u,this._width=c,this._height=l}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(wp)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new Ap(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new Ap(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new Ap(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new Ap(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.round(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.floor(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,o=t.width,a=t.height,i=Math.abs(o-a);return o<a&&(n-=i/2,o+=i),a<o&&(r-=i/2,a+=i),new e({x:n,y:r,width:o,height:a})},e.prototype.rescale=function(t){var n=yp(t)?t.width:t,r=yp(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this,o=r.x,a=r.y,i=r.right,s=r.bottom,u=Math.max(o,0),c=Math.max(a,0),l=i-u,f=s-c;return new e({x:u,y:c,width:Math.min(l,t-u),height:Math.min(f,n-c)}).floor()},e.prototype.shift=function(t,n){var r=this.width,o=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:o})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,o=n,a=r,i=this.left,s=this.top,u=this.right,c=this.bottom;return u>t&&(o=-u+t+n,u=t),c>e&&(a=-c+e+r,c=e),i<1&&(a=2-i,i=1),s<1&&(a=2-s,s=1),{dy:1,edy:a,dx:1,edx:o,y:s,ey:c,x:i,ex:u,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),Sp=function(e){function t(t,n,r,o,a){return void 0===a&&(a=!1),e.call(this,{left:t,top:n,right:r,bottom:o},a)||this}return up(t,e),t}(Cp),_p=function(){function e(e,t,n,r,o){this._imageDims=new hp(o.width,o.height),this._score=e,this._classScore=t,this._className=n,this._box=new Cp(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new Cp(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),Ip=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return up(t,e),t.prototype.forSize=function(n,r){var o=e.prototype.forSize.call(this,n,r);return new t(o.score,o.relativeBox,o.imageDims)},t}(_p);function Rp(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function Tp(e,t,n,r){void 0===r&&(r=!0);for(var o=t.map((function(e,t){return{score:e,boxIndex:t}})).sort((function(e,t){return e.score-t.score})).map((function(e){return e.boxIndex})),a=[],i=function(){var t=o.pop();a.push(t);for(var i=o,s=[],u=0;u<i.length;u++){var c=i[u],l=e[t],f=e[c];s.push(Rp(l,f,r))}o=o.filter((function(e,t){return s[t]<=n}))};o.length>0;)i();return a}function Pp(e,t){return Gt((function(){var n=t[0],r=t[1],o=t[2],a=gn(pp(e.shape.slice(0,3),[1]),n),i=gn(pp(e.shape.slice(0,3),[1]),r),s=gn(pp(e.shape.slice(0,3),[1]),o),u=wn([a,i,s],3);return gu(e,u)}))}function Np(e){return 1/(1+Math.exp(-e))}var Op,Dp=function(e){function t(t,n,r,o,a){return void 0===a&&(a=!1),e.call(this,{x:t,y:n,width:r,height:o},a)||this}return up(t,e),t}(Cp),kp=function(){function e(e,t,n){void 0===n&&(n=new Ap(0,0));var r=t.width,o=t.height;this._imgDims=new hp(r,o),this._shift=n,this._positions=e.map((function(e){return e.mul(new Ap(r,o)).add(n)}))}return Object.defineProperty(e.prototype,"shift",{get:function(){return new Ap(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map((function(t){return t.sub(e._shift).div(new Ap(e.imageWidth,e.imageHeight))}))},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Ap(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof Ip?e.box.floor():new Cp(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=r.useDlibAlignment,a=r.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],r=e[2],o=function(e){return r.sub(e).magnitude()},a=(o(t)+o(n))/2,i=Math.floor(a/.45),s=bp(e),u=Math.floor(Math.max(0,s.x-.5*i)),c=Math.floor(Math.max(0,s.y-.43*i));return new Dp(u,c,Math.min(i,this.imageWidth+u),Math.min(i,this.imageHeight+c))},e.prototype.alignMinBbox=function(e){var t=function(e){var t=e.map((function(e){return e.x})),n=e.map((function(e){return e.y})),r=t.reduce((function(e,t){return t<e?t:e}),1/0),o=n.reduce((function(e,t){return t<e?t:e}),1/0),a=t.reduce((function(e,t){return e<t?t:e}),0),i=n.reduce((function(e,t){return e<t?t:e}),0);return new Sp(r,o,a,i)}(this.positions);return t.pad(t.width*e,t.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),Fp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],bp([e[3],e[4]])]},t}(kp),Mp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(bp)},t}(kp),Lp=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+function(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}(this.distance)+")":"")},e}(),Up=function(e){function t(t,n){var r=e.call(this,t)||this;return r._label=n,r}return up(t,e),t.assertIsValidLabeledBox=function(e,t){if(Cp.assertIsValidBox(e,t),!wp(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(Cp),Bp=function(){function e(e,t){if("string"!=typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some((function(e){return!(e instanceof Float32Array)})))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map((function(e){return Array.from(e)}))}},e.fromJSON=function(t){var n=t.descriptors.map((function(e){return new Float32Array(e)}));return new e(t.label,n)},e}();function Gp(e){return e.detection instanceof Ip}function Wp(e,t){var n={detection:t};return Object.assign({},e,n)}function Vp(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function $p(e){var t="";if(!e)try{e=__webpack_require__(730)}catch(e){t=e.toString()}return{readFile:e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){return e?r(e):n(t)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)}}}function Hp(){var e=__webpack_require__.g.Canvas||__webpack_require__.g.HTMLCanvasElement,t=__webpack_require__.g.Image||__webpack_require__.g.HTMLImageElement,n=__webpack_require__.g.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},r=$p();return cp({Canvas:e||function(){},CanvasRenderingContext2D:__webpack_require__.g.CanvasRenderingContext2D||function(){},Image:t||function(){},ImageData:__webpack_require__.g.ImageData||function(){},Video:__webpack_require__.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:n},r)}function jp(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function zp(){return"object"==typeof __webpack_require__.g&&"undefined"!=typeof process&&!!process.version}function qp(e){Op=e}function Kp(){jp()&&qp(Vp()),zp()&&qp(Hp())}!function(e){function t(t,n,r,o){var a=e.call(this,t,n)||this;return a._score=r,a._classScore=o,a}up(t,e),t.assertIsValidPredictedBox=function(e,t){if(Up.assertIsValidLabeledBox(e,t),!Ep(e.score)||!Ep(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(Up);var Xp,Yp={getEnv:function(){if(!Op)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Op},setEnv:qp,initialize:Kp,createBrowserEnv:Vp,createFileSystem:$p,createNodejsEnv:Hp,monkeyPatch:function(e){if(Op||Kp(),!Op)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?Op.Canvas:t,r=e.Image,o=void 0===r?Op.Image:r;Op.Canvas=n,Op.Image=o,Op.createCanvasElement=e.createCanvasElement||function(){return new n},Op.createImageElement=e.createImageElement||function(){return new o},Op.ImageData=e.ImageData||Op.ImageData,Op.Video=e.Video||Op.Video,Op.fetch=e.fetch||Op.fetch,Op.readFile=e.readFile||Op.readFile},isBrowser:jp,isNodejs:zp};function Zp(e){return Yp.isNodejs()||"string"!=typeof e?e:document.getElementById(e)}function Qp(e){var t=Yp.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=Zp(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=r.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}Kp(),function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Xp||(Xp={}));var Jp=function(e){void 0===e&&(e={});var t=e.anchorPosition,n=e.backgroundColor,r=e.fontColor,o=e.fontSize,a=e.fontStyle,i=e.padding;this.anchorPosition=t||Xp.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=a||"Georgia",this.padding=i||4};!function(){function e(t,n,r){void 0===r&&(r={}),this.text="string"==typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new Jp(r)}e.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map((function(t){return e.measureText(t).width})).reduce((function(e,t){return e<t?t:e}),0)+2*t},e.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},e.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,r=n===Xp.BOTTOM_RIGHT||n===Xp.TOP_RIGHT,o=n===Xp.BOTTOM_LEFT||n===Xp.BOTTOM_RIGHT,a=this.measureWidth(e),i=this.measureHeight(),s=r?this.anchor.x-a:this.anchor.x,u=o?this.anchor.y-i:this.anchor.y;if(t){var c=t.width,l=t.height;return{x:Math.max(Math.min(s,c-a),0),y:Math.max(Math.min(u,l-i),0)}}return{x:s,y:u}},e.prototype.draw=function(e){var t=Zp(e),n=Qp(t),r=this.options,o=r.backgroundColor,a=r.fontColor,i=r.fontSize,s=r.fontStyle,u=r.padding;n.font=i+"px "+s;var c=this.measureWidth(n),l=this.measureHeight();n.fillStyle=o;var f=this.getUpperLeft(n,t);n.fillRect(f.x,f.y,c,l),n.fillStyle=a,this.text.forEach((function(e,t){var r=u+f.x,o=u+f.y+(t+1)*i;n.fillText(e,r,o)}))}}();function eh(e){var t=Yp.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function th(e){var t=Yp.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new hp(e.naturalWidth,e.naturalHeight):e instanceof r?new hp(e.videoWidth,e.videoHeight):new hp(e.width,e.height)}function nh(e){var t=e.width,n=e.height,r=(0,Yp.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function rh(e,t){var n=Yp.getEnv().ImageData;if(!(e instanceof n||eh(e)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||th(e),o=r.width,a=r.height,i=nh({width:o,height:a});return e instanceof n?Qp(i).putImageData(e,0,0):Qp(i).drawImage(e,0,0,o,a),i}function oh(e,t){return lp(this,void 0,void 0,(function(){var n,r,o,a,i,s;return fp(this,(function(u){switch(u.label){case 0:return n=t||Yp.getEnv().createCanvasElement(),r=e.shape.slice(mp(e)?1:0),o=r[0],a=r[1],i=r[2],s=Gt((function(){return e.as3D(o,a,i).toInt()})),[4,jf.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}}))}))}function ah(e){var t=Yp.getEnv(),n=t.Image,r=t.Canvas,o=t.Video;return e instanceof n||e instanceof r||e instanceof o}var ih=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach((function(e,t){if(vp(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(mp(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var o=e instanceof Yp.getEnv().Canvas?e:rh(e);n._canvases[t]=o,n._inputDimensions[t]=[o.height,o.width,3]}))}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return xp(this.batchSize,0,1).map((function(t,n){return e.getReshapedInputDimensions(n)}))},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(e,t){var n=e.width,r=e.height,o=t/Math.max(r,n);return new hp(Math.round(n*o),Math.round(r*o))}({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,Gt((function(){var r=xp(n.batchSize,0,1).map((function(r){var o=n.getInput(r);if(o instanceof ye){var a=mp(o)?o:o.expandDims();return a=function(e,t){return void 0===t&&(t=!1),Gt((function(){var n=e.shape.slice(1),r=n[0],o=n[1];if(r===o)return e;var a=Math.abs(r-o),i=Math.round(a*(t?.5:1)),s=r>o?2:1,u=function(t){var n=e.shape.slice();return n[s]=t,gn(n,0)},c=u(i),l=a-c.shape[s],f=[t&&l?u(l):null,e,c].filter((function(e){return!!e})).map((function(e){return e.toFloat()}));return wn(f,s)}))}(a,t),a.shape[1]===e&&a.shape[2]===e||(a=Sl.resizeBilinear(a,[e,e])),a.as3D(e,e,3)}if(o instanceof Yp.getEnv().Canvas)return jf.fromPixels(function(e,t,n){void 0===n&&(n=!1);var r=Yp.getEnv(),o=r.Image,a=r.Canvas;if(!(e instanceof o||e instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=th(e),s=t/Math.max(i.height,i.width),u=s*i.width,c=s*i.height,l=nh({width:t,height:t}),f=e instanceof a?e:rh(e),p=Math.abs(u-c)/2,h=n&&u<c?p:0,d=n&&c<u?p:0;return Qp(l).drawImage(f,h,d,u,c),l}(o,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+o)})),o=ur(r.map((function(e){return e.toFloat()}))).as4D(n.batchSize,e,e,3);return o}))},e}();function sh(e){return lp(this,void 0,void 0,(function(){var t,n,r;return fp(this,(function(o){switch(o.label){case 0:if(e instanceof ih)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map(Zp)).forEach((function(e,r){if(!ah(e)&&!vp(e)&&!mp(e)){if("string"==typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(mp(e)){var o=e.shape[0];if(1!==o)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+o+" passed, but not supported in input array")}})),[4,Promise.all(r.map((function(e){return ah(e)&&(t=e,new Promise((function(e,n){if(t instanceof Yp.getEnv().Canvas||eh(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),e(t))}function o(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",o),n(e))}t.addEventListener("load",r),t.addEventListener("error",o)})));var t})))];case 1:return o.sent(),[2,new ih(r,Array.isArray(e))]}}))}))}function uh(e,t){return lp(this,void 0,void 0,(function(){var n,r,o,a,i,s;return fp(this,(function(u){switch(u.label){case 0:return n=Yp.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,sh(e)];case 1:if((o=u.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(a=o.getInput(0))instanceof n?(i=a,[3,4]):[3,2];case 2:return[4,oh(a)];case 3:i=u.sent(),u.label=4;case 4:r=i,u.label=5;case 5:return s=Qp(r),[2,t.map((function(e){return e instanceof Ip?e.forSize(r.width,r.height).box.floor():e})).map((function(e){return e.clipAtImageBorders(r.width,r.height)})).map((function(e){var t=e.x,n=e.y,r=e.width,o=e.height,a=nh({width:r,height:o});return Qp(a).putImageData(s.getImageData(t,n,r,o),0,0),a}))]}}))}))}function ch(e,t){return lp(this,void 0,void 0,(function(){return fp(this,(function(n){if(!vp(e)&&!mp(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(mp(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Gt((function(){var n=e.shape.slice(mp(e)?1:0),r=n[0],o=n[1],a=n[2],i=t.map((function(e){return e instanceof Ip?e.forSize(o,r).box:e})).map((function(e){return e.clipAtImageBorders(o,r)})).map((function(t){var n=t.x,i=t.y,s=t.width,u=t.height;return hc(e.as3D(r,o,a),[i,n,0],[u,s,a])}));return i}))]}))}))}function lh(e,t){return lp(this,void 0,void 0,(function(){var n;return fp(this,(function(r){switch(r.label){case 0:return[4,(0,Yp.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}}))}))}function fh(e){return lp(this,void 0,void 0,(function(){return fp(this,(function(t){switch(t.label){case 0:return[4,lh(e)];case 1:return[2,t.sent().json()]}}))}))}function ph(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",o=(e=e.replace(r,"")).split("/").filter((function(e){return e})),a=e.endsWith(".json")?o[o.length-1]:n,i=r+(e.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:i=e.startsWith("/")?"/"+i:i,manifestUri:"/"===i?"/"+a:i+"/"+a}}function hh(e,t){return lp(this,void 0,void 0,(function(){var n,r,o,a;return fp(this,(function(i){switch(i.label){case 0:return n=ph(e,t),r=n.manifestUri,o=n.modelBaseUri,[4,fh(r)];case 1:return a=i.sent(),[2,Vf.loadWeights(a,o)]}}))}))}function dh(e,t,n){void 0===n&&(n=!1);var r=n?th(t):t,o=r.width,a=r.height;return e.width=o,e.height=a,{width:o,height:a}}var vh=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,o=n.objProp;r[o].dispose(),r[o]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map((function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}}))},e.prototype.getTrainableParams=function(){return this.getParamList().filter((function(e){return e.tensor instanceof Ce}))},e.prototype.getFrozenParams=function(){return this.getParamList().filter((function(e){return!(e.tensor instanceof Ce)}))},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach((function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())}))},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach((function(t){var n=t.path,r=t.tensor,o=un(r.dataSync());r.dispose(),e.reassignParamFromPath(n,o)}))},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach((function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()})),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map((function(e){var t=e.tensor;return Array.from(t.dataSync())})).reduce((function(e,t){return e.concat(t)})))},e.prototype.load=function(e){return lp(this,void 0,void 0,(function(){return fp(this,(function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.loadFromUri=function(e){return lp(this,void 0,void 0,(function(){var t;return fp(this,(function(n){switch(n.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,hh(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}}))}))},e.prototype.loadFromDisk=function(e){return lp(this,void 0,void 0,(function(){var t,n,r,o,a,i,s,u,c,l;return fp(this,(function(f){switch(f.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=Yp.getEnv().readFile,n=ph(e,this.getDefaultModelName()),r=n.manifestUri,o=n.modelBaseUri,a=function(e){return Promise.all(e.map((function(e){return t(e).then((function(e){return e.buffer}))})))},i=Vf.weightsLoaderFactory(a),c=(u=JSON).parse,[4,t(r)];case 1:return s=c.apply(u,[f.sent().toString()]),[4,i(s,o)];case 2:return l=f.sent(),this.loadFromWeightMap(l),[2]}}))}))},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce((function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}}),{nextObj:this.params}),n=t.obj,r=t.objProp;if(!(n&&r&&n[r]instanceof ye))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function mh(e,t,n){return Gt((function(){var r=zu(e,t.depthwise_filter,t.pointwise_filter,n,"same");return Qs(r,t.bias)}))}function gh(e,t,n){return void 0===n&&(n=!1),Gt((function(){var r=Pc(n?Qs(Bu(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):mh(e,t.conv0,[2,2])),o=mh(r,t.conv1,[1,1]),a=mh(Pc(Qs(r,o)),t.conv2,[1,1]);return Pc(Qs(r,Qs(o,a)))}))}function yh(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),Gt((function(){var o=Pc(n?Qs(Bu(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):mh(e,t.conv0,r?[2,2]:[1,1])),a=mh(o,t.conv1,[1,1]),i=mh(Pc(Qs(o,a)),t.conv2,[1,1]),s=mh(Pc(Qs(o,Qs(a,i))),t.conv3,[1,1]);return Pc(Qs(o,Qs(a,Qs(i,s))))}))}function bh(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),Gt((function(){var o=Qs(Bu(e,t.filters,[1,1],n),t.bias);return r?Pc(o):o}))}function xh(e,t){Object.keys(e).forEach((function(n){t.some((function(e){return e.originalPath===n}))||e[n].dispose()}))}function wh(e,t){return function(n,r,o,a){var i=dn(e(n*r*o*o),[o,o,n,r]),s=fn(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:s}}}function Eh(e,t){return function(n,r,o){var a=pn(e(n*r),[n,r]),i=fn(e(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:a,bias:i}}}var Ah=function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n};function Ch(e,t){return function(n,r,o){var a=dn(e(9*n),[3,3,n,1]),i=dn(e(n*r),[1,1,n,r]),s=fn(e(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new Ah(a,i,s)}}function Sh(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),o=e(t+"/bias",1);return new Ah(n,r,o)}}function _h(e,t){return function(n,r,o){var a=e[n];if(!dp(a,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+a);return t.push({originalPath:n,paramPath:o||n}),a}}function Ih(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function Rh(e,t){var n=wh(e,t),r=Ch(e,t);function o(e,t,o,a){return void 0===a&&(a=!1),{conv0:a?n(e,t,3,o+"/conv0"):r(e,t,o+"/conv0"),conv1:r(t,t,o+"/conv1"),conv2:r(t,t,o+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function(e,t,n,a){void 0===a&&(a=!1);var i=o(e,t,n,a);return{conv0:i.conv0,conv1:i.conv1,conv2:i.conv2,conv3:r(t,t,n+"/conv3")}}}}function Th(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function Ph(e,t){var n=_h(e,t),r=Th(n),o=Sh(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):o(e+"/conv0"),conv1:o(e+"/conv1"),conv2:o(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):o(e+"/conv0"),conv1:o(e+"/conv1"),conv2:o(e+"/conv2"),conv3:o(e+"/conv3")}}}}var Nh=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return up(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return Gt((function(){var n=yh(Pp(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(ln(255)),t.dense0,!0);return n=yh(n,t.dense1),n=yh(n,t.dense2),n=yh(n,t.dense3),ic(n,[7,7],[2,2],"valid")}))},t.prototype.forward=function(e){return lp(this,void 0,void 0,(function(){var t;return fp(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,sh(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=Ph(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return xh(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=Ih(e),r=n.extractWeights,o=n.getRemainingWeights,a=Rh(r,t).extractDenseBlock4Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2"),c=a(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u,dense3:c}}}(e)},t}(vh);function Oh(e,t){return Gt((function(){return Qs(Xu(e,t.weights),t.bias)}))}function Dh(e){var t={},n={};return Object.keys(e).forEach((function(r){(r.startsWith("fc")?n:t)[r]=e[r]})),{featureExtractorMap:t,classifierMap:n}}var kh=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return up(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Gt((function(){var r=e instanceof ih?t.faceFeatureExtractor.forwardInput(e):e;return Oh(r.as2D(r.shape[0],-1),n.fc)}))},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e,t,n){var r=[],o=Ih(e),a=o.extractWeights,i=o.getRemainingWeights,s=Eh(a,r)(t,n,"fc");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=Dh(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=_h(e,t),r={fc:("fc",{weights:n("fc/weights",2),bias:n("fc/bias",1)})};return xh(e,t),{params:r,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,o=e.slice(0,e.length-r),a=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(a)},t}(vh),Fh=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Mh=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);Fh.forEach((function(n,r){t[n]=e[r]}))}return e.prototype.asSortedArray=function(){var e=this;return Fh.map((function(t){return{expression:t,probability:e[t]}})).sort((function(e,t){return t.probability-e.probability}))},e}(),Lh=function(e){function t(t){return void 0===t&&(t=new Nh),e.call(this,"FaceExpressionNet",t)||this}return up(t,e),t.prototype.forwardInput=function(e){var t=this;return Gt((function(){return Pr(t.runNet(e))}))},t.prototype.forward=function(e){return lp(this,void 0,void 0,(function(){var t;return fp(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,sh(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictExpressions=function(e){return lp(this,void 0,void 0,(function(){var t,n,r,o,a=this;return fp(this,(function(i){switch(i.label){case 0:return[4,sh(e)];case 1:return t=i.sent(),[4,this.forwardInput(t)];case 2:return n=i.sent(),[4,Promise.all(fr(n).map((function(e){return lp(a,void 0,void 0,(function(){var t;return fp(this,(function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}}))}))})))];case 3:return r=i.sent(),n.dispose(),o=r.map((function(e){return new Mh(e)})),[2,t.isBatchInput?o:o[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(kh);function Uh(e,t){var n={expressions:t};return Object.assign({},e,n)}function Bh(e){return Gp(e)&&e.landmarks instanceof kp&&e.unshiftedLandmarks instanceof kp&&e.alignedRect instanceof Ip}function Gh(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),o=r.align(),a=e.detection.imageDims,i={landmarks:r,unshiftedLandmarks:t,alignedRect:new Ip(e.detection.score,o.rescale(a.reverse()),a)};return Object.assign({},e,i)}function Wh(e,t,n){return Qs(Bu(e,t.filters,n,"same"),t.bias)}function Vh(e,t,n){void 0===n&&(n=!0);var r=n?Pc(e):e;return r=mh(r,t.separable_conv0,[1,1]),r=mh(Pc(r),t.separable_conv1,[1,1]),r=ac(r,[3,3],[2,2],"same"),Qs(r,Wh(e,t.expansion_conv,[2,2]))}var $h,Hh,jh=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return up(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return Gt((function(){var r=Pp(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(ln(256)),o=Pc(Wh(r,n.entry_flow.conv_in,[2,2]));return o=Vh(o,n.entry_flow.reduction_block_0,!1),o=Vh(o,n.entry_flow.reduction_block_1),xp(t._numMainBlocks,0,1).forEach((function(e){o=function(e,t){var n=mh(Pc(e),t.separable_conv0,[1,1]);return n=mh(Pc(n),t.separable_conv1,[1,1]),n=mh(Pc(n),t.separable_conv2,[1,1]),Qs(n,e)}(o,n.middle_flow["main_block_"+e])})),o=Vh(o,n.exit_flow.reduction_block),o=Pc(mh(o,n.exit_flow.separable_conv,[1,1]))}))},t.prototype.forward=function(e){return lp(this,void 0,void 0,(function(){var t;return fp(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,sh(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n=[],r=function(e,t){var n=_h(e,t),r=Th(n),o=Sh(n);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function(e){return{separable_conv0:o(e+"/separable_conv0"),separable_conv1:o(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:o(e+"/separable_conv0"),separable_conv1:o(e+"/separable_conv1"),separable_conv2:o(e+"/separable_conv2")}}}}(e,n),o=r.extractConvParams,a=r.extractSeparableConvParams,i=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:o("entry_flow/conv_in"),reduction_block_0:i("entry_flow/reduction_block_0"),reduction_block_1:i("entry_flow/reduction_block_1")},c={};xp(t,0,1).forEach((function(e){c["main_block_"+e]=s("middle_flow/main_block_"+e)}));var l={reduction_block:i("exit_flow/reduction_block"),separable_conv:a("exit_flow/separable_conv")};return xh(e,n),{params:{entry_flow:u,middle_flow:c,exit_flow:l},paramMappings:n}}(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return function(e,t){var n=[],r=Ih(e),o=r.extractWeights,a=r.getRemainingWeights,i=function(e,t){var n=wh(e,t),r=Ch(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,o){return{separable_conv0:r(e,t,o+"/separable_conv0"),separable_conv1:r(t,t,o+"/separable_conv1"),expansion_conv:n(e,t,1,o+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}(o,n),s=i.extractConvParams,u=i.extractSeparableConvParams,c=i.extractReductionBlockParams,l=i.extractMainBlockParams,f={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},p={};xp(t,0,1).forEach((function(e){p["main_block_"+e]=l(128,"middle_flow/main_block_"+e)}));var h={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{entry_flow:f,middle_flow:p,exit_flow:h}}}(e,this._numMainBlocks)},t}(vh);(Hh=$h||($h={})).FEMALE="female",Hh.MALE="male";var zh,qh=function(e){function t(t){void 0===t&&(t=new jh(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return up(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Gt((function(){var r=e instanceof ih?t.faceFeatureExtractor.forwardInput(e):e,o=ic(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:Oh(o,n.fc.age).as1D(),gender:Oh(o,n.fc.gender)}}))},t.prototype.forwardInput=function(e){var t=this;return Gt((function(){var n=t.runNet(e),r=n.age,o=n.gender;return{age:r,gender:Pr(o)}}))},t.prototype.forward=function(e){return lp(this,void 0,void 0,(function(){var t;return fp(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,sh(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictAgeAndGender=function(e){return lp(this,void 0,void 0,(function(){var t,n,r,o,a,i,s=this;return fp(this,(function(u){switch(u.label){case 0:return[4,sh(e)];case 1:return t=u.sent(),[4,this.forwardInput(t)];case 2:return n=u.sent(),r=fr(n.age),o=fr(n.gender),a=r.map((function(e,t){return{ageTensor:e,genderTensor:o[t]}})),[4,Promise.all(a.map((function(e){var t=e.ageTensor,n=e.genderTensor;return lp(s,void 0,void 0,(function(){var e,r,o,a,i;return fp(this,(function(s){switch(s.label){case 0:return[4,t.data()];case 1:return e=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],a=(o=r>.5)?$h.MALE:$h.FEMALE,i=o?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:a,genderProbability:i}]}}))}))})))];case 3:return i=u.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?i:i[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e){var t=[],n=Ih(e),r=n.extractWeights,o=n.getRemainingWeights,a=Eh(r,t),i=a(512,1,"fc/age"),s=a(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:i,gender:s}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=Dh(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=_h(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return xh(e,t),{params:o,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(vh),Kh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map((function(e){var n=e.width,r=e.height,o=t/Math.max(r,n);return{width:n*o,height:r*o}})),o=r.length;return Gt((function(){var n=function(e,t){return ur([gn([68],e),gn([68],t)],1).as2D(1,136).as1D()},a=function(e,t){var n=r[e],o=n.width,a=n.height;return t(o,a)?Math.abs(o-a)/2:0},i=e.mul(gn([o,136],t)).sub(ur(Array.from(Array(o),(function(e,t){return n(function(e){return a(e,(function(e,t){return e<t}))}(t),function(e){return a(e,(function(e,t){return t<e}))}(t))})))).div(ur(Array.from(Array(o),(function(e,t){return n(r[t].width,r[t].height)}))));return i}))},t.prototype.forwardInput=function(e){var t=this;return Gt((function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map((function(e){return{height:e[0],width:e[1]}})))}))},t.prototype.forward=function(e){return lp(this,void 0,void 0,(function(){var t;return fp(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,sh(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.detectLandmarks=function(e){return lp(this,void 0,void 0,(function(){var t,n,r,o=this;return fp(this,(function(a){switch(a.label){case 0:return[4,sh(e)];case 1:return t=a.sent(),n=Gt((function(){return fr(o.forwardInput(t))})),[4,Promise.all(n.map((function(e,n){return lp(o,void 0,void 0,(function(){var r,o,a,i,s;return fp(this,(function(u){switch(u.label){case 0:return a=(o=Array).from,[4,e.data()];case 1:return r=a.apply(o,[u.sent()]),i=r.filter((function(e,t){return gp(t)})),s=r.filter((function(e,t){return!gp(t)})),[2,new Mp(Array(68).fill(0).map((function(e,t){return new Ap(i[t],s[t])})),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}}))}))})))];case 2:return r=a.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getClassifierChannelsOut=function(){return 136},t}(kh),Xh=function(e){function t(t){return void 0===t&&(t=new Nh),e.call(this,"FaceLandmark68Net",t)||this}return up(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(Kh),Yh=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return up(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Gt((function(){var n=gh(Pp(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(ln(255)),t.dense0,!0);return n=gh(n,t.dense1),n=gh(n,t.dense2),ic(n,[14,14],[2,2],"valid")}))},t.prototype.forward=function(e){return lp(this,void 0,void 0,(function(){var t;return fp(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,sh(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=Ph(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return xh(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=Ih(e),r=n.extractWeights,o=n.getRemainingWeights,a=Rh(r,t).extractDenseBlock3Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u}}}(e)},t}(vh),Zh=function(e){function t(t){return void 0===t&&(t=new Yh),e.call(this,"FaceLandmark68TinyNet",t)||this}return up(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(Kh);function Qh(e,t,n,r,o){void 0===o&&(o="same");var a=t.conv,i=a.filters,s=a.bias,u=Bu(e,i,n,o);return u=function(e,t){return Qs(pu(e,t.weights),t.biases)}(u=Qs(u,s),t.scale),r?Pc(u):u}function Jh(e,t){return Qh(e,t,[1,1],!1)}function ed(e,t){return Qh(e,t,[2,2],!0,"valid")}function td(e,t){function n(n,r,o,a){var i=function(n,r,o,a){var i=function(t,n,r){var o=e(t),a=o.length/(n*r*r);if(a%1!=0)throw new Error("depth has to be an integer: "+a+", weights.length: "+o.length+", numFilters: "+n+", filterSize: "+r);return Gt((function(){return Dc(dn(o,[n,a,r,r]),[2,3,1,0])}))}(n,r,o),s=fn(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:s}}(n,r,o,a+"/conv"),s=function(n,r){var o=fn(e(n)),a=fn(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:o,biases:a}}(r,a+"/scale");return{conv:i,scale:s}}return{extractConvLayerParams:n,extractResidualLayerParams:function(e,t,r,o,a){return void 0===a&&(a=!1),{conv1:n((a?.5:1)*e,t,r,o+"/conv1"),conv2:n(e,t,r,o+"/conv2")}}}}function nd(e){var t=[],n=function(e,t){var n=_h(e,t);function r(e){var t=n(e+"/conv/filters",4),r=n(e+"/conv/bias",1),o=function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e);return{conv:{filters:t,bias:r},scale:o}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}(e,t),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,a=r("conv32_down"),i=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),l=o("conv64_1"),f=o("conv64_2"),p=o("conv64_3"),h=o("conv128_down"),d=o("conv128_1"),v=o("conv128_2"),m=o("conv256_down"),g=o("conv256_1"),y=o("conv256_2"),b=o("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!dp(x,2))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var w={conv32_down:a,conv32_1:i,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:f,conv64_3:p,conv128_down:h,conv128_1:d,conv128_2:v,conv256_down:m,conv256_1:g,conv256_2:y,conv256_down_out:b,fc:x};return xh(e,t),{params:w,paramMappings:t}}function rd(e,t){var n=function(e,t){return Qh(e,t,[1,1],!0)}(e,t.conv1);return n=Jh(n,t.conv2),n=Qs(n,e),Pc(n)}function od(e,t){var n=ed(e,t.conv1);n=Jh(n,t.conv2);var r=ic(e,2,2,"valid"),o=mn(r.shape),a=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var i=pp(n.shape);i[1]=1;var s=mn(i),u=pp((n=wn([n,s],1)).shape);u[2]=1;var c=mn(u);n=wn([n,c],2)}return r=a?wn([r,o],3):r,n=Qs(r,n),Pc(n)}up((function(){return null!==zh&&zh.apply(this,arguments)||this}),zh=Xh);var ad=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return up(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return Gt((function(){var n=ed(Pp(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(ln(256)),t.conv32_down);n=rd(n=ac(n,3,2,"valid"),t.conv32_1),n=rd(n,t.conv32_2),n=rd(n,t.conv32_3),n=rd(n=od(n,t.conv64_down),t.conv64_1),n=rd(n,t.conv64_2),n=rd(n,t.conv64_3),n=rd(n=od(n,t.conv128_down),t.conv128_1),n=rd(n,t.conv128_2),n=rd(n=od(n,t.conv256_down),t.conv256_1);var r=(n=od(n=rd(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return Xu(r,t.fc)}))},t.prototype.forward=function(e){return lp(this,void 0,void 0,(function(){var t;return fp(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,sh(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.computeFaceDescriptor=function(e){return lp(this,void 0,void 0,(function(){var t,n,r,o=this;return fp(this,(function(a){switch(a.label){case 0:return[4,sh(e)];case 1:return t=a.sent(),n=Gt((function(){return fr(o.forwardInput(t))})),[4,Promise.all(n.map((function(e){return e.data()})))];case 2:return r=a.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return nd(e)},t.prototype.extractParams=function(e){return function(e){var t=Ih(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],a=td(n,o),i=a.extractConvLayerParams,s=a.extractResidualLayerParams,u=i(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),f=s(9216,32,3,"conv32_3"),p=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),d=s(36864,64,3,"conv64_2"),v=s(36864,64,3,"conv64_3"),m=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),E=s(589824,256,3,"conv256_down_out"),A=Gt((function(){return Dc(pn(n(32768),[128,256]),[1,0])}));if(o.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:f,conv64_down:p,conv64_1:h,conv64_2:d,conv64_3:v,conv128_down:m,conv128_1:g,conv128_2:y,conv256_down:b,conv256_1:x,conv256_2:w,conv256_down_out:E,fc:A},paramMappings:o}}(e)},t}(vh);function id(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var sd=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,o=t.maxNumScales,a=t.scoreThresholds,i=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=o||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=i,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some((function(e){return"number"!=typeof e})))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some((function(e){return"number"!=typeof e}))))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function ud(e,t,n){return Gt((function(){var r=Bu(e,t.filters,n,"same");return r=Qs(r,t.batch_norm_offset),is(r,0,6)}))}function cd(e,t,n){var r=e.arraySync(),o=Math.min(r[t][0],r[t][2]),a=Math.min(r[t][1],r[t][3]),i=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),f=Math.max(r[n][1],r[n][3]),p=(i-o)*(s-a),h=(l-u)*(f-c);if(p<=0||h<=0)return 0;var d=Math.max(o,u),v=Math.max(a,c),m=Math.min(i,l),g=Math.min(s,f),y=Math.max(m-d,0)*Math.max(g-v,0);return y/(p+h-y)}function ld(e,t){return Gt((function(){var n=e.shape[0];return{boxPredictionEncoding:ar(bh(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:ar(bh(e,t.class_predictor),[n,-1,3])}}))}var fd=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),pd=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return up(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return Gt((function(){var n=e.toBatchTensor(512,!1).toFloat(),r=function(e,t){return Gt((function(){var n=null,r=ud(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((function(e,t){var o=t+1,a=function(e){return[2,4,6,12].some((function(t){return t===e}))?[2,2]:[1,1]}(o);r=function(e,t,n){return Gt((function(){var r=$u(e,t.filters,n,"same");return r=Vs(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),is(r,0,6)}))}(r,e.depthwise_conv,a),r=ud(r,e.pointwise_conv,[1,1]),11===o&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}(gu(pu(n,ln(.007843137718737125)),ln(1)),t.mobilenetv1),o=function(e,t,n){return Gt((function(){var r=ud(e,n.conv_0,[1,1]),o=ud(r,n.conv_1,[2,2]),a=ud(o,n.conv_2,[1,1]),i=ud(a,n.conv_3,[2,2]),s=ud(i,n.conv_4,[1,1]),u=ud(s,n.conv_5,[2,2]),c=ud(u,n.conv_6,[1,1]),l=ud(c,n.conv_7,[2,2]),f=ld(t,n.box_predictor_0),p=ld(e,n.box_predictor_1),h=ld(o,n.box_predictor_2),d=ld(i,n.box_predictor_3),v=ld(u,n.box_predictor_4),m=ld(l,n.box_predictor_5);return{boxPredictions:wn([f.boxPredictionEncoding,p.boxPredictionEncoding,h.boxPredictionEncoding,d.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding],1),classPredictions:wn([f.classPrediction,p.classPrediction,h.classPrediction,d.classPrediction,v.classPrediction,m.classPrediction],1)}}))}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return Gt((function(){var r=e.shape[0],o=function(e,t){var n=function(e){var t=fr(Dc(e,[1,0])),n=[gu(t[2],t[0]),gu(t[3],t[1])];return{sizes:n,centers:[Qs(t[0],nu(n[0],ln(2))),Qs(t[1],nu(n[1],ln(2)))]}}(e),r=n.sizes,o=n.centers,a=fr(Dc(t,[1,0])),i=nu(pu(ls(nu(a[2],ln(5))),r[0]),ln(2)),s=Qs(pu(nu(a[0],ln(10)),r[0]),o[0]),u=nu(pu(ls(nu(a[3],ln(5))),r[1]),ln(2)),c=Qs(pu(nu(a[1],ln(10)),r[1]),o[1]);return Dc(ur([gu(s,i),gu(c,u),Qs(s,i),Qs(c,u)]),[1,0])}(ar(cr(n.extra_dim,[r,1,1]),[-1,4]),ar(e,[-1,4]));o=ar(o,[r,o.shape[0]/r,4]);var a=xs(lc(t,[0,0,1],[-1,-1,-1])),i=lc(a,[0,0,0],[-1,-1,1]);return i=ar(i,[r,i.shape[1]]),{boxes:fr(o),scores:fr(i)}}))}(o.boxPredictions,o.classPredictions,t.output_layer)}))},t.prototype.forward=function(e){return lp(this,void 0,void 0,(function(){var t;return fp(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,sh(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),lp(this,void 0,void 0,(function(){var n,r,o,a,i,s,u,c,l,f,p,h,d,v,m,g,y,b,x,w;return fp(this,(function(E){switch(E.label){case 0:return n=new fd(t),r=n.maxResults,o=n.minConfidence,[4,sh(e)];case 1:for(a=E.sent(),i=this.forwardInput(a),s=i.boxes,u=i.scores,c=s[0],l=u[0],f=1;f<s.length;f++)s[f].dispose(),u[f].dispose();return d=(h=Array).from,[4,l.data()];case 2:return p=d.apply(h,[E.sent()]),v=function(e,t,n,r,o){var a=e.shape[0],i=Math.min(n,a),s=t.map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>o})).sort((function(e,t){return t.score-e.score})),u=function(e){return e<=.5?1:0},c=[];return s.forEach((function(t){if(!(c.length>=i)){for(var n=t.score,r=c.length-1;r>=0;--r){var a=cd(e,t.boxIndex,c[r]);if(0!==a&&(t.score*=u(a),t.score<=o))break}n===t.score&&c.push(t.boxIndex)}})),c}(c,p,r,0,o),m=a.getReshapedInputDimensions(0),g=a.inputSize,y=g/m.width,b=g/m.height,x=c.arraySync(),w=v.map((function(e){var t=[Math.max(0,x[e][0]),Math.min(1,x[e][2])].map((function(e){return e*b})),n=t[0],r=t[1],o=[Math.max(0,x[e][1]),Math.min(1,x[e][3])].map((function(e){return e*y})),i=o[0],s=o[1];return new Ip(p[e],new Dp(i,n,s-i,r-n),{height:a.getInputHeight(0),width:a.getInputWidth(0)})})),c.dispose(),l.dispose(),[2,w]}}))}))},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=function(e,t){var n=_h(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function o(e){var t="mobilenetv1/conv_"+e,o="MobilenetV1/Conv2d_"+e+"_depthwise",a=t+"/depthwise_conv",i=t+"/pointwise_conv";return{depthwise_conv:{filters:n(o+"/depthwise_weights",4,a+"/filters"),batch_norm_scale:n(o+"/BatchNorm/gamma",1,a+"/batch_norm_scale"),batch_norm_offset:n(o+"/BatchNorm/beta",1,a+"/batch_norm_offset"),batch_norm_mean:n(o+"/BatchNorm/moving_mean",1,a+"/batch_norm_mean"),batch_norm_variance:n(o+"/BatchNorm/moving_variance",1,a+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,i)}}function a(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function i(e){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:i(0),box_predictor_1:i(1),box_predictor_2:i(2),box_predictor_3:i(3),box_predictor_4:i(4),box_predictor_5:i(5)}}}}(e,t),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,a=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!vp(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var i={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:a}};return xh(e,t),{params:i,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=Ih(e),r=n.extractWeights,o=n.getRemainingWeights,a=function(e,t){function n(n,r,o,a,i){var s=dn(e(n*r*o*o),[o,o,n,r]),u=fn(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/"+(i?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,o){var a=n(e,t,r,o,!0);return{filters:a.filters,batch_norm_offset:a.bias}}function o(n,o,a){var i=function(n,r){var o=dn(e(9*n),[3,3,n,1]),a=fn(e(n)),i=fn(e(n)),s=fn(e(n)),u=fn(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:o,batch_norm_scale:a,batch_norm_offset:i,batch_norm_mean:s,batch_norm_variance:u}}(n,a+"/depthwise_conv");return{depthwise_conv:i,pointwise_conv:r(n,o,1,a+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,t),i=a.extractMobilenetV1Params,s=a.extractPredictionLayerParams,u=i(),c=s(),l={extra_dim:hn(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:l},paramMappings:t}}(e)},t}(vh);!function(e){up((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(pd);var hd,dd=[new Ap(.738768,.874946),new Ap(2.42204,2.65704),new Ap(4.30971,7.04493),new Ap(10.246,4.59428),new Ap(12.6868,11.8741)],vd=[new Ap(1.603231,2.094468),new Ap(6.041143,7.080126),new Ap(2.882459,3.518061),new Ap(4.266906,5.178857),new Ap(9.041765,10.66308)],md=[117.001,114.697,97.404],gd=function(e){return"number"==typeof e};function yd(e){return Gt((function(){var t=pu(e,ln(.10000000149011612));return Qs(Pc(gu(e,t)),t)}))}function bd(e,t){return Gt((function(){var n=Yn(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Bu(n,t.conv.filters,[1,1],"valid"),n=gu(n,t.bn.sub),n=pu(n,t.bn.truediv),yd(n=Qs(n,t.conv.bias))}))}function xd(e,t){return Gt((function(){var n=Yn(e,[[0,0],[1,1],[1,1],[0,0]]);return n=zu(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),yd(n=Qs(n,t.bias))}))}!function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"}(hd||(hd={}));var wd=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),Ed=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return function(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!=typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!gd(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every((function(e){return"string"==typeof e})))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map((function(e){return e||{}})).every((function(e){return gd(e.x)&&gd(e.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(gd)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}(t),n._config=t,n}return up(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=bd(e,t.conv0);return n=bd(n=ac(n,[2,2],[2,2],"same"),t.conv1),n=bd(n=ac(n,[2,2],[2,2],"same"),t.conv2),n=bd(n=ac(n,[2,2],[2,2],"same"),t.conv3),n=bd(n=ac(n,[2,2],[2,2],"same"),t.conv4),n=bd(n=ac(n,[2,2],[2,2],"same"),t.conv5),n=bd(n=ac(n,[2,2],[1,1],"same"),t.conv6),bh(n=bd(n,t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?yd(bh(e,t.conv0,"valid",!1)):xd(e,t.conv0);return n=xd(n=ac(n,[2,2],[2,2],"same"),t.conv1),n=xd(n=ac(n,[2,2],[2,2],"same"),t.conv2),n=xd(n=ac(n,[2,2],[2,2],"same"),t.conv3),n=xd(n=ac(n,[2,2],[2,2],"same"),t.conv4),n=xd(n=ac(n,[2,2],[2,2],"same"),t.conv5),n=ac(n,[2,2],[1,1],"same"),n=t.conv6?xd(n,t.conv6):n,bh(n=t.conv7?xd(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return Gt((function(){var o=e.toBatchTensor(t,!1).toFloat();return o=(o=n.config.meanRgb?Pp(o,n.config.meanRgb):o).div(ln(256)),n.config.withSeparableConvs?n.runMobilenet(o,r):n.runTinyYolov2(o,r)}))},t.prototype.forward=function(e,t){return lp(this,void 0,void 0,(function(){var n;return fp(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,sh(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}}))}))},t.prototype.detect=function(e,t){return void 0===t&&(t={}),lp(this,void 0,void 0,(function(){var n,r,o,a,i,s,u,c,l,f,p,h,d=this;return fp(this,(function(v){switch(v.label){case 0:return n=new wd(t),r=n.inputSize,o=n.scoreThreshold,[4,sh(e)];case 1:return a=v.sent(),[4,this.forwardInput(a,r)];case 2:return i=v.sent(),s=Gt((function(){return fr(i)[0].expandDims()})),u={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(s,a.getReshapedInputDimensions(0),o)];case 3:return c=v.sent(),i.dispose(),s.dispose(),l=c.map((function(e){return e.box})),f=c.map((function(e){return e.score})),p=c.map((function(e){return e.classScore})),h=c.map((function(e){return d.config.classes[e.label]})),[2,Tp(l.map((function(e){return e.rescale(r)})),f,this.config.iouThreshold,!0).map((function(e){return new _p(f[e],p[e],h[e],l[e],u)}))]}}))}))},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n,r=[],o=function(e,t){var n=_h(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r(e+"/conv"),o=function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn");return{conv:t,bn:o}},extractSeparableConvParams:Sh(n)}}(e,r),a=o.extractConvParams,i=o.extractConvWithBatchNormParams,s=o.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?a("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:a("conv8")}}else n={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:a("conv8")};return xh(e,r),{params:n,paramMappings:r}}(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(e,t,n,r){var o,a=Ih(e),i=a.extractWeights,s=a.getRemainingWeights,u=[],c=function(e,t){var n=wh(e,t),r=Ch(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,o,a){var i=n(r,o,3,a+"/conv"),s=function(n,r){var o=fn(e(n)),a=fn(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:o,truediv:a}}(o,a+"/bn");return{conv:i,bn:s}},extractSeparableConvParams:r}}(i,u),l=c.extractConvParams,f=c.extractConvWithBatchNormParams,p=c.extractSeparableConvParams;if(t.withSeparableConvs){var h=r[0],d=r[1],v=r[2],m=r[3],g=r[4],y=r[5],b=r[6],x=r[7],w=r[8];o={conv0:t.isFirstLayerConv2d?l(h,d,3,"conv0"):p(h,d,"conv0"),conv1:p(d,v,"conv1"),conv2:p(v,m,"conv2"),conv3:p(m,g,"conv3"),conv4:p(g,y,"conv4"),conv5:p(y,b,"conv5"),conv6:x?p(b,x,"conv6"):void 0,conv7:w?p(x,w,"conv7"):void 0,conv8:l(w||x||b,5*n,1,"conv8")}}else h=r[0],d=r[1],v=r[2],m=r[3],g=r[4],y=r[5],b=r[6],x=r[7],w=r[8],o={conv0:f(h,d,"conv0"),conv1:f(d,v,"conv1"),conv2:f(v,m,"conv2"),conv3:f(m,g,"conv3"),conv4:f(g,y,"conv4"),conv5:f(y,b,"conv5"),conv6:f(b,x,"conv6"),conv7:f(x,w,"conv7"),conv8:l(w,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:o,paramMappings:u}}(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return lp(this,void 0,void 0,(function(){var r,o,a,i,s,u,c,l,f,p,h,d,v,m,g,y,b,x,w,E,A,C,S,_,I,R,T,P,N,O=this;return fp(this,(function(D){switch(D.label){case 0:return r=t.width,o=t.height,a=Math.max(r,o),i=a/r,s=a/o,u=e.shape[1],c=this.config.anchors.length,l=Gt((function(){var t=e.reshape([u,u,c,O.boxEncodingSize]);return[t.slice([0,0,0,0],[u,u,c,4]),t.slice([0,0,0,4],[u,u,c,1]),O.withClassScores?Pr(t.slice([0,0,0,5],[u,u,c,O.config.classes.length]),3):ln(0)]})),f=l[0],p=l[1],h=l[2],d=[],[4,p.array()];case 1:return v=D.sent(),[4,f.array()];case 2:m=D.sent(),g=0,D.label=3;case 3:if(!(g<u))return[3,12];y=0,D.label=4;case 4:if(!(y<u))return[3,11];b=0,D.label=5;case 5:return b<c?(x=Np(v[g][y][b][0]),!n||x>n?(w=(y+Np(m[g][y][b][0]))/u*i,E=(g+Np(m[g][y][b][1]))/u*s,A=Math.exp(m[g][y][b][2])*this.config.anchors[b].x/u*i,C=Math.exp(m[g][y][b][3])*this.config.anchors[b].y/u*s,S=w-A/2,_=E-C/2,I={row:g,col:y,anchor:b},this.withClassScores?[4,this.extractPredictedClass(h,I)]:[3,7]):[3,9]):[3,10];case 6:return N=D.sent(),[3,8];case 7:N={classScore:1,label:0},D.label=8;case 8:T=(R=N).classScore,P=R.label,d.push(cp({box:new Sp(S,_,S+A,_+C),score:x,classScore:x*T,label:P},I)),D.label=9;case 9:return b++,[3,5];case 10:return y++,[3,4];case 11:return g++,[3,3];case 12:return f.dispose(),p.dispose(),h.dispose(),[2,d]}}))}))},t.prototype.extractPredictedClass=function(e,t){return lp(this,void 0,void 0,(function(){var n,r,o,a;return fp(this,(function(i){switch(i.label){case 0:return n=t.row,r=t.col,o=t.anchor,[4,e.array()];case 1:return a=i.sent(),[2,Array(this.config.classes.length).fill(0).map((function(e,t){return a[n][r][o][t]})).map((function(e,t){return{classScore:e,label:t}})).reduce((function(e,t){return e.classScore>t.classScore?e:t}))]}}))}))},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(vh),Ad=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:vd,meanRgb:md}:{anchors:dd,withClassScores:!0});return e.call(this,n)||this}return up(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return lp(this,void 0,void 0,(function(){return fp(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new Ip(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(Ed),Cd=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return up(t,e),t}(wd),Sd=function(){function e(){}return e.prototype.then=function(e){return lp(this,void 0,void 0,(function(){var t;return fp(this,(function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}}))}))},e.prototype.run=function(){return lp(this,void 0,void 0,(function(){return fp(this,(function(e){throw new Error("ComposableTask - run is not implemented")}))}))},e}();function _d(e,t){var n={descriptor:t};return Object.assign({},e,n)}function Id(e,t,n,r,o){return void 0===o&&(o=function(e){return e.alignedRect}),lp(this,void 0,void 0,(function(){var a,i,s,u,c;return fp(this,(function(l){switch(l.label){case 0:return a=e.map((function(e){return Bh(e)?o(e):e.detection})),(s=r)?[3,5]:t instanceof ye?[4,ch(t,a)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,uh(t,a)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,n(i=s)];case 6:return c=l.sent(),i.forEach((function(e){return e instanceof ye&&e.dispose()})),[2,c]}}))}))}function Rd(e,t,n,r,o){return lp(this,void 0,void 0,(function(){var a=this;return fp(this,(function(i){return[2,Id([e],t,(function(e){return lp(a,void 0,void 0,(function(){return fp(this,(function(t){return[2,n(e[0])]}))}))}),r,o)]}))}))}function Td(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}var Pd=function(e){function t(t,n,r,o){return e.call(this,{left:t,top:n,right:r,bottom:o},!0)||this}return up(t,e),t}(Cp);function Nd(e){return Gt((function(){return pu(gu(e,ln(127.5)),ln(.0078125))}))}function Od(e,t){return Gt((function(){return Qs(Pc(e),pu(t,ms(Pc(ms(e)))))}))}function Dd(e,t,n){return void 0===n&&(n=!1),Gt((function(){var r=bh(e,t.conv1,"valid");return r=Od(r,t.prelu1_alpha),r=Od(r=bh(r=ac(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),Od(r=bh(r=n?r:ac(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)}))}function kd(e,t,n,r,o){o.stage1=[];var a=t.map((function(t){return Gt((function(){var n={scale:t},o=function(e,t){return Gt((function(){var n=Td(t,e.shape.slice(1)),r=n.height,o=n.width,a=Nd(Sl.resizeBilinear(e,[r,o]));return Dc(a,[0,2,1,3])}))}(e,t),a=Date.now(),i=function(e,t){return Gt((function(){var n=Dd(e,t,!0),r=bh(n,t.conv4_1,"valid"),o=zn(wc(r,3),3);return{prob:Pr(gu(r,o),3),regions:bh(n,t.conv4_2,"valid")}}))}(o,r),s=i.prob,u=i.regions;return n.pnet=Date.now()-a,{scoresTensor:fr(fr(s,3)[1])[0],regionsTensor:fr(u)[0],scale:t,statsForScale:n}}))})),i=a.map((function(e){var t=e.scoresTensor,r=e.regionsTensor,a=e.scale,i=e.statsForScale,s=function(e,t,n,r){for(var o=[],a=e.arraySync(),i=0;i<e.shape[0];i++)for(var s=0;s<e.shape[1];s++)a[i][s]>=r&&o.push(new Ap(s,i));return o.map((function(e){var r=new Sp(Math.round((2*e.y+1)/n),Math.round((2*e.x+1)/n),Math.round((2*e.y+12)/n),Math.round((2*e.x+12)/n)),o=a[e.y][e.x],i=t.arraySync();return{cell:r,score:o,region:new Pd(i[e.y][e.x][0],i[e.y][e.x][1],i[e.y][e.x][2],i[e.y][e.x][3])}}))}(t,r,a,n);if(t.dispose(),r.dispose(),!s.length)return o.stage1.push(i),[];var u=Date.now(),c=Tp(s.map((function(e){return e.cell})),s.map((function(e){return e.score})),.5);return i.nms=Date.now()-u,i.numBoxes=c.length,o.stage1.push(i),c.map((function(e){return s[e]}))})),s=i.reduce((function(e,t){return e.concat(t)}),[]),u=[],c=[];if(s.length>0){var l=Date.now(),f=Tp(s.map((function(e){return e.cell})),s.map((function(e){return e.score})),.7);o.stage1_nms=Date.now()-l,c=f.map((function(e){return s[e].score})),u=f.map((function(e){return s[e]})).map((function(e){var t=e.cell,n=e.region;return new Sp(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()}))}return{boxes:u,scores:c}}function Fd(e,t,n){var r=n.width,o=n.height;return lp(this,void 0,void 0,(function(){var n,a,i,s=this;return fp(this,(function(u){switch(u.label){case 0:return n=Qp(e),[4,Promise.all(t.map((function(t){return lp(s,void 0,void 0,(function(){var r,o,a,i,s,u,c,l;return fp(this,(function(f){return r=t.padAtBorders(e.height,e.width),o=r.y,a=r.ey,i=r.x,s=r.ex,u=i-1,c=o-1,l=n.getImageData(u,c,s-u,a-c),[2,Yp.isNodejs()?rh(l):createImageBitmap(l)]}))}))})))];case 1:return a=u.sent(),i=[],a.forEach((function(e){var t=Qp(nh({width:r,height:o}));t.drawImage(e,0,0,r,o);for(var n=t.getImageData(0,0,r,o).data,a=[],s=0;s<n.length;s+=4)a.push(n[s+2]),a.push(n[s+1]),a.push(n[s]);i.push(a)})),[2,i.map((function(e){return Gt((function(){return Nd(Dc(dn(e,[1,r,o,3]),[0,2,1,3]).toFloat())}))}))]}}))}))}function Md(e,t,n,r,o){return lp(this,void 0,void 0,(function(){var a,i,s,u,c,l,f,p,h,d,v,m,g,y;return fp(this,(function(b){switch(b.label){case 0:return a=Date.now(),[4,Fd(e,t,{width:24,height:24})];case 1:return i=b.sent(),o.stage2_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map((function(e){var t=function(e,t){return Gt((function(){var n=Dd(e,t),r=Od(Oh(ar(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),o=Oh(r,t.fc2_1),a=zn(wc(o,1),1),i=Pr(gu(o,a),1),s=Oh(r,t.fc2_2);return{scores:fr(i,1)[1],regions:s}}))}(e,r);return e.dispose(),t})),o.stage2_rnet=Date.now()-a,u=s.length>1?wn(s.map((function(e){return e.scores}))):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[b.sent()]),u.dispose(),p=c.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),h=p.map((function(e){return t[e]})),d=p.map((function(e){return c[e]})),v=[],m=[],h.length>0&&(a=Date.now(),g=Tp(h,d,.7),o.stage2_nms=Date.now()-a,y=g.map((function(e){var t=s[p[e]].regions.arraySync();return new Pd(t[0][0],t[0][1],t[0][2],t[0][3])})),m=g.map((function(e){return d[e]})),v=g.map((function(e,t){return h[e].calibrate(y[t])}))),s.forEach((function(e){e.regions.dispose(),e.scores.dispose()})),[2,{boxes:v,scores:m}]}}))}))}function Ld(e,t,n,r,o){return lp(this,void 0,void 0,(function(){var a,i,s,u,c,l,f,p,h,d,v,m,g,y,b;return fp(this,(function(x){switch(x.label){case 0:return a=Date.now(),[4,Fd(e,t,{width:48,height:48})];case 1:return i=x.sent(),o.stage3_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map((function(e){var t=function(e,t){return Gt((function(){var n=Dd(e,t);n=Od(n=bh(n=ac(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=Od(Oh(ar(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),o=Oh(r,t.fc2_1),a=zn(wc(o,1),1),i=Pr(gu(o,a),1),s=Oh(r,t.fc2_2),u=Oh(r,t.fc2_3);return{scores:fr(i,1)[1],regions:s,points:u}}))}(e,r);return e.dispose(),t})),o.stage3_onet=Date.now()-a,u=s.length>1?wn(s.map((function(e){return e.scores}))):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[x.sent()]),u.dispose(),p=c.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),h=p.map((function(e){var t=s[e].regions.arraySync();return new Pd(t[0][0],t[0][1],t[0][2],t[0][3])})),d=p.map((function(e,n){return t[e].calibrate(h[n])})),v=p.map((function(e){return c[e]})),m=[],g=[],y=[],d.length>0&&(a=Date.now(),b=Tp(d,v,.7,!1),o.stage3_nms=Date.now()-a,m=b.map((function(e){return d[e]})),g=b.map((function(e){return v[e]})),y=b.map((function(e,t){return Array(5).fill(0).map((function(n,r){var o=s[e].points.arraySync();return new Ap(o[0][r]*(m[t].width+1)+m[t].left,o[0][r+5]*(m[t].height+1)+m[t].top)}))}))),s.forEach((function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()})),[2,{boxes:m,scores:g,points:y}]}}))}))}var Ud=function(e){function t(){return e.call(this,"Mtcnn")||this}return up(t,e),t.prototype.load=function(t){return lp(this,void 0,void 0,(function(){return fp(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,t)]}))}))},t.prototype.loadFromDisk=function(t){return lp(this,void 0,void 0,(function(){return fp(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,t)]}))}))},t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),lp(this,void 0,void 0,(function(){var n,r,o,a,i,s,u,c,l,f,p,h,d,v,m,g,y,b,x,w,E;return fp(this,(function(A){switch(A.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},a=Date.now(),i=Gt((function(){return e=zn(jf.fromPixels(r)).toFloat(),Gt((function(){return ur(fr(e,3).reverse(),3)}));var e})),s=function(e){return i.dispose(),o.total=Date.now()-a,e},u=i.shape.slice(1),c=u[0],l=u[1],f=new sd(t),p=f.minFaceSize,h=f.scaleFactor,d=f.maxNumScales,v=f.scoreThresholds,m=f.scaleSteps,g=(m||function(e,t,n){for(var r=n[0],o=n[1],a=12/e,i=[],s=Math.min(r,o)*a,u=0;s>=12;)i.push(a*Math.pow(t,u)),s*=t,u+=1;return i}(p,h,[c,l])).filter((function(e){var t=Td(e,[c,l]);return Math.min(t.width,t.height)>12})).slice(0,d),o.scales=g,o.pyramid=g.map((function(e){return Td(e,[c,l])})),y=Date.now(),[4,kd(i,g,v[0],n.pnet,o)];case 1:return b=A.sent(),o.total_stage1=Date.now()-y,b.boxes.length?(o.stage2_numInputBoxes=b.boxes.length,y=Date.now(),[4,Md(r,b.boxes,v[1],n.rnet,o)]):[2,s({results:[],stats:o})];case 2:return x=A.sent(),o.total_stage2=Date.now()-y,x.boxes.length?(o.stage3_numInputBoxes=x.boxes.length,y=Date.now(),[4,Ld(r,x.boxes,v[2],n.onet,o)]):[2,s({results:[],stats:o})];case 3:return w=A.sent(),o.total_stage3=Date.now()-y,E=w.boxes.map((function(e,t){return Gh(Wp({},new Ip(w.scores[t],new Dp(e.left/l,e.top/c,e.width/l,e.height/c),{height:c,width:l})),new Fp(w.points[t].map((function(t){return t.sub(new Ap(e.left,e.top)).div(new Ap(e.width,e.height))})),{width:e.width,height:e.height}))})),[2,s({results:E,stats:o})]}}))}))},t.prototype.forward=function(e,t){return void 0===t&&(t={}),lp(this,void 0,void 0,(function(){var n;return fp(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,sh(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}}))}))},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),lp(this,void 0,void 0,(function(){var n;return fp(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,sh(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}}))}))},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=function(e,t){var n=_h(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function o(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function a(e){return n(e,1)}function i(e){return{conv1:r(e+"/conv1"),prelu1_alpha:a(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:a(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:a(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=i("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return cp(cp({},e),{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=i("rnet"),t=o("rnet/fc1"),n=a("rnet/prelu4_alpha"),r=o("rnet/fc2_1"),s=o("rnet/fc2_2");return cp(cp({},e),{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var e=i("onet"),t=r("onet/conv4"),n=a("onet/prelu4_alpha"),s=o("onet/fc1"),u=a("onet/prelu5_alpha"),c=o("onet/fc2_1"),l=o("onet/fc2_2"),f=o("onet/fc2_3");return cp(cp({},e),{conv4:t,prelu4_alpha:n,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:f})}}}(e,t),r=n.extractPNetParams,o=n.extractRNetParams,a=n.extractONetParams,i=r(),s=o(),u=a();return xh(e,t),{params:{pnet:i,rnet:s,onet:u},paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=Ih(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],a=function(e,t){var n=wh(e,t),r=Eh(e,t);function o(n,r){var o=fn(e(n));return t.push({paramPath:r}),o}function a(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:o(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:o(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:o(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=a([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return cp(cp({},e),{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=a([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=o(128,"rnet/prelu4_alpha"),i=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return cp(cp({},e),{fc1:t,prelu4_alpha:n,fc2_1:i,fc2_2:s})},extractONetParams:function(){var e=a([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),i=o(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),u=o(256,"onet/prelu5_alpha"),c=r(256,2,"onet/fc2_1"),l=r(256,4,"onet/fc2_2"),f=r(256,10,"onet/fc2_3");return cp(cp({},e),{conv4:t,prelu4_alpha:i,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:f})}}}(n,o),i=a.extractPNetParams,s=a.extractRNetParams,u=a.extractONetParams,c=i(),l=s(),f=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:f},paramMappings:o}}(e)},t}(vh),Bd=[new Ap(1.603231,2.094468),new Ap(6.041143,7.080126),new Ap(2.882459,3.518061),new Ap(4.266906,5.178857),new Ap(9.041765,10.66308)],Gd=[117.001,114.697,97.404],Wd=function(e){function t(){var t={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:Bd,meanRgb:Gd,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e.call(this,t)||this}return up(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return lp(this,void 0,void 0,(function(){return fp(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new Ip(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(Ed),Vd={ssdMobilenetv1:new pd,tinyFaceDetector:new Wd,tinyYolov2:new Ad,mtcnn:new Ud,faceLandmark68Net:new Xh,faceLandmark68TinyNet:new Zh,faceRecognitionNet:new ad,faceExpressionNet:new Lh,ageGenderNet:new qh};function $d(e,t){var n={age:t};return Object.assign({},e,n)}var Hd=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=r,o}return up(t,e),t}(Sd),jd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.run=function(){return lp(this,void 0,void 0,(function(){var e,t,n=this;return fp(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Id(e=r.sent(),this.input,(function(e){return lp(n,void 0,void 0,(function(){return fp(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return Vd.faceExpressionNet.predictExpressions(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){return Uh(e,t[n])}))]}}))}))},t.prototype.withAgeAndGender=function(){return new Yd(this,this.input)},t}(Hd),zd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.run=function(){return lp(this,void 0,void 0,(function(){var e,t;return fp(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,Rd(e,this.input,(function(e){return Vd.faceExpressionNet.predictExpressions(e)}),this.extractedFaces)]:[2];case 2:return t=n.sent(),[2,Uh(e,t)]}}))}))},t.prototype.withAgeAndGender=function(){return new Zd(this,this.input)},t}(Hd),qd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.withAgeAndGender=function(){return new Qd(this,this.input)},t.prototype.withFaceDescriptors=function(){return new tv(this,this.input)},t}(jd),Kd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.withAgeAndGender=function(){return new Jd(this,this.input)},t.prototype.withFaceDescriptor=function(){return new nv(this,this.input)},t}(zd),Xd=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=r,o}return up(t,e),t}(Sd),Yd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.run=function(){return lp(this,void 0,void 0,(function(){var e,t,n=this;return fp(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Id(e=r.sent(),this.input,(function(e){return lp(n,void 0,void 0,(function(){return fp(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return Vd.ageGenderNet.predictAgeAndGender(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){var r=t[n],o=r.age;return $d(id(e,r.gender,r.genderProbability),o)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new jd(this,this.input)},t}(Xd),Zd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.run=function(){return lp(this,void 0,void 0,(function(){var e,t,n,r,o;return fp(this,(function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?[4,Rd(e,this.input,(function(e){return Vd.ageGenderNet.predictAgeAndGender(e)}),this.extractedFaces)]:[2];case 2:return t=a.sent(),n=t.age,r=t.gender,o=t.genderProbability,[2,$d(id(e,r,o),n)]}}))}))},t.prototype.withFaceExpressions=function(){return new zd(this,this.input)},t}(Xd),Qd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.withFaceExpressions=function(){return new qd(this,this.input)},t.prototype.withFaceDescriptors=function(){return new tv(this,this.input)},t}(Yd),Jd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.withFaceExpressions=function(){return new Kd(this,this.input)},t.prototype.withFaceDescriptor=function(){return new nv(this,this.input)},t}(Zd),ev=function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return up(t,e),t}(Sd),tv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.run=function(){return lp(this,void 0,void 0,(function(){var e;return fp(this,(function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,Id(e=t.sent(),this.input,(function(e){return Promise.all(e.map((function(e){return Vd.faceRecognitionNet.computeFaceDescriptor(e)})))}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}))];case 2:return[2,t.sent().map((function(t,n){return _d(e[n],t)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new qd(this,this.input)},t.prototype.withAgeAndGender=function(){return new Qd(this,this.input)},t}(ev),nv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.run=function(){return lp(this,void 0,void 0,(function(){var e,t;return fp(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,Rd(e,this.input,(function(e){return Vd.faceRecognitionNet.computeFaceDescriptor(e)}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}))]:[2];case 2:return t=n.sent(),[2,_d(e,t)]}}))}))},t.prototype.withFaceExpressions=function(){return new Kd(this,this.input)},t.prototype.withAgeAndGender=function(){return new Jd(this,this.input)},t}(ev),rv=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.useTinyLandmarkNet=r,o}return up(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Vd.faceLandmark68TinyNet:Vd.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(Sd),ov=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.run=function(){return lp(this,void 0,void 0,(function(){var e,t,n,r,o,a=this;return fp(this,(function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),t=e.map((function(e){return e.detection})),this.input instanceof ye?[4,ch(this.input,t)]:[3,3];case 2:return r=i.sent(),[3,5];case 3:return[4,uh(this.input,t)];case 4:r=i.sent(),i.label=5;case 5:return n=r,[4,Promise.all(n.map((function(e){return a.landmarkNet.detectLandmarks(e)})))];case 6:return o=i.sent(),n.forEach((function(e){return e instanceof ye&&e.dispose()})),[2,e.map((function(e,t){return Gh(e,o[t])}))]}}))}))},t.prototype.withFaceExpressions=function(){return new qd(this,this.input)},t.prototype.withAgeAndGender=function(){return new Qd(this,this.input)},t.prototype.withFaceDescriptors=function(){return new tv(this,this.input)},t}(rv),av=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.run=function(){return lp(this,void 0,void 0,(function(){var e,t,n,r,o;return fp(this,(function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?(t=e.detection,this.input instanceof ye?[4,ch(this.input,[t])]:[3,3]):[2];case 2:return r=a.sent(),[3,5];case 3:return[4,uh(this.input,[t])];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return o=a.sent(),n.forEach((function(e){return e instanceof ye&&e.dispose()})),[2,Gh(e,o)]}}))}))},t.prototype.withFaceExpressions=function(){return new Kd(this,this.input)},t.prototype.withAgeAndGender=function(){return new Jd(this,this.input)},t.prototype.withFaceDescriptor=function(){return new nv(this,this.input)},t}(rv),iv=function(e){function t(t,n){void 0===n&&(n=new fd);var r=e.call(this)||this;return r.input=t,r.options=n,r}return up(t,e),t}(Sd),sv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.run=function(){return lp(this,void 0,void 0,(function(){var e,t,n,r;return fp(this,(function(o){switch(o.label){case 0:return t=(e=this).input,(n=e.options)instanceof sd?[4,Vd.mtcnn.forward(t,n)]:[3,2];case 1:return[2,o.sent().map((function(e){return e.detection}))];case 2:if(r=n instanceof Cd?function(e){return Vd.tinyFaceDetector.locateFaces(e,n)}:n instanceof fd?function(e){return Vd.ssdMobilenetv1.locateFaces(e,n)}:n instanceof wd?function(e){return Vd.tinyYolov2.locateFaces(e,n)}:null,!r)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}}))}))},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise((function(t){return lp(e,void 0,void 0,(function(){var e;return fp(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map((function(e){return Wp({},e)})))]}}))}))}))},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new ov(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new jd(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new Yd(this.runAndExtendWithFaceDetections(),this.input)},t}(iv),uv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return up(t,e),t.prototype.run=function(){return lp(this,void 0,void 0,(function(){var e,t;return fp(this,(function(n){switch(n.label){case 0:return[4,new sv(this.input,this.options)];case 1:return e=n.sent(),t=e[0],e.forEach((function(e){e.score>t.score&&(t=e)})),[2,t]}}))}))},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise((function(t){return lp(e,void 0,void 0,(function(){var e;return fp(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e?Wp({},e):void 0)]}}))}))}))},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new av(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new zd(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new Zd(this.runAndExtendWithFaceDetection(),this.input)},t}(iv);function cv(e,t){return void 0===t&&(t=new fd),new uv(e,t)}function lv(e,t){var n=new hp(t.width,t.height),r=n.width,o=n.height;if(r<=0||o<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:o}));if(Array.isArray(e))return e.map((function(e){return lv(e,{width:r,height:o})}));if(Bh(e)){var a=e.detection.forSize(r,o),i=e.unshiftedLandmarks.forSize(a.box.width,a.box.height);return Gh(Wp(e,a),i)}return Gp(e)?Wp(e,e.detection.forSize(r,o)):e instanceof kp||e instanceof Ip?e.forSize(r,o):e}function fv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,o=function(){return"person "+r++};this._labeledDescriptors=n.map((function(e){if(e instanceof Bp)return e;if(e instanceof Float32Array)return new Bp(o(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new Bp(o(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")}))}Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map((function(t){return function(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map((function(e,t){return e-r[t]})).reduce((function(e,t){return e+Math.pow(t,2)}),0))}(t,e)})).reduce((function(e,t){return e+t}),0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map((function(n){var r=n.descriptors,o=n.label;return new Lp(o,t.computeMeanDistance(e,r))})).reduce((function(e,t){return e.distance<t.distance?e:t}))},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new Lp("unknown",t.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map((function(e){return e.toJSON()}))}},e.fromJSON=function(t){return new e(t.labeledDescriptors.map((function(e){return Bp.fromJSON(e)})),t.distanceThreshold)}}();var pv={"de-DE":{document:{noDocumentDetected:"AUSRICHTEN",smallDocument:"NÄHER HERANRÜCKEN",capturing:"AUFNAHME",tapToCapture:"TIPPEN, UM AUFZUNEHMEN"},selfie:{moveFurther:"Weiter weg bewegen",moveCloser:"Näher heranrücken",holdStill:"Still halten",centerFace:"Bitte Gesicht zentrieren",holdUpright:"Smartphone aufrecht halten",loadingCamera:"Kamera wird geladen ..."}},"en-GB":{document:{noDocumentDetected:"ALIGN",smallDocument:"MOVE CLOSER",capturing:"CAPTURING",tapToCapture:"TAP TO CAPTURE"},selfie:{moveFurther:"Move further",moveCloser:"Move closer",holdStill:"Hold still",centerFace:"Please centre your face",holdUpright:"Hold your phone upright",loadingCamera:"Loading camera..."}},"en-US":{document:{noDocumentDetected:"ALIGN",smallDocument:"MOVE CLOSER",capturing:"CAPTURING",tapToCapture:"TAP TO CAPTURE"},selfie:{moveFurther:"Move further",moveCloser:"Move closer",holdStill:"Hold still",centerFace:"Please center your face",holdUpright:"Hold your phone upright",loadingCamera:"Loading camera..."}},"es-MX":{document:{noDocumentDetected:"ALINEAR",smallDocument:"ACÉRQUESE",capturing:"CAPTURANDO",tapToCapture:"PULSE PARA CAPTURAR"},selfie:{moveFurther:"Aléjese",moveCloser:"Acérquese",holdStill:"No se mueva",centerFace:"Centre su rostro",holdUpright:"Mantenga el teléfono recto",loadingCamera:"Cargando la cámara..."}},"fr-CA":{document:{noDocumentDetected:"ALIGNER",smallDocument:"RAPPROCHEZ-VOUS",capturing:"SAISIE",tapToCapture:"TAPEZ POUR SAISIR"},selfie:{moveFurther:"Éloignez-vous",moveCloser:"Rapprochez-vous",holdStill:"Demeurez immobile",centerFace:"Centrez votre visage",holdUpright:"Tenez votre téléphone à la verticale",loadingCamera:"Chargement de la caméra..."}},"fr-FR":{document:{noDocumentDetected:"ALIGNEZ",smallDocument:"RAPPROCHEZ-VOUS",capturing:"CAPTURE",tapToCapture:"TOUCHEZ POUR CAPTURER"},selfie:{moveFurther:"Éloignez-vous",moveCloser:"Rapprochez-vous",holdStill:"Restez immobile",centerFace:"Centrez votre visage",holdUpright:"Tenez votre téléphone à la verticale",loadingCamera:"Chargement de l’appareil photo..."}},"it-IT":{document:{noDocumentDetected:"ALLINEA",smallDocument:"VAI PIÙ VICINO",capturing:"ACQUISIZIONE IN CORSO",tapToCapture:"TOCCA PER ACQUISIRE"},selfie:{moveFurther:"Allontana",moveCloser:"Vai più vicino",holdStill:"Tieni fermo",centerFace:"Centra il tuo viso",holdUpright:"Tieni il telefono diritto",loadingCamera:"Caricamento fotocamera in corso..."}},"ja-JP":{document:{noDocumentDetected:"合わせてください",smallDocument:"もっと近づいてください",capturing:"撮影しています",tapToCapture:"タップして撮影"},selfie:{moveFurther:"もっと離れてください",moveCloser:"もっと近づいてください",holdStill:"動かないでください",centerFace:"顔が真ん中にくるようにしてください",holdUpright:"携帯電話を縦にしてください",loadingCamera:"カメラを読み込み中…"}},"ko-KR":{document:{noDocumentDetected:"정렬",smallDocument:"더 가까이로 이동",capturing:"캡처",tapToCapture:"탭하여 캡처"},selfie:{moveFurther:"더 먼 거리로 이동",moveCloser:"더 가까이로 이동",holdStill:"움직이지 마십시오",centerFace:"얼굴을 중앙에 맞추십시오",holdUpright:"휴대폰을 똑바로 들어주십시오",loadingCamera:"카메라 로딩 중..."}},"nl-NL":{document:{noDocumentDetected:"UITLIJNEN",smallDocument:"KOM DICHTERBIJ",capturing:"AAN HET VASTLEGGEN",tapToCapture:"TIK OM VAST TE LEGGEN"},selfie:{moveFurther:"Ga verder weg",moveCloser:"Kom dichterbij",holdStill:"Beweeg niet",centerFace:"Centreer uw gezicht",holdUpright:"Houd uw telefoon rechtop",loadingCamera:"Camera aan het laden..."}},"pl-PL":{document:{noDocumentDetected:"WYRÓWNAJ",smallDocument:"PRZYBLIŻ",capturing:"UCHWYCENIE",tapToCapture:"STUKNIJ, ABY UCHWYCIĆ"},selfie:{moveFurther:"Oddal",moveCloser:"Przybliż",holdStill:"Nie ruszaj się",centerFace:"Wyśrodkuj twarz",holdUpright:"Trzymaj telefon w pozycji pionowej",loadingCamera:"Ładowanie kamery..."}},"ru-RU":{document:{noDocumentDetected:"ВЫРОВНЯЙТЕ ИЗОБРАЖЕНИЕ",smallDocument:"ПРИДВИНЬТЕ КАМЕРУ БЛИЖЕ",capturing:"СЪЕМКА",tapToCapture:"НАЖМИТЕ, ЧТОБЫ СФОТОГРАФИРОВАТЬ"},selfie:{moveFurther:"Отодвиньте камеру дальше",moveCloser:"Придвиньте камеру ближе",holdStill:"Не шевелитесь",centerFace:"Разместите лицо по центру",holdUpright:"Держите телефон прямо",loadingCamera:"Загрузка камеры..."}},"tr-TR":{document:{noDocumentDetected:"HİZALAYIN",smallDocument:"YAKLAŞIN",capturing:"GÖRÜNTÜ ALINIYOR",tapToCapture:"GÖRÜNTÜ ALMAK İÇİN DOKUNUN"},selfie:{moveFurther:"Uzaklaşın",moveCloser:"Yaklaşın",holdStill:"Sabit durun",centerFace:"Lütfen yüzünüzü ortalayın",holdUpright:"Telefonunuzu dik tutun",loadingCamera:"Kamera yükleniyor..."}},"uk-UA":{document:{noDocumentDetected:"ВИРІВНЯЙТЕ",smallDocument:"ПІДІЙДІТЬ БЛИЖЧЕ",capturing:"ЗАХОПЛЕННЯ",tapToCapture:"НАТИСНІТЬ ДЛЯ ЗАХОПЛЕННЯ"},selfie:{moveFurther:"Відійдіть далі",moveCloser:"Підійдіть ближче",holdStill:"Не рухайтеся",centerFace:"Відцентруйте своє обличчя",holdUpright:"Тримайте телефон вертикально",loadingCamera:"Завантаження камери..."}},"zh-CN":{document:{noDocumentDetected:"对准",smallDocument:"靠近一点",capturing:"正在采集",tapToCapture:"点击以进行采集"},selfie:{moveFurther:"离远一点",moveCloser:"靠近一点",holdStill:"保持不动",centerFace:"请将您的面部放在中央",holdUpright:"竖着拿起手机",loadingCamera:"正在加载相机……"}},"zh-TW":{document:{noDocumentDetected:"對齊",smallDocument:"靠近點",capturing:"拍攝中",tapToCapture:"點選以拍攝"},selfie:{moveFurther:"退後點",moveCloser:"靠近點",holdStill:"保持不動",centerFace:"請將臉部置放在中央處",holdUpright:"請直立手機",loadingCamera:"載入相機中…"}}},hv=["targetLocale","browserLocale","defaultLocale"];function dv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dv(Object(n),!0).forEach((function(t){fv(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dv(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var mv="zh-CN",gv="zh-TW",yv={en:"en-US",zh:mv,fr:"fr-FR",nl:"nl-NL",de:"de-DE",it:"it-IT",ja:"ja-JP",ko:"ko-KR",pl:"pl-PL",ru:"ru-RU",es:"es-MX",tr:"tr-TR",uk:"uk-UA"},bv={"zh-CHS":mv,"zh-CHT":gv,"zh-CN":mv,"zh-HK":gv,"zh-MO":gv,"zh-SG":mv,"zh-TW":gv},xv=vv(vv({},yv),bv);function wv(e,t){return!(!e&&!t)}function Ev(e){return e.split(/[-_]/)}function Av(e){if(!e)return"";var t=Ev(e),n=t[0].toLowerCase();if(t.length>1){var r=t[1].toUpperCase();return"".concat(n,"-").concat(r)}return n}function Cv(e){return Ev(e)[0]}function Sv(e,t){var n=function(e,t){if(wv(e,t))for(var n=function(e,t){return{targetLocale:e,defaultLocale:t,browserLocale:navigator.languages[0]||navigator.language}}(e,t),r=0;r<hv.length;r+=1){var o=Av(n[hv[r]]);if(o in pv)return o;var a=xv[o];if(a in pv)return a;var i=Cv(o),s=yv[i];if(s in pv)return s}return"en-US"}(e,t);if(wv(e,t)&&Av(e)!==n){var r=JSON.stringify({"Locale param":e,"DefaultLocale param":t,"Browser locale":{languages:navigator.languages,language:navigator.language},"Final chosen locale":n});console.warn("".concat("Unable to use provided locale","\n").concat(r))}return pv[n]}function _v(e,t){var n=Sv(e,t).document;return{NONE:n.noDocumentDetected,SMALL_DOCUMENT:n.smallDocument,GOOD_DOCUMENT:null,CAPTURING:n.capturing,TAP_TO_CAPTURE:n.tapToCapture}}function Iv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rv(e,t,n){return t&&Iv(e.prototype,t),n&&Iv(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Pv="MOVE_FURTHER",Nv="MOVE_CLOSER",Ov="HOLD_STILL",Dv=Rv((function e(n,o,a,i,s,u,c,l){var f=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),fv(this,"beginProcessing",(function(){f.videoPlayer.addEventListener("playing",f.processFace),f.captureTimer=setTimeout(f.captureFail,f.options.autoCaptureTime)})),fv(this,"getDetectionBias",(function(e){var t=0;return e?(f.lastDetection=e,t=f.detectionBias+1):f.lastDetection&&f.detectionBias>0?t=f.detectionBias-1:f.lastDetection=null,f.detectionBias=f.clamp(t,0,f.options.maxDetectionBias),f.lastDetection})),fv(this,"clearDetections",(function(){f.detectionBias=0,f.setDetections(null)})),fv(this,"clamp",(function(e,t,n){return Math.min(Math.max(e,t),n)})),fv(this,"getDetections",(function(){return f.detections})),fv(this,"setDetections",(function(e){f.detections=e})),fv(this,"prepareFaceCaptureAPI",function(){var e=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return setTimeout((function(){t(),e()}),n)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),fv(this,"processFace",t(r().mark((function e(){var n,o,a,i,s,u,c,l,p;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.videoPlayer,o=f.detectionCanvas,a=f.overlayCanvas,i=1e3/30,s=500,u="",c=function(){f.counter>0&&(f.counter=0,f.countDown=!1,f.countDownInterval&&(clearInterval(f.countDownInterval),f.countDownInterval=null,f.countDownNum=f.options.countDownDigits))},l=function(){var e=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,cv(n,f.faceDetector);case 2:t=e.sent,f.setDetections(f.getDetectionBias(t));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=function(){var e=f.getDetections();if(e){var t=lv(e,dh(o,n,!0));if(f.isFaceCentered(o,t)){var r=f.getFaceDepth(t);0===r?(u=Pv,c()):1===r?(u=Nv,c()):(f.counter<5&&(u=Ov,f.counter++),5!==f.counter||f.countDown||(f.countDown=!0,f.countDownNum=2,u="".concat(f.countDownNum),f.countDownInterval=setInterval((function(){f.countDownNum--,u="".concat(f.countDownNum),0===f.countDownNum&&(clearInterval(f.countDownInterval),f.completeCapture())}),1e3)))}else u="CENTER_FACE",c()}else u="HOLD_UPRIGHT",c();f.updateUI(a,u)},f.showTextHint(),f.updateUI(a,"LOADING_CAMERA"),e.next=14,f.prepareFaceCaptureAPI(l,10);case 14:f.clearDetections(),f.faceUpdateInterval=setInterval(l,s),f.faceProcessInterval=setInterval(p,i),f.removeLoadingIndicator();case 18:case"end":return e.stop()}}),e)})))),fv(this,"updateUI",(function(e,t){var n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),n.fillStyle="rgba(39,46,54,0.6)",n.fillRect(0,0,e.width,e.height);var r=Math.min(.33*e.height,470),o=Math.min(.4*e.width,.75*r),a={x:e.width/2,y:e.height/2};n.globalCompositeOperation="destination-out",n.fillStyle="rgb(255,255,255)",n.beginPath(),n.ellipse(a.x,a.y,o,r,0,0,2*Math.PI),n.fill(),n.globalCompositeOperation="source-over",n.strokeStyle=f.getCircleColor(t),n.lineWidth=17,n.beginPath(),n.ellipse(a.x,a.y,o-8.5,r-8.5,0,0,2*Math.PI),n.stroke(),f.textElement.innerHTML=f.faceCaptureText[t]||t})),fv(this,"isFaceCentered",(function(e,t){var n=e.width,r=e.height,o=t.box.topLeft.x+t.box.width/2,a=(t.box.topLeft.y+t.box.height/2)/f.options.scaledHeightOffset,i=n/2,s=r/2,u=Math.abs(i-o),c=Math.abs(s-a);return u<f.options.centerDeadzone&&c<f.options.centerDeadzone})),fv(this,"getFaceDepth",(function(e){var t=e.box,n=t.width*t.height/(f.options.resolution.width*f.options.resolution.height);return n>f.options.faceSize.max?0:n<f.options.faceSize.min?1:2})),fv(this,"getCircleColor",(function(e){switch(e){case Pv:case Nv:return"rgba(222,54,23,0.5)";case Ov:case"2":case"1":return"rgba(0,204,82,0.5)";default:return"rgba(255,255,255,0.5)"}})),fv(this,"showTextHint",(function(){return f.textElement.style.display="block"})),fv(this,"hideTextHint",(function(){return f.textElement.style.display="none"})),fv(this,"removeLoadingIndicator",(function(){var e=document.getElementById(f.options.containerId),t=document.getElementById(f.options.loadingElementId);e.removeChild(t)})),fv(this,"cleanup",(function(){clearInterval(f.countDownInterval),f.countDownInterval=null,clearTimeout(f.captureTimer),f.captureTimer=null,f.videoPlayer.removeEventListener("playing",f.processFace),clearInterval(f.faceProcessInterval),f.faceProcessInterval=null,clearInterval(f.faceUpdateInterval),f.faceUpdateInterval=null,f.hideTextHint()})),fv(this,"completeCapture",(function(){f.cleanup(),f.callback()})),fv(this,"captureFail",(function(){f.countDown?setTimeout(f.captureFail,1e3):(f.cleanup(),f.failCallback())})),this.callback=n,this.failCallback=o,this.videoPlayer=a,this.overlayCanvas=i,this.detectionCanvas=s,this.textElement=u,this.options=c,this.faceCaptureText=l,this.faceDetector=new Cd({inputSize:this.options.inputSize,scoreThreshold:this.options.scoreThreshold}),this.counter=0,this.countDown=!1,this.countDownInterval=null,this.countDownNum=this.options.countDownDigits,this.detections=null,this.lastDetection=null,this.detectionBias=0,this.faceProcessInterval=null,this.faceUpdateInterval=null,this.captureTimer=null,dh(this.detectionCanvas,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tv(Object(n),!0).forEach((function(t){fv(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tv(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.options.resolution)),this.beginProcessing()})),kv=4*Math.pow(1024,2),Fv={FAIL_TO_INITIALIZE:{code:1e3,type:"FAIL_TO_INITIALIZE"},IMAGE_SMALLER_THAN_MIN_SIZE:{code:1001,type:"IMAGE_SMALLER_THAN_MIN_SIZE"},CORRUPT_IMAGE:{code:1002,type:"CORRUPT_IMAGE"},FILE_TYPE_INVALID:{code:1003,type:"FILE_TYPE_INVALID"},PDF_FILE_SIZE_OVER_4_MB:{code:1004,type:"PDF_FILE_SIZE_OVER_4_MB"},AUTO_CAPTURE_NOT_SUPPORT:{code:1005,type:"AUTO_CAPTURE_NOT_SUPPORT"},FAIL_TO_AUTO_CAPTURE:{code:1006,type:"FAIL_TO_AUTO_CAPTURE"},FAIL_TO_MANUAL_CAPTURE:{code:1007,type:"FAIL_TO_MANUAL_CAPTURE"},MISSING_TOKEN:{code:1008,type:"MISSING_TOKEN"},INVALID_TOKEN:{code:1009,type:"INVALID_TOKEN"},NO_MORE_TOKEN_ATTEMPTS:{code:1010,type:"NO_MORE_TOKEN_ATTEMPTS"},INVALID_ORIGIN_URL:{code:1011,type:"INVALID_ORIGIN_URL"},MISSING_IMAGE:{code:1012,type:"MISSING_IMAGE"},FAIL_TO_GET_LIVENESS_DATA:{code:1013,type:"FAIL_TO_GET_LIVENESS_DATA"},FAIL_TO_GET_CLASSIFICATION_DATA:{code:1014,type:"FAIL_TO_GET_CLASSIFICATION_DATA"},FAIL_TO_CAPTURE:{code:1015,type:"FAIL_TO_CAPTURE",description:"Fail to capture image."},FAIL_TO_PROCESS:{code:1016,type:"FAIL_TO_PROCESS",description:"Fail to process captured image."},AUTO_CAPTURE_REPEAT_ERROR:{code:1017,type:"AUTO_CAPTURE_REPEAT_ERROR",description:"Auto capture has previously failed and was called again."},AUTO_CAPTURE_SEQUENCE_BREAK_ERROR:{code:1018,type:"AUTO_CAPTURE_SEQUENCE_BREAK_ERROR",description:"Camera capture failed due to unexpected sequence break."}};function Mv(e){var t=Object.entries(Fv).find((function(t){return e===t[1].code}));return t&&t.length>1?t[1]:null}var Lv,Uv,Bv,Gv,Wv=function(e,n,o,a){Hv||(Bv=o,Gv=a,$v?im():(Hv=!0,t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Vd.tinyFaceDetector.loadFromUri("/".concat(Vv,"/GlobalGatewayFaceCaptureSDK/models"));case 2:$v=!0,Hv=!1,im();case 5:case"end":return e.stop()}}),e)})))()),Lv=e,Uv=n)},Vv=window.GG_CAPTURE_FOLDER||"",$v=!1,Hv=!1,jv=null,zv=null,qv={x:0,y:0},Kv="face-capture-container",Xv="capture-loading-indicator",Yv={centerDeadzone:150,faceSize:{min:.2,max:.4},scaledHeightOffset:1.2,autoCaptureTime:2e4,scoreThreshold:.6,inputSize:512,maxDetectionBias:2,countDownDigits:2,fontStyle:"30px Roboto sans-serif",containerId:Kv,loadingElementId:Xv,resolution:{width:960,height:1280}},Zv=function(){return document.getElementById("video-canvas")},Qv=function(){return document.getElementById("overlay")},Jv=function(){return document.getElementById("face-capture-player")},em=function(){var e=document.getElementById(Kv);e&&e.remove()},tm=function(){em();var e=document.createElement("div");e.id=Kv,e.style.cssText="position: absolute; left: 0; top: 0; right: 0; bottom: 0; background-color: black;",e.innerHTML='<div style="display:flex;height:100%;"> <div style="margin:auto;width:100%;"> <div id="hintMessage-container" style="position: absolute; z-index: 20; left: 50%; top: 5vh;"> <p id="hintMessage" style="position: relative; left: -50%; font: 15px sans-serif; padding: 8px; background-color: rgba(255, 255, 255, 0.85); border-radius: 4px; display: none;"></p> </div><div> <canvas id="detection-canvas" style="display: none;" /> </div> <div> <canvas id="video-canvas" style="z-index: 10; -webkit-transform: scaleX(-1); transform: scaleX(-1); width: 100%; height: 100%;" /> </div> <div id="overlay-container" style="position: absolute; left: 0; top: 0;"> <canvas id="overlay" style="z-index: 15; width: 100%; height: 100%;" /> </div> </div> <video id="face-capture-player" style="display: block; position: absolute; z-index: -11; opacity: 0; height: 1%; width: 1%;" controls autoplay playsinline /> </div> ';var t=document.createElement("div");t.id=Xv,t.style.cssText="position: absolute; left: 0; top: 0; right: 0; bottom: 0; text-align: center; z-index: 11; background-color: black;",e.appendChild(t),document.body.appendChild(e)},nm=function(e,t){console.warn(e,t),Uv&&Uv([e])},rm=function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,t=Jv(),n=t.videoWidth*(.5*e),r=t.videoWidth-t.videoWidth*e,o=t.videoHeight*(.5*e),a=t.videoHeight-t.videoHeight*e,i=document.createElement("canvas");i.id="cropping-canvas",i.width=r-n,i.height=a-o,i.hidden=!0,document.body.appendChild(i),i.getContext("2d").drawImage(t,n,o,r,a,0,0,i.width,i.height);var s=i.toDataURL("image/jpeg");return document.body.removeChild(i),s}(.2);am(),Lv(e)},om=function(){am(),nm(Fv.FAIL_TO_AUTO_CAPTURE,new Error("Auto capture timed out."))},am=function(){zv&&(zv.pause(),zv.srcObject=null,zv=null),jv&&(jv.getTracks().forEach((function(e){e.stop()})),jv=null),em()},im=function(){var e=t(r().mark((function e(){var t,n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return tm(),zv=Jv(),t=Zv(),n=t.getContext("2d"),zv.addEventListener("play",(function(){um(this,n,zv.videoWidth,zv.videoHeight)}),!1),e.prev=5,e.next=8,navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:Yv.resolution.height},height:{ideal:Yv.resolution.width}},audio:!1}).then((function(e){jv=e,zv.srcObject=jv})).then((function(){return new Promise((function(e){return zv.onloadedmetadata=e}))}));case 8:sm(),cm(),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(5),am(),nm(Fv.FAIL_TO_CAPTURE,e.t0);case 16:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(){return e.apply(this,arguments)}}(),sm=function(){var e=Zv(),t=e.getContext("2d"),n=Qv(),r=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(jv.getTracks(),1)[0].getSettings(),a=r.width,i=r.height,s=window,u=s.innerWidth,c=s.innerHeight;if(e.width=u,e.height=c,n.width=2*u,n.height=2*c,i!==c&&a!==u){var l=c/i,f=u/a;t.scale(l,l);var p=zv.videoWidth*l/2,h=zv.videoHeight*l/2,d=u/2-p-(p-zv.videoWidth*f/2),v=c/2-h;qv.x=d,qv.y=v}window.scrollTo(0,0)},um=function e(t,n,r,o){if(t.paused||t.ended)return!1;n.drawImage(t,qv.x,qv.y,r,o),setTimeout(e,10,t,n,r,o)},cm=function(){var e;new Dv(rm,om,Jv(),Qv(),document.getElementById("detection-canvas"),document.getElementById("hintMessage"),Yv,{MOVE_FURTHER:(e=Sv(Bv,Gv).selfie).moveFurther,MOVE_CLOSER:e.moveCloser,HOLD_STILL:e.holdStill,CENTER_FACE:e.centerFace,HOLD_UPRIGHT:e.holdUpright,LOADING_CAMERA:e.loadingCamera})};function lm(e){return fm.apply(this,arguments)}function fm(){return fm=t(r().mark((function e(t){var n,o,a=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]&&a[1],o=a.length>2&&void 0!==a[2]?a[2]:null,e.abrupt("return",new Promise((function(e,r){var a=document.createElement("script");a.setAttribute("src",t),a.async=n,null!=o&&a.setAttribute("type",o),document.body.appendChild(a),a.addEventListener("load",(function(){return e()})),a.addEventListener("error",(function(e){return r(e.message)}))})));case 3:case"end":return e.stop()}}),e)}))),fm.apply(this,arguments)}function pm(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hm(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pm(Object(n),!0).forEach((function(t){fv(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pm(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var dm={"Content-Type":"application/json","Access-Control-Allow-Origin":"*"};function vm(e,t,n){return mm.apply(this,arguments)}function mm(){return(mm=t(r().mark((function e(t,n,o){var a,i,s,u,c;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}return e.abrupt("return",{liveness:null});case 2:return e.next=4,fetch("".concat(t,"/liveness-check"),{method:"POST",headers:hm(hm({},dm),{},{token:o}),body:JSON.stringify({image:n})});case 4:if(!(a=e.sent).ok){e.next=10;break}return e.next=8,a.json();case 8:return i=e.sent,e.abrupt("return",{liveness:i});case 10:if(s=Fv.FAIL_TO_GET_LIVENESS_DATA,400!==a.status&&401!==a.status){e.next=20;break}return e.next=14,a.json();case 14:if(!(u=e.sent)||!u.ErrorCode){e.next=19;break}if(!(c=Mv(u.ErrorCode))){e.next=19;break}return e.abrupt("return",{error:c});case 19:case 20:return e.abrupt("return",{error:s});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gm(e,t,n,r){return ym.apply(this,arguments)}function ym(){return ym=t(r().mark((function e(t,n,o,a){var i,s,u,c,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return",{classification:null});case 2:return e.next=4,fetch("".concat(t,"/classification"),{method:"POST",headers:hm(hm({},dm),{},{token:a}),body:JSON.stringify({isFrontImage:"DOCUMENT_BACK"!==o,image:n})});case 4:if(!(i=e.sent).ok){e.next=10;break}return e.next=8,i.json();case 8:return s=e.sent,e.abrupt("return",{classification:s});case 10:if(u=Fv.FAIL_TO_GET_CLASSIFICATION_DATA,400!==i.status&&401!==i.status){e.next=20;break}return e.next=14,i.json();case 14:if(!(c=e.sent)||!c.ErrorCode){e.next=19;break}if(!(l=Mv(c.ErrorCode))){e.next=19;break}return e.abrupt("return",{error:l});case 19:case 20:return e.abrupt("return",{error:u});case 21:case"end":return e.stop()}}),e)}))),ym.apply(this,arguments)}function bm(e){return xm.apply(this,arguments)}function xm(){return xm=t(r().mark((function e(t){var n,o,a,i,s,u,c,l,f,p,h,d,v,m,g,y,b,x,w,E,A,C,S;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.isAuto,o=t.retries,a=t.captureType,i=t.version,s=t.collectGeo,u=t.deviceType,c=t.additionalInfo,l="true"===s||!0===s,f=new Date,e.next=5,wm();case 5:if(p=e.sent,h=Am(),d=Cm(),v={V:"4.0.81",MODE:n?"AUTO":"MANUAL",RETRIES:o,SYSTEM:"WEB",CAPTURESDK:i,TRULIOOSDK:"DOCUMENT_FRONT"===a||"DOCUMENT_BACK"===a?"DOCUMENT":a,TIMESTAMP:f.toJSON(),IPADDRESS:p,DEVICETYPE:u,OPERATINGSYSTEM:d,BROWSER:h},m=c.qualityObject,g=c.liveness,y=c.classification,m&&(b=String(Math.floor(m.glare)),x=String(Math.floor(m.sharpness)),w=String(Math.floor(m.dpi)),E=String(Math.floor(m.dpi)),Object.assign(v,{AcuantGlareMetric:b,AcuantSharpnessMetric:x,AcuantVerticalResolution:w,AcuantHorizontalResolution:E})),g&&Object.assign(v,{Liveness:g}),y&&Object.assign(v,{IDClassification:y}),!l){e.next=18;break}return e.next=16,Sm();case 16:(A=e.sent)&&(C=A.coords.latitude,S=A.coords.longitude,Object.assign(v,{GPSLATITUDE:C,GPSLONGITUDE:S}));case 18:return e.abrupt("return",JSON.stringify(v));case 19:case"end":return e.stop()}}),e)}))),xm.apply(this,arguments)}function wm(){return Em.apply(this,arguments)}function Em(){return(Em=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="UNAVAILABLE",e.abrupt("return",new Promise((function(e){var n=new XMLHttpRequest;n.open("GET","https://api.globaldatacompany.com/common/v1/ip-info",!0),n.responseType="json",n.timeout=3e3,n.ontimeout=function(){e(t)},n.onload=function(){200===n.status&&n.response&&n.response.ipAddress?e(n.response.ipAddress):e(t)},n.onerror=function(){e(t)},n.send()})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Am(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE ".concat(e[1]||"")):"Chrome"===n[1]&&null!=(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}function Cm(){var e=window.navigator,t=e.userAgent,n=e.platform,r="Unknown";return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(n)?r="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(n)?r="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(n)?r="Windows":/Android/.test(t)?r="Android":!r&&/Linux/.test(n)&&(r="Linux"),r}function Sm(){return _m.apply(this,arguments)}function _m(){return(_m=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){navigator.geolocation.getCurrentPosition((function(t){e(t)}),(function(t){console.error(t),e(null)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Im=__webpack_require__(8),Rm=__webpack_require__.n(Im);function Tm(e,t,n){"jpeg"===e.substring("data:image/".length,e.indexOf(";base64")).toLowerCase()?function(e,t,n){try{var r={};r[Rm().ImageIFD.Software]=t;var o={"0th":r},a=Rm().dump(o);n(Rm().insert(a,e))}catch(t){n(e)}}(e,t,n):n(e)}var Pm=__webpack_require__(221),Nm={maxSizeMB:4,maxWidthOrHeight:4096,useWebWorker:!0};function Om(e){return Dm.apply(this,arguments)}function Dm(){return(Dm=t(r().mark((function e(t){var n,o,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(3*t.length/4/1024/1024<kv)){e.next=3;break}return e.abrupt("return",t);case 3:return n=window.GlobalGatewayImageCompressionOption||Nm,e.next=6,Pm.Z.getFilefromDataUrl(t,"temp");case 6:return o=e.sent,e.next=9,(0,Pm.Z)(o,n);case 9:return a=e.sent,e.abrupt("return",Pm.Z.getDataUrlFromFile(a));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function km(){var e=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"Tablet":/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?"Mobile":"Desktop"}var Fm,Mm="https://gg-ic-sdk-server-proxy.globalgateway.io",Lm="".concat(Mm,"/acuant-html"),Um="AcuantV11.6.3",Bm="capture-canvas-container",Gm=null,Wm=!1;function Vm(){var e=document.getElementById(Bm);e&&e.remove()}function $m(){return $m=t(r().mark((function e(t,n,o,a,i){var s,u,c,l,f,p,h,d=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=d.length>5&&void 0!==d[5]?d[5]:0,!(n&&n.image&&n.image.data)){e.next=30;break}return e.prev=2,u=n.image.data,e.next=6,Om(u);case 6:if(c=e.sent,l={glare:n.glare,dpi:n.dpi,sharpness:n.sharpness},f={},null==Gm||"DOCUMENT_BACK"===Gm||"BARCODE"===Gm){e.next=13;break}return e.next=12,gm(Mm,c,Gm,i);case 12:f=e.sent;case 13:if(!("error"in f)){e.next=16;break}return a([f.error]),e.abrupt("return");case 16:return p=f.classification,e.next=19,bm({isAuto:t,retries:s,captureType:Gm,version:Um,collectGeo:Wm,deviceType:km(),additionalInfo:{qualityObject:l,classification:p}});case 19:h=e.sent,Tm(c,h,(function(e){return o({image:e,quality:l,classification:p})})),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(2),a([Fv.FAIL_TO_PROCESS]),console.error("[processCrop error]",e.t0);case 28:e.next=31;break;case 30:a([Fv.FAIL_TO_PROCESS]);case 31:case"end":return e.stop()}}),e,null,[[2,24]])}))),$m.apply(this,arguments)}function Hm(e){return function(t,n,r,o,a,i,s,u,c){Gm=e,Wm=n,function(e,t,n,r,o,a,i,s){try{var u={onCaptured:function(){Vm(),t()},onCropped:function(t){!function(e,t,n,r,o){$m.apply(this,arguments)}(e,t,n,r,o,s)},onFrameAvailable:function(){}},c={text:_v(a,i)};e?AcuantCamera.isCameraSupported&&!AcuantCamera.isIOSWebview?(function(){Vm();var e=document.createElement("div");e.id=Bm,e.style.cssText="position:absolute;left:0;top:0;right:0;bottom:0;background-color:black;",e.innerHTML='\n        <div id="camera" style="display:flex;height:100%;">\n          <div style="margin:auto;">\n              <div id="acuant-camera"></div>\n          </div>\n        </div>\n      ',document.body.appendChild(e)}(),AcuantCameraUI.start(u,(function(e,t){switch(Vm(),t){case AcuantJavascriptWebSdk.REPEAT_FAIL_CODE:r([Fv.AUTO_CAPTURE_REPEAT_ERROR]);break;case AcuantJavascriptWebSdk.SEQUENCE_BREAK_CODE:r([Fv.AUTO_CAPTURE_SEQUENCE_BREAK_ERROR]);break;default:r([Fv.FAIL_TO_AUTO_CAPTURE])}console.error("[startAcuantCamera auto capture failed]",JSON.stringify({code:t,error:e}))}),c)):r([Fv.AUTO_CAPTURE_NOT_SUPPORT]):AcuantCamera.startManualCapture(u)}catch(e){r([Fv.FAIL_TO_CAPTURE]),console.error("[startAcuantCamera error]",e)}}(t,r,o,a,i,s,u,c)}}lm("".concat(Fm="/GlobalGatewayImageCaptureSDK/","AcuantJavascriptWebSdk.min.js")).then((function(){return loadAcuantSdk()}),(function(e){return console.error("[Mount SDK error]",e)})),lm("".concat(Fm,"AcuantCamera.min.js"),!0),lm("".concat(Fm,"AcuantPassiveLiveness.min.js"),!0),window.acuantConfig={path:Fm};var jm=Nm,zm=Hm("DOCUMENT_FRONT"),qm=Hm("DOCUMENT_BACK"),Km=Hm("BARCODE"),Xm=Hm("PASSPORT"),Ym=function(e,n,o,a,i,s,u,c,l){Gm="SELFIE",Wm=n;try{var f=e,p=function(){var e=t(r().mark((function e(t){var n,u,c,p,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o(),n=f?t:"data:image/jpeg;base64,".concat(t),e.next=4,Om(n);case 4:return u=e.sent,e.next=7,vm(Mm,u,s);case 7:if(!("error"in(c=e.sent))){e.next=11;break}return i([c.error]),e.abrupt("return");case 11:return p=c.liveness,e.next=14,bm({isAuto:f,retries:l,captureType:Gm,version:"00000.00000.00000",deviceType:km(),collectGeo:Wm,additionalInfo:{liveness:p}});case 14:h=e.sent,Tm(u,h,(function(e){a({image:e,liveness:p})}));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();f?Wv(p,i,u,c):AcuantPassiveLiveness.startSelfieCapture(p)}catch(e){i([Fv.FAIL_TO_AUTO_CAPTURE]),console.error("[startSelfieCapture error]",e)}},Zm=function(e,t,n,r){AcuantJavascriptWebSdk.setUnexpectedErrorCallback((function(e){console.error("[AcuantJavascriptWebSdk] unexpected error callback:",e)}));var o=btoa("".concat(e,":").concat(t)),a={onSuccess:function(){!function(){var e=navigator.userAgent,t="iPhone OS",n=e.indexOf(t);if(n<0&&(t="iPad; CPU OS",n=e.indexOf(t)),n<0)return!1;var r=e.substring(n+t.length+1,n+t.length+3);try{var o=parseInt(r,10);return o&&o<13}catch(e){return!1}}()?AcuantJavascriptWebSdk.startWorkers(n):AcuantJavascriptWebSdk.startWorkers(n,[AcuantJavascriptWebSdk.ACUANT_IMAGE_WORKER])},onFail:function(e,t){r([Fv.FAIL_TO_INITIALIZE]),console.error("[SDK initialize failed]",JSON.stringify({code:e,description:t}))}};AcuantJavascriptWebSdk.initialize(o,Lm,a)},Qm=function(){AcuantJavascriptWebSdk.endWorkers()}}(),__webpack_exports__}()}));